//
// THIS FILE IS AUTOMATICALLY GENERATED!!
//
// Generated at Fri 10-Jan-97 by the VDM-SLtoC++ Code Generator
// (vdmde - v3.0l - Fri 10-Jan-97)
//
// Supported compiler: g++ version 2.7.2
//



#include "DEF.h"

#define vdm_DEF_MkEmptyBlkEnv vdm_AUX_MkEmptyBlkEnv
#define vdm_DEF_OldNameInExpr vdm_OLD_OldNameInExpr

static Map vdm_DEF_CreateExplOpFns(Record, Record, Generic);
static Sequence vdm_DEF_CreateExplOperationPostParms(Sequence, Sequence, Generic);
static Map vdm_DEF_CreateExplPolyPrePostFns(Record, Record);
static Sequence vdm_DEF_CreateExtExplOperationPostParms(Sequence, Sequence, Generic);
static Record vdm_DEF_CreateFunctionPostType(Sequence, Sequence);
static Map vdm_DEF_CreateImplOpFns(Record, Record, Generic);
static Sequence vdm_DEF_CreateImplOperationPostParms(Sequence, Sequence, Generic);
static Map vdm_DEF_CreateImplPolyPrePostFns(Record, Record);
static Record vdm_DEF_CreateOperationPostType(Sequence, Sequence, Generic);
static Sequence vdm_DEF_CreateOperationPreParms(Sequence, Generic);
static Record vdm_DEF_CreateOperationPreType(Sequence, Generic);
static Sequence vdm_DEF_CreatePostParms(Sequence);
static Record vdm_DEF_CreateSigmaPattern(Record, Bool);
static Map vdm_DEF_CreateStateInvAndInit(Record, Record);
static Map vdm_DEF_DoCreateExplOpFns(Record, Record, Generic);
static Map vdm_DEF_DoCreateExplPolyPrePostFns(Record, Record);
static Map vdm_DEF_DoCreateExplPrePostFns(Record, Record);
static Map vdm_DEF_DoCreateExtExplOpFns(Record, Record, Generic);
static Map vdm_DEF_DoCreateExtExplPolyPrePostFns(Record, Record);
static Map vdm_DEF_DoCreateExtExplPrePostFns(Record, Record);
static Tuple vdm_DEF_ImplicitResNameTypes(Sequence);
static Generic vdm_DEF_ImplicitResType(Sequence);
static Tuple vdm_DEF_ImplicitTypeParams(Sequence);
static Tuple vdm_DEF_TCompT(Sequence);
static Map vdm_DEF_TransTpMap(Map);

void init_DEF() {}

Sequence vdm_DEF_CreatePostParms(Sequence vdm_DEF_resnms) {
  Sequence varRes_3;
{ if (((Bool) ((Int) (vdm_DEF_resnms.Length()) == (Int) 1)).GetValue()) {
   Record tmpVar_30(vdm_AS_PatternName, length_AS_PatternName);
   tmpVar_30 = Record(vdm_AS_PatternName, length_AS_PatternName);
   tmpVar_30.SetField(1, (Record) (vdm_DEF_resnms.Hd()));
   tmpVar_30.SetField(2, Nil());
   varRes_3 = Sequence().ImpAppend(tmpVar_30);
 }
 else {
   Sequence vdm_DEF_pl;
   {
     Sequence res_l_10;
     Record reselem_11(vdm_AS_PatternName, length_AS_PatternName);
     Set resBind_s_13;
     {
       Set riseq_18;
       int max_19 = (Int) (vdm_DEF_resnms.Length());
       for (int i_20 = 1; i_20 <= max_19; i_20++) 
         riseq_18.Insert((Int) i_20);
       resBind_s_13 = riseq_18;
     }
     Sequence bind_l_12;
     if ((Int) (resBind_s_13.Card()) != (Int) 0) 
       bind_l_12 = Sort(resBind_s_13);
     bool succ_14 = true;
     Int vdm_DEF_i;
     Generic tmpe_26;
     for (int i_25 = bind_l_12.First(tmpe_26); i_25; i_25 = bind_l_12.Next(tmpe_26)) {
       Int e_16 = tmpe_26;
       {
         vdm_DEF_i = e_16;
         succ_14 = true;
         if (succ_14) {
           reselem_11 = Record(vdm_AS_PatternName, length_AS_PatternName);
           Record tmpVar_21(vdm_AS_Name, length_AS_Name);
           {
             Sequence tmpseq_22;
             tmpseq_22 = vdm_DEF_resnms;
             tmpVar_21 = (Record) (tmpseq_22[vdm_DEF_i.GetValue()]);
           }
           reselem_11.SetField(1, tmpVar_21);
           reselem_11.SetField(2, Nil());
           res_l_10.ImpAppend(reselem_11);
         }
       }
     }
     vdm_DEF_pl = res_l_10;
   }
   {
     Record tmpVar_27(vdm_AS_TuplePattern, length_AS_TuplePattern);
     tmpVar_27 = Record(vdm_AS_TuplePattern, length_AS_TuplePattern);
     tmpVar_27.SetField(1, vdm_DEF_pl);
     tmpVar_27.SetField(2, Nil());
     varRes_3 = Sequence().ImpAppend(tmpVar_27);
   }
 } }
  return varRes_3;
}

Map vdm_DEF_CreateExplOpFns(Record vdm_DEF_mod__id, Record vdm_DEF_opdef, Generic vdm_DEF_gst) {
  Bool cond_5;
  {
    Record argTmp_6;
    argTmp_6 = vdm_DEF_opdef;
    if (argTmp_6.IsRecord()) 
      cond_5 = vdm_AS_ExplOpDef == argTmp_6.GetTag();
    else 
      cond_5 = false;
  }
  if (cond_5.GetValue()) {
    Record tmpVar_10(vdm_AS_Name, length_AS_Name);
    tmpVar_10 = vdm_DEF_mod__id;
    Record tmpVar_11;
    tmpVar_11 = vdm_DEF_opdef;
    Generic tmpVar_12;
    tmpVar_12 = vdm_DEF_gst;
    return vdm_DEF_DoCreateExplOpFns(tmpVar_10, tmpVar_11, tmpVar_12);
  }
  else {
    Record tmpVar_7(vdm_AS_Name, length_AS_Name);
    tmpVar_7 = vdm_DEF_mod__id;
    Record tmpVar_8;
    tmpVar_8 = vdm_DEF_opdef;
    Generic tmpVar_9;
    tmpVar_9 = vdm_DEF_gst;
    return vdm_DEF_DoCreateExtExplOpFns(tmpVar_7, tmpVar_8, tmpVar_9);
  }
}

Sequence vdm_DEF_CreateExplOperationPostParms(Sequence vdm_DEF_parm, Sequence vdm_DEF_resnmtps, Generic vdm_DEF_gst) {
  Sequence vdm_DEF_res__parm;
  Bool cond_7;
  {
    Sequence var2_9;
    var2_9 = Sequence();
    cond_7 = (Bool) (vdm_DEF_resnmtps == var2_9);
  }
  if (cond_7.GetValue()) 
    vdm_DEF_res__parm = Sequence();
  else {
    Record tmpVar_10(vdm_AS_PatternName, length_AS_PatternName);
    tmpVar_10 = Record(vdm_AS_PatternName, length_AS_PatternName);
    Record tmpVar_11(vdm_AS_Name, length_AS_Name);
    {
      tmpVar_11 = Record(vdm_AS_Name, length_AS_Name);
      Sequence tmpVar_12;
      tmpVar_12 = Sequence().ImpAppend(Sequence("RESULT"));
      tmpVar_11.SetField(1, tmpVar_12);
      tmpVar_11.SetField(2, Nil());
    }
    tmpVar_10.SetField(1, tmpVar_11);
    tmpVar_10.SetField(2, Nil());
    vdm_DEF_res__parm = Sequence().ImpAppend(tmpVar_10);
  }
  {
    Bool cond_16;
    cond_16 = (Bool) (vdm_DEF_gst == Nil());
    if (cond_16.GetValue()) {
      Sequence rexpr_36;
      {
        Sequence tmpVar_37;
        tmpVar_37.ImpConc(vdm_DEF_parm).ImpConc(vdm_DEF_res__parm);
        rexpr_36 = Sequence().ImpAppend(tmpVar_37);
      }
      return rexpr_36;
    }
    else {
      Record vdm_DEF_sigma__old(vdm_AS_RecordPattern, length_AS_RecordPattern);
      Record tmpVar_21(vdm_AS_CompositeType, length_AS_CompositeType);
      {
        Generic tmpRec_22;
        tmpRec_22 = vdm_DEF_gst;
        if (tmpRec_22.IsRecord()) 
          if (((Record) tmpRec_22).Is(vdm_AS_StateDef)) 
            tmpVar_21 = ((Record) tmpRec_22).GetField(pos_AS_StateDef_tp);
          else 
            RunTime("Unknown record field selector");
        else 
          RunTime("A record was expected");
      }
      vdm_DEF_sigma__old = vdm_DEF_CreateSigmaPattern(tmpVar_21, (Bool) true);
      Record vdm_DEF_sigma__res(vdm_AS_RecordPattern, length_AS_RecordPattern);
      Record tmpVar_25(vdm_AS_CompositeType, length_AS_CompositeType);
      {
        Generic tmpRec_26;
        tmpRec_26 = vdm_DEF_gst;
        if (tmpRec_26.IsRecord()) 
          if (((Record) tmpRec_26).Is(vdm_AS_StateDef)) 
            tmpVar_25 = ((Record) tmpRec_26).GetField(pos_AS_StateDef_tp);
          else 
            RunTime("Unknown record field selector");
        else 
          RunTime("A record was expected");
      }
      vdm_DEF_sigma__res = vdm_DEF_CreateSigmaPattern(tmpVar_25, (Bool) false);
      {
        Sequence rexpr_28;
        {
          Sequence tmpVar_29;
          Sequence var1_30;
          var1_30.ImpConc(vdm_DEF_parm).ImpConc(vdm_DEF_res__parm);
          Sequence var2_31;
          var2_31 = Sequence().ImpAppend(vdm_DEF_sigma__old);
          var2_31.ImpAppend(vdm_DEF_sigma__res);
          tmpVar_29.ImpConc(var1_30).ImpConc(var2_31);
          rexpr_28 = Sequence().ImpAppend(tmpVar_29);
        }
        return rexpr_28;
      }
    }
  }
}

Map vdm_DEF_CreateExplPolyPrePostFns(Record vdm_DEF_mod__id, Record vdm_DEF_fndef) {
  Bool cond_4;
  {
    Record argTmp_5;
    argTmp_5 = vdm_DEF_fndef;
    if (argTmp_5.IsRecord()) 
      cond_4 = vdm_AS_ExplFnDef == argTmp_5.GetTag();
    else 
      cond_4 = false;
  }
  if (cond_4.GetValue()) {
    Record tmpVar_8(vdm_AS_Name, length_AS_Name);
    tmpVar_8 = vdm_DEF_mod__id;
    Record tmpVar_9;
    tmpVar_9 = vdm_DEF_fndef;
    return vdm_DEF_DoCreateExplPolyPrePostFns(tmpVar_8, tmpVar_9);
  }
  else {
    Record tmpVar_6(vdm_AS_Name, length_AS_Name);
    tmpVar_6 = vdm_DEF_mod__id;
    Record tmpVar_7;
    tmpVar_7 = vdm_DEF_fndef;
    return vdm_DEF_DoCreateExtExplPolyPrePostFns(tmpVar_6, tmpVar_7);
  }
}

Map vdm_DEF_CreateExplPrePostFns(Record vdm_DEF_mod__id, Record vdm_DEF_fndef) {
  Bool cond_4;
  {
    Record argTmp_5;
    argTmp_5 = vdm_DEF_fndef;
    if (argTmp_5.IsRecord()) 
      cond_4 = vdm_AS_ExplFnDef == argTmp_5.GetTag();
    else 
      cond_4 = false;
  }
  if (cond_4.GetValue()) {
    Record tmpVar_8(vdm_AS_Name, length_AS_Name);
    tmpVar_8 = vdm_DEF_mod__id;
    Record tmpVar_9;
    tmpVar_9 = vdm_DEF_fndef;
    return vdm_DEF_DoCreateExplPrePostFns(tmpVar_8, tmpVar_9);
  }
  else {
    Record tmpVar_6(vdm_AS_Name, length_AS_Name);
    tmpVar_6 = vdm_DEF_mod__id;
    Record tmpVar_7;
    tmpVar_7 = vdm_DEF_fndef;
    return vdm_DEF_DoCreateExtExplPrePostFns(tmpVar_6, tmpVar_7);
  }
}

Sequence vdm_DEF_CreateExtExplOperationPostParms(Sequence vdm_DEF_parm, Sequence vdm_DEF_resnms, Generic vdm_DEF_gst) {
  Sequence vdm_DEF_res__parm;
  vdm_DEF_res__parm = vdm_DEF_CreatePostParms(vdm_DEF_resnms);
  {
    Bool cond_8;
    cond_8 = (Bool) (vdm_DEF_gst == Nil());
    if (cond_8.GetValue()) {
      Sequence rexpr_28;
      {
        Sequence tmpVar_29;
        tmpVar_29.ImpConc(vdm_DEF_parm).ImpConc(vdm_DEF_res__parm);
        rexpr_28 = Sequence().ImpAppend(tmpVar_29);
      }
      return rexpr_28;
    }
    else {
      Record vdm_DEF_sigma__old(vdm_AS_RecordPattern, length_AS_RecordPattern);
      Record tmpVar_13(vdm_AS_CompositeType, length_AS_CompositeType);
      {
        Generic tmpRec_14;
        tmpRec_14 = vdm_DEF_gst;
        if (tmpRec_14.IsRecord()) 
          if (((Record) tmpRec_14).Is(vdm_AS_StateDef)) 
            tmpVar_13 = ((Record) tmpRec_14).GetField(pos_AS_StateDef_tp);
          else 
            RunTime("Unknown record field selector");
        else 
          RunTime("A record was expected");
      }
      vdm_DEF_sigma__old = vdm_DEF_CreateSigmaPattern(tmpVar_13, (Bool) true);
      Record vdm_DEF_sigma__res(vdm_AS_RecordPattern, length_AS_RecordPattern);
      Record tmpVar_17(vdm_AS_CompositeType, length_AS_CompositeType);
      {
        Generic tmpRec_18;
        tmpRec_18 = vdm_DEF_gst;
        if (tmpRec_18.IsRecord()) 
          if (((Record) tmpRec_18).Is(vdm_AS_StateDef)) 
            tmpVar_17 = ((Record) tmpRec_18).GetField(pos_AS_StateDef_tp);
          else 
            RunTime("Unknown record field selector");
        else 
          RunTime("A record was expected");
      }
      vdm_DEF_sigma__res = vdm_DEF_CreateSigmaPattern(tmpVar_17, (Bool) false);
      {
        Sequence rexpr_20;
        {
          Sequence tmpVar_21;
          Sequence var1_22;
          var1_22.ImpConc(vdm_DEF_parm).ImpConc(vdm_DEF_res__parm);
          Sequence var2_23;
          var2_23 = Sequence().ImpAppend(vdm_DEF_sigma__old);
          var2_23.ImpAppend(vdm_DEF_sigma__res);
          tmpVar_21.ImpConc(var1_22).ImpConc(var2_23);
          rexpr_20 = Sequence().ImpAppend(tmpVar_21);
        }
        return rexpr_20;
      }
    }
  }
}

Record vdm_DEF_CreateFunctionPostType(Sequence vdm_DEF_tpdom, Sequence vdm_DEF_tprng) {
  Record rexpr_4(vdm_AS_TotalFnType, length_AS_TotalFnType);
  {
    rexpr_4 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
    Sequence tmpVar_5;
{ tmpVar_5.ImpConc(vdm_DEF_tpdom).ImpConc(vdm_DEF_tprng); }
    rexpr_4.SetField(1, tmpVar_5);
    Record tmpVar_8(vdm_AS_BasicType, length_AS_BasicType);
    {
      tmpVar_8 = Record(vdm_AS_BasicType, length_AS_BasicType);
      tmpVar_8.SetField(1, (Quote) "BOOLEAN");
    }
    rexpr_4.SetField(2, tmpVar_8);
  }
  return rexpr_4;
}

Map vdm_DEF_CreateImplOpFns(Record var_1_1, Record var_2_2, Generic var_3_3) {
  Record vdm_DEF_Post__e;
  Generic vdm_DEF_Pre__e;
  Generic vdm_DEF_gst;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Record vdm_DEF_name(vdm_AS_Name, length_AS_Name);
  Sequence vdm_DEF_partps;
  Sequence vdm_DEF_resnmtps;
  bool succ_4 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_4 = true;
  }
  {
    succ_4 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_ImplOpDef == var_2_2.GetTag()) {
        Sequence e_l_5;
        for (int i_6 = 1; i_6 <= var_2_2.Length(); i_6++) 
          e_l_5.ImpAppend(var_2_2.GetField(i_6));
        if (succ_4 = 7 == (Int) (e_l_5.Length())) {
          Generic permI_7;
          permI_7 = (Generic) (e_l_5.Hd());
          succ_4 = true;
          {
            vdm_DEF_name = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[2]);
          if (succ_4) {
            vdm_DEF_partps = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[3]);
          if (succ_4) {
            vdm_DEF_resnmtps = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[4]);
          if (succ_4) 
            succ_4 = true;
          permI_7 = (Generic) (e_l_5[5]);
          if (succ_4) {
            vdm_DEF_Pre__e = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[6]);
          if (succ_4) {
            vdm_DEF_Post__e = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[7]);
          if (succ_4) 
            succ_4 = true;
        }
      }
  }
  {
    vdm_DEF_gst = var_3_3;
    succ_4 = true;
  }
  if (succ_4) {
    bool succ_8;
    Tuple tmpVal_9(2);
    tmpVal_9 = vdm_DEF_ImplicitTypeParams(vdm_DEF_partps);
    Sequence vdm_DEF_fn__parm;
    Sequence vdm_DEF_fn__tp;
    succ_8 = true;
    {
      succ_8 = false;
      if (tmpVal_9.IsTuple()) {
        Sequence e_l_11;
        for (int i_12 = 1; i_12 <= ((Tuple) tmpVal_9).Length(); i_12++) 
          e_l_11.ImpAppend(((Tuple) tmpVal_9).GetField(i_12));
        if (succ_8 = 2 == (Int) (e_l_11.Length())) {
          Sequence permI_13;
          permI_13 = (Sequence) (e_l_11.Hd());
          succ_8 = true;
          {
            vdm_DEF_fn__tp = permI_13;
            succ_8 = true;
          }
          permI_13 = (Sequence) (e_l_11[2]);
          if (succ_8) {
            vdm_DEF_fn__parm = permI_13;
            succ_8 = true;
          }
        }
      }
    }
    if (!succ_8) 
      RunTime("Pattern match did not succeed in value definition");
    Tuple tmpVal_14(2);
    tmpVal_14 = vdm_DEF_ImplicitResNameTypes(vdm_DEF_resnmtps);
    Sequence vdm_DEF_res__nms;
    Sequence vdm_DEF_res__tps;
    succ_8 = true;
    {
      succ_8 = false;
      if (tmpVal_14.IsTuple()) {
        Sequence e_l_16;
        for (int i_17 = 1; i_17 <= ((Tuple) tmpVal_14).Length(); i_17++) 
          e_l_16.ImpAppend(((Tuple) tmpVal_14).GetField(i_17));
        if (succ_8 = 2 == (Int) (e_l_16.Length())) {
          Sequence permI_18;
          permI_18 = (Sequence) (e_l_16.Hd());
          succ_8 = true;
          {
            vdm_DEF_res__nms = permI_18;
            succ_8 = true;
          }
          permI_18 = (Sequence) (e_l_16[2]);
          if (succ_8) {
            vdm_DEF_res__tps = permI_18;
            succ_8 = true;
          }
        }
      }
    }
    if (!succ_8) 
      RunTime("Pattern match did not succeed in value definition");
    Generic vdm_DEF_st__id;
    if (((Bool) (vdm_DEF_gst == Nil())).GetValue()) 
      vdm_DEF_st__id = Nil();
    else {
      Record tmpRec_23(vdm_AS_CompositeType, length_AS_CompositeType);
      {
        Generic tmpRec_24;
        tmpRec_24 = vdm_DEF_gst;
        if (tmpRec_24.IsRecord()) 
          if (((Record) tmpRec_24).Is(vdm_AS_StateDef)) 
            tmpRec_23 = ((Record) tmpRec_24).GetField(pos_AS_StateDef_tp);
          else 
            RunTime("Unknown record field selector");
        else 
          RunTime("A record was expected");
      }
      if (tmpRec_23.Is(vdm_AS_CompositeType)) 
        vdm_DEF_st__id = tmpRec_23.GetField(pos_AS_CompositeType_name);
      else 
        RunTime("Unknown record field selector");
    }
    {
      Map vdm_DEF_res__m;
      vdm_DEF_res__m = Map();
      {
        Bool cond_25;
        cond_25 = (Bool) (vdm_DEF_Pre__e == Nil());
        if (cond_25.GetValue()) 
          ;
        else {
          bool succ_28;
          Record tmpVal_29(vdm_AS_Name, length_AS_Name);
          tmpVal_29 = vdm_DEF_name;
          Sequence vdm_DEF_id__l;
          succ_28 = true;
          {
            succ_28 = false;
            if (tmpVal_29.IsRecord()) 
              if (vdm_AS_Name == tmpVal_29.GetTag()) {
                Sequence e_l_30;
                for (int i_31 = 1; i_31 <= tmpVal_29.Length(); i_31++) 
                  e_l_30.ImpAppend(tmpVal_29.GetField(i_31));
                if (succ_28 = 2 == (Int) (e_l_30.Length())) {
                  Generic permI_32;
                  permI_32 = (Generic) (e_l_30.Hd());
                  succ_28 = true;
                  {
                    vdm_DEF_id__l = permI_32;
                    succ_28 = true;
                  }
                  permI_32 = (Generic) (e_l_30[2]);
                  if (succ_28) 
                    succ_28 = true;
                }
              }
          }
          if (!succ_28) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Record vdm_DEF_nm__pre(vdm_AS_Name, length_AS_Name);
            vdm_DEF_nm__pre = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_35;
            {
              Sequence tmpVar_36;
              Sequence var2_38;
              Sequence tmpseq_39;
              tmpseq_39 = vdm_DEF_id__l;
              var2_38 = (Sequence) (tmpseq_39[((Int) 1).GetValue()]);
              tmpVar_36.ImpConc(Sequence("pre_")).ImpConc(var2_38);
              tmpVar_35 = Sequence().ImpAppend(tmpVar_36);
            }
            vdm_DEF_nm__pre.SetField(1, tmpVar_35);
            vdm_DEF_nm__pre.SetField(2, Nil());
            {
              Record vdm_DEF_fn__pre(vdm_SEM_ExplFN, length_SEM_ExplFN);
              vdm_DEF_fn__pre = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
              vdm_DEF_fn__pre.SetField(1, vdm_DEF_CreateOperationPreType(vdm_DEF_fn__tp, vdm_DEF_st__id));
              vdm_DEF_fn__pre.SetField(2, vdm_DEF_CreateOperationPreParms(vdm_DEF_fn__parm, vdm_DEF_gst));
              vdm_DEF_fn__pre.SetField(3, vdm_DEF_Pre__e);
              vdm_DEF_fn__pre.SetField(4, Nil());
              vdm_DEF_fn__pre.SetField(5, Nil());
              vdm_DEF_fn__pre.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
              Map tmpVar_55;
              tmpVar_55 = Map();
              vdm_DEF_fn__pre.SetField(7, tmpVar_55);
              vdm_DEF_fn__pre.SetField(8, vdm_DEF_nm__pre);
              vdm_DEF_fn__pre.SetField(9, vdm_DEF_mod__id);
              vdm_DEF_fn__pre.SetField(10, Nil());
              {
                Map rhs_59;
                {
                  Map seqmap_60;
                  seqmap_60 = vdm_DEF_res__m;
                  Map modmap_61;
                  modmap_61 = Map().Insert(vdm_DEF_nm__pre, vdm_DEF_fn__pre);
                  seqmap_60.ImpOverride(modmap_61);
                  rhs_59 = seqmap_60;
                }
                vdm_DEF_res__m = rhs_59;
              }
            }
          }
        }
      }
      {
        bool succ_65;
        Record tmpVal_66(vdm_AS_Name, length_AS_Name);
        tmpVal_66 = vdm_DEF_name;
        Sequence vdm_DEF_id__l;
        succ_65 = true;
        {
          succ_65 = false;
          if (tmpVal_66.IsRecord()) 
            if (vdm_AS_Name == tmpVal_66.GetTag()) {
              Sequence e_l_67;
              for (int i_68 = 1; i_68 <= tmpVal_66.Length(); i_68++) 
                e_l_67.ImpAppend(tmpVal_66.GetField(i_68));
              if (succ_65 = 2 == (Int) (e_l_67.Length())) {
                Generic permI_69;
                permI_69 = (Generic) (e_l_67.Hd());
                succ_65 = true;
                {
                  vdm_DEF_id__l = permI_69;
                  succ_65 = true;
                }
                permI_69 = (Generic) (e_l_67[2]);
                if (succ_65) 
                  succ_65 = true;
              }
            }
        }
        if (!succ_65) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Record vdm_DEF_nm__post(vdm_AS_Name, length_AS_Name);
          vdm_DEF_nm__post = Record(vdm_AS_Name, length_AS_Name);
          Sequence tmpVar_72;
          {
            Sequence tmpVar_73;
            Sequence var2_75;
            Sequence tmpseq_76;
            tmpseq_76 = vdm_DEF_id__l;
            var2_75 = (Sequence) (tmpseq_76[((Int) 1).GetValue()]);
            tmpVar_73.ImpConc(Sequence("post_")).ImpConc(var2_75);
            tmpVar_72 = Sequence().ImpAppend(tmpVar_73);
          }
          vdm_DEF_nm__post.SetField(1, tmpVar_72);
          vdm_DEF_nm__post.SetField(2, Nil());
          Record vdm_DEF_tp__post;
          vdm_DEF_tp__post = vdm_DEF_CreateOperationPostType(vdm_DEF_fn__tp, vdm_DEF_res__tps, vdm_DEF_st__id);
          Record vdm_DEF_expr__post;
          if (((Bool) (vdm_DEF_gst == Nil())).GetValue()) 
            vdm_DEF_expr__post = vdm_DEF_Post__e;
          else { vdm_DEF_expr__post = vdm_DEF_OldNameInExpr(vdm_DEF_Post__e); }
          Sequence vdm_DEF_parm__post;
          vdm_DEF_parm__post = vdm_DEF_CreateImplOperationPostParms(vdm_DEF_fn__parm, vdm_DEF_res__nms, vdm_DEF_gst);
          {
            Record vdm_DEF_fn__post(vdm_SEM_ExplFN, length_SEM_ExplFN);
            vdm_DEF_fn__post = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
            vdm_DEF_fn__post.SetField(1, vdm_DEF_tp__post);
            vdm_DEF_fn__post.SetField(2, vdm_DEF_parm__post);
            vdm_DEF_fn__post.SetField(3, vdm_DEF_expr__post);
            vdm_DEF_fn__post.SetField(4, Nil());
            vdm_DEF_fn__post.SetField(5, Nil());
            vdm_DEF_fn__post.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
            Map tmpVar_101;
            tmpVar_101 = Map();
            vdm_DEF_fn__post.SetField(7, tmpVar_101);
            vdm_DEF_fn__post.SetField(8, vdm_DEF_nm__post);
            vdm_DEF_fn__post.SetField(9, vdm_DEF_mod__id);
            vdm_DEF_fn__post.SetField(10, Nil());
            {
              Map rhs_105;
              {
                Map seqmap_106;
                seqmap_106 = vdm_DEF_res__m;
                Map modmap_107;
                modmap_107 = Map().Insert(vdm_DEF_nm__post, vdm_DEF_fn__post);
                seqmap_106.ImpOverride(modmap_107);
                rhs_105 = seqmap_106;
              }
              vdm_DEF_res__m = rhs_105;
            }
          }
        }
      }
      {
        Map rexpr_111;
        rexpr_111 = vdm_DEF_res__m;
        return rexpr_111;
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: CreateImplOpFns");
}

Sequence vdm_DEF_CreateImplOperationPostParms(Sequence vdm_DEF_parm, Sequence vdm_DEF_resnms, Generic vdm_DEF_gst) {
  Sequence vdm_DEF_res__parm;
  vdm_DEF_res__parm = vdm_DEF_CreatePostParms(vdm_DEF_resnms);
  {
    Bool cond_8;
    cond_8 = (Bool) (vdm_DEF_gst == Nil());
    if (cond_8.GetValue()) {
      Sequence rexpr_28;
      {
        Sequence tmpVar_29;
        tmpVar_29.ImpConc(vdm_DEF_parm).ImpConc(vdm_DEF_res__parm);
        rexpr_28 = Sequence().ImpAppend(tmpVar_29);
      }
      return rexpr_28;
    }
    else {
      Record vdm_DEF_sigma__old(vdm_AS_RecordPattern, length_AS_RecordPattern);
      Record tmpVar_13(vdm_AS_CompositeType, length_AS_CompositeType);
      {
        Generic tmpRec_14;
        tmpRec_14 = vdm_DEF_gst;
        if (tmpRec_14.IsRecord()) 
          if (((Record) tmpRec_14).Is(vdm_AS_StateDef)) 
            tmpVar_13 = ((Record) tmpRec_14).GetField(pos_AS_StateDef_tp);
          else 
            RunTime("Unknown record field selector");
        else 
          RunTime("A record was expected");
      }
      vdm_DEF_sigma__old = vdm_DEF_CreateSigmaPattern(tmpVar_13, (Bool) true);
      Record vdm_DEF_sigma__res(vdm_AS_RecordPattern, length_AS_RecordPattern);
      Record tmpVar_17(vdm_AS_CompositeType, length_AS_CompositeType);
      {
        Generic tmpRec_18;
        tmpRec_18 = vdm_DEF_gst;
        if (tmpRec_18.IsRecord()) 
          if (((Record) tmpRec_18).Is(vdm_AS_StateDef)) 
            tmpVar_17 = ((Record) tmpRec_18).GetField(pos_AS_StateDef_tp);
          else 
            RunTime("Unknown record field selector");
        else 
          RunTime("A record was expected");
      }
      vdm_DEF_sigma__res = vdm_DEF_CreateSigmaPattern(tmpVar_17, (Bool) false);
      {
        Sequence rexpr_20;
        {
          Sequence tmpVar_21;
          Sequence var1_22;
          var1_22.ImpConc(vdm_DEF_parm).ImpConc(vdm_DEF_res__parm);
          Sequence var2_23;
          var2_23 = Sequence().ImpAppend(vdm_DEF_sigma__old);
          var2_23.ImpAppend(vdm_DEF_sigma__res);
          tmpVar_21.ImpConc(var1_22).ImpConc(var2_23);
          rexpr_20 = Sequence().ImpAppend(tmpVar_21);
        }
        return rexpr_20;
      }
    }
  }
}

Map vdm_DEF_CreateImplPolyPrePostFns(Record var_1_1, Record var_2_2) {
  Record vdm_DEF_Post__e;
  Generic vdm_DEF_Pre__e;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Record vdm_DEF_name(vdm_AS_Name, length_AS_Name);
  Sequence vdm_DEF_partps;
  Sequence vdm_DEF_resnmtps;
  Sequence vdm_DEF_tpp;
  bool succ_3 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_3 = true;
  }
  {
    succ_3 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_ImplFnDef == var_2_2.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_2_2.Length(); i_5++) 
          e_l_4.ImpAppend(var_2_2.GetField(i_5));
        if (succ_3 = 6 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_DEF_name = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) {
            vdm_DEF_tpp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[3]);
          if (succ_3) {
            vdm_DEF_partps = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[4]);
          if (succ_3) {
            vdm_DEF_resnmtps = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[5]);
          if (succ_3) {
            vdm_DEF_Pre__e = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[6]);
          if (succ_3) {
            vdm_DEF_Post__e = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  if (succ_3) {
    bool succ_7;
    Tuple tmpVal_8(2);
    tmpVal_8 = vdm_DEF_ImplicitTypeParams(vdm_DEF_partps);
    Sequence vdm_DEF_fn__parm;
    Sequence vdm_DEF_fn__tp;
    succ_7 = true;
    {
      succ_7 = false;
      if (tmpVal_8.IsTuple()) {
        Sequence e_l_10;
        for (int i_11 = 1; i_11 <= ((Tuple) tmpVal_8).Length(); i_11++) 
          e_l_10.ImpAppend(((Tuple) tmpVal_8).GetField(i_11));
        if (succ_7 = 2 == (Int) (e_l_10.Length())) {
          Sequence permI_12;
          permI_12 = (Sequence) (e_l_10.Hd());
          succ_7 = true;
          {
            vdm_DEF_fn__tp = permI_12;
            succ_7 = true;
          }
          permI_12 = (Sequence) (e_l_10[2]);
          if (succ_7) {
            vdm_DEF_fn__parm = permI_12;
            succ_7 = true;
          }
        }
      }
    }
    if (!succ_7) 
      RunTime("Pattern match did not succeed in value definition");
    Tuple tmpVal_13(2);
    tmpVal_13 = vdm_DEF_ImplicitResNameTypes(vdm_DEF_resnmtps);
    Sequence vdm_DEF_fnrng;
    Sequence vdm_DEF_res__nms;
    succ_7 = true;
    {
      succ_7 = false;
      if (tmpVal_13.IsTuple()) {
        Sequence e_l_15;
        for (int i_16 = 1; i_16 <= ((Tuple) tmpVal_13).Length(); i_16++) 
          e_l_15.ImpAppend(((Tuple) tmpVal_13).GetField(i_16));
        if (succ_7 = 2 == (Int) (e_l_15.Length())) {
          Sequence permI_17;
          permI_17 = (Sequence) (e_l_15.Hd());
          succ_7 = true;
          {
            vdm_DEF_res__nms = permI_17;
            succ_7 = true;
          }
          permI_17 = (Sequence) (e_l_15[2]);
          if (succ_7) {
            vdm_DEF_fnrng = permI_17;
            succ_7 = true;
          }
        }
      }
    }
    if (!succ_7) 
      RunTime("Pattern match did not succeed in value definition");
    {
      Map vdm_DEF_res__m;
      vdm_DEF_res__m = Map();
      {
        Bool cond_18;
        cond_18 = (Bool) (vdm_DEF_Pre__e == Nil());
        if (cond_18.GetValue()) 
          ;
        else {
          bool succ_21;
          Record tmpVal_22(vdm_AS_Name, length_AS_Name);
          tmpVal_22 = vdm_DEF_name;
          Sequence vdm_DEF_id__l;
          succ_21 = true;
          {
            succ_21 = false;
            if (tmpVal_22.IsRecord()) 
              if (vdm_AS_Name == tmpVal_22.GetTag()) {
                Sequence e_l_23;
                for (int i_24 = 1; i_24 <= tmpVal_22.Length(); i_24++) 
                  e_l_23.ImpAppend(tmpVal_22.GetField(i_24));
                if (succ_21 = 2 == (Int) (e_l_23.Length())) {
                  Generic permI_25;
                  permI_25 = (Generic) (e_l_23.Hd());
                  succ_21 = true;
                  {
                    vdm_DEF_id__l = permI_25;
                    succ_21 = true;
                  }
                  permI_25 = (Generic) (e_l_23[2]);
                  if (succ_21) 
                    succ_21 = true;
                }
              }
          }
          if (!succ_21) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Record vdm_DEF_nm__pre(vdm_AS_Name, length_AS_Name);
            vdm_DEF_nm__pre = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_28;
            {
              Sequence tmpVar_29;
              Sequence var2_31;
              Sequence tmpseq_32;
              tmpseq_32 = vdm_DEF_id__l;
              var2_31 = (Sequence) (tmpseq_32[((Int) 1).GetValue()]);
              tmpVar_29.ImpConc(Sequence("pre_")).ImpConc(var2_31);
              tmpVar_28 = Sequence().ImpAppend(tmpVar_29);
            }
            vdm_DEF_nm__pre.SetField(1, tmpVar_28);
            vdm_DEF_nm__pre.SetField(2, Nil());
            {
              Record vdm_DEF_fn__pre(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
              vdm_DEF_fn__pre = Record(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
              vdm_DEF_fn__pre.SetField(1, vdm_DEF_tpp);
              Record tmpVar_38(vdm_AS_TotalFnType, length_AS_TotalFnType);
              {
                tmpVar_38 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
                tmpVar_38.SetField(1, vdm_DEF_fn__tp);
                Record tmpVar_40(vdm_AS_BasicType, length_AS_BasicType);
                {
                  tmpVar_40 = Record(vdm_AS_BasicType, length_AS_BasicType);
                  tmpVar_40.SetField(1, (Quote) "BOOLEAN");
                }
                tmpVar_38.SetField(2, tmpVar_40);
              }
              vdm_DEF_fn__pre.SetField(2, tmpVar_38);
              Sequence tmpVar_42;
              tmpVar_42 = Sequence().ImpAppend(vdm_DEF_fn__parm);
              vdm_DEF_fn__pre.SetField(3, tmpVar_42);
              vdm_DEF_fn__pre.SetField(4, vdm_DEF_Pre__e);
              vdm_DEF_fn__pre.SetField(5, Nil());
              vdm_DEF_fn__pre.SetField(6, Nil());
              vdm_DEF_fn__pre.SetField(7, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
              vdm_DEF_fn__pre.SetField(8, vdm_DEF_nm__pre);
              vdm_DEF_fn__pre.SetField(9, vdm_DEF_mod__id);
              vdm_DEF_fn__pre.SetField(10, Nil());
              {
                Map rhs_52;
                {
                  Map seqmap_53;
                  seqmap_53 = vdm_DEF_res__m;
                  Map modmap_54;
                  modmap_54 = Map().Insert(vdm_DEF_nm__pre, vdm_DEF_fn__pre);
                  seqmap_53.ImpOverride(modmap_54);
                  rhs_52 = seqmap_53;
                }
                vdm_DEF_res__m = rhs_52;
              }
            }
          }
        }
      }
      {
        bool succ_58;
        Record tmpVal_59(vdm_AS_Name, length_AS_Name);
        tmpVal_59 = vdm_DEF_name;
        Sequence vdm_DEF_id__l;
        succ_58 = true;
        {
          succ_58 = false;
          if (tmpVal_59.IsRecord()) 
            if (vdm_AS_Name == tmpVal_59.GetTag()) {
              Sequence e_l_60;
              for (int i_61 = 1; i_61 <= tmpVal_59.Length(); i_61++) 
                e_l_60.ImpAppend(tmpVal_59.GetField(i_61));
              if (succ_58 = 2 == (Int) (e_l_60.Length())) {
                Generic permI_62;
                permI_62 = (Generic) (e_l_60.Hd());
                succ_58 = true;
                {
                  vdm_DEF_id__l = permI_62;
                  succ_58 = true;
                }
                permI_62 = (Generic) (e_l_60[2]);
                if (succ_58) 
                  succ_58 = true;
              }
            }
        }
        if (!succ_58) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Record vdm_DEF_nm__post(vdm_AS_Name, length_AS_Name);
          vdm_DEF_nm__post = Record(vdm_AS_Name, length_AS_Name);
          Sequence tmpVar_65;
          {
            Sequence tmpVar_66;
            Sequence var2_68;
            Sequence tmpseq_69;
            tmpseq_69 = vdm_DEF_id__l;
            var2_68 = (Sequence) (tmpseq_69[((Int) 1).GetValue()]);
            tmpVar_66.ImpConc(Sequence("post_")).ImpConc(var2_68);
            tmpVar_65 = Sequence().ImpAppend(tmpVar_66);
          }
          vdm_DEF_nm__post.SetField(1, tmpVar_65);
          vdm_DEF_nm__post.SetField(2, Nil());
          Record vdm_DEF_tp__post;
          vdm_DEF_tp__post = vdm_DEF_CreateFunctionPostType(vdm_DEF_fn__tp, vdm_DEF_fnrng);
          Sequence vdm_DEF_parm__post;
          vdm_DEF_parm__post.ImpConc(vdm_DEF_fn__parm).ImpConc(vdm_DEF_CreatePostParms(vdm_DEF_res__nms));
          {
            Record vdm_DEF_fn__post(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
            vdm_DEF_fn__post = Record(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
            vdm_DEF_fn__post.SetField(1, vdm_DEF_tpp);
            vdm_DEF_fn__post.SetField(2, vdm_DEF_tp__post);
            Sequence tmpVar_83;
            tmpVar_83 = Sequence().ImpAppend(vdm_DEF_parm__post);
            vdm_DEF_fn__post.SetField(3, tmpVar_83);
            vdm_DEF_fn__post.SetField(4, vdm_DEF_Post__e);
            vdm_DEF_fn__post.SetField(5, Nil());
            vdm_DEF_fn__post.SetField(6, Nil());
            vdm_DEF_fn__post.SetField(7, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
            vdm_DEF_fn__post.SetField(8, vdm_DEF_nm__post);
            vdm_DEF_fn__post.SetField(9, vdm_DEF_mod__id);
            vdm_DEF_fn__post.SetField(10, Nil());
            {
              Map rhs_93;
              {
                Map seqmap_94;
                seqmap_94 = vdm_DEF_res__m;
                Map modmap_95;
                modmap_95 = Map().Insert(vdm_DEF_nm__post, vdm_DEF_fn__post);
                seqmap_94.ImpOverride(modmap_95);
                rhs_93 = seqmap_94;
              }
              vdm_DEF_res__m = rhs_93;
            }
          }
        }
      }
      {
        Map rexpr_99;
        rexpr_99 = vdm_DEF_res__m;
        return rexpr_99;
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: CreateImplPolyPrePostFns");
}

Map vdm_DEF_CreateImplPrePostFns(Record var_1_1, Record var_2_2) {
  Record vdm_DEF_Post__e;
  Generic vdm_DEF_Pre__e;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Record vdm_DEF_name(vdm_AS_Name, length_AS_Name);
  Sequence vdm_DEF_partps;
  Sequence vdm_DEF_resnmtps;
  bool succ_3 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_3 = true;
  }
  {
    succ_3 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_ImplFnDef == var_2_2.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_2_2.Length(); i_5++) 
          e_l_4.ImpAppend(var_2_2.GetField(i_5));
        if (succ_3 = 6 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_DEF_name = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) 
            succ_3 = true;
          permI_6 = (Generic) (e_l_4[3]);
          if (succ_3) {
            vdm_DEF_partps = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[4]);
          if (succ_3) {
            vdm_DEF_resnmtps = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[5]);
          if (succ_3) {
            vdm_DEF_Pre__e = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[6]);
          if (succ_3) {
            vdm_DEF_Post__e = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  if (succ_3) {
    bool succ_7;
    Tuple tmpVal_8(2);
    tmpVal_8 = vdm_DEF_ImplicitTypeParams(vdm_DEF_partps);
    Sequence vdm_DEF_fn__parm;
    Sequence vdm_DEF_fn__tp;
    succ_7 = true;
    {
      succ_7 = false;
      if (tmpVal_8.IsTuple()) {
        Sequence e_l_10;
        for (int i_11 = 1; i_11 <= ((Tuple) tmpVal_8).Length(); i_11++) 
          e_l_10.ImpAppend(((Tuple) tmpVal_8).GetField(i_11));
        if (succ_7 = 2 == (Int) (e_l_10.Length())) {
          Sequence permI_12;
          permI_12 = (Sequence) (e_l_10.Hd());
          succ_7 = true;
          {
            vdm_DEF_fn__tp = permI_12;
            succ_7 = true;
          }
          permI_12 = (Sequence) (e_l_10[2]);
          if (succ_7) {
            vdm_DEF_fn__parm = permI_12;
            succ_7 = true;
          }
        }
      }
    }
    if (!succ_7) 
      RunTime("Pattern match did not succeed in value definition");
    Tuple tmpVal_13(2);
    tmpVal_13 = vdm_DEF_ImplicitResNameTypes(vdm_DEF_resnmtps);
    Sequence vdm_DEF_fnrng;
    Sequence vdm_DEF_res__nms;
    succ_7 = true;
    {
      succ_7 = false;
      if (tmpVal_13.IsTuple()) {
        Sequence e_l_15;
        for (int i_16 = 1; i_16 <= ((Tuple) tmpVal_13).Length(); i_16++) 
          e_l_15.ImpAppend(((Tuple) tmpVal_13).GetField(i_16));
        if (succ_7 = 2 == (Int) (e_l_15.Length())) {
          Sequence permI_17;
          permI_17 = (Sequence) (e_l_15.Hd());
          succ_7 = true;
          {
            vdm_DEF_res__nms = permI_17;
            succ_7 = true;
          }
          permI_17 = (Sequence) (e_l_15[2]);
          if (succ_7) {
            vdm_DEF_fnrng = permI_17;
            succ_7 = true;
          }
        }
      }
    }
    if (!succ_7) 
      RunTime("Pattern match did not succeed in value definition");
    {
      Map vdm_DEF_res__m;
      vdm_DEF_res__m = Map();
      {
        Bool cond_18;
        cond_18 = (Bool) (vdm_DEF_Pre__e == Nil());
        if (cond_18.GetValue()) 
          ;
        else {
          bool succ_21;
          Record tmpVal_22(vdm_AS_Name, length_AS_Name);
          tmpVal_22 = vdm_DEF_name;
          Sequence vdm_DEF_id__l;
          succ_21 = true;
          {
            succ_21 = false;
            if (tmpVal_22.IsRecord()) 
              if (vdm_AS_Name == tmpVal_22.GetTag()) {
                Sequence e_l_23;
                for (int i_24 = 1; i_24 <= tmpVal_22.Length(); i_24++) 
                  e_l_23.ImpAppend(tmpVal_22.GetField(i_24));
                if (succ_21 = 2 == (Int) (e_l_23.Length())) {
                  Generic permI_25;
                  permI_25 = (Generic) (e_l_23.Hd());
                  succ_21 = true;
                  {
                    vdm_DEF_id__l = permI_25;
                    succ_21 = true;
                  }
                  permI_25 = (Generic) (e_l_23[2]);
                  if (succ_21) 
                    succ_21 = true;
                }
              }
          }
          if (!succ_21) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Record vdm_DEF_nm__pre(vdm_AS_Name, length_AS_Name);
            vdm_DEF_nm__pre = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_28;
            {
              Sequence tmpVar_29;
              Sequence var2_31;
              Sequence tmpseq_32;
              tmpseq_32 = vdm_DEF_id__l;
              var2_31 = (Sequence) (tmpseq_32[((Int) 1).GetValue()]);
              tmpVar_29.ImpConc(Sequence("pre_")).ImpConc(var2_31);
              tmpVar_28 = Sequence().ImpAppend(tmpVar_29);
            }
            vdm_DEF_nm__pre.SetField(1, tmpVar_28);
            vdm_DEF_nm__pre.SetField(2, Nil());
            {
              Record vdm_DEF_fn__pre(vdm_SEM_ExplFN, length_SEM_ExplFN);
              vdm_DEF_fn__pre = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
              Record tmpVar_37(vdm_AS_TotalFnType, length_AS_TotalFnType);
              {
                tmpVar_37 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
                tmpVar_37.SetField(1, vdm_DEF_fn__tp);
                Record tmpVar_39(vdm_AS_BasicType, length_AS_BasicType);
                {
                  tmpVar_39 = Record(vdm_AS_BasicType, length_AS_BasicType);
                  tmpVar_39.SetField(1, (Quote) "BOOLEAN");
                }
                tmpVar_37.SetField(2, tmpVar_39);
              }
              vdm_DEF_fn__pre.SetField(1, tmpVar_37);
              Sequence tmpVar_41;
              tmpVar_41 = Sequence().ImpAppend(vdm_DEF_fn__parm);
              vdm_DEF_fn__pre.SetField(2, tmpVar_41);
              vdm_DEF_fn__pre.SetField(3, vdm_DEF_Pre__e);
              vdm_DEF_fn__pre.SetField(4, Nil());
              vdm_DEF_fn__pre.SetField(5, Nil());
              vdm_DEF_fn__pre.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
              Map tmpVar_48;
              tmpVar_48 = Map();
              vdm_DEF_fn__pre.SetField(7, tmpVar_48);
              vdm_DEF_fn__pre.SetField(8, vdm_DEF_nm__pre);
              vdm_DEF_fn__pre.SetField(9, vdm_DEF_mod__id);
              vdm_DEF_fn__pre.SetField(10, Nil());
              {
                Map rhs_52;
                {
                  Map seqmap_53;
                  seqmap_53 = vdm_DEF_res__m;
                  Map modmap_54;
                  modmap_54 = Map().Insert(vdm_DEF_nm__pre, vdm_DEF_fn__pre);
                  seqmap_53.ImpOverride(modmap_54);
                  rhs_52 = seqmap_53;
                }
                vdm_DEF_res__m = rhs_52;
              }
            }
          }
        }
      }
      {
        bool succ_58;
        Record tmpVal_59(vdm_AS_Name, length_AS_Name);
        tmpVal_59 = vdm_DEF_name;
        Sequence vdm_DEF_id__l;
        succ_58 = true;
        {
          succ_58 = false;
          if (tmpVal_59.IsRecord()) 
            if (vdm_AS_Name == tmpVal_59.GetTag()) {
              Sequence e_l_60;
              for (int i_61 = 1; i_61 <= tmpVal_59.Length(); i_61++) 
                e_l_60.ImpAppend(tmpVal_59.GetField(i_61));
              if (succ_58 = 2 == (Int) (e_l_60.Length())) {
                Generic permI_62;
                permI_62 = (Generic) (e_l_60.Hd());
                succ_58 = true;
                {
                  vdm_DEF_id__l = permI_62;
                  succ_58 = true;
                }
                permI_62 = (Generic) (e_l_60[2]);
                if (succ_58) 
                  succ_58 = true;
              }
            }
        }
        if (!succ_58) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Record vdm_DEF_nm__post(vdm_AS_Name, length_AS_Name);
          vdm_DEF_nm__post = Record(vdm_AS_Name, length_AS_Name);
          Sequence tmpVar_65;
          {
            Sequence tmpVar_66;
            Sequence var2_68;
            Sequence tmpseq_69;
            tmpseq_69 = vdm_DEF_id__l;
            var2_68 = (Sequence) (tmpseq_69[((Int) 1).GetValue()]);
            tmpVar_66.ImpConc(Sequence("post_")).ImpConc(var2_68);
            tmpVar_65 = Sequence().ImpAppend(tmpVar_66);
          }
          vdm_DEF_nm__post.SetField(1, tmpVar_65);
          vdm_DEF_nm__post.SetField(2, Nil());
          Record vdm_DEF_tp__post;
          vdm_DEF_tp__post = vdm_DEF_CreateFunctionPostType(vdm_DEF_fn__tp, vdm_DEF_fnrng);
          Sequence vdm_DEF_parm__post;
          vdm_DEF_parm__post.ImpConc(vdm_DEF_fn__parm).ImpConc(vdm_DEF_CreatePostParms(vdm_DEF_res__nms));
          {
            Record vdm_DEF_fn__post(vdm_SEM_ExplFN, length_SEM_ExplFN);
            vdm_DEF_fn__post = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
            vdm_DEF_fn__post.SetField(1, vdm_DEF_tp__post);
            Sequence tmpVar_82;
            tmpVar_82 = Sequence().ImpAppend(vdm_DEF_parm__post);
            vdm_DEF_fn__post.SetField(2, tmpVar_82);
            vdm_DEF_fn__post.SetField(3, vdm_DEF_Post__e);
            vdm_DEF_fn__post.SetField(4, Nil());
            vdm_DEF_fn__post.SetField(5, Nil());
            vdm_DEF_fn__post.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
            Map tmpVar_89;
            tmpVar_89 = Map();
            vdm_DEF_fn__post.SetField(7, tmpVar_89);
            vdm_DEF_fn__post.SetField(8, vdm_DEF_nm__post);
            vdm_DEF_fn__post.SetField(9, vdm_DEF_mod__id);
            vdm_DEF_fn__post.SetField(10, Nil());
            {
              Map rhs_93;
              {
                Map seqmap_94;
                seqmap_94 = vdm_DEF_res__m;
                Map modmap_95;
                modmap_95 = Map().Insert(vdm_DEF_nm__post, vdm_DEF_fn__post);
                seqmap_94.ImpOverride(modmap_95);
                rhs_93 = seqmap_94;
              }
              vdm_DEF_res__m = rhs_93;
            }
          }
        }
      }
      {
        Map rexpr_99;
        rexpr_99 = vdm_DEF_res__m;
        return rexpr_99;
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: CreateImplPrePostFns");
}

Map vdm_DEF_CreateInvs(Record vdm_DEF_mod__id, Map vdm_DEF_tm) {
  Map vdm_DEF_tmp;
  vdm_DEF_tmp = Map();
  {
    Set iset_4;
    iset_4 = vdm_DEF_tm.Dom();
    Record vdm_DEF_name(vdm_AS_Name, length_AS_Name);
    bool succ_6;
    Generic tmpe_62;
    for (int bb_61 = iset_4.First(tmpe_62); bb_61; bb_61 = iset_4.Next(tmpe_62)) {
      Record elem_5 = tmpe_62;
      {
        succ_6 = true;
        {
          vdm_DEF_name = elem_5;
          succ_6 = true;
        }
        if (succ_6) {
          bool succ_8;
          Record tmpVal_9(vdm_AS_TypeDef, length_AS_TypeDef);
          {
            Map tmp_m_10;
            tmp_m_10 = vdm_DEF_tm;
            tmpVal_9 = (Record) (((Map) tmp_m_10)[vdm_DEF_name]);
          }
          Generic vdm_DEF_Inv;
          succ_8 = true;
          {
            succ_8 = false;
            if (tmpVal_9.IsRecord()) 
              if (vdm_AS_TypeDef == tmpVal_9.GetTag()) {
                Sequence e_l_12;
                for (int i_13 = 1; i_13 <= tmpVal_9.Length(); i_13++) 
                  e_l_12.ImpAppend(tmpVal_9.GetField(i_13));
                if (succ_8 = 3 == (Int) (e_l_12.Length())) {
                  Generic permI_14;
                  permI_14 = (Generic) (e_l_12.Hd());
                  succ_8 = true;
                  succ_8 = true;
                  permI_14 = (Generic) (e_l_12[2]);
                  if (succ_8) 
                    succ_8 = true;
                  permI_14 = (Generic) (e_l_12[3]);
                  if (succ_8) {
                    vdm_DEF_Inv = permI_14;
                    succ_8 = true;
                  }
                }
              }
          }
          if (!succ_8) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Bool cond_15;
            cond_15 = (Bool) (!(vdm_DEF_Inv == Nil()));
            if (cond_15.GetValue()) {
              bool succ_18;
              Generic tmpVal_19;
              tmpVal_19 = vdm_DEF_Inv;
              Record vdm_DEF_expr;
              Record vdm_DEF_pattern;
              succ_18 = true;
              {
                succ_18 = false;
                if (tmpVal_19.IsTuple()) {
                  Sequence e_l_20;
                  for (int i_21 = 1; i_21 <= ((Tuple) tmpVal_19).Length(); i_21++) 
                    e_l_20.ImpAppend(((Tuple) tmpVal_19).GetField(i_21));
                  if (succ_18 = 2 == (Int) (e_l_20.Length())) {
                    Record permI_22;
                    permI_22 = (Record) (e_l_20.Hd());
                    succ_18 = true;
                    {
                      vdm_DEF_pattern = permI_22;
                      succ_18 = true;
                    }
                    permI_22 = (Record) (e_l_20[2]);
                    if (succ_18) {
                      vdm_DEF_expr = permI_22;
                      succ_18 = true;
                    }
                  }
                }
              }
              if (!succ_18) 
                RunTime("Pattern match did not succeed in value definition");
              Record tmpVal_23(vdm_AS_Name, length_AS_Name);
              tmpVal_23 = vdm_DEF_name;
              Sequence vdm_DEF_id;
              succ_18 = true;
              {
                succ_18 = false;
                if (tmpVal_23.IsRecord()) 
                  if (vdm_AS_Name == tmpVal_23.GetTag()) {
                    Sequence e_l_24;
                    for (int i_25 = 1; i_25 <= tmpVal_23.Length(); i_25++) 
                      e_l_24.ImpAppend(tmpVal_23.GetField(i_25));
                    if (succ_18 = 2 == (Int) (e_l_24.Length())) {
                      Generic permI_26;
                      permI_26 = (Generic) (e_l_24.Hd());
                      succ_18 = true;
                      {
                        vdm_DEF_id = permI_26;
                        succ_18 = true;
                      }
                      permI_26 = (Generic) (e_l_24[2]);
                      if (succ_18) 
                        succ_18 = true;
                    }
                  }
              }
              if (!succ_18) 
                RunTime("Pattern match did not succeed in value definition");
              {
                Map rhs_27;
                {
                  Map var2_29;
                  Record tmpVar1_30(vdm_AS_Name, length_AS_Name);
                  {
                    tmpVar1_30 = Record(vdm_AS_Name, length_AS_Name);
                    Sequence tmpVar_32;
                    {
                      Sequence tmpVar_33;
                      Sequence var2_35;
                      Sequence tmpseq_36;
                      tmpseq_36 = vdm_DEF_id;
                      var2_35 = (Sequence) (tmpseq_36[((Int) 1).GetValue()]);
                      tmpVar_33.ImpConc(Sequence("inv_")).ImpConc(var2_35);
                      tmpVar_32 = Sequence().ImpAppend(tmpVar_33);
                    }
                    tmpVar1_30.SetField(1, tmpVar_32);
                    tmpVar1_30.SetField(2, Nil());
                  }
                  Record tmpVar2_31;
                  {
                    Record tmpVar_40(vdm_AS_ExplFnDef, length_AS_ExplFnDef);
                    {
                      tmpVar_40 = Record(vdm_AS_ExplFnDef, length_AS_ExplFnDef);
                      tmpVar_40.SetField(1, vdm_DEF_name);
                      Sequence tmpVar_42;
                      tmpVar_42 = Sequence();
                      tmpVar_40.SetField(2, tmpVar_42);
                      Record tmpVar_43(vdm_AS_TotalFnType, length_AS_TotalFnType);
                      {
                        tmpVar_43 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
                        Sequence tmpVar_44;
                        {
                          Record tmpVar_45(vdm_AS_TypeName, length_AS_TypeName);
                          tmpVar_45 = Record(vdm_AS_TypeName, length_AS_TypeName);
                          tmpVar_45.SetField(1, vdm_DEF_name);
                          tmpVar_44 = Sequence().ImpAppend(tmpVar_45);
                        }
                        tmpVar_43.SetField(1, tmpVar_44);
                        Record tmpVar_47(vdm_AS_BasicType, length_AS_BasicType);
                        {
                          tmpVar_47 = Record(vdm_AS_BasicType, length_AS_BasicType);
                          tmpVar_47.SetField(1, (Quote) "BOOLEAN");
                        }
                        tmpVar_43.SetField(2, tmpVar_47);
                      }
                      tmpVar_40.SetField(3, tmpVar_43);
                      Sequence tmpVar_49;
                      {
                        Sequence tmpVar_50;
                        tmpVar_50 = Sequence().ImpAppend(vdm_DEF_pattern);
                        tmpVar_49 = Sequence().ImpAppend(tmpVar_50);
                      }
                      tmpVar_40.SetField(4, tmpVar_49);
                      tmpVar_40.SetField(5, vdm_DEF_expr);
                      tmpVar_40.SetField(6, Nil());
                      tmpVar_40.SetField(7, Nil());
                    }
                    tmpVar2_31 = vdm_DEF_TransFN(vdm_DEF_mod__id, tmpVar_40);
                  }
                  var2_29 = Map().Insert(tmpVar1_30, tmpVar2_31);
                  {
                    Map m1_59 = vdm_DEF_tmp;
                    Map m2_60 = var2_29;
                    Set com_55 = m1_59.Dom();
                    com_55.ImpIntersect(m2_60.Dom());
                    int all_applies_56 = 1;
                    Generic d_57;
                    for (int bb_58 = com_55.First(d_57); bb_58 && all_applies_56; bb_58 = com_55.Next(d_57)) 
                      all_applies_56 *= m1_59[d_57] == m2_60[d_57];
                    if (all_applies_56) 
                      m1_59.ImpOverride(m2_60);
                    else 
                      RunTime("EvalMapMerge Duplicates not equal");
                    rhs_27 = m1_59;
                  }
                }
                vdm_DEF_tmp = rhs_27;
              }
            }
          }
        }
        else 
          RunTime("Pattern did not match in set for loop");
      }
    }
  }
  {
    Map rexpr_63;
    rexpr_63 = vdm_DEF_tmp;
    return rexpr_63;
  }
}

Record vdm_DEF_CreateOperationPostType(Sequence vdm_DEF_tpdom, Sequence vdm_DEF_tprng, Generic vdm_DEF_st__id) {
  Bool cond_5;
  {
    Sequence var2_7;
    var2_7 = Sequence();
    cond_5 = (Bool) (vdm_DEF_tpdom == var2_7);
  }
  if (cond_5.GetValue()) {
    Bool cond_44;
    cond_44 = (Bool) (vdm_DEF_st__id == Nil());
    if (cond_44.GetValue()) {
      Bool cond_67;
      {
        Sequence var2_69;
        var2_69 = Sequence();
        cond_67 = (Bool) (vdm_DEF_tprng == var2_69);
      }
      if (cond_67.GetValue()) {
        Record rexpr_74(vdm_AS_TotalFnType, length_AS_TotalFnType);
        {
          rexpr_74 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
          Sequence tmpVar_75;
          tmpVar_75 = Sequence();
          rexpr_74.SetField(1, tmpVar_75);
          Record tmpVar_76(vdm_AS_BasicType, length_AS_BasicType);
          {
            tmpVar_76 = Record(vdm_AS_BasicType, length_AS_BasicType);
            tmpVar_76.SetField(1, (Quote) "BOOLEAN");
          }
          rexpr_74.SetField(2, tmpVar_76);
        }
        return rexpr_74;
      }
      else {
        Record rexpr_70(vdm_AS_TotalFnType, length_AS_TotalFnType);
        {
          rexpr_70 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
          rexpr_70.SetField(1, vdm_DEF_tprng);
          Record tmpVar_72(vdm_AS_BasicType, length_AS_BasicType);
          {
            tmpVar_72 = Record(vdm_AS_BasicType, length_AS_BasicType);
            tmpVar_72.SetField(1, (Quote) "BOOLEAN");
          }
          rexpr_70.SetField(2, tmpVar_72);
        }
        return rexpr_70;
      }
    }
    else {
      Record vdm_DEF_st__tp(vdm_AS_TypeName, length_AS_TypeName);
      vdm_DEF_st__tp = Record(vdm_AS_TypeName, length_AS_TypeName);
      vdm_DEF_st__tp.SetField(1, vdm_DEF_st__id);
      {
        Bool cond_50;
        {
          Sequence var2_52;
          var2_52 = Sequence();
          cond_50 = (Bool) (vdm_DEF_tprng == var2_52);
        }
        if (cond_50.GetValue()) {
          Record rexpr_61(vdm_AS_TotalFnType, length_AS_TotalFnType);
          {
            rexpr_61 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
            Sequence tmpVar_62;
            {
              tmpVar_62 = Sequence().ImpAppend(vdm_DEF_st__tp);
              tmpVar_62.ImpAppend(vdm_DEF_st__tp);
            }
            rexpr_61.SetField(1, tmpVar_62);
            Record tmpVar_65(vdm_AS_BasicType, length_AS_BasicType);
            {
              tmpVar_65 = Record(vdm_AS_BasicType, length_AS_BasicType);
              tmpVar_65.SetField(1, (Quote) "BOOLEAN");
            }
            rexpr_61.SetField(2, tmpVar_65);
          }
          return rexpr_61;
        }
        else {
          Record rexpr_53(vdm_AS_TotalFnType, length_AS_TotalFnType);
          {
            rexpr_53 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
            Sequence tmpVar_54;
            {
              Sequence var2_56;
              var2_56 = Sequence().ImpAppend(vdm_DEF_st__tp);
              var2_56.ImpAppend(vdm_DEF_st__tp);
              tmpVar_54.ImpConc(vdm_DEF_tprng).ImpConc(var2_56);
            }
            rexpr_53.SetField(1, tmpVar_54);
            Record tmpVar_59(vdm_AS_BasicType, length_AS_BasicType);
            {
              tmpVar_59 = Record(vdm_AS_BasicType, length_AS_BasicType);
              tmpVar_59.SetField(1, (Quote) "BOOLEAN");
            }
            rexpr_53.SetField(2, tmpVar_59);
          }
          return rexpr_53;
        }
      }
    }
  }
  else {
    Bool cond_8;
    cond_8 = (Bool) (vdm_DEF_st__id == Nil());
    if (cond_8.GetValue()) {
      Sequence vdm_DEF_new__tp;
      Bool cond_35;
      {
        Sequence var2_37;
        var2_37 = Sequence();
        cond_35 = (Bool) (vdm_DEF_tprng == var2_37);
      }
      if (cond_35.GetValue()) 
        vdm_DEF_new__tp = vdm_DEF_tpdom;
      else { vdm_DEF_new__tp.ImpConc(vdm_DEF_tpdom).ImpConc(vdm_DEF_tprng); }
      {
        Record rexpr_40(vdm_AS_TotalFnType, length_AS_TotalFnType);
        {
          rexpr_40 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
          rexpr_40.SetField(1, vdm_DEF_new__tp);
          Record tmpVar_42(vdm_AS_BasicType, length_AS_BasicType);
          {
            tmpVar_42 = Record(vdm_AS_BasicType, length_AS_BasicType);
            tmpVar_42.SetField(1, (Quote) "BOOLEAN");
          }
          rexpr_40.SetField(2, tmpVar_42);
        }
        return rexpr_40;
      }
    }
    else {
      Record vdm_DEF_st__tp(vdm_AS_TypeName, length_AS_TypeName);
      vdm_DEF_st__tp = Record(vdm_AS_TypeName, length_AS_TypeName);
      vdm_DEF_st__tp.SetField(1, vdm_DEF_st__id);
      {
        Sequence vdm_DEF_new__tp;
        Bool cond_16;
        {
          Sequence var2_18;
          var2_18 = Sequence();
          cond_16 = (Bool) (vdm_DEF_tprng == var2_18);
        }
        if (cond_16.GetValue()) {
          Sequence var2_26;
          var2_26 = Sequence().ImpAppend(vdm_DEF_st__tp);
          var2_26.ImpAppend(vdm_DEF_st__tp);
          vdm_DEF_new__tp.ImpConc(vdm_DEF_tpdom).ImpConc(var2_26);
        }
        else {
          Sequence var1_19;
          var1_19.ImpConc(vdm_DEF_tpdom).ImpConc(vdm_DEF_tprng);
          Sequence var2_20;
          var2_20 = Sequence().ImpAppend(vdm_DEF_st__tp);
          var2_20.ImpAppend(vdm_DEF_st__tp);
          vdm_DEF_new__tp.ImpConc(var1_19).ImpConc(var2_20);
        }
        {
          Record rexpr_29(vdm_AS_TotalFnType, length_AS_TotalFnType);
          {
            rexpr_29 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
            rexpr_29.SetField(1, vdm_DEF_new__tp);
            Record tmpVar_31(vdm_AS_BasicType, length_AS_BasicType);
            {
              tmpVar_31 = Record(vdm_AS_BasicType, length_AS_BasicType);
              tmpVar_31.SetField(1, (Quote) "BOOLEAN");
            }
            rexpr_29.SetField(2, tmpVar_31);
          }
          return rexpr_29;
        }
      }
    }
  }
}

Sequence vdm_DEF_CreateOperationPreParms(Sequence vdm_DEF_parm, Generic vdm_DEF_gst) {
  Bool cond_4;
  cond_4 = (Bool) (vdm_DEF_gst == Nil());
  if (cond_4.GetValue()) {
    Sequence rexpr_17;
    rexpr_17 = Sequence().ImpAppend(vdm_DEF_parm);
    return rexpr_17;
  }
  else {
    Record vdm_DEF_sigma__parm(vdm_AS_RecordPattern, length_AS_RecordPattern);
    Record tmpVar_9(vdm_AS_CompositeType, length_AS_CompositeType);
    {
      Generic tmpRec_10;
      tmpRec_10 = vdm_DEF_gst;
      if (tmpRec_10.IsRecord()) 
        if (((Record) tmpRec_10).Is(vdm_AS_StateDef)) 
          tmpVar_9 = ((Record) tmpRec_10).GetField(pos_AS_StateDef_tp);
        else 
          RunTime("Unknown record field selector");
      else 
        RunTime("A record was expected");
    }
    vdm_DEF_sigma__parm = vdm_DEF_CreateSigmaPattern(tmpVar_9, (Bool) false);
    {
      Sequence rexpr_12;
      {
        Sequence tmpVar_13;
        Sequence var2_15;
        var2_15 = Sequence().ImpAppend(vdm_DEF_sigma__parm);
        tmpVar_13.ImpConc(vdm_DEF_parm).ImpConc(var2_15);
        rexpr_12 = Sequence().ImpAppend(tmpVar_13);
      }
      return rexpr_12;
    }
  }
}

Map vdm_DEF_CreateOperationPrePostFns(Record vdm_DEF_mod__id, Map vdm_DEF_opm, Generic vdm_DEF_gst) {
  Map vdm_DEF_res__m;
  vdm_DEF_res__m = Map();
  {
    Set iset_5;
    iset_5 = vdm_DEF_opm.Dom();
    Record vdm_DEF_id(vdm_AS_Name, length_AS_Name);
    bool succ_7;
    Generic tmpe_33;
    for (int bb_32 = iset_5.First(tmpe_33); bb_32; bb_32 = iset_5.Next(tmpe_33)) {
      Record elem_6 = tmpe_33;
      {
        succ_7 = true;
        {
          vdm_DEF_id = elem_6;
          succ_7 = true;
        }
        if (succ_7) {
          Record vdm_DEF_op__def;
          Map tmp_m_11;
          tmp_m_11 = vdm_DEF_opm;
          vdm_DEF_op__def = (Record) (((Map) tmp_m_11)[vdm_DEF_id]);
          {
            Bool cond_13;
            {
              Bool var1_14;
              Record argTmp_16;
              argTmp_16 = vdm_DEF_op__def;
              if (argTmp_16.IsRecord()) 
                var1_14 = vdm_AS_ExplOpDef == argTmp_16.GetTag();
              else 
                var1_14 = false;
              if (!(cond_13 = var1_14).GetValue()) {
                Bool var2_15;
                Record argTmp_17;
                argTmp_17 = vdm_DEF_op__def;
                if (argTmp_17.IsRecord()) 
                  var2_15 = vdm_AS_ExtExplOpDef == argTmp_17.GetTag();
                else 
                  var2_15 = false;
                cond_13 = var2_15;
              }
            }
            if (cond_13.GetValue()) {
              Map rhs_25;
              {
                Map seqmap_26;
                seqmap_26 = vdm_DEF_res__m;
                Map modmap_27;
                modmap_27 = vdm_DEF_CreateExplOpFns(vdm_DEF_mod__id, vdm_DEF_op__def, vdm_DEF_gst);
                seqmap_26.ImpOverride(modmap_27);
                rhs_25 = seqmap_26;
              }
              vdm_DEF_res__m = rhs_25;
            }
            else {
              Map rhs_18;
              {
                Map seqmap_19;
                seqmap_19 = vdm_DEF_res__m;
                Map modmap_20;
                modmap_20 = vdm_DEF_CreateImplOpFns(vdm_DEF_mod__id, vdm_DEF_op__def, vdm_DEF_gst);
                seqmap_19.ImpOverride(modmap_20);
                rhs_18 = seqmap_19;
              }
              vdm_DEF_res__m = rhs_18;
            }
          }
        }
        else 
          RunTime("Pattern did not match in set for loop");
      }
    }
  }
  {
    Map rexpr_34;
    rexpr_34 = vdm_DEF_res__m;
    return rexpr_34;
  }
}

Record vdm_DEF_CreateOperationPreType(Sequence vdm_DEF_tpdom, Generic vdm_DEF_st__id) {
  Bool cond_4;
  {
    Sequence var2_6;
    var2_6 = Sequence();
    cond_4 = (Bool) (vdm_DEF_tpdom == var2_6);
  }
  if (cond_4.GetValue()) {
    Bool cond_22;
    cond_22 = (Bool) (vdm_DEF_st__id == Nil());
    if (cond_22.GetValue()) {
      Record rexpr_31(vdm_AS_TotalFnType, length_AS_TotalFnType);
      {
        rexpr_31 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
        Sequence tmpVar_32;
        tmpVar_32 = Sequence();
        rexpr_31.SetField(1, tmpVar_32);
        Record tmpVar_33(vdm_AS_BasicType, length_AS_BasicType);
        {
          tmpVar_33 = Record(vdm_AS_BasicType, length_AS_BasicType);
          tmpVar_33.SetField(1, (Quote) "BOOLEAN");
        }
        rexpr_31.SetField(2, tmpVar_33);
      }
      return rexpr_31;
    }
    else {
      Record rexpr_25(vdm_AS_TotalFnType, length_AS_TotalFnType);
      {
        rexpr_25 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
        Sequence tmpVar_26;
        {
          Record tmpVar_27(vdm_AS_TypeName, length_AS_TypeName);
          tmpVar_27 = Record(vdm_AS_TypeName, length_AS_TypeName);
          tmpVar_27.SetField(1, vdm_DEF_st__id);
          tmpVar_26 = Sequence().ImpAppend(tmpVar_27);
        }
        rexpr_25.SetField(1, tmpVar_26);
        Record tmpVar_29(vdm_AS_BasicType, length_AS_BasicType);
        {
          tmpVar_29 = Record(vdm_AS_BasicType, length_AS_BasicType);
          tmpVar_29.SetField(1, (Quote) "BOOLEAN");
        }
        rexpr_25.SetField(2, tmpVar_29);
      }
      return rexpr_25;
    }
  }
  else {
    Bool cond_7;
    cond_7 = (Bool) (vdm_DEF_st__id == Nil());
    if (cond_7.GetValue()) {
      Record rexpr_18(vdm_AS_TotalFnType, length_AS_TotalFnType);
      {
        rexpr_18 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
        rexpr_18.SetField(1, vdm_DEF_tpdom);
        Record tmpVar_20(vdm_AS_BasicType, length_AS_BasicType);
        {
          tmpVar_20 = Record(vdm_AS_BasicType, length_AS_BasicType);
          tmpVar_20.SetField(1, (Quote) "BOOLEAN");
        }
        rexpr_18.SetField(2, tmpVar_20);
      }
      return rexpr_18;
    }
    else {
      Record rexpr_10(vdm_AS_TotalFnType, length_AS_TotalFnType);
      {
        rexpr_10 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
        Sequence tmpVar_11;
        {
          Sequence var2_13;
          Record tmpVar_14(vdm_AS_TypeName, length_AS_TypeName);
          tmpVar_14 = Record(vdm_AS_TypeName, length_AS_TypeName);
          tmpVar_14.SetField(1, vdm_DEF_st__id);
          var2_13 = Sequence().ImpAppend(tmpVar_14);
          tmpVar_11.ImpConc(vdm_DEF_tpdom).ImpConc(var2_13);
        }
        rexpr_10.SetField(1, tmpVar_11);
        Record tmpVar_16(vdm_AS_BasicType, length_AS_BasicType);
        {
          tmpVar_16 = Record(vdm_AS_BasicType, length_AS_BasicType);
          tmpVar_16.SetField(1, (Quote) "BOOLEAN");
        }
        rexpr_10.SetField(2, tmpVar_16);
      }
      return rexpr_10;
    }
  }
}

Record vdm_DEF_CreateSigmaPattern(Record var_1_1, Bool var_2_2) {
  Sequence vdm_DEF_fields;
  Bool vdm_DEF_old__names;
  Record vdm_DEF_tag(vdm_AS_Name, length_AS_Name);
  bool succ_3 = true;
  {
    succ_3 = false;
    if (var_1_1.IsRecord()) 
      if (vdm_AS_CompositeType == var_1_1.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_1_1.Length(); i_5++) 
          e_l_4.ImpAppend(var_1_1.GetField(i_5));
        if (succ_3 = 2 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_DEF_tag = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) {
            vdm_DEF_fields = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  {
    vdm_DEF_old__names = var_2_2;
    succ_3 = true;
  }
  if (succ_3) {
    Sequence vdm_DEF_rec__l;
    vdm_DEF_rec__l = Sequence();
    {
      Sequence sq_7;
      sq_7 = vdm_DEF_fields;
      Generic vdm_DEF_sel;
      bool succ_9;
      Generic tmpe_46;
      for (int i_45 = sq_7.First(tmpe_46); i_45; i_45 = sq_7.Next(tmpe_46)) {
        Record elem_8 = tmpe_46;
        {
          succ_9 = true;
          {
            succ_9 = false;
            if (elem_8.IsRecord()) 
              if (vdm_AS_Field == elem_8.GetTag()) {
                Sequence e_l_42;
                for (int i_43 = 1; i_43 <= elem_8.Length(); i_43++) 
                  e_l_42.ImpAppend(elem_8.GetField(i_43));
                if (succ_9 = 2 == (Int) (e_l_42.Length())) {
                  Generic permI_44;
                  permI_44 = (Generic) (e_l_42.Hd());
                  succ_9 = true;
                  {
                    vdm_DEF_sel = permI_44;
                    succ_9 = true;
                  }
                  permI_44 = (Generic) (e_l_42[2]);
                  if (succ_9) 
                    succ_9 = true;
                }
              }
          }
          if (succ_9) {
            Bool cond_10;
            cond_10 = (Bool) (vdm_DEF_sel == Nil());
            if (cond_10.GetValue()) {
              Sequence rhs_36;
              {
                Sequence var2_38;
                Record tmpVar_39(vdm_AS_PatternName, length_AS_PatternName);
                tmpVar_39 = Record(vdm_AS_PatternName, length_AS_PatternName);
                tmpVar_39.SetField(1, Nil());
                tmpVar_39.SetField(2, Nil());
                var2_38 = Sequence().ImpAppend(tmpVar_39);
                rhs_36.ImpConc(vdm_DEF_rec__l).ImpConc(var2_38);
              }
              vdm_DEF_rec__l = rhs_36;
            }
            else {
              bool succ_13;
              Generic tmpVal_14;
              tmpVal_14 = vdm_DEF_sel;
              Sequence vdm_DEF_sel__id;
              succ_13 = true;
              {
                succ_13 = false;
                if (tmpVal_14.IsRecord()) 
                  if (vdm_AS_Name == ((Record) tmpVal_14).GetTag()) {
                    Sequence e_l_15;
                    for (int i_16 = 1; i_16 <= ((Record) tmpVal_14).Length(); i_16++) 
                      e_l_15.ImpAppend(((Record) tmpVal_14).GetField(i_16));
                    if (succ_13 = 2 == (Int) (e_l_15.Length())) {
                      Generic permI_17;
                      permI_17 = (Generic) (e_l_15.Hd());
                      succ_13 = true;
                      {
                        vdm_DEF_sel__id = permI_17;
                        succ_13 = true;
                      }
                      permI_17 = (Generic) (e_l_15[2]);
                      if (succ_13) 
                        succ_13 = true;
                    }
                  }
              }
              if (!succ_13) 
                RunTime("Pattern match did not succeed in value definition");
              {
                Sequence vdm_DEF_sel__id_q;
                if (vdm_DEF_old__names.GetValue()) {
                  Sequence var1_23;
                  Sequence tmpseq_25;
                  tmpseq_25 = vdm_DEF_sel__id;
                  var1_23 = (Sequence) (tmpseq_25[((Int) 1).GetValue()]);
                  vdm_DEF_sel__id_q.ImpConc(var1_23).ImpConc(Sequence("~"));
                }
                else {
                  Sequence tmpseq_21;
                  tmpseq_21 = vdm_DEF_sel__id;
                  vdm_DEF_sel__id_q = (Sequence) (tmpseq_21[((Int) 1).GetValue()]);
                }
                {
                  Sequence rhs_27;
                  {
                    Sequence var2_29;
                    Record tmpVar_30(vdm_AS_PatternName, length_AS_PatternName);
                    tmpVar_30 = Record(vdm_AS_PatternName, length_AS_PatternName);
                    Record tmpVar_31(vdm_AS_Name, length_AS_Name);
                    {
                      tmpVar_31 = Record(vdm_AS_Name, length_AS_Name);
                      Sequence tmpVar_32;
                      tmpVar_32 = Sequence().ImpAppend(vdm_DEF_sel__id_q);
                      tmpVar_31.SetField(1, tmpVar_32);
                      tmpVar_31.SetField(2, Nil());
                    }
                    tmpVar_30.SetField(1, tmpVar_31);
                    tmpVar_30.SetField(2, Nil());
                    var2_29 = Sequence().ImpAppend(tmpVar_30);
                    rhs_27.ImpConc(vdm_DEF_rec__l).ImpConc(var2_29);
                  }
                  vdm_DEF_rec__l = rhs_27;
                }
              }
            }
          }
          else 
            RunTime("Pattern did not match in sequence for loop");
        }
      }
    }
    {
      Record rexpr_47(vdm_AS_RecordPattern, length_AS_RecordPattern);
      {
        rexpr_47 = Record(vdm_AS_RecordPattern, length_AS_RecordPattern);
        rexpr_47.SetField(1, vdm_DEF_tag);
        rexpr_47.SetField(2, vdm_DEF_rec__l);
        rexpr_47.SetField(3, Nil());
      }
      return rexpr_47;
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: CreateSigmaPattern");
}

Map vdm_DEF_CreateStateInvAndInit(Record var_1_1, Record var_2_2) {
  Generic vdm_DEF_Init;
  Generic vdm_DEF_Inv;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Record vdm_DEF_tp(vdm_AS_CompositeType, length_AS_CompositeType);
  bool succ_3 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_3 = true;
  }
  {
    succ_3 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_StateDef == var_2_2.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_2_2.Length(); i_5++) 
          e_l_4.ImpAppend(var_2_2.GetField(i_5));
        if (succ_3 = 3 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_DEF_tp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) {
            vdm_DEF_Inv = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[3]);
          if (succ_3) {
            vdm_DEF_Init = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  if (succ_3) {
    Map vdm_DEF_res;
    vdm_DEF_res = Map();
    {
      Bool cond_7;
      cond_7 = (Bool) (!(vdm_DEF_Inv == Nil()));
      if (cond_7.GetValue()) {
        bool succ_10;
        Generic tmpVal_11;
        tmpVal_11 = vdm_DEF_Inv;
        Record vdm_DEF_expr;
        Record vdm_DEF_pattern;
        succ_10 = true;
        {
          succ_10 = false;
          if (tmpVal_11.IsTuple()) {
            Sequence e_l_12;
            for (int i_13 = 1; i_13 <= ((Tuple) tmpVal_11).Length(); i_13++) 
              e_l_12.ImpAppend(((Tuple) tmpVal_11).GetField(i_13));
            if (succ_10 = 2 == (Int) (e_l_12.Length())) {
              Record permI_14;
              permI_14 = (Record) (e_l_12.Hd());
              succ_10 = true;
              {
                vdm_DEF_pattern = permI_14;
                succ_10 = true;
              }
              permI_14 = (Record) (e_l_12[2]);
              if (succ_10) {
                vdm_DEF_expr = permI_14;
                succ_10 = true;
              }
            }
          }
        }
        if (!succ_10) 
          RunTime("Pattern match did not succeed in value definition");
        Record tmpVal_15(vdm_AS_Name, length_AS_Name);
        {
          Record tmpRec_16(vdm_AS_CompositeType, length_AS_CompositeType);
          tmpRec_16 = vdm_DEF_tp;
          if (tmpRec_16.Is(vdm_AS_CompositeType)) 
            tmpVal_15 = tmpRec_16.GetField(pos_AS_CompositeType_name);
          else 
            RunTime("Unknown record field selector");
        }
        Sequence vdm_DEF_id;
        succ_10 = true;
        {
          succ_10 = false;
          if (tmpVal_15.IsRecord()) 
            if (vdm_AS_Name == tmpVal_15.GetTag()) {
              Sequence e_l_17;
              for (int i_18 = 1; i_18 <= tmpVal_15.Length(); i_18++) 
                e_l_17.ImpAppend(tmpVal_15.GetField(i_18));
              if (succ_10 = 2 == (Int) (e_l_17.Length())) {
                Generic permI_19;
                permI_19 = (Generic) (e_l_17.Hd());
                succ_10 = true;
                {
                  vdm_DEF_id = permI_19;
                  succ_10 = true;
                }
                permI_19 = (Generic) (e_l_17[2]);
                if (succ_10) 
                  succ_10 = true;
              }
            }
        }
        if (!succ_10) 
          RunTime("Pattern match did not succeed in value definition");
        Sequence vdm_DEF_args;
        {
          Sequence res_l_21;
          Record reselem_22;
          Set resBind_s_24;
          {
            Sequence unArg_28;
            Record tmpRec_29(vdm_AS_CompositeType, length_AS_CompositeType);
            tmpRec_29 = vdm_DEF_tp;
            if (tmpRec_29.Is(vdm_AS_CompositeType)) 
              unArg_28 = tmpRec_29.GetField(pos_AS_CompositeType_fields);
            else 
              RunTime("Unknown record field selector");
            {
              Set riseq_30;
              int max_31 = (Int) (unArg_28.Length());
              for (int i_32 = 1; i_32 <= max_31; i_32++) 
                riseq_30.Insert((Int) i_32);
              resBind_s_24 = riseq_30;
            }
          }
          Sequence bind_l_23;
          if ((Int) (resBind_s_24.Card()) != (Int) 0) 
            bind_l_23 = Sort(resBind_s_24);
          bool succ_25 = true;
          Int vdm_DEF_i;
          Generic tmpe_38;
          for (int i_37 = bind_l_23.First(tmpe_38); i_37; i_37 = bind_l_23.Next(tmpe_38)) {
            Int e_27 = tmpe_38;
            {
              vdm_DEF_i = e_27;
              succ_25 = true;
              if (succ_25) {
                Record tmpRec_33(vdm_AS_Field, length_AS_Field);
                {
                  Sequence tmpseq_34;
                  {
                    Record tmpRec_36(vdm_AS_CompositeType, length_AS_CompositeType);
                    tmpRec_36 = vdm_DEF_tp;
                    if (tmpRec_36.Is(vdm_AS_CompositeType)) 
                      tmpseq_34 = tmpRec_36.GetField(pos_AS_CompositeType_fields);
                    else 
                      RunTime("Unknown record field selector");
                  }
                  tmpRec_33 = (Record) (tmpseq_34[vdm_DEF_i.GetValue()]);
                }
                if (tmpRec_33.Is(vdm_AS_Field)) 
                  reselem_22 = tmpRec_33.GetField(pos_AS_Field_type);
                else 
                  RunTime("Unknown record field selector");
                res_l_21.ImpAppend(reselem_22);
              }
            }
          }
          vdm_DEF_args = res_l_21;
        }
        {
          Map rhs_39;
          {
            Map var2_41;
            Record tmpVar1_42(vdm_AS_Name, length_AS_Name);
            {
              tmpVar1_42 = Record(vdm_AS_Name, length_AS_Name);
              Sequence tmpVar_44;
              {
                Sequence tmpVar_45;
                Sequence var2_47;
                Sequence tmpseq_48;
                tmpseq_48 = vdm_DEF_id;
                var2_47 = (Sequence) (tmpseq_48[((Int) 1).GetValue()]);
                tmpVar_45.ImpConc(Sequence("inv_")).ImpConc(var2_47);
                tmpVar_44 = Sequence().ImpAppend(tmpVar_45);
              }
              tmpVar1_42.SetField(1, tmpVar_44);
              tmpVar1_42.SetField(2, Nil());
            }
            Record tmpVar2_43;
            {
              Record tmpVar_52(vdm_AS_ExplFnDef, length_AS_ExplFnDef);
              {
                tmpVar_52 = Record(vdm_AS_ExplFnDef, length_AS_ExplFnDef);
                Record tmpVar_53(vdm_AS_Name, length_AS_Name);
                {
                  Record tmpRec_54(vdm_AS_CompositeType, length_AS_CompositeType);
                  tmpRec_54 = vdm_DEF_tp;
                  if (tmpRec_54.Is(vdm_AS_CompositeType)) 
                    tmpVar_53 = tmpRec_54.GetField(pos_AS_CompositeType_name);
                  else 
                    RunTime("Unknown record field selector");
                }
                tmpVar_52.SetField(1, tmpVar_53);
                Sequence tmpVar_55;
                tmpVar_55 = Sequence();
                tmpVar_52.SetField(2, tmpVar_55);
                Record tmpVar_56(vdm_AS_TotalFnType, length_AS_TotalFnType);
                {
                  tmpVar_56 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
                  tmpVar_56.SetField(1, vdm_DEF_args);
                  Record tmpVar_58(vdm_AS_BasicType, length_AS_BasicType);
                  {
                    tmpVar_58 = Record(vdm_AS_BasicType, length_AS_BasicType);
                    tmpVar_58.SetField(1, (Quote) "BOOLEAN");
                  }
                  tmpVar_56.SetField(2, tmpVar_58);
                }
                tmpVar_52.SetField(3, tmpVar_56);
                Sequence tmpVar_60;
                {
                  Sequence tmpVar_61;
                  tmpVar_61 = Sequence().ImpAppend(vdm_DEF_pattern);
                  tmpVar_60 = Sequence().ImpAppend(tmpVar_61);
                }
                tmpVar_52.SetField(4, tmpVar_60);
                tmpVar_52.SetField(5, vdm_DEF_expr);
                tmpVar_52.SetField(6, Nil());
                tmpVar_52.SetField(7, Nil());
              }
              tmpVar2_43 = vdm_DEF_TransFN(vdm_DEF_mod__id, tmpVar_52);
            }
            var2_41 = Map().Insert(tmpVar1_42, tmpVar2_43);
            {
              Map m1_70 = vdm_DEF_res;
              Map m2_71 = var2_41;
              Set com_66 = m1_70.Dom();
              com_66.ImpIntersect(m2_71.Dom());
              int all_applies_67 = 1;
              Generic d_68;
              for (int bb_69 = com_66.First(d_68); bb_69 && all_applies_67; bb_69 = com_66.Next(d_68)) 
                all_applies_67 *= m1_70[d_68] == m2_71[d_68];
              if (all_applies_67) 
                m1_70.ImpOverride(m2_71);
              else 
                RunTime("EvalMapMerge Duplicates not equal");
              rhs_39 = m1_70;
            }
          }
          vdm_DEF_res = rhs_39;
        }
      }
    }
    {
      Bool cond_72;
      cond_72 = (Bool) (!(vdm_DEF_Init == Nil()));
      if (cond_72.GetValue()) {
        bool succ_75;
        Generic tmpVal_76;
        tmpVal_76 = vdm_DEF_Init;
        Record vdm_DEF_expr;
        Record vdm_DEF_pattern;
        succ_75 = true;
        {
          succ_75 = false;
          if (tmpVal_76.IsTuple()) {
            Sequence e_l_77;
            for (int i_78 = 1; i_78 <= ((Tuple) tmpVal_76).Length(); i_78++) 
              e_l_77.ImpAppend(((Tuple) tmpVal_76).GetField(i_78));
            if (succ_75 = 2 == (Int) (e_l_77.Length())) {
              Record permI_79;
              permI_79 = (Record) (e_l_77.Hd());
              succ_75 = true;
              {
                vdm_DEF_pattern = permI_79;
                succ_75 = true;
              }
              permI_79 = (Record) (e_l_77[2]);
              if (succ_75) {
                vdm_DEF_expr = permI_79;
                succ_75 = true;
              }
            }
          }
        }
        if (!succ_75) 
          RunTime("Pattern match did not succeed in value definition");
        Record tmpVal_80(vdm_AS_Name, length_AS_Name);
        {
          Record tmpRec_81(vdm_AS_CompositeType, length_AS_CompositeType);
          tmpRec_81 = vdm_DEF_tp;
          if (tmpRec_81.Is(vdm_AS_CompositeType)) 
            tmpVal_80 = tmpRec_81.GetField(pos_AS_CompositeType_name);
          else 
            RunTime("Unknown record field selector");
        }
        Sequence vdm_DEF_id;
        succ_75 = true;
        {
          succ_75 = false;
          if (tmpVal_80.IsRecord()) 
            if (vdm_AS_Name == tmpVal_80.GetTag()) {
              Sequence e_l_82;
              for (int i_83 = 1; i_83 <= tmpVal_80.Length(); i_83++) 
                e_l_82.ImpAppend(tmpVal_80.GetField(i_83));
              if (succ_75 = 2 == (Int) (e_l_82.Length())) {
                Generic permI_84;
                permI_84 = (Generic) (e_l_82.Hd());
                succ_75 = true;
                {
                  vdm_DEF_id = permI_84;
                  succ_75 = true;
                }
                permI_84 = (Generic) (e_l_82[2]);
                if (succ_75) 
                  succ_75 = true;
              }
            }
        }
        if (!succ_75) 
          RunTime("Pattern match did not succeed in value definition");
        Sequence vdm_DEF_args;
        {
          Sequence res_l_86;
          Record reselem_87;
          Set resBind_s_89;
          {
            Sequence unArg_93;
            Record tmpRec_94(vdm_AS_CompositeType, length_AS_CompositeType);
            tmpRec_94 = vdm_DEF_tp;
            if (tmpRec_94.Is(vdm_AS_CompositeType)) 
              unArg_93 = tmpRec_94.GetField(pos_AS_CompositeType_fields);
            else 
              RunTime("Unknown record field selector");
            {
              Set riseq_95;
              int max_96 = (Int) (unArg_93.Length());
              for (int i_97 = 1; i_97 <= max_96; i_97++) 
                riseq_95.Insert((Int) i_97);
              resBind_s_89 = riseq_95;
            }
          }
          Sequence bind_l_88;
          if ((Int) (resBind_s_89.Card()) != (Int) 0) 
            bind_l_88 = Sort(resBind_s_89);
          bool succ_90 = true;
          Int vdm_DEF_i;
          Generic tmpe_103;
          for (int i_102 = bind_l_88.First(tmpe_103); i_102; i_102 = bind_l_88.Next(tmpe_103)) {
            Int e_92 = tmpe_103;
            {
              vdm_DEF_i = e_92;
              succ_90 = true;
              if (succ_90) {
                Record tmpRec_98(vdm_AS_Field, length_AS_Field);
                {
                  Sequence tmpseq_99;
                  {
                    Record tmpRec_101(vdm_AS_CompositeType, length_AS_CompositeType);
                    tmpRec_101 = vdm_DEF_tp;
                    if (tmpRec_101.Is(vdm_AS_CompositeType)) 
                      tmpseq_99 = tmpRec_101.GetField(pos_AS_CompositeType_fields);
                    else 
                      RunTime("Unknown record field selector");
                  }
                  tmpRec_98 = (Record) (tmpseq_99[vdm_DEF_i.GetValue()]);
                }
                if (tmpRec_98.Is(vdm_AS_Field)) 
                  reselem_87 = tmpRec_98.GetField(pos_AS_Field_type);
                else 
                  RunTime("Unknown record field selector");
                res_l_86.ImpAppend(reselem_87);
              }
            }
          }
          vdm_DEF_args = res_l_86;
        }
        {
          Map rhs_104;
          {
            Map var2_106;
            Record tmpVar1_107(vdm_AS_Name, length_AS_Name);
            {
              tmpVar1_107 = Record(vdm_AS_Name, length_AS_Name);
              Sequence tmpVar_109;
              {
                Sequence tmpVar_110;
                Sequence var2_112;
                Sequence tmpseq_113;
                tmpseq_113 = vdm_DEF_id;
                var2_112 = (Sequence) (tmpseq_113[((Int) 1).GetValue()]);
                tmpVar_110.ImpConc(Sequence("init_")).ImpConc(var2_112);
                tmpVar_109 = Sequence().ImpAppend(tmpVar_110);
              }
              tmpVar1_107.SetField(1, tmpVar_109);
              tmpVar1_107.SetField(2, Nil());
            }
            Record tmpVar2_108;
            {
              Record tmpVar_117(vdm_AS_ExplFnDef, length_AS_ExplFnDef);
              {
                tmpVar_117 = Record(vdm_AS_ExplFnDef, length_AS_ExplFnDef);
                Record tmpVar_118(vdm_AS_Name, length_AS_Name);
                {
                  Record tmpRec_119(vdm_AS_CompositeType, length_AS_CompositeType);
                  tmpRec_119 = vdm_DEF_tp;
                  if (tmpRec_119.Is(vdm_AS_CompositeType)) 
                    tmpVar_118 = tmpRec_119.GetField(pos_AS_CompositeType_name);
                  else 
                    RunTime("Unknown record field selector");
                }
                tmpVar_117.SetField(1, tmpVar_118);
                Sequence tmpVar_120;
                tmpVar_120 = Sequence();
                tmpVar_117.SetField(2, tmpVar_120);
                Record tmpVar_121(vdm_AS_TotalFnType, length_AS_TotalFnType);
                {
                  tmpVar_121 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
                  tmpVar_121.SetField(1, vdm_DEF_args);
                  Record tmpVar_123(vdm_AS_BasicType, length_AS_BasicType);
                  {
                    tmpVar_123 = Record(vdm_AS_BasicType, length_AS_BasicType);
                    tmpVar_123.SetField(1, (Quote) "BOOLEAN");
                  }
                  tmpVar_121.SetField(2, tmpVar_123);
                }
                tmpVar_117.SetField(3, tmpVar_121);
                Sequence tmpVar_125;
                {
                  Sequence tmpVar_126;
                  tmpVar_126 = Sequence().ImpAppend(vdm_DEF_pattern);
                  tmpVar_125 = Sequence().ImpAppend(tmpVar_126);
                }
                tmpVar_117.SetField(4, tmpVar_125);
                tmpVar_117.SetField(5, vdm_DEF_expr);
                tmpVar_117.SetField(6, Nil());
                tmpVar_117.SetField(7, Nil());
              }
              tmpVar2_108 = vdm_DEF_TransFN(vdm_DEF_mod__id, tmpVar_117);
            }
            var2_106 = Map().Insert(tmpVar1_107, tmpVar2_108);
            {
              Map m1_135 = vdm_DEF_res;
              Map m2_136 = var2_106;
              Set com_131 = m1_135.Dom();
              com_131.ImpIntersect(m2_136.Dom());
              int all_applies_132 = 1;
              Generic d_133;
              for (int bb_134 = com_131.First(d_133); bb_134 && all_applies_132; bb_134 = com_131.Next(d_133)) 
                all_applies_132 *= m1_135[d_133] == m2_136[d_133];
              if (all_applies_132) 
                m1_135.ImpOverride(m2_136);
              else 
                RunTime("EvalMapMerge Duplicates not equal");
              rhs_104 = m1_135;
            }
          }
          vdm_DEF_res = rhs_104;
        }
      }
    }
    {
      Map rexpr_137;
      rexpr_137 = vdm_DEF_res;
      return rexpr_137;
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: CreateStateInvAndInit");
}

Map vdm_DEF_DoCreateExplOpFns(Record var_1_1, Record var_2_2, Generic var_3_3) {
  Generic vdm_DEF_Post__e;
  Generic vdm_DEF_Pre__e;
  Generic vdm_DEF_gst;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
  Sequence vdm_DEF_parms;
  Record vdm_DEF_tp(vdm_AS_OpType, length_AS_OpType);
  bool succ_4 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_4 = true;
  }
  {
    succ_4 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_ExplOpDef == var_2_2.GetTag()) {
        Sequence e_l_5;
        for (int i_6 = 1; i_6 <= var_2_2.Length(); i_6++) 
          e_l_5.ImpAppend(var_2_2.GetField(i_6));
        if (succ_4 = 6 == (Int) (e_l_5.Length())) {
          Generic permI_7;
          permI_7 = (Generic) (e_l_5.Hd());
          succ_4 = true;
          {
            vdm_DEF_nm = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[2]);
          if (succ_4) {
            vdm_DEF_tp = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[3]);
          if (succ_4) {
            vdm_DEF_parms = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[4]);
          if (succ_4) 
            succ_4 = true;
          permI_7 = (Generic) (e_l_5[5]);
          if (succ_4) {
            vdm_DEF_Pre__e = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[6]);
          if (succ_4) {
            vdm_DEF_Post__e = permI_7;
            succ_4 = true;
          }
        }
      }
  }
  {
    vdm_DEF_gst = var_3_3;
    succ_4 = true;
  }
  if (succ_4) {
    bool succ_8;
    Generic tmpVal_9;
{ if (((Bool) (vdm_DEF_gst == Nil())).GetValue()) 
   tmpVal_9 = Nil();
 else {
   Record tmpRec_13(vdm_AS_CompositeType, length_AS_CompositeType);
   {
     Generic tmpRec_14;
     tmpRec_14 = vdm_DEF_gst;
     if (tmpRec_14.IsRecord()) 
       if (((Record) tmpRec_14).Is(vdm_AS_StateDef)) 
         tmpRec_13 = ((Record) tmpRec_14).GetField(pos_AS_StateDef_tp);
       else 
         RunTime("Unknown record field selector");
     else 
       RunTime("A record was expected");
   }
   if (tmpRec_13.Is(vdm_AS_CompositeType)) 
     tmpVal_9 = tmpRec_13.GetField(pos_AS_CompositeType_name);
   else 
     RunTime("Unknown record field selector");
 } }
    Generic vdm_DEF_st__id;
    succ_8 = true;
    {
      vdm_DEF_st__id = tmpVal_9;
      succ_8 = true;
    }
    if (!succ_8) 
      RunTime("Pattern match did not succeed in value definition");
    {
      Map vdm_DEF_res__m;
      vdm_DEF_res__m = Map();
      {
        Bool cond_15;
        cond_15 = (Bool) (vdm_DEF_Pre__e == Nil());
        if (cond_15.GetValue()) 
          ;
        else {
          bool succ_18;
          Record tmpVal_19(vdm_AS_Name, length_AS_Name);
          tmpVal_19 = vdm_DEF_nm;
          Sequence vdm_DEF_id__l;
          succ_18 = true;
          {
            succ_18 = false;
            if (tmpVal_19.IsRecord()) 
              if (vdm_AS_Name == tmpVal_19.GetTag()) {
                Sequence e_l_20;
                for (int i_21 = 1; i_21 <= tmpVal_19.Length(); i_21++) 
                  e_l_20.ImpAppend(tmpVal_19.GetField(i_21));
                if (succ_18 = 2 == (Int) (e_l_20.Length())) {
                  Generic permI_22;
                  permI_22 = (Generic) (e_l_20.Hd());
                  succ_18 = true;
                  {
                    vdm_DEF_id__l = permI_22;
                    succ_18 = true;
                  }
                  permI_22 = (Generic) (e_l_20[2]);
                  if (succ_18) 
                    succ_18 = true;
                }
              }
          }
          if (!succ_18) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Record vdm_DEF_nm__pre(vdm_AS_Name, length_AS_Name);
            vdm_DEF_nm__pre = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_25;
            {
              Sequence tmpVar_26;
              Sequence var2_28;
              Sequence tmpseq_29;
              tmpseq_29 = vdm_DEF_id__l;
              var2_28 = (Sequence) (tmpseq_29[((Int) 1).GetValue()]);
              tmpVar_26.ImpConc(Sequence("pre_")).ImpConc(var2_28);
              tmpVar_25 = Sequence().ImpAppend(tmpVar_26);
            }
            vdm_DEF_nm__pre.SetField(1, tmpVar_25);
            vdm_DEF_nm__pre.SetField(2, Nil());
            {
              Record vdm_DEF_fn__pre(vdm_SEM_ExplFN, length_SEM_ExplFN);
              vdm_DEF_fn__pre = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
              Record tmpVar_34;
              {
                Sequence tmpVar_35;
                {
                  Record tmpRec_36(vdm_AS_OpType, length_AS_OpType);
                  tmpRec_36 = vdm_DEF_tp;
                  if (tmpRec_36.Is(vdm_AS_OpType)) 
                    tmpVar_35 = tmpRec_36.GetField(pos_AS_OpType_opdom);
                  else 
                    RunTime("Unknown record field selector");
                }
                tmpVar_34 = vdm_DEF_CreateOperationPreType(tmpVar_35, vdm_DEF_st__id);
              }
              vdm_DEF_fn__pre.SetField(1, tmpVar_34);
              vdm_DEF_fn__pre.SetField(2, vdm_DEF_CreateOperationPreParms(vdm_DEF_parms, vdm_DEF_gst));
              vdm_DEF_fn__pre.SetField(3, vdm_DEF_Pre__e);
              vdm_DEF_fn__pre.SetField(4, Nil());
              vdm_DEF_fn__pre.SetField(5, Nil());
              vdm_DEF_fn__pre.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
              Map tmpVar_46;
              tmpVar_46 = Map();
              vdm_DEF_fn__pre.SetField(7, tmpVar_46);
              vdm_DEF_fn__pre.SetField(8, vdm_DEF_nm__pre);
              vdm_DEF_fn__pre.SetField(9, vdm_DEF_mod__id);
              vdm_DEF_fn__pre.SetField(10, Nil());
              {
                Map rhs_50;
                {
                  Map seqmap_51;
                  seqmap_51 = vdm_DEF_res__m;
                  Map modmap_52;
                  modmap_52 = Map().Insert(vdm_DEF_nm__pre, vdm_DEF_fn__pre);
                  seqmap_51.ImpOverride(modmap_52);
                  rhs_50 = seqmap_51;
                }
                vdm_DEF_res__m = rhs_50;
              }
            }
          }
        }
      }
      {
        Bool cond_56;
        cond_56 = (Bool) (vdm_DEF_Post__e == Nil());
        if (cond_56.GetValue()) 
          ;
        else {
          bool succ_59;
          Record tmpVal_60(vdm_AS_Name, length_AS_Name);
          tmpVal_60 = vdm_DEF_nm;
          Sequence vdm_DEF_id__l;
          succ_59 = true;
          {
            succ_59 = false;
            if (tmpVal_60.IsRecord()) 
              if (vdm_AS_Name == tmpVal_60.GetTag()) {
                Sequence e_l_61;
                for (int i_62 = 1; i_62 <= tmpVal_60.Length(); i_62++) 
                  e_l_61.ImpAppend(tmpVal_60.GetField(i_62));
                if (succ_59 = 2 == (Int) (e_l_61.Length())) {
                  Generic permI_63;
                  permI_63 = (Generic) (e_l_61.Hd());
                  succ_59 = true;
                  {
                    vdm_DEF_id__l = permI_63;
                    succ_59 = true;
                  }
                  permI_63 = (Generic) (e_l_61[2]);
                  if (succ_59) 
                    succ_59 = true;
                }
              }
          }
          if (!succ_59) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Record vdm_DEF_nm__post(vdm_AS_Name, length_AS_Name);
            vdm_DEF_nm__post = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_66;
            {
              Sequence tmpVar_67;
              Sequence var2_69;
              Sequence tmpseq_70;
              tmpseq_70 = vdm_DEF_id__l;
              var2_69 = (Sequence) (tmpseq_70[((Int) 1).GetValue()]);
              tmpVar_67.ImpConc(Sequence("post_")).ImpConc(var2_69);
              tmpVar_66 = Sequence().ImpAppend(tmpVar_67);
            }
            vdm_DEF_nm__post.SetField(1, tmpVar_66);
            vdm_DEF_nm__post.SetField(2, Nil());
            Record vdm_DEF_tp__post;
            Sequence tmpVar_74;
            {
              Record tmpRec_75(vdm_AS_OpType, length_AS_OpType);
              tmpRec_75 = vdm_DEF_tp;
              if (tmpRec_75.Is(vdm_AS_OpType)) 
                tmpVar_74 = tmpRec_75.GetField(pos_AS_OpType_opdom);
              else 
                RunTime("Unknown record field selector");
            }
            Sequence tmpVar_76;
            {
              Generic tmpVar_77;
              Record tmpRec_78(vdm_AS_OpType, length_AS_OpType);
              tmpRec_78 = vdm_DEF_tp;
              if (tmpRec_78.Is(vdm_AS_OpType)) 
                tmpVar_77 = tmpRec_78.GetField(pos_AS_OpType_oprng);
              else 
                RunTime("Unknown record field selector");
              tmpVar_76 = Sequence().ImpAppend(tmpVar_77);
            }
            vdm_DEF_tp__post = vdm_DEF_CreateOperationPostType(tmpVar_74, tmpVar_76, vdm_DEF_st__id);
            Generic vdm_DEF_expr__post;
            if (((Bool) (vdm_DEF_gst == Nil())).GetValue()) 
              vdm_DEF_expr__post = vdm_DEF_Post__e;
            else { vdm_DEF_expr__post = vdm_DEF_OldNameInExpr(vdm_DEF_Post__e); }
            Sequence vdm_DEF_parm__post;
            Sequence tmpVar_87;
            {
              Generic tmpVar_88;
              Record tmpRec_89(vdm_AS_OpType, length_AS_OpType);
              tmpRec_89 = vdm_DEF_tp;
              if (tmpRec_89.Is(vdm_AS_OpType)) 
                tmpVar_88 = tmpRec_89.GetField(pos_AS_OpType_oprng);
              else 
                RunTime("Unknown record field selector");
              tmpVar_87 = Sequence().ImpAppend(tmpVar_88);
            }
            vdm_DEF_parm__post = vdm_DEF_CreateExplOperationPostParms(vdm_DEF_parms, tmpVar_87, vdm_DEF_gst);
            {
              Record vdm_DEF_fn__post(vdm_SEM_ExplFN, length_SEM_ExplFN);
              vdm_DEF_fn__post = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
              vdm_DEF_fn__post.SetField(1, vdm_DEF_tp__post);
              vdm_DEF_fn__post.SetField(2, vdm_DEF_parm__post);
              vdm_DEF_fn__post.SetField(3, vdm_DEF_expr__post);
              vdm_DEF_fn__post.SetField(4, Nil());
              vdm_DEF_fn__post.SetField(5, Nil());
              vdm_DEF_fn__post.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
              Map tmpVar_100;
              tmpVar_100 = Map();
              vdm_DEF_fn__post.SetField(7, tmpVar_100);
              vdm_DEF_fn__post.SetField(8, vdm_DEF_nm__post);
              vdm_DEF_fn__post.SetField(9, vdm_DEF_mod__id);
              vdm_DEF_fn__post.SetField(10, Nil());
              {
                Map rhs_104;
                {
                  Map seqmap_105;
                  seqmap_105 = vdm_DEF_res__m;
                  Map modmap_106;
                  modmap_106 = Map().Insert(vdm_DEF_nm__post, vdm_DEF_fn__post);
                  seqmap_105.ImpOverride(modmap_106);
                  rhs_104 = seqmap_105;
                }
                vdm_DEF_res__m = rhs_104;
              }
            }
          }
        }
      }
      {
        Map rexpr_110;
        rexpr_110 = vdm_DEF_res__m;
        return rexpr_110;
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: DoCreateExplOpFns");
}

Map vdm_DEF_DoCreateExplPolyPrePostFns(Record var_1_1, Record var_2_2) {
  Generic vdm_DEF_Post__e;
  Generic vdm_DEF_Pre__e;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Record vdm_DEF_name(vdm_AS_Name, length_AS_Name);
  Sequence vdm_DEF_parms;
  Record vdm_DEF_tp;
  Sequence vdm_DEF_ttp;
  bool succ_3 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_3 = true;
  }
  {
    succ_3 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_ExplFnDef == var_2_2.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_2_2.Length(); i_5++) 
          e_l_4.ImpAppend(var_2_2.GetField(i_5));
        if (succ_3 = 7 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_DEF_name = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) {
            vdm_DEF_ttp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[3]);
          if (succ_3) {
            vdm_DEF_tp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[4]);
          if (succ_3) {
            vdm_DEF_parms = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[5]);
          if (succ_3) 
            succ_3 = true;
          permI_6 = (Generic) (e_l_4[6]);
          if (succ_3) {
            vdm_DEF_Pre__e = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[7]);
          if (succ_3) {
            vdm_DEF_Post__e = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  if (succ_3) {
    Map vdm_DEF_res__m;
    vdm_DEF_res__m = Map();
    {
      Bool cond_7;
      cond_7 = (Bool) (vdm_DEF_Pre__e == Nil());
      if (cond_7.GetValue()) 
        ;
      else {
        bool succ_10;
        Record tmpVal_11(vdm_AS_Name, length_AS_Name);
        tmpVal_11 = vdm_DEF_name;
        Sequence vdm_DEF_id__l;
        succ_10 = true;
        {
          succ_10 = false;
          if (tmpVal_11.IsRecord()) 
            if (vdm_AS_Name == tmpVal_11.GetTag()) {
              Sequence e_l_12;
              for (int i_13 = 1; i_13 <= tmpVal_11.Length(); i_13++) 
                e_l_12.ImpAppend(tmpVal_11.GetField(i_13));
              if (succ_10 = 2 == (Int) (e_l_12.Length())) {
                Generic permI_14;
                permI_14 = (Generic) (e_l_12.Hd());
                succ_10 = true;
                {
                  vdm_DEF_id__l = permI_14;
                  succ_10 = true;
                }
                permI_14 = (Generic) (e_l_12[2]);
                if (succ_10) 
                  succ_10 = true;
              }
            }
        }
        if (!succ_10) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Record vdm_DEF_nm__pre(vdm_AS_Name, length_AS_Name);
          vdm_DEF_nm__pre = Record(vdm_AS_Name, length_AS_Name);
          Sequence tmpVar_17;
          {
            Sequence tmpVar_18;
            Sequence var2_20;
            Sequence tmpseq_21;
            tmpseq_21 = vdm_DEF_id__l;
            var2_20 = (Sequence) (tmpseq_21[((Int) 1).GetValue()]);
            tmpVar_18.ImpConc(Sequence("pre_")).ImpConc(var2_20);
            tmpVar_17 = Sequence().ImpAppend(tmpVar_18);
          }
          vdm_DEF_nm__pre.SetField(1, tmpVar_17);
          vdm_DEF_nm__pre.SetField(2, Nil());
          {
            Record vdm_DEF_fn__pre(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
            vdm_DEF_fn__pre = Record(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
            vdm_DEF_fn__pre.SetField(1, vdm_DEF_ttp);
            Record tmpVar_27(vdm_AS_TotalFnType, length_AS_TotalFnType);
            {
              tmpVar_27 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
              Sequence tmpVar_28;
              {
                Record tmpRec_29;
                tmpRec_29 = vdm_DEF_tp;
                if (((Record) tmpRec_29).Is(vdm_AS_TotalFnType)) 
                  tmpVar_28 = ((Record) tmpRec_29).GetField(pos_AS_TotalFnType_fndom);
                else 
                  if (((Record) tmpRec_29).Is(vdm_AS_PartialFnType)) 
                    tmpVar_28 = ((Record) tmpRec_29).GetField(pos_AS_PartialFnType_fndom);
                  else 
                    RunTime("Unknown record field selector");
              }
              tmpVar_27.SetField(1, tmpVar_28);
              Record tmpVar_30(vdm_AS_BasicType, length_AS_BasicType);
              {
                tmpVar_30 = Record(vdm_AS_BasicType, length_AS_BasicType);
                tmpVar_30.SetField(1, (Quote) "BOOLEAN");
              }
              tmpVar_27.SetField(2, tmpVar_30);
            }
            vdm_DEF_fn__pre.SetField(2, tmpVar_27);
            Sequence tmpVar_32;
            tmpVar_32 = Sequence().ImpAppend((Sequence) (vdm_DEF_parms.Hd()));
            vdm_DEF_fn__pre.SetField(3, tmpVar_32);
            vdm_DEF_fn__pre.SetField(4, vdm_DEF_Pre__e);
            vdm_DEF_fn__pre.SetField(5, Nil());
            vdm_DEF_fn__pre.SetField(6, Nil());
            vdm_DEF_fn__pre.SetField(7, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
            vdm_DEF_fn__pre.SetField(8, vdm_DEF_nm__pre);
            vdm_DEF_fn__pre.SetField(9, vdm_DEF_mod__id);
            vdm_DEF_fn__pre.SetField(10, Nil());
            {
              Map rhs_43;
              {
                Map seqmap_44;
                seqmap_44 = vdm_DEF_res__m;
                Map modmap_45;
                modmap_45 = Map().Insert(vdm_DEF_nm__pre, vdm_DEF_fn__pre);
                seqmap_44.ImpOverride(modmap_45);
                rhs_43 = seqmap_44;
              }
              vdm_DEF_res__m = rhs_43;
            }
          }
        }
      }
    }
    {
      Bool cond_49;
      cond_49 = (Bool) (vdm_DEF_Post__e == Nil());
      if (cond_49.GetValue()) 
        ;
      else {
        bool succ_52;
        Record tmpVal_53(vdm_AS_Name, length_AS_Name);
        tmpVal_53 = vdm_DEF_name;
        Sequence vdm_DEF_id__l;
        succ_52 = true;
        {
          succ_52 = false;
          if (tmpVal_53.IsRecord()) 
            if (vdm_AS_Name == tmpVal_53.GetTag()) {
              Sequence e_l_54;
              for (int i_55 = 1; i_55 <= tmpVal_53.Length(); i_55++) 
                e_l_54.ImpAppend(tmpVal_53.GetField(i_55));
              if (succ_52 = 2 == (Int) (e_l_54.Length())) {
                Generic permI_56;
                permI_56 = (Generic) (e_l_54.Hd());
                succ_52 = true;
                {
                  vdm_DEF_id__l = permI_56;
                  succ_52 = true;
                }
                permI_56 = (Generic) (e_l_54[2]);
                if (succ_52) 
                  succ_52 = true;
              }
            }
        }
        if (!succ_52) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Record vdm_DEF_nm__post(vdm_AS_Name, length_AS_Name);
          vdm_DEF_nm__post = Record(vdm_AS_Name, length_AS_Name);
          Sequence tmpVar_59;
          {
            Sequence tmpVar_60;
            Sequence var2_62;
            Sequence tmpseq_63;
            tmpseq_63 = vdm_DEF_id__l;
            var2_62 = (Sequence) (tmpseq_63[((Int) 1).GetValue()]);
            tmpVar_60.ImpConc(Sequence("post_")).ImpConc(var2_62);
            tmpVar_59 = Sequence().ImpAppend(tmpVar_60);
          }
          vdm_DEF_nm__post.SetField(1, tmpVar_59);
          vdm_DEF_nm__post.SetField(2, Nil());
          Record vdm_DEF_tp__post;
          Sequence tmpVar_67;
          {
            Record tmpRec_68;
            tmpRec_68 = vdm_DEF_tp;
            if (((Record) tmpRec_68).Is(vdm_AS_TotalFnType)) 
              tmpVar_67 = ((Record) tmpRec_68).GetField(pos_AS_TotalFnType_fndom);
            else 
              if (((Record) tmpRec_68).Is(vdm_AS_PartialFnType)) 
                tmpVar_67 = ((Record) tmpRec_68).GetField(pos_AS_PartialFnType_fndom);
              else 
                RunTime("Unknown record field selector");
          }
          Sequence tmpVar_69;
          {
            Record tmpVar_70;
            Record tmpRec_71;
            tmpRec_71 = vdm_DEF_tp;
            if (((Record) tmpRec_71).Is(vdm_AS_TotalFnType)) 
              tmpVar_70 = ((Record) tmpRec_71).GetField(pos_AS_TotalFnType_fnrng);
            else 
              if (((Record) tmpRec_71).Is(vdm_AS_PartialFnType)) 
                tmpVar_70 = ((Record) tmpRec_71).GetField(pos_AS_PartialFnType_fnrng);
              else 
                RunTime("Unknown record field selector");
            tmpVar_69 = Sequence().ImpAppend(tmpVar_70);
          }
          vdm_DEF_tp__post = vdm_DEF_CreateFunctionPostType(tmpVar_67, tmpVar_69);
          Sequence vdm_DEF_parm__post;
          Sequence var2_74;
          Record tmpVar_76(vdm_AS_PatternName, length_AS_PatternName);
          tmpVar_76 = Record(vdm_AS_PatternName, length_AS_PatternName);
          Record tmpVar_77(vdm_AS_Name, length_AS_Name);
          {
            tmpVar_77 = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_78;
            tmpVar_78 = Sequence().ImpAppend(Sequence("RESULT"));
            tmpVar_77.SetField(1, tmpVar_78);
            tmpVar_77.SetField(2, Nil());
          }
          tmpVar_76.SetField(1, tmpVar_77);
          tmpVar_76.SetField(2, Nil());
          var2_74 = Sequence().ImpAppend(tmpVar_76);
          vdm_DEF_parm__post.ImpConc((Sequence) (vdm_DEF_parms.Hd())).ImpConc(var2_74);
          {
            Record vdm_DEF_fn__post(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
            vdm_DEF_fn__post = Record(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
            vdm_DEF_fn__post.SetField(1, vdm_DEF_ttp);
            vdm_DEF_fn__post.SetField(2, vdm_DEF_tp__post);
            Sequence tmpVar_86;
            tmpVar_86 = Sequence().ImpAppend(vdm_DEF_parm__post);
            vdm_DEF_fn__post.SetField(3, tmpVar_86);
            vdm_DEF_fn__post.SetField(4, vdm_DEF_Post__e);
            vdm_DEF_fn__post.SetField(5, Nil());
            vdm_DEF_fn__post.SetField(6, Nil());
            vdm_DEF_fn__post.SetField(7, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
            vdm_DEF_fn__post.SetField(8, vdm_DEF_nm__post);
            vdm_DEF_fn__post.SetField(9, vdm_DEF_mod__id);
            vdm_DEF_fn__post.SetField(10, Nil());
            {
              Map rhs_96;
              {
                Map seqmap_97;
                seqmap_97 = vdm_DEF_res__m;
                Map modmap_98;
                modmap_98 = Map().Insert(vdm_DEF_nm__post, vdm_DEF_fn__post);
                seqmap_97.ImpOverride(modmap_98);
                rhs_96 = seqmap_97;
              }
              vdm_DEF_res__m = rhs_96;
            }
          }
        }
      }
    }
    {
      Map rexpr_102;
      rexpr_102 = vdm_DEF_res__m;
      return rexpr_102;
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: DoCreateExplPolyPrePostFns");
}

Map vdm_DEF_DoCreateExplPrePostFns(Record var_1_1, Record var_2_2) {
  Generic vdm_DEF_Post__e;
  Generic vdm_DEF_Pre__e;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Record vdm_DEF_name(vdm_AS_Name, length_AS_Name);
  Sequence vdm_DEF_parms;
  Record vdm_DEF_tp;
  bool succ_3 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_3 = true;
  }
  {
    succ_3 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_ExplFnDef == var_2_2.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_2_2.Length(); i_5++) 
          e_l_4.ImpAppend(var_2_2.GetField(i_5));
        if (succ_3 = 7 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_DEF_name = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) 
            succ_3 = true;
          permI_6 = (Generic) (e_l_4[3]);
          if (succ_3) {
            vdm_DEF_tp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[4]);
          if (succ_3) {
            vdm_DEF_parms = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[5]);
          if (succ_3) 
            succ_3 = true;
          permI_6 = (Generic) (e_l_4[6]);
          if (succ_3) {
            vdm_DEF_Pre__e = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[7]);
          if (succ_3) {
            vdm_DEF_Post__e = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  if (succ_3) {
    Map vdm_DEF_res__m;
    vdm_DEF_res__m = Map();
    {
      Bool cond_7;
      cond_7 = (Bool) (vdm_DEF_Pre__e == Nil());
      if (cond_7.GetValue()) 
        ;
      else {
        bool succ_10;
        Record tmpVal_11(vdm_AS_Name, length_AS_Name);
        tmpVal_11 = vdm_DEF_name;
        Sequence vdm_DEF_id__l;
        succ_10 = true;
        {
          succ_10 = false;
          if (tmpVal_11.IsRecord()) 
            if (vdm_AS_Name == tmpVal_11.GetTag()) {
              Sequence e_l_12;
              for (int i_13 = 1; i_13 <= tmpVal_11.Length(); i_13++) 
                e_l_12.ImpAppend(tmpVal_11.GetField(i_13));
              if (succ_10 = 2 == (Int) (e_l_12.Length())) {
                Generic permI_14;
                permI_14 = (Generic) (e_l_12.Hd());
                succ_10 = true;
                {
                  vdm_DEF_id__l = permI_14;
                  succ_10 = true;
                }
                permI_14 = (Generic) (e_l_12[2]);
                if (succ_10) 
                  succ_10 = true;
              }
            }
        }
        if (!succ_10) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Record vdm_DEF_nm__pre(vdm_AS_Name, length_AS_Name);
          vdm_DEF_nm__pre = Record(vdm_AS_Name, length_AS_Name);
          Sequence tmpVar_17;
          {
            Sequence tmpVar_18;
            Sequence var2_20;
            Sequence tmpseq_21;
            tmpseq_21 = vdm_DEF_id__l;
            var2_20 = (Sequence) (tmpseq_21[((Int) 1).GetValue()]);
            tmpVar_18.ImpConc(Sequence("pre_")).ImpConc(var2_20);
            tmpVar_17 = Sequence().ImpAppend(tmpVar_18);
          }
          vdm_DEF_nm__pre.SetField(1, tmpVar_17);
          vdm_DEF_nm__pre.SetField(2, Nil());
          {
            Record vdm_DEF_fn__pre(vdm_SEM_ExplFN, length_SEM_ExplFN);
            vdm_DEF_fn__pre = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
            Record tmpVar_26(vdm_AS_TotalFnType, length_AS_TotalFnType);
            {
              tmpVar_26 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
              Sequence tmpVar_27;
              {
                Record tmpRec_28;
                tmpRec_28 = vdm_DEF_tp;
                if (((Record) tmpRec_28).Is(vdm_AS_TotalFnType)) 
                  tmpVar_27 = ((Record) tmpRec_28).GetField(pos_AS_TotalFnType_fndom);
                else 
                  if (((Record) tmpRec_28).Is(vdm_AS_PartialFnType)) 
                    tmpVar_27 = ((Record) tmpRec_28).GetField(pos_AS_PartialFnType_fndom);
                  else 
                    RunTime("Unknown record field selector");
              }
              tmpVar_26.SetField(1, tmpVar_27);
              Record tmpVar_29(vdm_AS_BasicType, length_AS_BasicType);
              {
                tmpVar_29 = Record(vdm_AS_BasicType, length_AS_BasicType);
                tmpVar_29.SetField(1, (Quote) "BOOLEAN");
              }
              tmpVar_26.SetField(2, tmpVar_29);
            }
            vdm_DEF_fn__pre.SetField(1, tmpVar_26);
            Sequence tmpVar_31;
            tmpVar_31 = Sequence().ImpAppend((Sequence) (vdm_DEF_parms.Hd()));
            vdm_DEF_fn__pre.SetField(2, tmpVar_31);
            vdm_DEF_fn__pre.SetField(3, vdm_DEF_Pre__e);
            vdm_DEF_fn__pre.SetField(4, Nil());
            vdm_DEF_fn__pre.SetField(5, Nil());
            vdm_DEF_fn__pre.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
            Map tmpVar_39;
            tmpVar_39 = Map();
            vdm_DEF_fn__pre.SetField(7, tmpVar_39);
            vdm_DEF_fn__pre.SetField(8, vdm_DEF_nm__pre);
            vdm_DEF_fn__pre.SetField(9, vdm_DEF_mod__id);
            vdm_DEF_fn__pre.SetField(10, Nil());
            {
              Map rhs_43;
              {
                Map seqmap_44;
                seqmap_44 = vdm_DEF_res__m;
                Map modmap_45;
                modmap_45 = Map().Insert(vdm_DEF_nm__pre, vdm_DEF_fn__pre);
                seqmap_44.ImpOverride(modmap_45);
                rhs_43 = seqmap_44;
              }
              vdm_DEF_res__m = rhs_43;
            }
          }
        }
      }
    }
    {
      Bool cond_49;
      cond_49 = (Bool) (vdm_DEF_Post__e == Nil());
      if (cond_49.GetValue()) 
        ;
      else {
        bool succ_52;
        Record tmpVal_53(vdm_AS_Name, length_AS_Name);
        tmpVal_53 = vdm_DEF_name;
        Sequence vdm_DEF_id__l;
        succ_52 = true;
        {
          succ_52 = false;
          if (tmpVal_53.IsRecord()) 
            if (vdm_AS_Name == tmpVal_53.GetTag()) {
              Sequence e_l_54;
              for (int i_55 = 1; i_55 <= tmpVal_53.Length(); i_55++) 
                e_l_54.ImpAppend(tmpVal_53.GetField(i_55));
              if (succ_52 = 2 == (Int) (e_l_54.Length())) {
                Generic permI_56;
                permI_56 = (Generic) (e_l_54.Hd());
                succ_52 = true;
                {
                  vdm_DEF_id__l = permI_56;
                  succ_52 = true;
                }
                permI_56 = (Generic) (e_l_54[2]);
                if (succ_52) 
                  succ_52 = true;
              }
            }
        }
        if (!succ_52) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Record vdm_DEF_nm__post(vdm_AS_Name, length_AS_Name);
          vdm_DEF_nm__post = Record(vdm_AS_Name, length_AS_Name);
          Sequence tmpVar_59;
          {
            Sequence tmpVar_60;
            Sequence var2_62;
            Sequence tmpseq_63;
            tmpseq_63 = vdm_DEF_id__l;
            var2_62 = (Sequence) (tmpseq_63[((Int) 1).GetValue()]);
            tmpVar_60.ImpConc(Sequence("post_")).ImpConc(var2_62);
            tmpVar_59 = Sequence().ImpAppend(tmpVar_60);
          }
          vdm_DEF_nm__post.SetField(1, tmpVar_59);
          vdm_DEF_nm__post.SetField(2, Nil());
          Record vdm_DEF_tp__post;
          Sequence tmpVar_67;
          {
            Record tmpRec_68;
            tmpRec_68 = vdm_DEF_tp;
            if (((Record) tmpRec_68).Is(vdm_AS_TotalFnType)) 
              tmpVar_67 = ((Record) tmpRec_68).GetField(pos_AS_TotalFnType_fndom);
            else 
              if (((Record) tmpRec_68).Is(vdm_AS_PartialFnType)) 
                tmpVar_67 = ((Record) tmpRec_68).GetField(pos_AS_PartialFnType_fndom);
              else 
                RunTime("Unknown record field selector");
          }
          Sequence tmpVar_69;
          {
            Record tmpVar_70;
            Record tmpRec_71;
            tmpRec_71 = vdm_DEF_tp;
            if (((Record) tmpRec_71).Is(vdm_AS_TotalFnType)) 
              tmpVar_70 = ((Record) tmpRec_71).GetField(pos_AS_TotalFnType_fnrng);
            else 
              if (((Record) tmpRec_71).Is(vdm_AS_PartialFnType)) 
                tmpVar_70 = ((Record) tmpRec_71).GetField(pos_AS_PartialFnType_fnrng);
              else 
                RunTime("Unknown record field selector");
            tmpVar_69 = Sequence().ImpAppend(tmpVar_70);
          }
          vdm_DEF_tp__post = vdm_DEF_CreateFunctionPostType(tmpVar_67, tmpVar_69);
          Sequence vdm_DEF_parm__post;
          Sequence var2_74;
          Record tmpVar_76(vdm_AS_PatternName, length_AS_PatternName);
          tmpVar_76 = Record(vdm_AS_PatternName, length_AS_PatternName);
          Record tmpVar_77(vdm_AS_Name, length_AS_Name);
          {
            tmpVar_77 = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_78;
            tmpVar_78 = Sequence().ImpAppend(Sequence("RESULT"));
            tmpVar_77.SetField(1, tmpVar_78);
            tmpVar_77.SetField(2, Nil());
          }
          tmpVar_76.SetField(1, tmpVar_77);
          tmpVar_76.SetField(2, Nil());
          var2_74 = Sequence().ImpAppend(tmpVar_76);
          vdm_DEF_parm__post.ImpConc((Sequence) (vdm_DEF_parms.Hd())).ImpConc(var2_74);
          {
            Record vdm_DEF_fn__post(vdm_SEM_ExplFN, length_SEM_ExplFN);
            vdm_DEF_fn__post = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
            vdm_DEF_fn__post.SetField(1, vdm_DEF_tp__post);
            Sequence tmpVar_85;
            tmpVar_85 = Sequence().ImpAppend(vdm_DEF_parm__post);
            vdm_DEF_fn__post.SetField(2, tmpVar_85);
            vdm_DEF_fn__post.SetField(3, vdm_DEF_Post__e);
            vdm_DEF_fn__post.SetField(4, Nil());
            vdm_DEF_fn__post.SetField(5, Nil());
            vdm_DEF_fn__post.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
            Map tmpVar_92;
            tmpVar_92 = Map();
            vdm_DEF_fn__post.SetField(7, tmpVar_92);
            vdm_DEF_fn__post.SetField(8, vdm_DEF_nm__post);
            vdm_DEF_fn__post.SetField(9, vdm_DEF_mod__id);
            vdm_DEF_fn__post.SetField(10, Nil());
            {
              Map rhs_96;
              {
                Map seqmap_97;
                seqmap_97 = vdm_DEF_res__m;
                Map modmap_98;
                modmap_98 = Map().Insert(vdm_DEF_nm__post, vdm_DEF_fn__post);
                seqmap_97.ImpOverride(modmap_98);
                rhs_96 = seqmap_97;
              }
              vdm_DEF_res__m = rhs_96;
            }
          }
        }
      }
    }
    {
      Map rexpr_102;
      rexpr_102 = vdm_DEF_res__m;
      return rexpr_102;
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: DoCreateExplPrePostFns");
}

Map vdm_DEF_DoCreateExtExplOpFns(Record var_1_1, Record var_2_2, Generic var_3_3) {
  Generic vdm_DEF_Post__e;
  Generic vdm_DEF_Pre__e;
  Generic vdm_DEF_gst;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
  Sequence vdm_DEF_partps;
  Sequence vdm_DEF_resnmtps;
  bool succ_4 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_4 = true;
  }
  {
    succ_4 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_ExtExplOpDef == var_2_2.GetTag()) {
        Sequence e_l_5;
        for (int i_6 = 1; i_6 <= var_2_2.Length(); i_6++) 
          e_l_5.ImpAppend(var_2_2.GetField(i_6));
        if (succ_4 = 8 == (Int) (e_l_5.Length())) {
          Generic permI_7;
          permI_7 = (Generic) (e_l_5.Hd());
          succ_4 = true;
          {
            vdm_DEF_nm = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[2]);
          if (succ_4) {
            vdm_DEF_partps = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[3]);
          if (succ_4) {
            vdm_DEF_resnmtps = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[4]);
          if (succ_4) 
            succ_4 = true;
          permI_7 = (Generic) (e_l_5[5]);
          if (succ_4) 
            succ_4 = true;
          permI_7 = (Generic) (e_l_5[6]);
          if (succ_4) {
            vdm_DEF_Pre__e = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[7]);
          if (succ_4) {
            vdm_DEF_Post__e = permI_7;
            succ_4 = true;
          }
          permI_7 = (Generic) (e_l_5[8]);
          if (succ_4) 
            succ_4 = true;
        }
      }
  }
  {
    vdm_DEF_gst = var_3_3;
    succ_4 = true;
  }
  if (succ_4) {
    bool succ_8;
    Tuple tmpVal_9(2);
    tmpVal_9 = vdm_DEF_ImplicitTypeParams(vdm_DEF_partps);
    Sequence vdm_DEF_opdom;
    Sequence vdm_DEF_parms;
    succ_8 = true;
    {
      succ_8 = false;
      if (tmpVal_9.IsTuple()) {
        Sequence e_l_11;
        for (int i_12 = 1; i_12 <= ((Tuple) tmpVal_9).Length(); i_12++) 
          e_l_11.ImpAppend(((Tuple) tmpVal_9).GetField(i_12));
        if (succ_8 = 2 == (Int) (e_l_11.Length())) {
          Sequence permI_13;
          permI_13 = (Sequence) (e_l_11.Hd());
          succ_8 = true;
          {
            vdm_DEF_opdom = permI_13;
            succ_8 = true;
          }
          permI_13 = (Sequence) (e_l_11[2]);
          if (succ_8) {
            vdm_DEF_parms = permI_13;
            succ_8 = true;
          }
        }
      }
    }
    if (!succ_8) 
      RunTime("Pattern match did not succeed in value definition");
    Tuple tmpVal_14(2);
    tmpVal_14 = vdm_DEF_ImplicitResNameTypes(vdm_DEF_resnmtps);
    Sequence vdm_DEF_resnms;
    Sequence vdm_DEF_restps;
    succ_8 = true;
    {
      succ_8 = false;
      if (tmpVal_14.IsTuple()) {
        Sequence e_l_16;
        for (int i_17 = 1; i_17 <= ((Tuple) tmpVal_14).Length(); i_17++) 
          e_l_16.ImpAppend(((Tuple) tmpVal_14).GetField(i_17));
        if (succ_8 = 2 == (Int) (e_l_16.Length())) {
          Sequence permI_18;
          permI_18 = (Sequence) (e_l_16.Hd());
          succ_8 = true;
          {
            vdm_DEF_resnms = permI_18;
            succ_8 = true;
          }
          permI_18 = (Sequence) (e_l_16[2]);
          if (succ_8) {
            vdm_DEF_restps = permI_18;
            succ_8 = true;
          }
        }
      }
    }
    if (!succ_8) 
      RunTime("Pattern match did not succeed in value definition");
    {
      bool succ_19;
      Generic tmpVal_20;
{ if (((Bool) (vdm_DEF_gst == Nil())).GetValue()) 
   tmpVal_20 = Nil();
 else {
   Record tmpRec_24(vdm_AS_CompositeType, length_AS_CompositeType);
   {
     Generic tmpRec_25;
     tmpRec_25 = vdm_DEF_gst;
     if (tmpRec_25.IsRecord()) 
       if (((Record) tmpRec_25).Is(vdm_AS_StateDef)) 
         tmpRec_24 = ((Record) tmpRec_25).GetField(pos_AS_StateDef_tp);
       else 
         RunTime("Unknown record field selector");
     else 
       RunTime("A record was expected");
   }
   if (tmpRec_24.Is(vdm_AS_CompositeType)) 
     tmpVal_20 = tmpRec_24.GetField(pos_AS_CompositeType_name);
   else 
     RunTime("Unknown record field selector");
 } }
      Generic vdm_DEF_st__id;
      succ_19 = true;
      {
        vdm_DEF_st__id = tmpVal_20;
        succ_19 = true;
      }
      if (!succ_19) 
        RunTime("Pattern match did not succeed in value definition");
      {
        Map vdm_DEF_res__m;
        vdm_DEF_res__m = Map();
        {
          Bool cond_26;
          cond_26 = (Bool) (vdm_DEF_Pre__e == Nil());
          if (cond_26.GetValue()) 
            ;
          else {
            bool succ_29;
            Record tmpVal_30(vdm_AS_Name, length_AS_Name);
            tmpVal_30 = vdm_DEF_nm;
            Sequence vdm_DEF_id__l;
            succ_29 = true;
            {
              succ_29 = false;
              if (tmpVal_30.IsRecord()) 
                if (vdm_AS_Name == tmpVal_30.GetTag()) {
                  Sequence e_l_31;
                  for (int i_32 = 1; i_32 <= tmpVal_30.Length(); i_32++) 
                    e_l_31.ImpAppend(tmpVal_30.GetField(i_32));
                  if (succ_29 = 2 == (Int) (e_l_31.Length())) {
                    Generic permI_33;
                    permI_33 = (Generic) (e_l_31.Hd());
                    succ_29 = true;
                    {
                      vdm_DEF_id__l = permI_33;
                      succ_29 = true;
                    }
                    permI_33 = (Generic) (e_l_31[2]);
                    if (succ_29) 
                      succ_29 = true;
                  }
                }
            }
            if (!succ_29) 
              RunTime("Pattern match did not succeed in value definition");
            {
              Record vdm_DEF_nm__pre(vdm_AS_Name, length_AS_Name);
              vdm_DEF_nm__pre = Record(vdm_AS_Name, length_AS_Name);
              Sequence tmpVar_36;
              {
                Sequence tmpVar_37;
                Sequence var2_39;
                Sequence tmpseq_40;
                tmpseq_40 = vdm_DEF_id__l;
                var2_39 = (Sequence) (tmpseq_40[((Int) 1).GetValue()]);
                tmpVar_37.ImpConc(Sequence("pre_")).ImpConc(var2_39);
                tmpVar_36 = Sequence().ImpAppend(tmpVar_37);
              }
              vdm_DEF_nm__pre.SetField(1, tmpVar_36);
              vdm_DEF_nm__pre.SetField(2, Nil());
              {
                Record vdm_DEF_fn__pre(vdm_SEM_ExplFN, length_SEM_ExplFN);
                vdm_DEF_fn__pre = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
                vdm_DEF_fn__pre.SetField(1, vdm_DEF_CreateOperationPreType(vdm_DEF_opdom, vdm_DEF_st__id));
                vdm_DEF_fn__pre.SetField(2, vdm_DEF_CreateOperationPreParms(vdm_DEF_parms, vdm_DEF_gst));
                vdm_DEF_fn__pre.SetField(3, vdm_DEF_Pre__e);
                vdm_DEF_fn__pre.SetField(4, Nil());
                vdm_DEF_fn__pre.SetField(5, Nil());
                vdm_DEF_fn__pre.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
                Map tmpVar_56;
                tmpVar_56 = Map();
                vdm_DEF_fn__pre.SetField(7, tmpVar_56);
                vdm_DEF_fn__pre.SetField(8, vdm_DEF_nm__pre);
                vdm_DEF_fn__pre.SetField(9, vdm_DEF_mod__id);
                vdm_DEF_fn__pre.SetField(10, Nil());
                {
                  Map rhs_60;
                  {
                    Map seqmap_61;
                    seqmap_61 = vdm_DEF_res__m;
                    Map modmap_62;
                    modmap_62 = Map().Insert(vdm_DEF_nm__pre, vdm_DEF_fn__pre);
                    seqmap_61.ImpOverride(modmap_62);
                    rhs_60 = seqmap_61;
                  }
                  vdm_DEF_res__m = rhs_60;
                }
              }
            }
          }
        }
        {
          Bool cond_66;
          cond_66 = (Bool) (vdm_DEF_Post__e == Nil());
          if (cond_66.GetValue()) 
            ;
          else {
            bool succ_69;
            Record tmpVal_70(vdm_AS_Name, length_AS_Name);
            tmpVal_70 = vdm_DEF_nm;
            Sequence vdm_DEF_id__l;
            succ_69 = true;
            {
              succ_69 = false;
              if (tmpVal_70.IsRecord()) 
                if (vdm_AS_Name == tmpVal_70.GetTag()) {
                  Sequence e_l_71;
                  for (int i_72 = 1; i_72 <= tmpVal_70.Length(); i_72++) 
                    e_l_71.ImpAppend(tmpVal_70.GetField(i_72));
                  if (succ_69 = 2 == (Int) (e_l_71.Length())) {
                    Generic permI_73;
                    permI_73 = (Generic) (e_l_71.Hd());
                    succ_69 = true;
                    {
                      vdm_DEF_id__l = permI_73;
                      succ_69 = true;
                    }
                    permI_73 = (Generic) (e_l_71[2]);
                    if (succ_69) 
                      succ_69 = true;
                  }
                }
            }
            if (!succ_69) 
              RunTime("Pattern match did not succeed in value definition");
            {
              Record vdm_DEF_nm__post(vdm_AS_Name, length_AS_Name);
              vdm_DEF_nm__post = Record(vdm_AS_Name, length_AS_Name);
              Sequence tmpVar_76;
              {
                Sequence tmpVar_77;
                Sequence var2_79;
                Sequence tmpseq_80;
                tmpseq_80 = vdm_DEF_id__l;
                var2_79 = (Sequence) (tmpseq_80[((Int) 1).GetValue()]);
                tmpVar_77.ImpConc(Sequence("post_")).ImpConc(var2_79);
                tmpVar_76 = Sequence().ImpAppend(tmpVar_77);
              }
              vdm_DEF_nm__post.SetField(1, tmpVar_76);
              vdm_DEF_nm__post.SetField(2, Nil());
              Record vdm_DEF_tp__post;
              vdm_DEF_tp__post = vdm_DEF_CreateOperationPostType(vdm_DEF_opdom, vdm_DEF_restps, vdm_DEF_st__id);
              Generic vdm_DEF_expr__post;
              if (((Bool) (vdm_DEF_gst == Nil())).GetValue()) 
                vdm_DEF_expr__post = vdm_DEF_Post__e;
              else { vdm_DEF_expr__post = vdm_DEF_OldNameInExpr(vdm_DEF_Post__e); }
              Sequence vdm_DEF_parm__post;
              vdm_DEF_parm__post = vdm_DEF_CreateExtExplOperationPostParms(vdm_DEF_parms, vdm_DEF_resnms, vdm_DEF_gst);
              {
                Record vdm_DEF_fn__post(vdm_SEM_ExplFN, length_SEM_ExplFN);
                vdm_DEF_fn__post = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
                vdm_DEF_fn__post.SetField(1, vdm_DEF_tp__post);
                vdm_DEF_fn__post.SetField(2, vdm_DEF_parm__post);
                vdm_DEF_fn__post.SetField(3, vdm_DEF_expr__post);
                vdm_DEF_fn__post.SetField(4, Nil());
                vdm_DEF_fn__post.SetField(5, Nil());
                vdm_DEF_fn__post.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
                Map tmpVar_105;
                tmpVar_105 = Map();
                vdm_DEF_fn__post.SetField(7, tmpVar_105);
                vdm_DEF_fn__post.SetField(8, vdm_DEF_nm__post);
                vdm_DEF_fn__post.SetField(9, vdm_DEF_mod__id);
                vdm_DEF_fn__post.SetField(10, Nil());
                {
                  Map rhs_109;
                  {
                    Map seqmap_110;
                    seqmap_110 = vdm_DEF_res__m;
                    Map modmap_111;
                    modmap_111 = Map().Insert(vdm_DEF_nm__post, vdm_DEF_fn__post);
                    seqmap_110.ImpOverride(modmap_111);
                    rhs_109 = seqmap_110;
                  }
                  vdm_DEF_res__m = rhs_109;
                }
              }
            }
          }
        }
        {
          Map rexpr_115;
          rexpr_115 = vdm_DEF_res__m;
          return rexpr_115;
        }
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: DoCreateExtExplOpFns");
}

Map vdm_DEF_DoCreateExtExplPolyPrePostFns(Record var_1_1, Record var_2_2) {
  Generic vdm_DEF_Post__e;
  Generic vdm_DEF_Pre__e;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Record vdm_DEF_name(vdm_AS_Name, length_AS_Name);
  Sequence vdm_DEF_parml;
  Sequence vdm_DEF_resnmtps;
  Sequence vdm_DEF_ttp;
  bool succ_3 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_3 = true;
  }
  {
    succ_3 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_ExtExplFnDef == var_2_2.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_2_2.Length(); i_5++) 
          e_l_4.ImpAppend(var_2_2.GetField(i_5));
        if (succ_3 = 7 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_DEF_name = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) {
            vdm_DEF_ttp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[3]);
          if (succ_3) {
            vdm_DEF_parml = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[4]);
          if (succ_3) {
            vdm_DEF_resnmtps = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[5]);
          if (succ_3) 
            succ_3 = true;
          permI_6 = (Generic) (e_l_4[6]);
          if (succ_3) {
            vdm_DEF_Pre__e = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[7]);
          if (succ_3) {
            vdm_DEF_Post__e = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  if (succ_3) {
    bool succ_7;
    Tuple tmpVal_8(2);
    tmpVal_8 = vdm_DEF_ImplicitTypeParams(vdm_DEF_parml);
    Sequence vdm_DEF_fndom;
    Sequence vdm_DEF_parms;
    succ_7 = true;
    {
      succ_7 = false;
      if (tmpVal_8.IsTuple()) {
        Sequence e_l_10;
        for (int i_11 = 1; i_11 <= ((Tuple) tmpVal_8).Length(); i_11++) 
          e_l_10.ImpAppend(((Tuple) tmpVal_8).GetField(i_11));
        if (succ_7 = 2 == (Int) (e_l_10.Length())) {
          Sequence permI_12;
          permI_12 = (Sequence) (e_l_10.Hd());
          succ_7 = true;
          {
            vdm_DEF_fndom = permI_12;
            succ_7 = true;
          }
          permI_12 = (Sequence) (e_l_10[2]);
          if (succ_7) {
            vdm_DEF_parms = permI_12;
            succ_7 = true;
          }
        }
      }
    }
    if (!succ_7) 
      RunTime("Pattern match did not succeed in value definition");
    Tuple tmpVal_13(2);
    tmpVal_13 = vdm_DEF_ImplicitResNameTypes(vdm_DEF_resnmtps);
    Sequence vdm_DEF_resnms;
    Sequence vdm_DEF_restps;
    succ_7 = true;
    {
      succ_7 = false;
      if (tmpVal_13.IsTuple()) {
        Sequence e_l_15;
        for (int i_16 = 1; i_16 <= ((Tuple) tmpVal_13).Length(); i_16++) 
          e_l_15.ImpAppend(((Tuple) tmpVal_13).GetField(i_16));
        if (succ_7 = 2 == (Int) (e_l_15.Length())) {
          Sequence permI_17;
          permI_17 = (Sequence) (e_l_15.Hd());
          succ_7 = true;
          {
            vdm_DEF_resnms = permI_17;
            succ_7 = true;
          }
          permI_17 = (Sequence) (e_l_15[2]);
          if (succ_7) {
            vdm_DEF_restps = permI_17;
            succ_7 = true;
          }
        }
      }
    }
    if (!succ_7) 
      RunTime("Pattern match did not succeed in value definition");
    {
      Map vdm_DEF_res__m;
      vdm_DEF_res__m = Map();
      {
        Bool cond_18;
        cond_18 = (Bool) (vdm_DEF_Pre__e == Nil());
        if (cond_18.GetValue()) 
          ;
        else {
          bool succ_21;
          Record tmpVal_22(vdm_AS_Name, length_AS_Name);
          tmpVal_22 = vdm_DEF_name;
          Sequence vdm_DEF_id__l;
          succ_21 = true;
          {
            succ_21 = false;
            if (tmpVal_22.IsRecord()) 
              if (vdm_AS_Name == tmpVal_22.GetTag()) {
                Sequence e_l_23;
                for (int i_24 = 1; i_24 <= tmpVal_22.Length(); i_24++) 
                  e_l_23.ImpAppend(tmpVal_22.GetField(i_24));
                if (succ_21 = 2 == (Int) (e_l_23.Length())) {
                  Generic permI_25;
                  permI_25 = (Generic) (e_l_23.Hd());
                  succ_21 = true;
                  {
                    vdm_DEF_id__l = permI_25;
                    succ_21 = true;
                  }
                  permI_25 = (Generic) (e_l_23[2]);
                  if (succ_21) 
                    succ_21 = true;
                }
              }
          }
          if (!succ_21) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Record vdm_DEF_nm__pre(vdm_AS_Name, length_AS_Name);
            vdm_DEF_nm__pre = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_28;
            {
              Sequence tmpVar_29;
              Sequence var2_31;
              Sequence tmpseq_32;
              tmpseq_32 = vdm_DEF_id__l;
              var2_31 = (Sequence) (tmpseq_32[((Int) 1).GetValue()]);
              tmpVar_29.ImpConc(Sequence("pre_")).ImpConc(var2_31);
              tmpVar_28 = Sequence().ImpAppend(tmpVar_29);
            }
            vdm_DEF_nm__pre.SetField(1, tmpVar_28);
            vdm_DEF_nm__pre.SetField(2, Nil());
            {
              Record vdm_DEF_fn__pre(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
              vdm_DEF_fn__pre = Record(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
              vdm_DEF_fn__pre.SetField(1, vdm_DEF_ttp);
              Record tmpVar_38(vdm_AS_TotalFnType, length_AS_TotalFnType);
              {
                tmpVar_38 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
                tmpVar_38.SetField(1, vdm_DEF_fndom);
                Record tmpVar_40(vdm_AS_BasicType, length_AS_BasicType);
                {
                  tmpVar_40 = Record(vdm_AS_BasicType, length_AS_BasicType);
                  tmpVar_40.SetField(1, (Quote) "BOOLEAN");
                }
                tmpVar_38.SetField(2, tmpVar_40);
              }
              vdm_DEF_fn__pre.SetField(2, tmpVar_38);
              Sequence tmpVar_42;
              tmpVar_42 = Sequence().ImpAppend(vdm_DEF_parms);
              vdm_DEF_fn__pre.SetField(3, tmpVar_42);
              vdm_DEF_fn__pre.SetField(4, vdm_DEF_Pre__e);
              vdm_DEF_fn__pre.SetField(5, Nil());
              vdm_DEF_fn__pre.SetField(6, Nil());
              vdm_DEF_fn__pre.SetField(7, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
              vdm_DEF_fn__pre.SetField(8, vdm_DEF_nm__pre);
              vdm_DEF_fn__pre.SetField(9, vdm_DEF_mod__id);
              vdm_DEF_fn__pre.SetField(10, Nil());
              {
                Map rhs_52;
                {
                  Map seqmap_53;
                  seqmap_53 = vdm_DEF_res__m;
                  Map modmap_54;
                  modmap_54 = Map().Insert(vdm_DEF_nm__pre, vdm_DEF_fn__pre);
                  seqmap_53.ImpOverride(modmap_54);
                  rhs_52 = seqmap_53;
                }
                vdm_DEF_res__m = rhs_52;
              }
            }
          }
        }
      }
      {
        Bool cond_58;
        cond_58 = (Bool) (vdm_DEF_Post__e == Nil());
        if (cond_58.GetValue()) 
          ;
        else {
          bool succ_61;
          Record tmpVal_62(vdm_AS_Name, length_AS_Name);
          tmpVal_62 = vdm_DEF_name;
          Sequence vdm_DEF_id__l;
          succ_61 = true;
          {
            succ_61 = false;
            if (tmpVal_62.IsRecord()) 
              if (vdm_AS_Name == tmpVal_62.GetTag()) {
                Sequence e_l_63;
                for (int i_64 = 1; i_64 <= tmpVal_62.Length(); i_64++) 
                  e_l_63.ImpAppend(tmpVal_62.GetField(i_64));
                if (succ_61 = 2 == (Int) (e_l_63.Length())) {
                  Generic permI_65;
                  permI_65 = (Generic) (e_l_63.Hd());
                  succ_61 = true;
                  {
                    vdm_DEF_id__l = permI_65;
                    succ_61 = true;
                  }
                  permI_65 = (Generic) (e_l_63[2]);
                  if (succ_61) 
                    succ_61 = true;
                }
              }
          }
          if (!succ_61) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Record vdm_DEF_nm__post(vdm_AS_Name, length_AS_Name);
            vdm_DEF_nm__post = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_68;
            {
              Sequence tmpVar_69;
              Sequence var2_71;
              Sequence tmpseq_72;
              tmpseq_72 = vdm_DEF_id__l;
              var2_71 = (Sequence) (tmpseq_72[((Int) 1).GetValue()]);
              tmpVar_69.ImpConc(Sequence("post_")).ImpConc(var2_71);
              tmpVar_68 = Sequence().ImpAppend(tmpVar_69);
            }
            vdm_DEF_nm__post.SetField(1, tmpVar_68);
            vdm_DEF_nm__post.SetField(2, Nil());
            Record vdm_DEF_tp__post;
            vdm_DEF_tp__post = vdm_DEF_CreateFunctionPostType(vdm_DEF_fndom, vdm_DEF_restps);
            Sequence vdm_DEF_parm__post;
            vdm_DEF_parm__post.ImpConc(vdm_DEF_parms).ImpConc(vdm_DEF_CreatePostParms(vdm_DEF_resnms));
            {
              Record vdm_DEF_fn__post(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
              vdm_DEF_fn__post = Record(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
              vdm_DEF_fn__post.SetField(1, vdm_DEF_ttp);
              vdm_DEF_fn__post.SetField(2, vdm_DEF_tp__post);
              Sequence tmpVar_86;
              tmpVar_86 = Sequence().ImpAppend(vdm_DEF_parm__post);
              vdm_DEF_fn__post.SetField(3, tmpVar_86);
              vdm_DEF_fn__post.SetField(4, vdm_DEF_Post__e);
              vdm_DEF_fn__post.SetField(5, Nil());
              vdm_DEF_fn__post.SetField(6, Nil());
              vdm_DEF_fn__post.SetField(7, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
              vdm_DEF_fn__post.SetField(8, vdm_DEF_nm__post);
              vdm_DEF_fn__post.SetField(9, vdm_DEF_mod__id);
              vdm_DEF_fn__post.SetField(10, Nil());
              {
                Map rhs_96;
                {
                  Map seqmap_97;
                  seqmap_97 = vdm_DEF_res__m;
                  Map modmap_98;
                  modmap_98 = Map().Insert(vdm_DEF_nm__post, vdm_DEF_fn__post);
                  seqmap_97.ImpOverride(modmap_98);
                  rhs_96 = seqmap_97;
                }
                vdm_DEF_res__m = rhs_96;
              }
            }
          }
        }
      }
      {
        Map rexpr_102;
        rexpr_102 = vdm_DEF_res__m;
        return rexpr_102;
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: DoCreateExtExplPolyPrePostFns");
}

Map vdm_DEF_DoCreateExtExplPrePostFns(Record var_1_1, Record var_2_2) {
  Generic vdm_DEF_Post__e;
  Generic vdm_DEF_Pre__e;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Record vdm_DEF_name(vdm_AS_Name, length_AS_Name);
  Sequence vdm_DEF_parml;
  Sequence vdm_DEF_resnmtps;
  bool succ_3 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_3 = true;
  }
  {
    succ_3 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_ExtExplFnDef == var_2_2.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_2_2.Length(); i_5++) 
          e_l_4.ImpAppend(var_2_2.GetField(i_5));
        if (succ_3 = 7 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_DEF_name = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) 
            succ_3 = true;
          permI_6 = (Generic) (e_l_4[3]);
          if (succ_3) {
            vdm_DEF_parml = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[4]);
          if (succ_3) {
            vdm_DEF_resnmtps = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[5]);
          if (succ_3) 
            succ_3 = true;
          permI_6 = (Generic) (e_l_4[6]);
          if (succ_3) {
            vdm_DEF_Pre__e = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[7]);
          if (succ_3) {
            vdm_DEF_Post__e = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  if (succ_3) {
    bool succ_7;
    Tuple tmpVal_8(2);
    tmpVal_8 = vdm_DEF_ImplicitTypeParams(vdm_DEF_parml);
    Sequence vdm_DEF_fndom;
    Sequence vdm_DEF_parms;
    succ_7 = true;
    {
      succ_7 = false;
      if (tmpVal_8.IsTuple()) {
        Sequence e_l_10;
        for (int i_11 = 1; i_11 <= ((Tuple) tmpVal_8).Length(); i_11++) 
          e_l_10.ImpAppend(((Tuple) tmpVal_8).GetField(i_11));
        if (succ_7 = 2 == (Int) (e_l_10.Length())) {
          Sequence permI_12;
          permI_12 = (Sequence) (e_l_10.Hd());
          succ_7 = true;
          {
            vdm_DEF_fndom = permI_12;
            succ_7 = true;
          }
          permI_12 = (Sequence) (e_l_10[2]);
          if (succ_7) {
            vdm_DEF_parms = permI_12;
            succ_7 = true;
          }
        }
      }
    }
    if (!succ_7) 
      RunTime("Pattern match did not succeed in value definition");
    Tuple tmpVal_13(2);
    tmpVal_13 = vdm_DEF_ImplicitResNameTypes(vdm_DEF_resnmtps);
    Sequence vdm_DEF_resnms;
    Sequence vdm_DEF_restps;
    succ_7 = true;
    {
      succ_7 = false;
      if (tmpVal_13.IsTuple()) {
        Sequence e_l_15;
        for (int i_16 = 1; i_16 <= ((Tuple) tmpVal_13).Length(); i_16++) 
          e_l_15.ImpAppend(((Tuple) tmpVal_13).GetField(i_16));
        if (succ_7 = 2 == (Int) (e_l_15.Length())) {
          Sequence permI_17;
          permI_17 = (Sequence) (e_l_15.Hd());
          succ_7 = true;
          {
            vdm_DEF_resnms = permI_17;
            succ_7 = true;
          }
          permI_17 = (Sequence) (e_l_15[2]);
          if (succ_7) {
            vdm_DEF_restps = permI_17;
            succ_7 = true;
          }
        }
      }
    }
    if (!succ_7) 
      RunTime("Pattern match did not succeed in value definition");
    {
      Map vdm_DEF_res__m;
      vdm_DEF_res__m = Map();
      {
        Bool cond_18;
        cond_18 = (Bool) (vdm_DEF_Pre__e == Nil());
        if (cond_18.GetValue()) 
          ;
        else {
          bool succ_21;
          Record tmpVal_22(vdm_AS_Name, length_AS_Name);
          tmpVal_22 = vdm_DEF_name;
          Sequence vdm_DEF_id__l;
          succ_21 = true;
          {
            succ_21 = false;
            if (tmpVal_22.IsRecord()) 
              if (vdm_AS_Name == tmpVal_22.GetTag()) {
                Sequence e_l_23;
                for (int i_24 = 1; i_24 <= tmpVal_22.Length(); i_24++) 
                  e_l_23.ImpAppend(tmpVal_22.GetField(i_24));
                if (succ_21 = 2 == (Int) (e_l_23.Length())) {
                  Generic permI_25;
                  permI_25 = (Generic) (e_l_23.Hd());
                  succ_21 = true;
                  {
                    vdm_DEF_id__l = permI_25;
                    succ_21 = true;
                  }
                  permI_25 = (Generic) (e_l_23[2]);
                  if (succ_21) 
                    succ_21 = true;
                }
              }
          }
          if (!succ_21) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Record vdm_DEF_nm__pre(vdm_AS_Name, length_AS_Name);
            vdm_DEF_nm__pre = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_28;
            {
              Sequence tmpVar_29;
              Sequence var2_31;
              Sequence tmpseq_32;
              tmpseq_32 = vdm_DEF_id__l;
              var2_31 = (Sequence) (tmpseq_32[((Int) 1).GetValue()]);
              tmpVar_29.ImpConc(Sequence("pre_")).ImpConc(var2_31);
              tmpVar_28 = Sequence().ImpAppend(tmpVar_29);
            }
            vdm_DEF_nm__pre.SetField(1, tmpVar_28);
            vdm_DEF_nm__pre.SetField(2, Nil());
            {
              Record vdm_DEF_fn__pre(vdm_SEM_ExplFN, length_SEM_ExplFN);
              vdm_DEF_fn__pre = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
              Record tmpVar_37(vdm_AS_TotalFnType, length_AS_TotalFnType);
              {
                tmpVar_37 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
                tmpVar_37.SetField(1, vdm_DEF_fndom);
                Record tmpVar_39(vdm_AS_BasicType, length_AS_BasicType);
                {
                  tmpVar_39 = Record(vdm_AS_BasicType, length_AS_BasicType);
                  tmpVar_39.SetField(1, (Quote) "BOOLEAN");
                }
                tmpVar_37.SetField(2, tmpVar_39);
              }
              vdm_DEF_fn__pre.SetField(1, tmpVar_37);
              Sequence tmpVar_41;
              tmpVar_41 = Sequence().ImpAppend(vdm_DEF_parms);
              vdm_DEF_fn__pre.SetField(2, tmpVar_41);
              vdm_DEF_fn__pre.SetField(3, vdm_DEF_Pre__e);
              vdm_DEF_fn__pre.SetField(4, Nil());
              vdm_DEF_fn__pre.SetField(5, Nil());
              vdm_DEF_fn__pre.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
              Map tmpVar_48;
              tmpVar_48 = Map();
              vdm_DEF_fn__pre.SetField(7, tmpVar_48);
              vdm_DEF_fn__pre.SetField(8, vdm_DEF_nm__pre);
              vdm_DEF_fn__pre.SetField(9, vdm_DEF_mod__id);
              vdm_DEF_fn__pre.SetField(10, Nil());
              {
                Map rhs_52;
                {
                  Map seqmap_53;
                  seqmap_53 = vdm_DEF_res__m;
                  Map modmap_54;
                  modmap_54 = Map().Insert(vdm_DEF_nm__pre, vdm_DEF_fn__pre);
                  seqmap_53.ImpOverride(modmap_54);
                  rhs_52 = seqmap_53;
                }
                vdm_DEF_res__m = rhs_52;
              }
            }
          }
        }
      }
      {
        Bool cond_58;
        cond_58 = (Bool) (vdm_DEF_Post__e == Nil());
        if (cond_58.GetValue()) 
          ;
        else {
          bool succ_61;
          Record tmpVal_62(vdm_AS_Name, length_AS_Name);
          tmpVal_62 = vdm_DEF_name;
          Sequence vdm_DEF_id__l;
          succ_61 = true;
          {
            succ_61 = false;
            if (tmpVal_62.IsRecord()) 
              if (vdm_AS_Name == tmpVal_62.GetTag()) {
                Sequence e_l_63;
                for (int i_64 = 1; i_64 <= tmpVal_62.Length(); i_64++) 
                  e_l_63.ImpAppend(tmpVal_62.GetField(i_64));
                if (succ_61 = 2 == (Int) (e_l_63.Length())) {
                  Generic permI_65;
                  permI_65 = (Generic) (e_l_63.Hd());
                  succ_61 = true;
                  {
                    vdm_DEF_id__l = permI_65;
                    succ_61 = true;
                  }
                  permI_65 = (Generic) (e_l_63[2]);
                  if (succ_61) 
                    succ_61 = true;
                }
              }
          }
          if (!succ_61) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Record vdm_DEF_nm__post(vdm_AS_Name, length_AS_Name);
            vdm_DEF_nm__post = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_68;
            {
              Sequence tmpVar_69;
              Sequence var2_71;
              Sequence tmpseq_72;
              tmpseq_72 = vdm_DEF_id__l;
              var2_71 = (Sequence) (tmpseq_72[((Int) 1).GetValue()]);
              tmpVar_69.ImpConc(Sequence("post_")).ImpConc(var2_71);
              tmpVar_68 = Sequence().ImpAppend(tmpVar_69);
            }
            vdm_DEF_nm__post.SetField(1, tmpVar_68);
            vdm_DEF_nm__post.SetField(2, Nil());
            Record vdm_DEF_tp__post;
            vdm_DEF_tp__post = vdm_DEF_CreateFunctionPostType(vdm_DEF_fndom, vdm_DEF_restps);
            Sequence vdm_DEF_parm__post;
            vdm_DEF_parm__post.ImpConc(vdm_DEF_parms).ImpConc(vdm_DEF_CreatePostParms(vdm_DEF_resnms));
            {
              Record vdm_DEF_fn__post(vdm_SEM_ExplFN, length_SEM_ExplFN);
              vdm_DEF_fn__post = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
              vdm_DEF_fn__post.SetField(1, vdm_DEF_tp__post);
              Sequence tmpVar_85;
              tmpVar_85 = Sequence().ImpAppend(vdm_DEF_parm__post);
              vdm_DEF_fn__post.SetField(2, tmpVar_85);
              vdm_DEF_fn__post.SetField(3, vdm_DEF_Post__e);
              vdm_DEF_fn__post.SetField(4, Nil());
              vdm_DEF_fn__post.SetField(5, Nil());
              vdm_DEF_fn__post.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
              Map tmpVar_92;
              tmpVar_92 = Map();
              vdm_DEF_fn__post.SetField(7, tmpVar_92);
              vdm_DEF_fn__post.SetField(8, vdm_DEF_nm__post);
              vdm_DEF_fn__post.SetField(9, vdm_DEF_mod__id);
              vdm_DEF_fn__post.SetField(10, Nil());
              {
                Map rhs_96;
                {
                  Map seqmap_97;
                  seqmap_97 = vdm_DEF_res__m;
                  Map modmap_98;
                  modmap_98 = Map().Insert(vdm_DEF_nm__post, vdm_DEF_fn__post);
                  seqmap_97.ImpOverride(modmap_98);
                  rhs_96 = seqmap_97;
                }
                vdm_DEF_res__m = rhs_96;
              }
            }
          }
        }
      }
      {
        Map rexpr_102;
        rexpr_102 = vdm_DEF_res__m;
        return rexpr_102;
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: DoCreateExtExplPrePostFns");
}

Map vdm_DEF_GenStateTypeDef(Record vdm_DEF_sd) {
  bool succ_3;
  Record tmpVal_4(vdm_AS_Name, length_AS_Name);
  {
    Record tmpRec_5(vdm_AS_CompositeType, length_AS_CompositeType);
    {
      Record tmpRec_6(vdm_AS_StateDef, length_AS_StateDef);
      tmpRec_6 = vdm_DEF_sd;
      if (tmpRec_6.Is(vdm_AS_StateDef)) 
        tmpRec_5 = tmpRec_6.GetField(pos_AS_StateDef_tp);
      else 
        RunTime("Unknown record field selector");
    }
    if (tmpRec_5.Is(vdm_AS_CompositeType)) 
      tmpVal_4 = tmpRec_5.GetField(pos_AS_CompositeType_name);
    else 
      RunTime("Unknown record field selector");
  }
  Record vdm_DEF_id(vdm_AS_Name, length_AS_Name);
  succ_3 = true;
  {
    vdm_DEF_id = tmpVal_4;
    succ_3 = true;
  }
  if (!succ_3) 
    RunTime("Pattern match did not succeed in value definition");
  {
    Map rexpr_7;
    {
      Record tmpVar2_9(vdm_AS_TypeDef, length_AS_TypeDef);
      {
        tmpVar2_9 = Record(vdm_AS_TypeDef, length_AS_TypeDef);
        tmpVar2_9.SetField(1, vdm_DEF_id);
        Record tmpVar_11(vdm_AS_CompositeType, length_AS_CompositeType);
        {
          Record tmpRec_12(vdm_AS_StateDef, length_AS_StateDef);
          tmpRec_12 = vdm_DEF_sd;
          if (tmpRec_12.Is(vdm_AS_StateDef)) 
            tmpVar_11 = tmpRec_12.GetField(pos_AS_StateDef_tp);
          else 
            RunTime("Unknown record field selector");
        }
        tmpVar2_9.SetField(2, tmpVar_11);
        tmpVar2_9.SetField(3, Nil());
      }
      rexpr_7 = Map().Insert(vdm_DEF_id, tmpVar2_9);
    }
    return rexpr_7;
  }
}

Tuple vdm_DEF_ImplicitResNameTypes(Sequence vdm_DEF_resnmtps) {
  Bool cond_3;
  {
    Sequence var2_5;
    var2_5 = Sequence();
    cond_3 = (Bool) (vdm_DEF_resnmtps == var2_5);
  }
  if (cond_3.GetValue()) {
    Tuple rexpr_25(2);
    {
      rexpr_25 = Tuple(2);
      Sequence tmpVar_26;
      tmpVar_26 = Sequence();
      rexpr_25.SetField(1, tmpVar_26);
      Sequence tmpVar_27;
      tmpVar_27 = Sequence();
      rexpr_25.SetField(2, tmpVar_27);
    }
    return rexpr_25;
  }
  else {
    Sequence vdm_DEF_tp__l;
    vdm_DEF_tp__l = Sequence();
    Sequence vdm_DEF_nm__l;
    vdm_DEF_nm__l = Sequence();
    {
      Sequence sq_6;
      sq_6 = vdm_DEF_resnmtps;
      Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
      Record vdm_DEF_tp;
      bool succ_8;
      Generic tmpe_21;
      for (int i_20 = sq_6.First(tmpe_21); i_20; i_20 = sq_6.Next(tmpe_21)) {
        Record elem_7 = tmpe_21;
        {
          succ_8 = true;
          {
            succ_8 = false;
            if (elem_7.IsRecord()) 
              if (vdm_AS_NameType == elem_7.GetTag()) {
                Sequence e_l_17;
                for (int i_18 = 1; i_18 <= elem_7.Length(); i_18++) 
                  e_l_17.ImpAppend(elem_7.GetField(i_18));
                if (succ_8 = 2 == (Int) (e_l_17.Length())) {
                  Record permI_19;
                  permI_19 = (Record) (e_l_17.Hd());
                  succ_8 = true;
                  {
                    vdm_DEF_nm = permI_19;
                    succ_8 = true;
                  }
                  permI_19 = (Record) (e_l_17[2]);
                  if (succ_8) {
                    vdm_DEF_tp = permI_19;
                    succ_8 = true;
                  }
                }
              }
          }
          if (succ_8) {
            Sequence rhs_9;
            {
              Sequence var2_11;
              var2_11 = Sequence().ImpAppend(vdm_DEF_tp);
              rhs_9.ImpConc(vdm_DEF_tp__l).ImpConc(var2_11);
            }
            vdm_DEF_tp__l = rhs_9;
            {
              Sequence rhs_13;
              {
                Sequence var2_15;
                var2_15 = Sequence().ImpAppend(vdm_DEF_nm);
                rhs_13.ImpConc(vdm_DEF_nm__l).ImpConc(var2_15);
              }
              vdm_DEF_nm__l = rhs_13;
            }
          }
          else 
            RunTime("Pattern did not match in sequence for loop");
        }
      }
    }
    {
      Tuple rexpr_22(2);
      {
        rexpr_22 = Tuple(2);
        rexpr_22.SetField(1, vdm_DEF_nm__l);
        rexpr_22.SetField(2, vdm_DEF_tp__l);
      }
      return rexpr_22;
    }
  }
}

Generic vdm_DEF_ImplicitResType(Sequence vdm_DEF_resnmtps) {
  Bool cond_3;
  {
    Sequence var2_5;
    var2_5 = Sequence();
    cond_3 = (Bool) (vdm_DEF_resnmtps == var2_5);
  }
  if (cond_3.GetValue()) {
    Generic rexpr_28;
    rexpr_28 = Nil();
    return rexpr_28;
  }
  else {
    Sequence vdm_DEF_tp__l;
    vdm_DEF_tp__l = Sequence();
    {
      Sequence sq_6;
      sq_6 = vdm_DEF_resnmtps;
      Record vdm_DEF_tp;
      bool succ_8;
      Generic tmpe_17;
      for (int i_16 = sq_6.First(tmpe_17); i_16; i_16 = sq_6.Next(tmpe_17)) {
        Record elem_7 = tmpe_17;
        {
          succ_8 = true;
          {
            succ_8 = false;
            if (elem_7.IsRecord()) 
              if (vdm_AS_NameType == elem_7.GetTag()) {
                Sequence e_l_13;
                for (int i_14 = 1; i_14 <= elem_7.Length(); i_14++) 
                  e_l_13.ImpAppend(elem_7.GetField(i_14));
                if (succ_8 = 2 == (Int) (e_l_13.Length())) {
                  Record permI_15;
                  permI_15 = (Record) (e_l_13.Hd());
                  succ_8 = true;
                  succ_8 = true;
                  permI_15 = (Record) (e_l_13[2]);
                  if (succ_8) {
                    vdm_DEF_tp = permI_15;
                    succ_8 = true;
                  }
                }
              }
          }
          if (succ_8) {
            Sequence rhs_9;
            {
              Sequence var2_11;
              var2_11 = Sequence().ImpAppend(vdm_DEF_tp);
              rhs_9.ImpConc(vdm_DEF_tp__l).ImpConc(var2_11);
            }
            vdm_DEF_tp__l = rhs_9;
          }
          else 
            RunTime("Pattern did not match in sequence for loop");
        }
      }
    }
    {
      Bool cond_18;
      cond_18 = (Bool) ((Int) (vdm_DEF_tp__l.Length()) == (Int) 1);
      if (cond_18.GetValue()) {
        bool succ_24;
        Record tmpVal_25;
        tmpVal_25 = (Record) (vdm_DEF_tp__l.Hd());
        Record vdm_DEF_tp;
        succ_24 = true;
        {
          vdm_DEF_tp = tmpVal_25;
          succ_24 = true;
        }
        if (!succ_24) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Record rexpr_27;
          rexpr_27 = vdm_DEF_tp;
          return rexpr_27;
        }
      }
      else {
        Record rexpr_22(vdm_AS_ProductType, length_AS_ProductType);
        {
          rexpr_22 = Record(vdm_AS_ProductType, length_AS_ProductType);
          rexpr_22.SetField(1, vdm_DEF_tp__l);
        }
        return rexpr_22;
      }
    }
  }
}

Tuple vdm_DEF_ImplicitTypeParams(Sequence vdm_DEF_partps) {
  Bool cond_3;
  cond_3 = (Bool) ((Int) (vdm_DEF_partps.Length()) == (Int) 0);
  if (cond_3.GetValue()) {
    Tuple rexpr_31(2);
    {
      rexpr_31 = Tuple(2);
      Sequence tmpVar_32;
      tmpVar_32 = Sequence();
      rexpr_31.SetField(1, tmpVar_32);
      Sequence tmpVar_33;
      tmpVar_33 = Sequence();
      rexpr_31.SetField(2, tmpVar_33);
    }
    return rexpr_31;
  }
  else {
    Sequence vdm_DEF_tp__l;
    vdm_DEF_tp__l = Sequence();
    Sequence vdm_DEF_parm__l;
    vdm_DEF_parm__l = Sequence();
    {
      Sequence sq_7;
      sq_7 = vdm_DEF_partps;
      Sequence vdm_DEF_pat__l;
      Record vdm_DEF_tp;
      bool succ_9;
      Generic tmpe_27;
      for (int i_26 = sq_7.First(tmpe_27); i_26; i_26 = sq_7.Next(tmpe_27)) {
        Record elem_8 = tmpe_27;
        {
          succ_9 = true;
          {
            succ_9 = false;
            if (elem_8.IsRecord()) 
              if (vdm_AS_PatTypePair == elem_8.GetTag()) {
                Sequence e_l_23;
                for (int i_24 = 1; i_24 <= elem_8.Length(); i_24++) 
                  e_l_23.ImpAppend(elem_8.GetField(i_24));
                if (succ_9 = 2 == (Int) (e_l_23.Length())) {
                  Generic permI_25;
                  permI_25 = (Generic) (e_l_23.Hd());
                  succ_9 = true;
                  {
                    vdm_DEF_pat__l = permI_25;
                    succ_9 = true;
                  }
                  permI_25 = (Generic) (e_l_23[2]);
                  if (succ_9) {
                    vdm_DEF_tp = permI_25;
                    succ_9 = true;
                  }
                }
              }
          }
          if (succ_9) {
            Sequence sq_10;
            sq_10 = vdm_DEF_pat__l;
            Record vdm_DEF_pat;
            bool succ_12;
            Generic tmpe_22;
            for (int i_21 = sq_10.First(tmpe_22); i_21; i_21 = sq_10.Next(tmpe_22)) {
              Record elem_11 = tmpe_22;
              {
                succ_12 = true;
                {
                  vdm_DEF_pat = elem_11;
                  succ_12 = true;
                }
                if (succ_12) {
                  Sequence rhs_13;
                  {
                    Sequence var2_15;
                    var2_15 = Sequence().ImpAppend(vdm_DEF_tp);
                    rhs_13.ImpConc(vdm_DEF_tp__l).ImpConc(var2_15);
                  }
                  vdm_DEF_tp__l = rhs_13;
                  {
                    Sequence rhs_17;
                    {
                      Sequence var2_19;
                      var2_19 = Sequence().ImpAppend(vdm_DEF_pat);
                      rhs_17.ImpConc(vdm_DEF_parm__l).ImpConc(var2_19);
                    }
                    vdm_DEF_parm__l = rhs_17;
                  }
                }
                else 
                  RunTime("Pattern did not match in sequence for loop");
              }
            }
          }
          else 
            RunTime("Pattern did not match in sequence for loop");
        }
      }
    }
    {
      Tuple rexpr_28(2);
      {
        rexpr_28 = Tuple(2);
        rexpr_28.SetField(1, vdm_DEF_tp__l);
        rexpr_28.SetField(2, vdm_DEF_parm__l);
      }
      return rexpr_28;
    }
  }
}

Generic vdm_DEF_StateInvariant(Generic vdm_DEF_sd) {
  Bool cond_3;
  cond_3 = (Bool) (vdm_DEF_sd == Nil());
  if (cond_3.GetValue()) {
    Generic rexpr_45;
    rexpr_45 = Nil();
    return rexpr_45;
  }
  else {
    bool succ_6;
    Generic tmpVal_7;
    tmpVal_7 = vdm_DEF_sd;
    Sequence vdm_DEF_fields__lv;
    Generic vdm_DEF_invariant;
    Record vdm_DEF_name(vdm_AS_Name, length_AS_Name);
    succ_6 = true;
    {
      succ_6 = false;
      if (tmpVal_7.IsRecord()) 
        if (vdm_AS_StateDef == ((Record) tmpVal_7).GetTag()) {
          Sequence e_l_8;
          for (int i_9 = 1; i_9 <= ((Record) tmpVal_7).Length(); i_9++) 
            e_l_8.ImpAppend(((Record) tmpVal_7).GetField(i_9));
          if (succ_6 = 3 == (Int) (e_l_8.Length())) {
            Generic permI_10;
            permI_10 = (Generic) (e_l_8.Hd());
            succ_6 = true;
            {
              succ_6 = false;
              if (permI_10.IsRecord()) 
                if (vdm_AS_CompositeType == ((Record) permI_10).GetTag()) {
                  Sequence e_l_11;
                  for (int i_12 = 1; i_12 <= ((Record) permI_10).Length(); i_12++) 
                    e_l_11.ImpAppend(((Record) permI_10).GetField(i_12));
                  if (succ_6 = 2 == (Int) (e_l_11.Length())) {
                    Generic permI_13;
                    permI_13 = (Generic) (e_l_11.Hd());
                    succ_6 = true;
                    {
                      vdm_DEF_name = permI_13;
                      succ_6 = true;
                    }
                    permI_13 = (Generic) (e_l_11[2]);
                    if (succ_6) {
                      vdm_DEF_fields__lv = permI_13;
                      succ_6 = true;
                    }
                  }
                }
            }
            permI_10 = (Generic) (e_l_8[2]);
            if (succ_6) {
              vdm_DEF_invariant = permI_10;
              succ_6 = true;
            }
            permI_10 = (Generic) (e_l_8[3]);
            if (succ_6) 
              succ_6 = true;
          }
        }
    }
    if (!succ_6) 
      RunTime("Pattern match did not succeed in value definition");
    {
      Bool cond_14;
      cond_14 = (Bool) (!(vdm_DEF_invariant == Nil()));
      if (cond_14.GetValue()) {
        bool succ_18;
        Generic tmpVal_19;
        tmpVal_19 = vdm_DEF_invariant;
        Record vdm_DEF_exp;
        Record vdm_DEF_pat;
        succ_18 = true;
        {
          succ_18 = false;
          if (tmpVal_19.IsTuple()) {
            Sequence e_l_20;
            for (int i_21 = 1; i_21 <= ((Tuple) tmpVal_19).Length(); i_21++) 
              e_l_20.ImpAppend(((Tuple) tmpVal_19).GetField(i_21));
            if (succ_18 = 2 == (Int) (e_l_20.Length())) {
              Record permI_22;
              permI_22 = (Record) (e_l_20.Hd());
              succ_18 = true;
              {
                vdm_DEF_pat = permI_22;
                succ_18 = true;
              }
              permI_22 = (Record) (e_l_20[2]);
              if (succ_18) {
                vdm_DEF_exp = permI_22;
                succ_18 = true;
              }
            }
          }
        }
        if (!succ_18) 
          RunTime("Pattern match did not succeed in value definition");
        Sequence vdm_DEF_id__l;
        {
          Sequence res_l_24;
          Generic reselem_25;
          Set resBind_s_27;
          {
            Set riseq_32;
            int max_33 = (Int) (vdm_DEF_fields__lv.Length());
            for (int i_34 = 1; i_34 <= max_33; i_34++) 
              riseq_32.Insert((Int) i_34);
            resBind_s_27 = riseq_32;
          }
          Sequence bind_l_26;
          if ((Int) (resBind_s_27.Card()) != (Int) 0) 
            bind_l_26 = Sort(resBind_s_27);
          bool succ_28 = true;
          Int vdm_DEF_i;
          Generic tmpe_39;
          for (int i_38 = bind_l_26.First(tmpe_39); i_38; i_38 = bind_l_26.Next(tmpe_39)) {
            Int e_30 = tmpe_39;
            {
              vdm_DEF_i = e_30;
              succ_28 = true;
              if (succ_28) {
                Record tmpRec_35(vdm_AS_Field, length_AS_Field);
                {
                  Sequence tmpseq_36;
                  tmpseq_36 = vdm_DEF_fields__lv;
                  tmpRec_35 = (Record) (tmpseq_36[vdm_DEF_i.GetValue()]);
                }
                if (tmpRec_35.Is(vdm_AS_Field)) 
                  reselem_25 = tmpRec_35.GetField(pos_AS_Field_sel);
                else 
                  RunTime("Unknown record field selector");
                res_l_24.ImpAppend(reselem_25);
              }
            }
          }
          vdm_DEF_id__l = res_l_24;
        }
        {
          Tuple rexpr_40(4);
          {
            rexpr_40 = Tuple(4);
            rexpr_40.SetField(1, vdm_DEF_name);
            rexpr_40.SetField(2, vdm_DEF_id__l);
            rexpr_40.SetField(3, vdm_DEF_pat);
            rexpr_40.SetField(4, vdm_DEF_exp);
          }
          return rexpr_40;
        }
      }
      else {
        Generic rexpr_17;
        rexpr_17 = Nil();
        return rexpr_17;
      }
    }
  }
}

Tuple vdm_DEF_TCompT(Sequence vdm_DEF_fields) {
  Tuple rexpr_3(3);
  {
    rexpr_3 = Tuple(3);
    rexpr_3.SetField(1, (Int) (vdm_DEF_fields.Length()));
    Map tmpVar_6;
    {
      Map res_m_7;
      Generic md_8;
      {
        Sequence seq_lv_15;
        bool succ_13;
        Bool tsucc_16;
        tsucc_16 = true;
        {
          Set tmpVar_v_14;
          {
            Set riseq_19;
            int max_20 = (Int) (vdm_DEF_fields.Length());
            for (int i_21 = 1; i_21 <= max_20; i_21++) 
              riseq_19.Insert((Int) i_21);
            tmpVar_v_14 = riseq_19;
          }
{ seq_lv_15.ImpAppend(tmpVar_v_14); }
        }
        Set allComb_17 = GenAllComb(seq_lv_15);
        Bool pred_26;
        Int vdm_DEF_i;
        Generic tmpe_35;
        for (int bb_34 = allComb_17.First(tmpe_35); bb_34; bb_34 = allComb_17.Next(tmpe_35)) {
          Sequence tmp_27 = tmpe_35;
          {
            if (succ_13 = 1 == (Int) (tmp_27.Length())) {
              Int permI_33;
              permI_33 = (Int) (tmp_27.Hd());
              succ_13 = true;
              {
                vdm_DEF_i = permI_33;
                succ_13 = true;
              }
            }
            if (succ_13) {
              Generic var1_28;
              Record tmpRec_30(vdm_AS_Field, length_AS_Field);
              {
                Sequence tmpseq_31;
                tmpseq_31 = vdm_DEF_fields;
                tmpRec_30 = (Record) (tmpseq_31[vdm_DEF_i.GetValue()]);
              }
              if (tmpRec_30.Is(vdm_AS_Field)) 
                var1_28 = tmpRec_30.GetField(pos_AS_Field_sel);
              else 
                RunTime("Unknown record field selector");
              pred_26 = (Bool) (!(var1_28 == Nil()));
              if (pred_26.GetValue()) {
                Record tmpRec_10(vdm_AS_Field, length_AS_Field);
                {
                  Sequence tmpseq_11;
                  tmpseq_11 = vdm_DEF_fields;
                  tmpRec_10 = (Record) (tmpseq_11[vdm_DEF_i.GetValue()]);
                }
                if (tmpRec_10.Is(vdm_AS_Field)) 
                  md_8 = tmpRec_10.GetField(pos_AS_Field_sel);
                else 
                  RunTime("Unknown record field selector");
                res_m_7.Insert(md_8, vdm_DEF_i);
              }
            }
          }
        }
      }
      tmpVar_6 = res_m_7;
    }
    rexpr_3.SetField(2, tmpVar_6);
    Sequence tmpVar_36;
    {
      Sequence res_l_37;
      Record reselem_38;
      Set resBind_s_40;
      {
        Set riseq_45;
        int max_46 = (Int) (vdm_DEF_fields.Length());
        for (int i_47 = 1; i_47 <= max_46; i_47++) 
          riseq_45.Insert((Int) i_47);
        resBind_s_40 = riseq_45;
      }
      Sequence bind_l_39;
      if ((Int) (resBind_s_40.Card()) != (Int) 0) 
        bind_l_39 = Sort(resBind_s_40);
      bool succ_41 = true;
      Int vdm_DEF_i;
      Generic tmpe_52;
      for (int i_51 = bind_l_39.First(tmpe_52); i_51; i_51 = bind_l_39.Next(tmpe_52)) {
        Int e_43 = tmpe_52;
        {
          vdm_DEF_i = e_43;
          succ_41 = true;
          if (succ_41) {
            Record tmpRec_48(vdm_AS_Field, length_AS_Field);
            {
              Sequence tmpseq_49;
              tmpseq_49 = vdm_DEF_fields;
              tmpRec_48 = (Record) (tmpseq_49[vdm_DEF_i.GetValue()]);
            }
            if (tmpRec_48.Is(vdm_AS_Field)) 
              reselem_38 = tmpRec_48.GetField(pos_AS_Field_type);
            else 
              RunTime("Unknown record field selector");
            res_l_37.ImpAppend(reselem_38);
          }
        }
      }
      tmpVar_36 = res_l_37;
    }
    rexpr_3.SetField(3, tmpVar_36);
  }
  return rexpr_3;
}

Record vdm_DEF_TransFN(Record vdm_DEF_mod__id, Record vdm_DEF_fn) {
  Bool cond_4;
  {
    Record argTmp_5;
    argTmp_5 = vdm_DEF_fn;
    if (argTmp_5.IsRecord()) 
      cond_4 = vdm_AS_ExplFnDef == argTmp_5.GetTag();
    else 
      cond_4 = false;
  }
  if (cond_4.GetValue()) {
    bool succ_65;
    Record tmpVal_66;
    tmpVal_66 = vdm_DEF_fn;
    Generic vdm_DEF_Post__e;
    Generic vdm_DEF_Pre__e;
    Record vdm_DEF_body;
    Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
    Sequence vdm_DEF_parms;
    Record vdm_DEF_tp;
    Sequence vdm_DEF_ttp;
    succ_65 = true;
    {
      succ_65 = false;
      if (tmpVal_66.IsRecord()) 
        if (vdm_AS_ExplFnDef == ((Record) tmpVal_66).GetTag()) {
          Sequence e_l_67;
          for (int i_68 = 1; i_68 <= ((Record) tmpVal_66).Length(); i_68++) 
            e_l_67.ImpAppend(((Record) tmpVal_66).GetField(i_68));
          if (succ_65 = 7 == (Int) (e_l_67.Length())) {
            Generic permI_69;
            permI_69 = (Generic) (e_l_67.Hd());
            succ_65 = true;
            {
              vdm_DEF_nm = permI_69;
              succ_65 = true;
            }
            permI_69 = (Generic) (e_l_67[2]);
            if (succ_65) {
              vdm_DEF_ttp = permI_69;
              succ_65 = true;
            }
            permI_69 = (Generic) (e_l_67[3]);
            if (succ_65) {
              vdm_DEF_tp = permI_69;
              succ_65 = true;
            }
            permI_69 = (Generic) (e_l_67[4]);
            if (succ_65) {
              vdm_DEF_parms = permI_69;
              succ_65 = true;
            }
            permI_69 = (Generic) (e_l_67[5]);
            if (succ_65) {
              vdm_DEF_body = permI_69;
              succ_65 = true;
            }
            permI_69 = (Generic) (e_l_67[6]);
            if (succ_65) {
              vdm_DEF_Pre__e = permI_69;
              succ_65 = true;
            }
            permI_69 = (Generic) (e_l_67[7]);
            if (succ_65) {
              vdm_DEF_Post__e = permI_69;
              succ_65 = true;
            }
          }
        }
    }
    if (!succ_65) 
      RunTime("Pattern match did not succeed in value definition");
    {
      Bool cond_70;
      cond_70 = (Bool) ((Int) (vdm_DEF_ttp.Length()) == (Int) 0);
      if (cond_70.GetValue()) {
        Record rexpr_86(vdm_SEM_ExplFN, length_SEM_ExplFN);
        {
          rexpr_86 = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
          rexpr_86.SetField(1, vdm_DEF_tp);
          rexpr_86.SetField(2, vdm_DEF_parms);
          rexpr_86.SetField(3, vdm_DEF_body);
          rexpr_86.SetField(4, vdm_DEF_Pre__e);
          rexpr_86.SetField(5, vdm_DEF_Post__e);
          rexpr_86.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
          Map tmpVar_94;
          tmpVar_94 = Map();
          rexpr_86.SetField(7, tmpVar_94);
          rexpr_86.SetField(8, vdm_DEF_nm);
          rexpr_86.SetField(9, vdm_DEF_mod__id);
          rexpr_86.SetField(10, Nil());
        }
        return rexpr_86;
      }
      else {
        Record rexpr_74(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
        {
          rexpr_74 = Record(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
          rexpr_74.SetField(1, vdm_DEF_ttp);
          rexpr_74.SetField(2, vdm_DEF_tp);
          rexpr_74.SetField(3, vdm_DEF_parms);
          rexpr_74.SetField(4, vdm_DEF_body);
          rexpr_74.SetField(5, vdm_DEF_Pre__e);
          rexpr_74.SetField(6, vdm_DEF_Post__e);
          rexpr_74.SetField(7, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
          rexpr_74.SetField(8, vdm_DEF_nm);
          rexpr_74.SetField(9, vdm_DEF_mod__id);
          rexpr_74.SetField(10, Nil());
        }
        return rexpr_74;
      }
    }
  }
  else {
    Record argTmp_17;
    argTmp_17 = vdm_DEF_fn;
    if (argTmp_17.IsRecord()) 
      cond_4 = vdm_AS_ExtExplFnDef == argTmp_17.GetTag();
    else 
      cond_4 = false;
    if (cond_4.GetValue()) {
      bool succ_18;
      Record tmpVal_19;
      tmpVal_19 = vdm_DEF_fn;
      Generic vdm_DEF_Post__e;
      Generic vdm_DEF_Pre__e;
      Record vdm_DEF_body;
      Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
      Sequence vdm_DEF_parml;
      Sequence vdm_DEF_resnmtps;
      Sequence vdm_DEF_ttp;
      succ_18 = true;
      {
        succ_18 = false;
        if (tmpVal_19.IsRecord()) 
          if (vdm_AS_ExtExplFnDef == ((Record) tmpVal_19).GetTag()) {
            Sequence e_l_20;
            for (int i_21 = 1; i_21 <= ((Record) tmpVal_19).Length(); i_21++) 
              e_l_20.ImpAppend(((Record) tmpVal_19).GetField(i_21));
            if (succ_18 = 7 == (Int) (e_l_20.Length())) {
              Generic permI_22;
              permI_22 = (Generic) (e_l_20.Hd());
              succ_18 = true;
              {
                vdm_DEF_nm = permI_22;
                succ_18 = true;
              }
              permI_22 = (Generic) (e_l_20[2]);
              if (succ_18) {
                vdm_DEF_ttp = permI_22;
                succ_18 = true;
              }
              permI_22 = (Generic) (e_l_20[3]);
              if (succ_18) {
                vdm_DEF_parml = permI_22;
                succ_18 = true;
              }
              permI_22 = (Generic) (e_l_20[4]);
              if (succ_18) {
                vdm_DEF_resnmtps = permI_22;
                succ_18 = true;
              }
              permI_22 = (Generic) (e_l_20[5]);
              if (succ_18) {
                vdm_DEF_body = permI_22;
                succ_18 = true;
              }
              permI_22 = (Generic) (e_l_20[6]);
              if (succ_18) {
                vdm_DEF_Pre__e = permI_22;
                succ_18 = true;
              }
              permI_22 = (Generic) (e_l_20[7]);
              if (succ_18) {
                vdm_DEF_Post__e = permI_22;
                succ_18 = true;
              }
            }
          }
      }
      if (!succ_18) 
        RunTime("Pattern match did not succeed in value definition");
      {
        bool succ_23;
        Tuple tmpVal_24(2);
        tmpVal_24 = vdm_DEF_ImplicitTypeParams(vdm_DEF_parml);
        Sequence vdm_DEF_fndom;
        Sequence vdm_DEF_parms;
        succ_23 = true;
        {
          succ_23 = false;
          if (tmpVal_24.IsTuple()) {
            Sequence e_l_26;
            for (int i_27 = 1; i_27 <= ((Tuple) tmpVal_24).Length(); i_27++) 
              e_l_26.ImpAppend(((Tuple) tmpVal_24).GetField(i_27));
            if (succ_23 = 2 == (Int) (e_l_26.Length())) {
              Sequence permI_28;
              permI_28 = (Sequence) (e_l_26.Hd());
              succ_23 = true;
              {
                vdm_DEF_fndom = permI_28;
                succ_23 = true;
              }
              permI_28 = (Sequence) (e_l_26[2]);
              if (succ_23) {
                vdm_DEF_parms = permI_28;
                succ_23 = true;
              }
            }
          }
        }
        if (!succ_23) 
          RunTime("Pattern match did not succeed in value definition");
        Generic vdm_DEF_fnrng;
        vdm_DEF_fnrng = vdm_DEF_ImplicitResType(vdm_DEF_resnmtps);
        {
          bool succ_31;
          Record tmpVal_32(vdm_AS_TotalFnType, length_AS_TotalFnType);
          {
            tmpVal_32 = Record(vdm_AS_TotalFnType, length_AS_TotalFnType);
            tmpVal_32.SetField(1, vdm_DEF_fndom);
            tmpVal_32.SetField(2, vdm_DEF_fnrng);
          }
          Record vdm_DEF_tp(vdm_AS_TotalFnType, length_AS_TotalFnType);
          succ_31 = true;
          {
            vdm_DEF_tp = tmpVal_32;
            succ_31 = true;
          }
          if (!succ_31) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Bool cond_35;
            cond_35 = (Bool) ((Int) (vdm_DEF_ttp.Length()) == (Int) 0);
            if (cond_35.GetValue()) {
              Record rexpr_52(vdm_SEM_ExplFN, length_SEM_ExplFN);
              {
                rexpr_52 = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
                rexpr_52.SetField(1, vdm_DEF_tp);
                Sequence tmpVar_54;
                tmpVar_54 = Sequence().ImpAppend(vdm_DEF_parms);
                rexpr_52.SetField(2, tmpVar_54);
                rexpr_52.SetField(3, vdm_DEF_body);
                rexpr_52.SetField(4, vdm_DEF_Pre__e);
                rexpr_52.SetField(5, vdm_DEF_Post__e);
                rexpr_52.SetField(6, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
                Map tmpVar_61;
                tmpVar_61 = Map();
                rexpr_52.SetField(7, tmpVar_61);
                rexpr_52.SetField(8, vdm_DEF_nm);
                rexpr_52.SetField(9, vdm_DEF_mod__id);
                rexpr_52.SetField(10, vdm_DEF_resnmtps);
              }
              return rexpr_52;
            }
            else {
              Record rexpr_39(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
              {
                rexpr_39 = Record(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
                rexpr_39.SetField(1, vdm_DEF_ttp);
                rexpr_39.SetField(2, vdm_DEF_tp);
                Sequence tmpVar_42;
                tmpVar_42 = Sequence().ImpAppend(vdm_DEF_parms);
                rexpr_39.SetField(3, tmpVar_42);
                rexpr_39.SetField(4, vdm_DEF_body);
                rexpr_39.SetField(5, vdm_DEF_Pre__e);
                rexpr_39.SetField(6, vdm_DEF_Post__e);
                rexpr_39.SetField(7, vdm_DEF_MkEmptyBlkEnv((Quote) "READ_ONLY"));
                rexpr_39.SetField(8, vdm_DEF_nm);
                rexpr_39.SetField(9, vdm_DEF_mod__id);
                rexpr_39.SetField(10, vdm_DEF_resnmtps);
              }
              return rexpr_39;
            }
          }
        }
      }
    }
    else {
      bool succ_6;
      Record tmpVal_7;
      tmpVal_7 = vdm_DEF_fn;
      Sequence vdm_DEF_ttp;
      succ_6 = true;
      {
        succ_6 = false;
        if (tmpVal_7.IsRecord()) 
          if (vdm_AS_ImplFnDef == ((Record) tmpVal_7).GetTag()) {
            Sequence e_l_8;
            for (int i_9 = 1; i_9 <= ((Record) tmpVal_7).Length(); i_9++) 
              e_l_8.ImpAppend(((Record) tmpVal_7).GetField(i_9));
            if (succ_6 = 6 == (Int) (e_l_8.Length())) {
              Generic permI_10;
              permI_10 = (Generic) (e_l_8.Hd());
              succ_6 = true;
              succ_6 = true;
              permI_10 = (Generic) (e_l_8[2]);
              if (succ_6) {
                vdm_DEF_ttp = permI_10;
                succ_6 = true;
              }
              permI_10 = (Generic) (e_l_8[3]);
              if (succ_6) 
                succ_6 = true;
              permI_10 = (Generic) (e_l_8[4]);
              if (succ_6) 
                succ_6 = true;
              permI_10 = (Generic) (e_l_8[5]);
              if (succ_6) 
                succ_6 = true;
              permI_10 = (Generic) (e_l_8[6]);
              if (succ_6) 
                succ_6 = true;
            }
          }
      }
      if (!succ_6) 
        RunTime("Pattern match did not succeed in value definition");
      {
        Bool cond_11;
        cond_11 = (Bool) ((Int) (vdm_DEF_ttp.Length()) == (Int) 0);
        if (cond_11.GetValue()) {
          Record rexpr_16(vdm_SEM_ImplFN, length_SEM_ImplFN);
          rexpr_16 = Record(vdm_SEM_ImplFN, length_SEM_ImplFN);
          return rexpr_16;
        }
        else {
          Record rexpr_15(vdm_SEM_ImplPOLY, length_SEM_ImplPOLY);
          rexpr_15 = Record(vdm_SEM_ImplPOLY, length_SEM_ImplPOLY);
          return rexpr_15;
        }
      }
    }
  }
}

Tuple vdm_DEF_TransFnMap(Record vdm_DEF_mod__id, Map vdm_DEF_fnm) {
  Map vdm_DEF_efn;
  vdm_DEF_efn = Map();
  Map vdm_DEF_ifn;
  vdm_DEF_ifn = Map();
  Map vdm_DEF_epf;
  vdm_DEF_epf = Map();
  Map vdm_DEF_ipf;
  vdm_DEF_ipf = Map();
  {
    Set iset_4;
    iset_4 = vdm_DEF_fnm.Dom();
    Record vdm_DEF_id(vdm_AS_Name, length_AS_Name);
    bool succ_6;
    Generic tmpe_73;
    for (int bb_72 = iset_4.First(tmpe_73); bb_72; bb_72 = iset_4.Next(tmpe_73)) {
      Record elem_5 = tmpe_73;
      {
        succ_6 = true;
        {
          vdm_DEF_id = elem_5;
          succ_6 = true;
        }
        if (succ_6) {
          Record vdm_DEF_FNval;
          Record tmpVar_11;
          {
            Map tmp_m_12;
            tmp_m_12 = vdm_DEF_fnm;
            tmpVar_11 = (Record) (((Map) tmp_m_12)[vdm_DEF_id]);
          }
          vdm_DEF_FNval = vdm_DEF_TransFN(vdm_DEF_mod__id, tmpVar_11);
          {
            Bool cond_14;
            {
              Record argTmp_15;
              argTmp_15 = vdm_DEF_FNval;
              if (argTmp_15.IsRecord()) 
                cond_14 = vdm_SEM_ExplFN == argTmp_15.GetTag();
              else 
                cond_14 = false;
            }
            if (cond_14.GetValue()) {
              Map rhs_59;
              {
                Map seqmap_60;
                {
                  Map seqmap_63;
                  seqmap_63 = vdm_DEF_efn;
                  Map modmap_64;
                  modmap_64 = Map().Insert(vdm_DEF_id, vdm_DEF_FNval);
                  seqmap_63.ImpOverride(modmap_64);
                  seqmap_60 = seqmap_63;
                }
                Map modmap_61;
                {
                  Record tmpVar_69;
                  {
                    Map tmp_m_70;
                    tmp_m_70 = vdm_DEF_fnm;
                    tmpVar_69 = (Record) (((Map) tmp_m_70)[vdm_DEF_id]);
                  }
                  modmap_61 = vdm_DEF_CreateExplPrePostFns(vdm_DEF_mod__id, tmpVar_69);
                }
                seqmap_60.ImpOverride(modmap_61);
                rhs_59 = seqmap_60;
              }
              vdm_DEF_efn = rhs_59;
            }
            else {
              Record argTmp_44;
              argTmp_44 = vdm_DEF_FNval;
              if (argTmp_44.IsRecord()) 
                cond_14 = vdm_SEM_ImplFN == argTmp_44.GetTag();
              else 
                cond_14 = false;
              if (cond_14.GetValue()) {
                Map rhs_45;
                {
                  Map seqmap_46;
                  seqmap_46 = vdm_DEF_ifn;
                  Map modmap_47;
                  modmap_47 = Map().Insert(vdm_DEF_id, vdm_DEF_FNval);
                  seqmap_46.ImpOverride(modmap_47);
                  rhs_45 = seqmap_46;
                }
                vdm_DEF_ifn = rhs_45;
                {
                  Map rhs_51;
                  {
                    Map seqmap_52;
                    seqmap_52 = vdm_DEF_efn;
                    Map modmap_53;
                    {
                      Record tmpVar_56;
                      {
                        Map tmp_m_57;
                        tmp_m_57 = vdm_DEF_fnm;
                        tmpVar_56 = (Record) (((Map) tmp_m_57)[vdm_DEF_id]);
                      }
                      modmap_53 = vdm_DEF_CreateImplPrePostFns(vdm_DEF_mod__id, tmpVar_56);
                    }
                    seqmap_52.ImpOverride(modmap_53);
                    rhs_51 = seqmap_52;
                  }
                  vdm_DEF_efn = rhs_51;
                }
              }
              else {
                Record argTmp_30;
                argTmp_30 = vdm_DEF_FNval;
                if (argTmp_30.IsRecord()) 
                  cond_14 = vdm_SEM_ExplPOLY == argTmp_30.GetTag();
                else 
                  cond_14 = false;
                if (cond_14.GetValue()) {
                  Map rhs_31;
                  {
                    Map seqmap_32;
                    {
                      Map seqmap_35;
                      seqmap_35 = vdm_DEF_epf;
                      Map modmap_36;
                      modmap_36 = Map().Insert(vdm_DEF_id, vdm_DEF_FNval);
                      seqmap_35.ImpOverride(modmap_36);
                      seqmap_32 = seqmap_35;
                    }
                    Map modmap_33;
                    {
                      Record tmpVar_41;
                      {
                        Map tmp_m_42;
                        tmp_m_42 = vdm_DEF_fnm;
                        tmpVar_41 = (Record) (((Map) tmp_m_42)[vdm_DEF_id]);
                      }
                      modmap_33 = vdm_DEF_CreateExplPolyPrePostFns(vdm_DEF_mod__id, tmpVar_41);
                    }
                    seqmap_32.ImpOverride(modmap_33);
                    rhs_31 = seqmap_32;
                  }
                  vdm_DEF_epf = rhs_31;
                }
                else {
                  Map rhs_16;
                  {
                    Map seqmap_17;
                    seqmap_17 = vdm_DEF_ipf;
                    Map modmap_18;
                    modmap_18 = Map().Insert(vdm_DEF_id, vdm_DEF_FNval);
                    seqmap_17.ImpOverride(modmap_18);
                    rhs_16 = seqmap_17;
                  }
                  vdm_DEF_ipf = rhs_16;
                  {
                    Map rhs_22;
                    {
                      Map seqmap_23;
                      seqmap_23 = vdm_DEF_epf;
                      Map modmap_24;
                      {
                        Record tmpVar_27;
                        {
                          Map tmp_m_28;
                          tmp_m_28 = vdm_DEF_fnm;
                          tmpVar_27 = (Record) (((Map) tmp_m_28)[vdm_DEF_id]);
                        }
                        modmap_24 = vdm_DEF_CreateImplPolyPrePostFns(vdm_DEF_mod__id, tmpVar_27);
                      }
                      seqmap_23.ImpOverride(modmap_24);
                      rhs_22 = seqmap_23;
                    }
                    vdm_DEF_epf = rhs_22;
                  }
                }
              }
            }
          }
        }
        else 
          RunTime("Pattern did not match in set for loop");
      }
    }
  }
  {
    Tuple rexpr_74(4);
    {
      rexpr_74 = Tuple(4);
      rexpr_74.SetField(1, vdm_DEF_efn);
      rexpr_74.SetField(2, vdm_DEF_ifn);
      rexpr_74.SetField(3, vdm_DEF_epf);
      rexpr_74.SetField(4, vdm_DEF_ipf);
    }
    return rexpr_74;
  }
}

Record vdm_DEF_TransOP(Record vdm_DEF_mod__id, Record vdm_DEF_op) {
  Bool cond_4;
  {
    Record argTmp_5;
    argTmp_5 = vdm_DEF_op;
    if (argTmp_5.IsRecord()) 
      cond_4 = vdm_AS_ExplOpDef == argTmp_5.GetTag();
    else 
      cond_4 = false;
  }
  if (cond_4.GetValue()) {
    bool succ_34;
    Record tmpVal_35;
    tmpVal_35 = vdm_DEF_op;
    Generic vdm_DEF_Post__e;
    Generic vdm_DEF_Pre__e;
    Record vdm_DEF_body;
    Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
    Sequence vdm_DEF_parms;
    Record vdm_DEF_tp(vdm_AS_OpType, length_AS_OpType);
    succ_34 = true;
    {
      succ_34 = false;
      if (tmpVal_35.IsRecord()) 
        if (vdm_AS_ExplOpDef == ((Record) tmpVal_35).GetTag()) {
          Sequence e_l_36;
          for (int i_37 = 1; i_37 <= ((Record) tmpVal_35).Length(); i_37++) 
            e_l_36.ImpAppend(((Record) tmpVal_35).GetField(i_37));
          if (succ_34 = 6 == (Int) (e_l_36.Length())) {
            Generic permI_38;
            permI_38 = (Generic) (e_l_36.Hd());
            succ_34 = true;
            {
              vdm_DEF_nm = permI_38;
              succ_34 = true;
            }
            permI_38 = (Generic) (e_l_36[2]);
            if (succ_34) {
              vdm_DEF_tp = permI_38;
              succ_34 = true;
            }
            permI_38 = (Generic) (e_l_36[3]);
            if (succ_34) {
              vdm_DEF_parms = permI_38;
              succ_34 = true;
            }
            permI_38 = (Generic) (e_l_36[4]);
            if (succ_34) {
              vdm_DEF_body = permI_38;
              succ_34 = true;
            }
            permI_38 = (Generic) (e_l_36[5]);
            if (succ_34) {
              vdm_DEF_Pre__e = permI_38;
              succ_34 = true;
            }
            permI_38 = (Generic) (e_l_36[6]);
            if (succ_34) {
              vdm_DEF_Post__e = permI_38;
              succ_34 = true;
            }
          }
        }
    }
    if (!succ_34) 
      RunTime("Pattern match did not succeed in value definition");
    {
      Record rexpr_39(vdm_SEM_ExplOP, length_SEM_ExplOP);
      {
        rexpr_39 = Record(vdm_SEM_ExplOP, length_SEM_ExplOP);
        rexpr_39.SetField(1, vdm_DEF_tp);
        rexpr_39.SetField(2, vdm_DEF_parms);
        rexpr_39.SetField(3, vdm_DEF_body);
        rexpr_39.SetField(4, vdm_DEF_Pre__e);
        rexpr_39.SetField(5, vdm_DEF_Post__e);
        rexpr_39.SetField(6, vdm_DEF_nm);
        rexpr_39.SetField(7, vdm_DEF_mod__id);
        rexpr_39.SetField(8, Nil());
      }
      return rexpr_39;
    }
  }
  else {
    Record argTmp_7;
    argTmp_7 = vdm_DEF_op;
    if (argTmp_7.IsRecord()) 
      cond_4 = vdm_AS_ExtExplOpDef == argTmp_7.GetTag();
    else 
      cond_4 = false;
    if (cond_4.GetValue()) {
      bool succ_8;
      Record tmpVal_9;
      tmpVal_9 = vdm_DEF_op;
      Generic vdm_DEF_Post__e;
      Generic vdm_DEF_Pre__e;
      Record vdm_DEF_body;
      Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
      Sequence vdm_DEF_parml;
      Sequence vdm_DEF_resnmtps;
      succ_8 = true;
      {
        succ_8 = false;
        if (tmpVal_9.IsRecord()) 
          if (vdm_AS_ExtExplOpDef == ((Record) tmpVal_9).GetTag()) {
            Sequence e_l_10;
            for (int i_11 = 1; i_11 <= ((Record) tmpVal_9).Length(); i_11++) 
              e_l_10.ImpAppend(((Record) tmpVal_9).GetField(i_11));
            if (succ_8 = 8 == (Int) (e_l_10.Length())) {
              Generic permI_12;
              permI_12 = (Generic) (e_l_10.Hd());
              succ_8 = true;
              {
                vdm_DEF_nm = permI_12;
                succ_8 = true;
              }
              permI_12 = (Generic) (e_l_10[2]);
              if (succ_8) {
                vdm_DEF_parml = permI_12;
                succ_8 = true;
              }
              permI_12 = (Generic) (e_l_10[3]);
              if (succ_8) {
                vdm_DEF_resnmtps = permI_12;
                succ_8 = true;
              }
              permI_12 = (Generic) (e_l_10[4]);
              if (succ_8) {
                vdm_DEF_body = permI_12;
                succ_8 = true;
              }
              permI_12 = (Generic) (e_l_10[5]);
              if (succ_8) 
                succ_8 = true;
              permI_12 = (Generic) (e_l_10[6]);
              if (succ_8) {
                vdm_DEF_Pre__e = permI_12;
                succ_8 = true;
              }
              permI_12 = (Generic) (e_l_10[7]);
              if (succ_8) {
                vdm_DEF_Post__e = permI_12;
                succ_8 = true;
              }
              permI_12 = (Generic) (e_l_10[8]);
              if (succ_8) 
                succ_8 = true;
            }
          }
      }
      if (!succ_8) 
        RunTime("Pattern match did not succeed in value definition");
      {
        bool succ_13;
        Tuple tmpVal_14(2);
        tmpVal_14 = vdm_DEF_ImplicitTypeParams(vdm_DEF_parml);
        Sequence vdm_DEF_opdom;
        Sequence vdm_DEF_parms;
        succ_13 = true;
        {
          succ_13 = false;
          if (tmpVal_14.IsTuple()) {
            Sequence e_l_16;
            for (int i_17 = 1; i_17 <= ((Tuple) tmpVal_14).Length(); i_17++) 
              e_l_16.ImpAppend(((Tuple) tmpVal_14).GetField(i_17));
            if (succ_13 = 2 == (Int) (e_l_16.Length())) {
              Sequence permI_18;
              permI_18 = (Sequence) (e_l_16.Hd());
              succ_13 = true;
              {
                vdm_DEF_opdom = permI_18;
                succ_13 = true;
              }
              permI_18 = (Sequence) (e_l_16[2]);
              if (succ_13) {
                vdm_DEF_parms = permI_18;
                succ_13 = true;
              }
            }
          }
        }
        if (!succ_13) 
          RunTime("Pattern match did not succeed in value definition");
        Generic vdm_DEF_oprng;
        vdm_DEF_oprng = vdm_DEF_ImplicitResType(vdm_DEF_resnmtps);
        {
          bool succ_21;
          Record tmpVal_22(vdm_AS_OpType, length_AS_OpType);
          {
            tmpVal_22 = Record(vdm_AS_OpType, length_AS_OpType);
            tmpVal_22.SetField(1, vdm_DEF_opdom);
            tmpVal_22.SetField(2, vdm_DEF_oprng);
          }
          Record vdm_DEF_tp(vdm_AS_OpType, length_AS_OpType);
          succ_21 = true;
          {
            vdm_DEF_tp = tmpVal_22;
            succ_21 = true;
          }
          if (!succ_21) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Record rexpr_25(vdm_SEM_ExplOP, length_SEM_ExplOP);
            {
              rexpr_25 = Record(vdm_SEM_ExplOP, length_SEM_ExplOP);
              rexpr_25.SetField(1, vdm_DEF_tp);
              rexpr_25.SetField(2, vdm_DEF_parms);
              rexpr_25.SetField(3, vdm_DEF_body);
              rexpr_25.SetField(4, vdm_DEF_Pre__e);
              rexpr_25.SetField(5, vdm_DEF_Post__e);
              rexpr_25.SetField(6, vdm_DEF_nm);
              rexpr_25.SetField(7, vdm_DEF_mod__id);
              rexpr_25.SetField(8, vdm_DEF_resnmtps);
            }
            return rexpr_25;
          }
        }
      }
    }
    else {
      Record rexpr_6(vdm_SEM_ImplOP, length_SEM_ImplOP);
      rexpr_6 = Record(vdm_SEM_ImplOP, length_SEM_ImplOP);
      return rexpr_6;
    }
  }
}

Tuple vdm_DEF_TransOpMap(Record vdm_DEF_mod__id, Map vdm_DEF_opm) {
  Map vdm_DEF_eop;
  vdm_DEF_eop = Map();
  Map vdm_DEF_iop;
  vdm_DEF_iop = Map();
  {
    Set iset_4;
    iset_4 = vdm_DEF_opm.Dom();
    Record vdm_DEF_id(vdm_AS_Name, length_AS_Name);
    bool succ_6;
    Generic tmpe_29;
    for (int bb_28 = iset_4.First(tmpe_29); bb_28; bb_28 = iset_4.Next(tmpe_29)) {
      Record elem_5 = tmpe_29;
      {
        succ_6 = true;
        {
          vdm_DEF_id = elem_5;
          succ_6 = true;
        }
        if (succ_6) {
          Record vdm_DEF_OPval;
          Record tmpVar_11;
          {
            Map tmp_m_12;
            tmp_m_12 = vdm_DEF_opm;
            tmpVar_11 = (Record) (((Map) tmp_m_12)[vdm_DEF_id]);
          }
          vdm_DEF_OPval = vdm_DEF_TransOP(vdm_DEF_mod__id, tmpVar_11);
          {
            Bool cond_14;
            {
              Record argTmp_15;
              argTmp_15 = vdm_DEF_OPval;
              if (argTmp_15.IsRecord()) 
                cond_14 = vdm_SEM_ExplOP == argTmp_15.GetTag();
              else 
                cond_14 = false;
            }
            if (cond_14.GetValue()) {
              Map rhs_22;
              {
                Map seqmap_23;
                seqmap_23 = vdm_DEF_eop;
                Map modmap_24;
                modmap_24 = Map().Insert(vdm_DEF_id, vdm_DEF_OPval);
                seqmap_23.ImpOverride(modmap_24);
                rhs_22 = seqmap_23;
              }
              vdm_DEF_eop = rhs_22;
            }
            else {
              Map rhs_16;
              {
                Map seqmap_17;
                seqmap_17 = vdm_DEF_iop;
                Map modmap_18;
                modmap_18 = Map().Insert(vdm_DEF_id, vdm_DEF_OPval);
                seqmap_17.ImpOverride(modmap_18);
                rhs_16 = seqmap_17;
              }
              vdm_DEF_iop = rhs_16;
            }
          }
        }
        else 
          RunTime("Pattern did not match in set for loop");
      }
    }
  }
  {
    Tuple rexpr_30(2);
    {
      rexpr_30 = Tuple(2);
      rexpr_30.SetField(1, vdm_DEF_eop);
      rexpr_30.SetField(2, vdm_DEF_iop);
    }
    return rexpr_30;
  }
}

Map vdm_DEF_TransTP(Set vdm_DEF_typeset) {
  Bool cond_3;
  {
    Set var2_5;
    var2_5 = Set();
    cond_3 = (Bool) (vdm_DEF_typeset == var2_5);
  }
  if (cond_3.GetValue()) {
    Map rexpr_148;
    rexpr_148 = Map();
    return rexpr_148;
  }
  else {
    Set tmpSet_6;
    tmpSet_6 = vdm_DEF_typeset;
    Record vdm_DEF_type;
    Bool tmpB_7;
    bool succ_8 = false;
    Generic tmpe_11;
    for (int bb_10 = tmpSet_6.First(tmpe_11); bb_10 && !succ_8; bb_10 = tmpSet_6.Next(tmpe_11)) {
      Record tmpElem_9 = tmpe_11;
      {
        succ_8 = true;
        {
          vdm_DEF_type = tmpElem_9;
          succ_8 = true;
        }
        if (succ_8) 
          succ_8 = ((Bool) true).GetValue();
      }
    }
    if (!succ_8) 
      RunTime("The binding environment was empty");
    {
      Map vdm_DEF_tmp;
      Record selRes_14;
      selRes_14 = vdm_DEF_type;
      bool succ_15 = true;
      {
        Sequence vdm_DEF_fields;
        Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
        {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_CompositeType == ((Record) selRes_14).GetTag()) {
              Sequence e_l_16;
              for (int i_17 = 1; i_17 <= ((Record) selRes_14).Length(); i_17++) 
                e_l_16.ImpAppend(((Record) selRes_14).GetField(i_17));
              if (succ_15 = 2 == (Int) (e_l_16.Length())) {
                Generic permI_18;
                permI_18 = (Generic) (e_l_16.Hd());
                succ_15 = true;
                {
                  vdm_DEF_nm = permI_18;
                  succ_15 = true;
                }
                permI_18 = (Generic) (e_l_16[2]);
                if (succ_15) {
                  vdm_DEF_fields = permI_18;
                  succ_15 = true;
                }
              }
            }
        }
        if (succ_15) {
          Map var1_19;
          var1_19 = Map().Insert(vdm_DEF_nm, vdm_DEF_TCompT(vdm_DEF_fields));
          Map var2_20;
          Set tmpVar_24;
          {
            Set res_s_25;
            {
              Sequence seq_lv_32;
              bool succ_30;
              Bool tsucc_33;
              tsucc_33 = true;
              {
                Set tmpVar_v_31;
                {
                  Set riseq_36;
                  int max_37 = (Int) (vdm_DEF_fields.Length());
                  for (int i_38 = 1; i_38 <= max_37; i_38++) 
                    riseq_36.Insert((Int) i_38);
                  tmpVar_v_31 = riseq_36;
                }
{ seq_lv_32.ImpAppend(tmpVar_v_31); }
              }
              Set allComb_34 = GenAllComb(seq_lv_32);
              Int vdm_DEF_i;
              Generic tmpe_47;
              for (int bb_46 = allComb_34.First(tmpe_47); bb_46; bb_46 = allComb_34.Next(tmpe_47)) {
                Sequence tmp_44 = tmpe_47;
                {
                  if (succ_30 = 1 == (Int) (tmp_44.Length())) {
                    Int permI_45;
                    permI_45 = (Int) (tmp_44.Hd());
                    succ_30 = true;
                    {
                      vdm_DEF_i = permI_45;
                      succ_30 = true;
                    }
                  }
                  if (succ_30) {
                    Record elem_26;
                    {
                      Record tmpRec_27(vdm_AS_Field, length_AS_Field);
                      {
                        Sequence tmpseq_28;
                        tmpseq_28 = vdm_DEF_fields;
                        tmpRec_27 = (Record) (tmpseq_28[vdm_DEF_i.GetValue()]);
                      }
                      if (tmpRec_27.Is(vdm_AS_Field)) 
                        elem_26 = tmpRec_27.GetField(pos_AS_Field_type);
                      else 
                        RunTime("Unknown record field selector");
                    }
                    res_s_25.Insert(elem_26);
                  }
                }
              }
            }
            tmpVar_24 = res_s_25;
          }
          var2_20 = vdm_DEF_TransTP(tmpVar_24);
          {
            Map m1_52 = var1_19;
            Map m2_53 = var2_20;
            Set com_48 = m1_52.Dom();
            com_48.ImpIntersect(m2_53.Dom());
            int all_applies_49 = 1;
            Generic d_50;
            for (int bb_51 = com_48.First(d_50); bb_51 && all_applies_49; bb_51 = com_48.Next(d_50)) 
              all_applies_49 *= m1_52[d_50] == m2_53[d_50];
            if (all_applies_49) 
              m1_52.ImpOverride(m2_53);
            else 
              RunTime("EvalMapMerge Duplicates not equal");
            vdm_DEF_tmp = m1_52;
          }
        }
      }
      if (!succ_15) {
        Sequence vdm_DEF_typeset;
        {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_UnionType == ((Record) selRes_14).GetTag()) {
              Sequence e_l_54;
              for (int i_55 = 1; i_55 <= ((Record) selRes_14).Length(); i_55++) 
                e_l_54.ImpAppend(((Record) selRes_14).GetField(i_55));
              if (succ_15 = 1 == (Int) (e_l_54.Length())) {
                Sequence permI_56;
                permI_56 = (Sequence) (e_l_54.Hd());
                succ_15 = true;
                {
                  vdm_DEF_typeset = permI_56;
                  succ_15 = true;
                }
              }
            }
        }
        if (succ_15) {
          Set tmpVar_57;
          tmpVar_57 = vdm_DEF_typeset.Elems();
          vdm_DEF_tmp = vdm_DEF_TransTP(tmpVar_57);
        }
      }
      if (!succ_15) {
        Sequence vdm_DEF_typeseq;
        {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_ProductType == ((Record) selRes_14).GetTag()) {
              Sequence e_l_59;
              for (int i_60 = 1; i_60 <= ((Record) selRes_14).Length(); i_60++) 
                e_l_59.ImpAppend(((Record) selRes_14).GetField(i_60));
              if (succ_15 = 1 == (Int) (e_l_59.Length())) {
                Sequence permI_61;
                permI_61 = (Sequence) (e_l_59.Hd());
                succ_15 = true;
                {
                  vdm_DEF_typeseq = permI_61;
                  succ_15 = true;
                }
              }
            }
        }
        if (succ_15) {
          Set tmpVar_62;
          tmpVar_62 = vdm_DEF_typeseq.Elems();
          vdm_DEF_tmp = vdm_DEF_TransTP(tmpVar_62);
        }
      }
      if (!succ_15) {
        Record vdm_DEF_type_q;
        {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_OptionalType == ((Record) selRes_14).GetTag()) {
              Sequence e_l_64;
              for (int i_65 = 1; i_65 <= ((Record) selRes_14).Length(); i_65++) 
                e_l_64.ImpAppend(((Record) selRes_14).GetField(i_65));
              if (succ_15 = 1 == (Int) (e_l_64.Length())) {
                Record permI_66;
                permI_66 = (Record) (e_l_64.Hd());
                succ_15 = true;
                {
                  vdm_DEF_type_q = permI_66;
                  succ_15 = true;
                }
              }
            }
        }
        if (!succ_15) {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_SetType == ((Record) selRes_14).GetTag()) {
              Sequence e_l_67;
              for (int i_68 = 1; i_68 <= ((Record) selRes_14).Length(); i_68++) 
                e_l_67.ImpAppend(((Record) selRes_14).GetField(i_68));
              if (succ_15 = 1 == (Int) (e_l_67.Length())) {
                Record permI_69;
                permI_69 = (Record) (e_l_67.Hd());
                succ_15 = true;
                {
                  vdm_DEF_type_q = permI_69;
                  succ_15 = true;
                }
              }
            }
        }
        if (!succ_15) {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_BracketedType == ((Record) selRes_14).GetTag()) {
              Sequence e_l_70;
              for (int i_71 = 1; i_71 <= ((Record) selRes_14).Length(); i_71++) 
                e_l_70.ImpAppend(((Record) selRes_14).GetField(i_71));
              if (succ_15 = 1 == (Int) (e_l_70.Length())) {
                Record permI_72;
                permI_72 = (Record) (e_l_70.Hd());
                succ_15 = true;
                {
                  vdm_DEF_type_q = permI_72;
                  succ_15 = true;
                }
              }
            }
        }
        if (!succ_15) {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_Seq0Type == ((Record) selRes_14).GetTag()) {
              Sequence e_l_73;
              for (int i_74 = 1; i_74 <= ((Record) selRes_14).Length(); i_74++) 
                e_l_73.ImpAppend(((Record) selRes_14).GetField(i_74));
              if (succ_15 = 1 == (Int) (e_l_73.Length())) {
                Record permI_75;
                permI_75 = (Record) (e_l_73.Hd());
                succ_15 = true;
                {
                  vdm_DEF_type_q = permI_75;
                  succ_15 = true;
                }
              }
            }
        }
        if (!succ_15) {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_Seq1Type == ((Record) selRes_14).GetTag()) {
              Sequence e_l_76;
              for (int i_77 = 1; i_77 <= ((Record) selRes_14).Length(); i_77++) 
                e_l_76.ImpAppend(((Record) selRes_14).GetField(i_77));
              if (succ_15 = 1 == (Int) (e_l_76.Length())) {
                Record permI_78;
                permI_78 = (Record) (e_l_76.Hd());
                succ_15 = true;
                {
                  vdm_DEF_type_q = permI_78;
                  succ_15 = true;
                }
              }
            }
        }
        if (succ_15) {
          Set tmpVar_79;
          tmpVar_79 = Set().Insert(vdm_DEF_type_q);
          vdm_DEF_tmp = vdm_DEF_TransTP(tmpVar_79);
        }
      }
      if (!succ_15) {
        Record vdm_DEF_dt;
        Record vdm_DEF_rt;
        {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_GeneralMapType == ((Record) selRes_14).GetTag()) {
              Sequence e_l_81;
              for (int i_82 = 1; i_82 <= ((Record) selRes_14).Length(); i_82++) 
                e_l_81.ImpAppend(((Record) selRes_14).GetField(i_82));
              if (succ_15 = 2 == (Int) (e_l_81.Length())) {
                Record permI_83;
                permI_83 = (Record) (e_l_81.Hd());
                succ_15 = true;
                {
                  vdm_DEF_dt = permI_83;
                  succ_15 = true;
                }
                permI_83 = (Record) (e_l_81[2]);
                if (succ_15) {
                  vdm_DEF_rt = permI_83;
                  succ_15 = true;
                }
              }
            }
        }
        if (succ_15) {
          Set tmpVar_84;
          {
            tmpVar_84 = Set().Insert(vdm_DEF_dt);
            tmpVar_84.Insert(vdm_DEF_rt);
          }
          vdm_DEF_tmp = vdm_DEF_TransTP(tmpVar_84);
        }
      }
      if (!succ_15) {
        Record vdm_DEF_dt;
        Record vdm_DEF_rt;
        {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_InjectiveMapType == ((Record) selRes_14).GetTag()) {
              Sequence e_l_87;
              for (int i_88 = 1; i_88 <= ((Record) selRes_14).Length(); i_88++) 
                e_l_87.ImpAppend(((Record) selRes_14).GetField(i_88));
              if (succ_15 = 2 == (Int) (e_l_87.Length())) {
                Record permI_89;
                permI_89 = (Record) (e_l_87.Hd());
                succ_15 = true;
                {
                  vdm_DEF_dt = permI_89;
                  succ_15 = true;
                }
                permI_89 = (Record) (e_l_87[2]);
                if (succ_15) {
                  vdm_DEF_rt = permI_89;
                  succ_15 = true;
                }
              }
            }
        }
        if (succ_15) {
          Set tmpVar_90;
          {
            tmpVar_90 = Set().Insert(vdm_DEF_dt);
            tmpVar_90.Insert(vdm_DEF_rt);
          }
          vdm_DEF_tmp = vdm_DEF_TransTP(tmpVar_90);
        }
      }
      if (!succ_15) {
        Sequence vdm_DEF_dt;
        Record vdm_DEF_rt;
        {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_PartialFnType == ((Record) selRes_14).GetTag()) {
              Sequence e_l_93;
              for (int i_94 = 1; i_94 <= ((Record) selRes_14).Length(); i_94++) 
                e_l_93.ImpAppend(((Record) selRes_14).GetField(i_94));
              if (succ_15 = 2 == (Int) (e_l_93.Length())) {
                Generic permI_95;
                permI_95 = (Generic) (e_l_93.Hd());
                succ_15 = true;
                {
                  vdm_DEF_dt = permI_95;
                  succ_15 = true;
                }
                permI_95 = (Generic) (e_l_93[2]);
                if (succ_15) {
                  vdm_DEF_rt = permI_95;
                  succ_15 = true;
                }
              }
            }
        }
        if (succ_15) {
          Map vdm_DEF_dtm;
          Bool cond_98;
          {
            Sequence var2_100;
            var2_100 = Sequence();
            cond_98 = (Bool) (vdm_DEF_dt == var2_100);
          }
          if (cond_98.GetValue()) 
            vdm_DEF_dtm = Map();
          else {
            Set tmpVar_101;
            tmpVar_101 = vdm_DEF_dt.Elems();
            vdm_DEF_dtm = vdm_DEF_TransTP(tmpVar_101);
          }
          Map vdm_DEF_rtm;
          Set tmpVar_104;
          tmpVar_104 = Set().Insert(vdm_DEF_rt);
          vdm_DEF_rtm = vdm_DEF_TransTP(tmpVar_104);
          {
            Map m1_112 = vdm_DEF_dtm;
            Map m2_113 = vdm_DEF_rtm;
            Set com_108 = m1_112.Dom();
            com_108.ImpIntersect(m2_113.Dom());
            int all_applies_109 = 1;
            Generic d_110;
            for (int bb_111 = com_108.First(d_110); bb_111 && all_applies_109; bb_111 = com_108.Next(d_110)) 
              all_applies_109 *= m1_112[d_110] == m2_113[d_110];
            if (all_applies_109) 
              m1_112.ImpOverride(m2_113);
            else 
              RunTime("EvalMapMerge Duplicates not equal");
            vdm_DEF_tmp = m1_112;
          }
        }
      }
      if (!succ_15) {
        Sequence vdm_DEF_dt;
        Record vdm_DEF_rt;
        {
          succ_15 = false;
          if (selRes_14.IsRecord()) 
            if (vdm_AS_TotalFnType == ((Record) selRes_14).GetTag()) {
              Sequence e_l_114;
              for (int i_115 = 1; i_115 <= ((Record) selRes_14).Length(); i_115++) 
                e_l_114.ImpAppend(((Record) selRes_14).GetField(i_115));
              if (succ_15 = 2 == (Int) (e_l_114.Length())) {
                Generic permI_116;
                permI_116 = (Generic) (e_l_114.Hd());
                succ_15 = true;
                {
                  vdm_DEF_dt = permI_116;
                  succ_15 = true;
                }
                permI_116 = (Generic) (e_l_114[2]);
                if (succ_15) {
                  vdm_DEF_rt = permI_116;
                  succ_15 = true;
                }
              }
            }
        }
        if (succ_15) {
          Map vdm_DEF_dtm;
          Bool cond_119;
          {
            Sequence var2_121;
            var2_121 = Sequence();
            cond_119 = (Bool) (vdm_DEF_dt == var2_121);
          }
          if (cond_119.GetValue()) 
            vdm_DEF_dtm = Map();
          else {
            Set tmpVar_122;
            tmpVar_122 = vdm_DEF_dt.Elems();
            vdm_DEF_dtm = vdm_DEF_TransTP(tmpVar_122);
          }
          Map vdm_DEF_rtm;
          Set tmpVar_125;
          tmpVar_125 = Set().Insert(vdm_DEF_rt);
          vdm_DEF_rtm = vdm_DEF_TransTP(tmpVar_125);
          {
            Map m1_133 = vdm_DEF_dtm;
            Map m2_134 = vdm_DEF_rtm;
            Set com_129 = m1_133.Dom();
            com_129.ImpIntersect(m2_134.Dom());
            int all_applies_130 = 1;
            Generic d_131;
            for (int bb_132 = com_129.First(d_131); bb_132 && all_applies_130; bb_132 = com_129.Next(d_131)) 
              all_applies_130 *= m1_133[d_131] == m2_134[d_131];
            if (all_applies_130) 
              m1_133.ImpOverride(m2_134);
            else 
              RunTime("EvalMapMerge Duplicates not equal");
            vdm_DEF_tmp = m1_133;
          }
        }
      }
      if (!succ_15) 
        vdm_DEF_tmp = Map();
      {
        Map rexpr_135;
        {
          Map var2_137;
          Set tmpVar_138;
          {
            Set var2_140;
            var2_140 = Set().Insert(vdm_DEF_type);
            tmpVar_138 = vdm_DEF_typeset;
            tmpVar_138.ImpDiff(var2_140);
          }
          var2_137 = vdm_DEF_TransTP(tmpVar_138);
          {
            Map m1_146 = vdm_DEF_tmp;
            Map m2_147 = var2_137;
            Set com_142 = m1_146.Dom();
            com_142.ImpIntersect(m2_147.Dom());
            int all_applies_143 = 1;
            Generic d_144;
            for (int bb_145 = com_142.First(d_144); bb_145 && all_applies_143; bb_145 = com_142.Next(d_144)) 
              all_applies_143 *= m1_146[d_144] == m2_147[d_144];
            if (all_applies_143) 
              m1_146.ImpOverride(m2_147);
            else 
              RunTime("EvalMapMerge Duplicates not equal");
            rexpr_135 = m1_146;
          }
        }
        return rexpr_135;
      }
    }
  }
}

Map vdm_DEF_TransTpMap(Map vdm_DEF_tm) {
  Set tmpVar_3;
  {
    Set res_s_4;
    {
      Sequence seq_lv_9;
      bool succ_7;
      Bool tsucc_10;
      tsucc_10 = true;
      {
        Set tmpVar_v_8;
        tmpVar_v_8 = vdm_DEF_tm.Rng();
{ seq_lv_9.ImpAppend(tmpVar_v_8); }
      }
      Set allComb_11 = GenAllComb(seq_lv_9);
      Record vdm_DEF_td(vdm_AS_TypeDef, length_AS_TypeDef);
      Generic tmpe_21;
      for (int bb_20 = allComb_11.First(tmpe_21); bb_20; bb_20 = allComb_11.Next(tmpe_21)) {
        Sequence tmp_18 = tmpe_21;
        {
          if (succ_7 = 1 == (Int) (tmp_18.Length())) {
            Record permI_19(vdm_AS_TypeDef, length_AS_TypeDef);
            permI_19 = (Record) (tmp_18.Hd());
            succ_7 = true;
            {
              vdm_DEF_td = permI_19;
              succ_7 = true;
            }
          }
          if (succ_7) {
            Record elem_5;
            {
              Record tmpRec_6(vdm_AS_TypeDef, length_AS_TypeDef);
              tmpRec_6 = vdm_DEF_td;
              if (tmpRec_6.Is(vdm_AS_TypeDef)) 
                elem_5 = tmpRec_6.GetField(pos_AS_TypeDef_shape);
              else 
                RunTime("Unknown record field selector");
            }
            res_s_4.Insert(elem_5);
          }
        }
      }
    }
    tmpVar_3 = res_s_4;
  }
  return vdm_DEF_TransTP(tmpVar_3);
}

Record vdm_DEF_TranslateDefinitions(Record var_1_1, Record var_2_2) {
  Map vdm_DEF_fnm;
  Generic vdm_DEF_gst;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Map vdm_DEF_opm;
  Map vdm_DEF_tm;
  Sequence vdm_DEF_vm;
  bool succ_3 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_3 = true;
  }
  {
    succ_3 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_Definitions == var_2_2.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_2_2.Length(); i_5++) 
          e_l_4.ImpAppend(var_2_2.GetField(i_5));
        if (succ_3 = 5 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_DEF_tm = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) {
            vdm_DEF_gst = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[3]);
          if (succ_3) {
            vdm_DEF_vm = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[4]);
          if (succ_3) {
            vdm_DEF_fnm = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[5]);
          if (succ_3) {
            vdm_DEF_opm = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  if (succ_3) {
    Record vdm_DEF_sigmadefs(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
    {
      Map rhs_7;
      rhs_7 = vdm_DEF_tm;
      Record mu_rhs_8(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);      {
        Record tmpRE_9(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
        tmpRE_9 = vdm_DEF_sigmadefs;
        int mu_10;
        mu_10 = pos_GLOBAL_SigmaDEFS_tps;
        Map val_11;
        val_11 = vdm_DEF_tm;
        tmpRE_9.SetField(mu_10, val_11);
        mu_rhs_8 = tmpRE_9;
      }      vdm_DEF_sigmadefs = mu_rhs_8;
    }
    {
      bool succ_12;
      Tuple tmpVal_13(4);
      tmpVal_13 = vdm_DEF_TransFnMap(vdm_DEF_mod__id, vdm_DEF_fnm);
      Map vdm_DEF_efn;
      Map vdm_DEF_epf;
      Map vdm_DEF_ifn;
      Map vdm_DEF_ipf;
      succ_12 = true;
      {
        succ_12 = false;
        if (tmpVal_13.IsTuple()) {
          Sequence e_l_16;
          for (int i_17 = 1; i_17 <= ((Tuple) tmpVal_13).Length(); i_17++) 
            e_l_16.ImpAppend(((Tuple) tmpVal_13).GetField(i_17));
          if (succ_12 = 4 == (Int) (e_l_16.Length())) {
            Map permI_18;
            permI_18 = (Map) (e_l_16.Hd());
            succ_12 = true;
            {
              vdm_DEF_efn = permI_18;
              succ_12 = true;
            }
            permI_18 = (Map) (e_l_16[2]);
            if (succ_12) {
              vdm_DEF_ifn = permI_18;
              succ_12 = true;
            }
            permI_18 = (Map) (e_l_16[3]);
            if (succ_12) {
              vdm_DEF_epf = permI_18;
              succ_12 = true;
            }
            permI_18 = (Map) (e_l_16[4]);
            if (succ_12) {
              vdm_DEF_ipf = permI_18;
              succ_12 = true;
            }
          }
        }
      }
      if (!succ_12) 
        RunTime("Pattern match did not succeed in value definition");
      {
        Map rhs_19;
        rhs_19 = vdm_DEF_efn;
        Record mu_rhs_20(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);        {
          Record tmpRE_21(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
          tmpRE_21 = vdm_DEF_sigmadefs;
          int mu_22;
          mu_22 = pos_GLOBAL_SigmaDEFS_explfns;
          Map val_23;
          val_23 = vdm_DEF_efn;
          tmpRE_21.SetField(mu_22, val_23);
          mu_rhs_20 = tmpRE_21;
        }        vdm_DEF_sigmadefs = mu_rhs_20;
        {
          Map rhs_24;
          rhs_24 = vdm_DEF_ifn;
          Record mu_rhs_25(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);          {
            Record tmpRE_26(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRE_26 = vdm_DEF_sigmadefs;
            int mu_27;
            mu_27 = pos_GLOBAL_SigmaDEFS_implfns;
            Map val_28;
            val_28 = vdm_DEF_ifn;
            tmpRE_26.SetField(mu_27, val_28);
            mu_rhs_25 = tmpRE_26;
          }          vdm_DEF_sigmadefs = mu_rhs_25;
        }
        {
          Map rhs_29;
          rhs_29 = vdm_DEF_epf;
          Record mu_rhs_30(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);          {
            Record tmpRE_31(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRE_31 = vdm_DEF_sigmadefs;
            int mu_32;
            mu_32 = pos_GLOBAL_SigmaDEFS_explpolys;
            Map val_33;
            val_33 = vdm_DEF_epf;
            tmpRE_31.SetField(mu_32, val_33);
            mu_rhs_30 = tmpRE_31;
          }          vdm_DEF_sigmadefs = mu_rhs_30;
        }
        {
          Map rhs_34;
          rhs_34 = vdm_DEF_ipf;
          Record mu_rhs_35(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);          {
            Record tmpRE_36(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRE_36 = vdm_DEF_sigmadefs;
            int mu_37;
            mu_37 = pos_GLOBAL_SigmaDEFS_implpolys;
            Map val_38;
            val_38 = vdm_DEF_ipf;
            tmpRE_36.SetField(mu_37, val_38);
            mu_rhs_35 = tmpRE_36;
          }          vdm_DEF_sigmadefs = mu_rhs_35;
        }
      }
    }
    {
      bool succ_39;
      Tuple tmpVal_40(2);
      tmpVal_40 = vdm_DEF_TransOpMap(vdm_DEF_mod__id, vdm_DEF_opm);
      Map vdm_DEF_eop;
      Map vdm_DEF_iop;
      succ_39 = true;
      {
        succ_39 = false;
        if (tmpVal_40.IsTuple()) {
          Sequence e_l_43;
          for (int i_44 = 1; i_44 <= ((Tuple) tmpVal_40).Length(); i_44++) 
            e_l_43.ImpAppend(((Tuple) tmpVal_40).GetField(i_44));
          if (succ_39 = 2 == (Int) (e_l_43.Length())) {
            Map permI_45;
            permI_45 = (Map) (e_l_43.Hd());
            succ_39 = true;
            {
              vdm_DEF_eop = permI_45;
              succ_39 = true;
            }
            permI_45 = (Map) (e_l_43[2]);
            if (succ_39) {
              vdm_DEF_iop = permI_45;
              succ_39 = true;
            }
          }
        }
      }
      if (!succ_39) 
        RunTime("Pattern match did not succeed in value definition");
      {
        Map rhs_46;
        rhs_46 = vdm_DEF_eop;
        Record mu_rhs_47(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);        {
          Record tmpRE_48(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
          tmpRE_48 = vdm_DEF_sigmadefs;
          int mu_49;
          mu_49 = pos_GLOBAL_SigmaDEFS_explops;
          Map val_50;
          val_50 = vdm_DEF_eop;
          tmpRE_48.SetField(mu_49, val_50);
          mu_rhs_47 = tmpRE_48;
        }        vdm_DEF_sigmadefs = mu_rhs_47;
        {
          Map rhs_51;
          rhs_51 = vdm_DEF_iop;
          Record mu_rhs_52(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);          {
            Record tmpRE_53(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRE_53 = vdm_DEF_sigmadefs;
            int mu_54;
            mu_54 = pos_GLOBAL_SigmaDEFS_implops;
            Map val_55;
            val_55 = vdm_DEF_iop;
            tmpRE_53.SetField(mu_54, val_55);
            mu_rhs_52 = tmpRE_53;
          }          vdm_DEF_sigmadefs = mu_rhs_52;
        }
      }
    }
    {
      Map rhs_56;
      {
        Set tmpVar_57;
        {
          Set res_s_58;
          {
            Sequence seq_lv_63;
            bool succ_61;
            Bool tsucc_64;
            tsucc_64 = true;
            {
              Set tmpVar_v_62;
              tmpVar_v_62 = vdm_DEF_tm.Rng();
{ seq_lv_63.ImpAppend(tmpVar_v_62); }
            }
            Set allComb_65 = GenAllComb(seq_lv_63);
            Record vdm_DEF_td(vdm_AS_TypeDef, length_AS_TypeDef);
            Generic tmpe_75;
            for (int bb_74 = allComb_65.First(tmpe_75); bb_74; bb_74 = allComb_65.Next(tmpe_75)) {
              Sequence tmp_72 = tmpe_75;
              {
                if (succ_61 = 1 == (Int) (tmp_72.Length())) {
                  Record permI_73(vdm_AS_TypeDef, length_AS_TypeDef);
                  permI_73 = (Record) (tmp_72.Hd());
                  succ_61 = true;
                  {
                    vdm_DEF_td = permI_73;
                    succ_61 = true;
                  }
                }
                if (succ_61) {
                  Record elem_59;
                  {
                    Record tmpRec_60(vdm_AS_TypeDef, length_AS_TypeDef);
                    tmpRec_60 = vdm_DEF_td;
                    if (tmpRec_60.Is(vdm_AS_TypeDef)) 
                      elem_59 = tmpRec_60.GetField(pos_AS_TypeDef_shape);
                    else 
                      RunTime("Unknown record field selector");
                  }
                  res_s_58.Insert(elem_59);
                }
              }
            }
          }
          tmpVar_57 = res_s_58;
        }
        rhs_56 = vdm_DEF_TransTP(tmpVar_57);
      }
      Record mu_rhs_76(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);      {
        Record tmpRE_77(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
        tmpRE_77 = vdm_DEF_sigmadefs;
        int mu_78;
        mu_78 = pos_GLOBAL_SigmaDEFS_recsel;
        Map val_79;
        {
          Set tmpVar_80;
          {
            Set res_s_81;
            {
              Sequence seq_lv_86;
              bool succ_84;
              Bool tsucc_87;
              tsucc_87 = true;
              {
                Set tmpVar_v_85;
                tmpVar_v_85 = vdm_DEF_tm.Rng();
{ seq_lv_86.ImpAppend(tmpVar_v_85); }
              }
              Set allComb_88 = GenAllComb(seq_lv_86);
              Record vdm_DEF_td(vdm_AS_TypeDef, length_AS_TypeDef);
              Generic tmpe_98;
              for (int bb_97 = allComb_88.First(tmpe_98); bb_97; bb_97 = allComb_88.Next(tmpe_98)) {
                Sequence tmp_95 = tmpe_98;
                {
                  if (succ_84 = 1 == (Int) (tmp_95.Length())) {
                    Record permI_96(vdm_AS_TypeDef, length_AS_TypeDef);
                    permI_96 = (Record) (tmp_95.Hd());
                    succ_84 = true;
                    {
                      vdm_DEF_td = permI_96;
                      succ_84 = true;
                    }
                  }
                  if (succ_84) {
                    Record elem_82;
                    {
                      Record tmpRec_83(vdm_AS_TypeDef, length_AS_TypeDef);
                      tmpRec_83 = vdm_DEF_td;
                      if (tmpRec_83.Is(vdm_AS_TypeDef)) 
                        elem_82 = tmpRec_83.GetField(pos_AS_TypeDef_shape);
                      else 
                        RunTime("Unknown record field selector");
                    }
                    res_s_81.Insert(elem_82);
                  }
                }
              }
            }
            tmpVar_80 = res_s_81;
          }
          val_79 = vdm_DEF_TransTP(tmpVar_80);
        }
        tmpRE_77.SetField(mu_78, val_79);
        mu_rhs_76 = tmpRE_77;
      }      vdm_DEF_sigmadefs = mu_rhs_76;
    }
    {
      Bool cond_99;
      cond_99 = (Bool) (!(vdm_DEF_gst == Nil()));
      if (cond_99.GetValue()) {
        Bool cond_107;
        {
          Record var1_108(vdm_AS_Name, length_AS_Name);
          Record tmpRec_110(vdm_AS_CompositeType, length_AS_CompositeType);
          {
            Generic tmpRec_111;
            tmpRec_111 = vdm_DEF_gst;
            if (tmpRec_111.IsRecord()) 
              if (((Record) tmpRec_111).Is(vdm_AS_StateDef)) 
                tmpRec_110 = ((Record) tmpRec_111).GetField(pos_AS_StateDef_tp);
              else 
                RunTime("Unknown record field selector");
            else 
              RunTime("A record was expected");
          }
          if (tmpRec_110.Is(vdm_AS_CompositeType)) 
            var1_108 = tmpRec_110.GetField(pos_AS_CompositeType_name);
          else 
            RunTime("Unknown record field selector");
          Set var2_109;
          Map unArg_112;
          Record tmpRec_113(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
          tmpRec_113 = vdm_DEF_sigmadefs;
          if (tmpRec_113.Is(vdm_GLOBAL_SigmaDEFS)) 
            unArg_112 = tmpRec_113.GetField(pos_GLOBAL_SigmaDEFS_recsel);
          else 
            RunTime("Unknown record field selector");
          var2_109 = unArg_112.Dom();
          cond_107 = (Bool) (var2_109.InSet(var1_108));
        }
        if (cond_107.GetValue()) 
          RunTime("Can not evaluate an error statement");
        else {
          Map rhs_114;
          {
            Map var1_115;
            Record tmpRec_117(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRec_117 = vdm_DEF_sigmadefs;
            if (tmpRec_117.Is(vdm_GLOBAL_SigmaDEFS)) 
              var1_115 = tmpRec_117.GetField(pos_GLOBAL_SigmaDEFS_recsel);
            else 
              RunTime("Unknown record field selector");
            Map var2_116;
            Set tmpVar_118;
            {
              Record tmpVar_119(vdm_AS_CompositeType, length_AS_CompositeType);
              Generic tmpRec_120;
              tmpRec_120 = vdm_DEF_gst;
              if (tmpRec_120.IsRecord()) 
                if (((Record) tmpRec_120).Is(vdm_AS_StateDef)) 
                  tmpVar_119 = ((Record) tmpRec_120).GetField(pos_AS_StateDef_tp);
                else 
                  RunTime("Unknown record field selector");
              else 
                RunTime("A record was expected");
              tmpVar_118 = Set().Insert(tmpVar_119);
            }
            var2_116 = vdm_DEF_TransTP(tmpVar_118);
            {
              Map m1_125 = var1_115;
              Map m2_126 = var2_116;
              Set com_121 = m1_125.Dom();
              com_121.ImpIntersect(m2_126.Dom());
              int all_applies_122 = 1;
              Generic d_123;
              for (int bb_124 = com_121.First(d_123); bb_124 && all_applies_122; bb_124 = com_121.Next(d_123)) 
                all_applies_122 *= m1_125[d_123] == m2_126[d_123];
              if (all_applies_122) 
                m1_125.ImpOverride(m2_126);
              else 
                RunTime("EvalMapMerge Duplicates not equal");
              rhs_114 = m1_125;
            }
          }
          Record mu_rhs_127(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);          {
            Record tmpRE_128(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRE_128 = vdm_DEF_sigmadefs;
            int mu_129;
            mu_129 = pos_GLOBAL_SigmaDEFS_recsel;
            Map val_130;
            {
              Map var1_131;
              Record tmpRec_133(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
              tmpRec_133 = vdm_DEF_sigmadefs;
              if (tmpRec_133.Is(vdm_GLOBAL_SigmaDEFS)) 
                var1_131 = tmpRec_133.GetField(pos_GLOBAL_SigmaDEFS_recsel);
              else 
                RunTime("Unknown record field selector");
              Map var2_132;
              Set tmpVar_134;
              {
                Record tmpVar_135(vdm_AS_CompositeType, length_AS_CompositeType);
                Generic tmpRec_136;
                tmpRec_136 = vdm_DEF_gst;
                if (tmpRec_136.IsRecord()) 
                  if (((Record) tmpRec_136).Is(vdm_AS_StateDef)) 
                    tmpVar_135 = ((Record) tmpRec_136).GetField(pos_AS_StateDef_tp);
                  else 
                    RunTime("Unknown record field selector");
                else 
                  RunTime("A record was expected");
                tmpVar_134 = Set().Insert(tmpVar_135);
              }
              var2_132 = vdm_DEF_TransTP(tmpVar_134);
              {
                Map m1_141 = var1_131;
                Map m2_142 = var2_132;
                Set com_137 = m1_141.Dom();
                com_137.ImpIntersect(m2_142.Dom());
                int all_applies_138 = 1;
                Generic d_139;
                for (int bb_140 = com_137.First(d_139); bb_140 && all_applies_138; bb_140 = com_137.Next(d_139)) 
                  all_applies_138 *= m1_141[d_139] == m2_142[d_139];
                if (all_applies_138) 
                  m1_141.ImpOverride(m2_142);
                else 
                  RunTime("EvalMapMerge Duplicates not equal");
                val_130 = m1_141;
              }
            }
            tmpRE_128.SetField(mu_129, val_130);
            mu_rhs_127 = tmpRE_128;
          }          vdm_DEF_sigmadefs = mu_rhs_127;
        }
        {
          Map rhs_143;
          {
            Map seqmap_144;
            {
              Record tmpRec_147(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
              tmpRec_147 = vdm_DEF_sigmadefs;
              if (tmpRec_147.Is(vdm_GLOBAL_SigmaDEFS)) 
                seqmap_144 = tmpRec_147.GetField(pos_GLOBAL_SigmaDEFS_tps);
              else 
                RunTime("Unknown record field selector");
            }
            Map modmap_145;
            modmap_145 = vdm_DEF_GenStateTypeDef(vdm_DEF_gst);
            seqmap_144.ImpOverride(modmap_145);
            rhs_143 = seqmap_144;
          }
          Record mu_rhs_149(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);          {
            Record tmpRE_150(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRE_150 = vdm_DEF_sigmadefs;
            int mu_151;
            mu_151 = pos_GLOBAL_SigmaDEFS_tps;
            Map val_152;
            {
              Map seqmap_153;
              {
                Record tmpRec_156(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
                tmpRec_156 = vdm_DEF_sigmadefs;
                if (tmpRec_156.Is(vdm_GLOBAL_SigmaDEFS)) 
                  seqmap_153 = tmpRec_156.GetField(pos_GLOBAL_SigmaDEFS_tps);
                else 
                  RunTime("Unknown record field selector");
              }
              Map modmap_154;
              modmap_154 = vdm_DEF_GenStateTypeDef(vdm_DEF_gst);
              seqmap_153.ImpOverride(modmap_154);
              val_152 = seqmap_153;
            }
            tmpRE_150.SetField(mu_151, val_152);
            mu_rhs_149 = tmpRE_150;
          }          vdm_DEF_sigmadefs = mu_rhs_149;
        }
        {
          Record rhs_158(vdm_AS_Name, length_AS_Name);
          {
            Record tmpRec_159(vdm_AS_CompositeType, length_AS_CompositeType);
            {
              Generic tmpRec_160;
              tmpRec_160 = vdm_DEF_gst;
              if (tmpRec_160.IsRecord()) 
                if (((Record) tmpRec_160).Is(vdm_AS_StateDef)) 
                  tmpRec_159 = ((Record) tmpRec_160).GetField(pos_AS_StateDef_tp);
                else 
                  RunTime("Unknown record field selector");
              else 
                RunTime("A record was expected");
            }
            if (tmpRec_159.Is(vdm_AS_CompositeType)) 
              rhs_158 = tmpRec_159.GetField(pos_AS_CompositeType_name);
            else 
              RunTime("Unknown record field selector");
          }
          Record mu_rhs_161(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);          {
            Record tmpRE_162(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRE_162 = vdm_DEF_sigmadefs;
            int mu_163;
            mu_163 = pos_GLOBAL_SigmaDEFS_stp__id;
            Record val_164(vdm_AS_Name, length_AS_Name);
            {
              Record tmpRec_165(vdm_AS_CompositeType, length_AS_CompositeType);
              {
                Generic tmpRec_166;
                tmpRec_166 = vdm_DEF_gst;
                if (tmpRec_166.IsRecord()) 
                  if (((Record) tmpRec_166).Is(vdm_AS_StateDef)) 
                    tmpRec_165 = ((Record) tmpRec_166).GetField(pos_AS_StateDef_tp);
                  else 
                    RunTime("Unknown record field selector");
                else 
                  RunTime("A record was expected");
              }
              if (tmpRec_165.Is(vdm_AS_CompositeType)) 
                val_164 = tmpRec_165.GetField(pos_AS_CompositeType_name);
              else 
                RunTime("Unknown record field selector");
            }
            tmpRE_162.SetField(mu_163, val_164);
            mu_rhs_161 = tmpRE_162;
          }          vdm_DEF_sigmadefs = mu_rhs_161;
        }
        {
          Map rhs_167;
          {
            Map seqmap_168;
            seqmap_168 = vdm_DEF_CreateStateInvAndInit(vdm_DEF_mod__id, vdm_DEF_gst);
            Map modmap_169;
            {
              Record tmpRec_173(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
              tmpRec_173 = vdm_DEF_sigmadefs;
              if (tmpRec_173.Is(vdm_GLOBAL_SigmaDEFS)) 
                modmap_169 = tmpRec_173.GetField(pos_GLOBAL_SigmaDEFS_explfns);
              else 
                RunTime("Unknown record field selector");
            }
            seqmap_168.ImpOverride(modmap_169);
            rhs_167 = seqmap_168;
          }
          Record mu_rhs_174(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);          {
            Record tmpRE_175(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRE_175 = vdm_DEF_sigmadefs;
            int mu_176;
            mu_176 = pos_GLOBAL_SigmaDEFS_explfns;
            Map val_177;
            {
              Map seqmap_178;
              seqmap_178 = vdm_DEF_CreateStateInvAndInit(vdm_DEF_mod__id, vdm_DEF_gst);
              Map modmap_179;
              {
                Record tmpRec_183(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
                tmpRec_183 = vdm_DEF_sigmadefs;
                if (tmpRec_183.Is(vdm_GLOBAL_SigmaDEFS)) 
                  modmap_179 = tmpRec_183.GetField(pos_GLOBAL_SigmaDEFS_explfns);
                else 
                  RunTime("Unknown record field selector");
              }
              seqmap_178.ImpOverride(modmap_179);
              val_177 = seqmap_178;
            }
            tmpRE_175.SetField(mu_176, val_177);
            mu_rhs_174 = tmpRE_175;
          }          vdm_DEF_sigmadefs = mu_rhs_174;
        }
      }
      else {
        Generic rhs_102;
        rhs_102 = Nil();
        Record mu_rhs_103(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);        {
          Record tmpRE_104(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
          tmpRE_104 = vdm_DEF_sigmadefs;
          int mu_105;
          mu_105 = pos_GLOBAL_SigmaDEFS_stp__id;
          Generic val_106;
          val_106 = Nil();
          tmpRE_104.SetField(mu_105, val_106);
          mu_rhs_103 = tmpRE_104;
        }        vdm_DEF_sigmadefs = mu_rhs_103;
      }
    }
    {
      Map rhs_184;
      {
        Map seqmap_185;
        seqmap_185 = vdm_DEF_CreateInvs(vdm_DEF_mod__id, vdm_DEF_tm);
        Map modmap_186;
        {
          Record tmpRec_190(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
          tmpRec_190 = vdm_DEF_sigmadefs;
          if (tmpRec_190.Is(vdm_GLOBAL_SigmaDEFS)) 
            modmap_186 = tmpRec_190.GetField(pos_GLOBAL_SigmaDEFS_explfns);
          else 
            RunTime("Unknown record field selector");
        }
        seqmap_185.ImpOverride(modmap_186);
        rhs_184 = seqmap_185;
      }
      Record mu_rhs_191(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);      {
        Record tmpRE_192(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
        tmpRE_192 = vdm_DEF_sigmadefs;
        int mu_193;
        mu_193 = pos_GLOBAL_SigmaDEFS_explfns;
        Map val_194;
        {
          Map seqmap_195;
          seqmap_195 = vdm_DEF_CreateInvs(vdm_DEF_mod__id, vdm_DEF_tm);
          Map modmap_196;
          {
            Record tmpRec_200(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRec_200 = vdm_DEF_sigmadefs;
            if (tmpRec_200.Is(vdm_GLOBAL_SigmaDEFS)) 
              modmap_196 = tmpRec_200.GetField(pos_GLOBAL_SigmaDEFS_explfns);
            else 
              RunTime("Unknown record field selector");
          }
          seqmap_195.ImpOverride(modmap_196);
          val_194 = seqmap_195;
        }
        tmpRE_192.SetField(mu_193, val_194);
        mu_rhs_191 = tmpRE_192;
      }      vdm_DEF_sigmadefs = mu_rhs_191;
    }
    {
      Map rhs_201;
      {
        Map seqmap_202;
        {
          Record tmpRec_205(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
          tmpRec_205 = vdm_DEF_sigmadefs;
          if (tmpRec_205.Is(vdm_GLOBAL_SigmaDEFS)) 
            seqmap_202 = tmpRec_205.GetField(pos_GLOBAL_SigmaDEFS_explfns);
          else 
            RunTime("Unknown record field selector");
        }
        Map modmap_203;
        modmap_203 = vdm_DEF_CreateOperationPrePostFns(vdm_DEF_mod__id, vdm_DEF_opm, vdm_DEF_gst);
        seqmap_202.ImpOverride(modmap_203);
        rhs_201 = seqmap_202;
      }
      Record mu_rhs_209(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);      {
        Record tmpRE_210(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
        tmpRE_210 = vdm_DEF_sigmadefs;
        int mu_211;
        mu_211 = pos_GLOBAL_SigmaDEFS_explfns;
        Map val_212;
        {
          Map seqmap_213;
          {
            Record tmpRec_216(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
            tmpRec_216 = vdm_DEF_sigmadefs;
            if (tmpRec_216.Is(vdm_GLOBAL_SigmaDEFS)) 
              seqmap_213 = tmpRec_216.GetField(pos_GLOBAL_SigmaDEFS_explfns);
            else 
              RunTime("Unknown record field selector");
          }
          Map modmap_214;
          modmap_214 = vdm_DEF_CreateOperationPrePostFns(vdm_DEF_mod__id, vdm_DEF_opm, vdm_DEF_gst);
          seqmap_213.ImpOverride(modmap_214);
          val_212 = seqmap_213;
        }
        tmpRE_210.SetField(mu_211, val_212);
        mu_rhs_209 = tmpRE_210;
      }      vdm_DEF_sigmadefs = mu_rhs_209;
    }
    {
      Sequence rhs_220;
      rhs_220 = vdm_DEF_vm;
      Record mu_rhs_221(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);      {
        Record tmpRE_222(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
        tmpRE_222 = vdm_DEF_sigmadefs;
        int mu_223;
        mu_223 = pos_GLOBAL_SigmaDEFS_gv__init;
        Sequence val_224;
        val_224 = vdm_DEF_vm;
        tmpRE_222.SetField(mu_223, val_224);
        mu_rhs_221 = tmpRE_222;
      }      vdm_DEF_sigmadefs = mu_rhs_221;
    }
    {
      Generic rhs_225;
      rhs_225 = vdm_DEF_gst;
      Record mu_rhs_226(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);      {
        Record tmpRE_227(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
        tmpRE_227 = vdm_DEF_sigmadefs;
        int mu_228;
        mu_228 = pos_GLOBAL_SigmaDEFS_gs__init;
        Generic val_229;
        val_229 = vdm_DEF_gst;
        tmpRE_227.SetField(mu_228, val_229);
        mu_rhs_226 = tmpRE_227;
      }      vdm_DEF_sigmadefs = mu_rhs_226;
    }
    {
      Generic rhs_230;
      rhs_230 = vdm_DEF_StateInvariant(vdm_DEF_gst);
      Record mu_rhs_232(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);      {
        Record tmpRE_233(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
        tmpRE_233 = vdm_DEF_sigmadefs;
        int mu_234;
        mu_234 = pos_GLOBAL_SigmaDEFS_stateinv;
        Generic val_235;
        val_235 = vdm_DEF_StateInvariant(vdm_DEF_gst);
        tmpRE_233.SetField(mu_234, val_235);
        mu_rhs_232 = tmpRE_233;
      }      vdm_DEF_sigmadefs = mu_rhs_232;
    }
    {
      Record rexpr_237(vdm_GLOBAL_SigmaDEFS, length_GLOBAL_SigmaDEFS);
      rexpr_237 = vdm_DEF_sigmadefs;
      return rexpr_237;
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: TranslateDefinitions");
}

Record vdm_DEF_TranslateImplExportSig(Record var_1_1, Record var_2_2, Generic var_3_3) {
  Map vdm_DEF_fns;
  Record vdm_DEF_mod__id(vdm_AS_Name, length_AS_Name);
  Map vdm_DEF_ops;
  Generic vdm_DEF_useslib;
  Map vdm_DEF_val;
  bool succ_4 = true;
  {
    vdm_DEF_mod__id = var_1_1;
    succ_4 = true;
  }
  {
    succ_4 = false;
    if (var_2_2.IsRecord()) 
      if (vdm_AS_ImplExportSig == var_2_2.GetTag()) {
        Sequence e_l_5;
        for (int i_6 = 1; i_6 <= var_2_2.Length(); i_6++) 
          e_l_5.ImpAppend(var_2_2.GetField(i_6));
        if (succ_4 = 3 == (Int) (e_l_5.Length())) {
          Map permI_7;
          permI_7 = (Map) (e_l_5.Hd());
          succ_4 = true;
          {
            vdm_DEF_val = permI_7;
            succ_4 = true;
          }
          permI_7 = (Map) (e_l_5[2]);
          if (succ_4) {
            vdm_DEF_fns = permI_7;
            succ_4 = true;
          }
          permI_7 = (Map) (e_l_5[3]);
          if (succ_4) {
            vdm_DEF_ops = permI_7;
            succ_4 = true;
          }
        }
      }
  }
  {
    vdm_DEF_useslib = var_3_3;
    succ_4 = true;
  }
  if (succ_4) {
    Record vdm_DEF_sigmaexp(vdm_GLOBAL_SigmaEXP, length_GLOBAL_SigmaEXP);
    Map vdm_DEF_efn;
    vdm_DEF_efn = Map();
    Map vdm_DEF_eop;
    vdm_DEF_eop = Map();
    Map vdm_DEF_gv;
    vdm_DEF_gv = Map();
    {
      Set iset_8;
      iset_8 = vdm_DEF_fns.Dom();
      Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
      bool succ_10;
      Generic tmpe_26;
      for (int bb_25 = iset_8.First(tmpe_26); bb_25; bb_25 = iset_8.Next(tmpe_26)) {
        Record elem_9 = tmpe_26;
        {
          succ_10 = true;
          {
            vdm_DEF_nm = elem_9;
            succ_10 = true;
          }
          if (succ_10) {
            Map rhs_12;
            {
              Map seqmap_13;
              seqmap_13 = vdm_DEF_efn;
              Map modmap_14;
              {
                Record tmpVar2_17(vdm_SEM_ExtFN, length_SEM_ExtFN);
                {
                  tmpVar2_17 = Record(vdm_SEM_ExtFN, length_SEM_ExtFN);
                  Record tmpVar_18;
                  {
                    Map tmp_m_19;
                    tmp_m_19 = vdm_DEF_fns;
                    tmpVar_18 = (Record) (((Map) tmp_m_19)[vdm_DEF_nm]);
                  }
                  tmpVar2_17.SetField(1, tmpVar_18);
                  Record tmpVar_21(vdm_SEM_LOC, length_SEM_LOC);
                  {
                    tmpVar_21 = Record(vdm_SEM_LOC, length_SEM_LOC);
                    tmpVar_21.SetField(1, vdm_DEF_nm);
                  }
                  tmpVar2_17.SetField(2, tmpVar_21);
                  tmpVar2_17.SetField(3, vdm_DEF_nm);
                  tmpVar2_17.SetField(4, vdm_DEF_mod__id);
                }
                modmap_14 = Map().Insert(vdm_DEF_nm, tmpVar2_17);
              }
              seqmap_13.ImpOverride(modmap_14);
              rhs_12 = seqmap_13;
            }
            vdm_DEF_efn = rhs_12;
          }
          else 
            RunTime("Pattern did not match in set for loop");
        }
      }
    }
    {
      Set iset_27;
      iset_27 = vdm_DEF_ops.Dom();
      Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
      bool succ_29;
      Generic tmpe_45;
      for (int bb_44 = iset_27.First(tmpe_45); bb_44; bb_44 = iset_27.Next(tmpe_45)) {
        Record elem_28 = tmpe_45;
        {
          succ_29 = true;
          {
            vdm_DEF_nm = elem_28;
            succ_29 = true;
          }
          if (succ_29) {
            Map rhs_31;
            {
              Map seqmap_32;
              seqmap_32 = vdm_DEF_eop;
              Map modmap_33;
              {
                Record tmpVar2_36(vdm_SEM_ExtOP, length_SEM_ExtOP);
                {
                  tmpVar2_36 = Record(vdm_SEM_ExtOP, length_SEM_ExtOP);
                  Record tmpVar_37(vdm_AS_OpType, length_AS_OpType);
                  {
                    Map tmp_m_38;
                    tmp_m_38 = vdm_DEF_ops;
                    tmpVar_37 = (Record) (((Map) tmp_m_38)[vdm_DEF_nm]);
                  }
                  tmpVar2_36.SetField(1, tmpVar_37);
                  Record tmpVar_40(vdm_SEM_LOC, length_SEM_LOC);
                  {
                    tmpVar_40 = Record(vdm_SEM_LOC, length_SEM_LOC);
                    tmpVar_40.SetField(1, vdm_DEF_nm);
                  }
                  tmpVar2_36.SetField(2, tmpVar_40);
                  tmpVar2_36.SetField(3, vdm_DEF_nm);
                  tmpVar2_36.SetField(4, vdm_DEF_mod__id);
                }
                modmap_33 = Map().Insert(vdm_DEF_nm, tmpVar2_36);
              }
              seqmap_32.ImpOverride(modmap_33);
              rhs_31 = seqmap_32;
            }
            vdm_DEF_eop = rhs_31;
          }
          else 
            RunTime("Pattern did not match in set for loop");
        }
      }
    }
    {
      Set iset_46;
      iset_46 = vdm_DEF_val.Dom();
      Record vdm_DEF_nm(vdm_AS_Name, length_AS_Name);
      bool succ_48;
      Generic tmpe_58;
      for (int bb_57 = iset_46.First(tmpe_58); bb_57; bb_57 = iset_46.Next(tmpe_58)) {
        Record elem_47 = tmpe_58;
        {
          succ_48 = true;
          {
            vdm_DEF_nm = elem_47;
            succ_48 = true;
          }
          if (succ_48) {
            Map rhs_50;
            {
              Map seqmap_51;
              seqmap_51 = vdm_DEF_gv;
              Map modmap_52;
              {
                Record tmpVar2_55(vdm_SEM_LOC, length_SEM_LOC);
                {
                  tmpVar2_55 = Record(vdm_SEM_LOC, length_SEM_LOC);
                  tmpVar2_55.SetField(1, vdm_DEF_nm);
                }
                modmap_52 = Map().Insert(vdm_DEF_nm, tmpVar2_55);
              }
              seqmap_51.ImpOverride(modmap_52);
              rhs_50 = seqmap_51;
            }
            vdm_DEF_gv = rhs_50;
          }
          else 
            RunTime("Pattern did not match in set for loop");
        }
      }
    }
    {
      Map rhs_59;
      rhs_59 = vdm_DEF_efn;
      Record mu_rhs_60(vdm_GLOBAL_SigmaEXP, length_GLOBAL_SigmaEXP);      {
        Record tmpRE_61(vdm_GLOBAL_SigmaEXP, length_GLOBAL_SigmaEXP);
        tmpRE_61 = vdm_DEF_sigmaexp;
        int mu_62;
        mu_62 = pos_GLOBAL_SigmaEXP_extfns;
        Map val_63;
        val_63 = vdm_DEF_efn;
        tmpRE_61.SetField(mu_62, val_63);
        mu_rhs_60 = tmpRE_61;
      }      vdm_DEF_sigmaexp = mu_rhs_60;
    }
    {
      Map rhs_64;
      rhs_64 = vdm_DEF_eop;
      Record mu_rhs_65(vdm_GLOBAL_SigmaEXP, length_GLOBAL_SigmaEXP);      {
        Record tmpRE_66(vdm_GLOBAL_SigmaEXP, length_GLOBAL_SigmaEXP);
        tmpRE_66 = vdm_DEF_sigmaexp;
        int mu_67;
        mu_67 = pos_GLOBAL_SigmaEXP_extops;
        Map val_68;
        val_68 = vdm_DEF_eop;
        tmpRE_66.SetField(mu_67, val_68);
        mu_rhs_65 = tmpRE_66;
      }      vdm_DEF_sigmaexp = mu_rhs_65;
    }
    {
      Map rhs_69;
      rhs_69 = vdm_DEF_gv;
      Record mu_rhs_70(vdm_GLOBAL_SigmaEXP, length_GLOBAL_SigmaEXP);      {
        Record tmpRE_71(vdm_GLOBAL_SigmaEXP, length_GLOBAL_SigmaEXP);
        tmpRE_71 = vdm_DEF_sigmaexp;
        int mu_72;
        mu_72 = pos_GLOBAL_SigmaEXP_extv;
        Map val_73;
        val_73 = vdm_DEF_gv;
        tmpRE_71.SetField(mu_72, val_73);
        mu_rhs_70 = tmpRE_71;
      }      vdm_DEF_sigmaexp = mu_rhs_70;
    }
    {
      Record rexpr_74(vdm_GLOBAL_SigmaEXP, length_GLOBAL_SigmaEXP);
      rexpr_74 = vdm_DEF_sigmaexp;
      return rexpr_74;
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: TranslateImplExportSig");
}
