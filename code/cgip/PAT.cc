//
// THIS FILE IS AUTOMATICALLY GENERATED!!
//
// Generated at Fri 10-Jan-97 by the VDM-SLtoC++ Code Generator
// (vdmde - v3.0l - Fri 10-Jan-97)
//
// Supported compiler: g++ version 2.7.2
//



#include "PAT.h"

#define vdm_PAT_CombineBlkEnv vdm_AUX_CombineBlkEnv
#define vdm_PAT_DistribCombineBlkEnv vdm_AUX_DistribCombineBlkEnv
#define vdm_PAT_EqualNames vdm_AUX_EqualNames
#define vdm_PAT_IsTypeStructExported vdm_AUX_IsTypeStructExported
#define vdm_PAT_MkBlkEnv vdm_AUX_MkBlkEnv
#define vdm_PAT_MkEmptyBlkEnv vdm_AUX_MkEmptyBlkEnv
#define vdm_PAT_Permute vdm_AUX_Permute
#define vdm_PAT_SeqOfSetOf2SetOfSeqOf vdm_AUX_SeqOfSetOf2SetOfSeqOf
#define vdm_PAT_ValSetToSeq vdm_AUX_ValSetToSeq
#define vdm_PAT_EvalExpr vdm_EXPR_EvalExpr
#define vdm_PAT_FreeInExpr vdm_FREE_FreeInExpr
#define vdm_PAT_FreeMapToBlkEnv vdm_FREE_FreeMapToBlkEnv
#define vdm_PAT_CurrentModule vdm_STATE_CurrentModule

static Map vdm_PAT_ITC;
static Set vdm_PAT_Collapse(Sequence);
static Record vdm_PAT_ConstructExplFN(Record, Set);
static Set vdm_PAT_EvalSetBind(Record, Generic);
static Set vdm_PAT_MatchMatchVal(Record, Record);
static Set vdm_PAT_MatchRecordPattern(Record, Record);
static Set vdm_PAT_MatchSeqConcPattern(Record, Record);
static Set vdm_PAT_MatchSeqEnumPattern(Record, Record);
static Set vdm_PAT_MatchSetEnumPattern(Record, Record);
static Set vdm_PAT_MatchSetUnionPattern(Record, Record);
static Set vdm_PAT_MatchTuplePattern(Record, Record);
static Sequence vdm_PAT_NatToId(Int);
static Record vdm_PAT_NewBase(Record, Int);
static Set vdm_PAT_Partition(Sequence);
static Record vdm_PAT_StripDoubles(Record);
static Set vdm_PAT_UnionMatch(Set);

void init_PAT() {
  bool succ_2 = true;
  {
    Map tmpVal_1;
    {
      tmpVal_1 = Map().Insert((Int) 0, (Char) '0');
      tmpVal_1.Insert((Int) 1, (Char) '1');
      tmpVal_1.Insert((Int) 2, (Char) '2');
      tmpVal_1.Insert((Int) 3, (Char) '3');
      tmpVal_1.Insert((Int) 4, (Char) '4');
      tmpVal_1.Insert((Int) 5, (Char) '5');
      tmpVal_1.Insert((Int) 6, (Char) '6');
      tmpVal_1.Insert((Int) 7, (Char) '7');
      tmpVal_1.Insert((Int) 8, (Char) '8');
      tmpVal_1.Insert((Int) 9, (Char) '9');
    }
    {
      vdm_PAT_ITC = tmpVal_1;
      succ_2 = true;
    }
    if (!succ_2) 
      RunTime("Pattern match did not succeed in value definition");
  }
}

Sequence vdm_PAT_NatToId(Int vdm_PAT_n) {
  Sequence varRes_3;
{ if (((Bool) (vdm_PAT_n == (Int) 0)).GetValue()) 
   varRes_3 = Sequence("0");
 else {
   Sequence var1_7;
   {
     Int vdm_PAT_ndt;
     vdm_PAT_ndt = (Int) (vdm_PAT_n / (Int) 10);
{ if (((Bool) (vdm_PAT_ndt == (Int) 0)).GetValue()) 
   var1_7 = Sequence("");
 else { var1_7 = vdm_PAT_NatToId((Int) (vdm_PAT_n / (Int) 10)); } }
   }
   Sequence var2_8;
   Char tmpVar_19;
   Map tmp_m_20;
   tmp_m_20 = vdm_PAT_ITC;
   tmpVar_19 = (Char) (((Map) tmp_m_20)[vdm_PAT_n - (Int) 10 * (Real) (floor((vdm_PAT_n / (Int) 10).GetValue()))]);
   var2_8 = Sequence().ImpAppend(tmpVar_19);
   varRes_3.ImpConc(var1_7).ImpConc(var2_8);
 } }
  return varRes_3;
}

Record vdm_PAT_NewBase(Record vdm_PAT_nm, Int vdm_PAT_n) {
  Record varRes_4(vdm_AS_Name, length_AS_Name);
  {
    bool succ_5;
    Sequence vdm_PAT_str;
    vdm_PAT_str = vdm_PAT_NatToId(vdm_PAT_n);
    Record tmpVal_8(vdm_AS_Name, length_AS_Name);
    tmpVal_8 = vdm_PAT_nm;
    Sequence vdm_PAT_id;
    succ_5 = true;
    {
      succ_5 = false;
      if (tmpVal_8.IsRecord()) 
        if (vdm_AS_Name == tmpVal_8.GetTag()) {
          Sequence e_l_9;
          for (int i_10 = 1; i_10 <= tmpVal_8.Length(); i_10++) 
            e_l_9.ImpAppend(tmpVal_8.GetField(i_10));
          if (succ_5 = 2 == (Int) (e_l_9.Length())) {
            Generic permI_11;
            permI_11 = (Generic) (e_l_9.Hd());
            succ_5 = true;
            {
              vdm_PAT_id = permI_11;
              succ_5 = true;
            }
            permI_11 = (Generic) (e_l_9[2]);
            if (succ_5) 
              succ_5 = true;
          }
        }
    }
    if (!succ_5) 
      RunTime("Pattern match did not succeed in value definition");
    {
      varRes_4 = Record(vdm_AS_Name, length_AS_Name);
      Sequence tmpVar_12;
      {
        Sequence var1_13;
        Sequence var2_16;
        var2_16 = Sequence().ImpAppend(vdm_PAT_str);
        var1_13.ImpConc(vdm_PAT_id).ImpConc(var2_16);
        Sequence var2_14;
        var2_14 = Sequence().ImpAppend(Sequence("_"));
        tmpVar_12.ImpConc(var1_13).ImpConc(var2_14);
      }
      varRes_4.SetField(1, tmpVar_12);
      varRes_4.SetField(2, Nil());
    }
  }
  return varRes_4;
}

Set vdm_PAT_Collapse(Sequence vdm_PAT_env__ls) {
  Set rexpr_3;
  {
    Set unArg_4;
    unArg_4 = vdm_PAT_env__ls.Elems();
    {
      Set rduset_6;
      Generic tmpe_9;
      for (int bb_8 = unArg_4.First(tmpe_9); bb_8; bb_8 = unArg_4.Next(tmpe_9)) {
        Set e_7 = tmpe_9;
        rduset_6.ImpUnion(e_7);
      }
      rexpr_3 = rduset_6;
    }
  }
  return rexpr_3;
}

Record vdm_PAT_ConstructExplFN(Record var_1_1, Set var_2_2) {
  Record vdm_PAT_body;
  Generic vdm_PAT_fnpost;
  Generic vdm_PAT_fnpre;
  Set vdm_PAT_id__s;
  Sequence vdm_PAT_parms;
  Record vdm_PAT_tp;
  Sequence vdm_PAT_tpparms;
  bool succ_3 = true;
  {
    succ_3 = false;
    if (var_1_1.IsRecord()) 
      if (vdm_AS_ExplFnDef == var_1_1.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_1_1.Length(); i_5++) 
          e_l_4.ImpAppend(var_1_1.GetField(i_5));
        if (succ_3 = 7 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          succ_3 = true;
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) {
            vdm_PAT_tpparms = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[3]);
          if (succ_3) {
            vdm_PAT_tp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[4]);
          if (succ_3) {
            vdm_PAT_parms = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[5]);
          if (succ_3) {
            vdm_PAT_body = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[6]);
          if (succ_3) {
            vdm_PAT_fnpre = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[7]);
          if (succ_3) {
            vdm_PAT_fnpost = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  {
    vdm_PAT_id__s = var_2_2;
    succ_3 = true;
  }
  if (succ_3) {
    bool succ_7;
    Record tmpVal_8(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
    tmpVal_8 = vdm_PAT_FreeMapToBlkEnv(vdm_PAT_FreeInExpr(vdm_PAT_body, vdm_PAT_id__s));
    Record vdm_PAT_env(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
    succ_7 = true;
    {
      vdm_PAT_env = tmpVal_8;
      succ_7 = true;
    }
    if (!succ_7) 
      RunTime("Pattern match did not succeed in value definition");
    Record tmpVal_12(vdm_AS_Name, length_AS_Name);
    tmpVal_12 = vdm_PAT_CurrentModule();
    Record vdm_PAT_modName(vdm_AS_Name, length_AS_Name);
    succ_7 = true;
    {
      vdm_PAT_modName = tmpVal_12;
      succ_7 = true;
    }
    if (!succ_7) 
      RunTime("Pattern match did not succeed in value definition");
    {
      Bool cond_13;
      {
        Sequence var2_15;
        var2_15 = Sequence();
        cond_13 = (Bool) (vdm_PAT_tpparms == var2_15);
      }
      if (cond_13.GetValue()) {
        Record rexpr_27(vdm_SEM_ExplFN, length_SEM_ExplFN);
        {
          rexpr_27 = Record(vdm_SEM_ExplFN, length_SEM_ExplFN);
          rexpr_27.SetField(1, vdm_PAT_tp);
          rexpr_27.SetField(2, vdm_PAT_parms);
          rexpr_27.SetField(3, vdm_PAT_body);
          rexpr_27.SetField(4, vdm_PAT_fnpre);
          rexpr_27.SetField(5, vdm_PAT_fnpost);
          rexpr_27.SetField(6, vdm_PAT_env);
          Map tmpVar_34;
          tmpVar_34 = Map();
          rexpr_27.SetField(7, tmpVar_34);
          rexpr_27.SetField(8, Nil());
          rexpr_27.SetField(9, vdm_PAT_modName);
          rexpr_27.SetField(10, Nil());
        }
        return rexpr_27;
      }
      else {
        Record rexpr_16(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
        {
          rexpr_16 = Record(vdm_SEM_ExplPOLY, length_SEM_ExplPOLY);
          rexpr_16.SetField(1, vdm_PAT_tpparms);
          rexpr_16.SetField(2, vdm_PAT_tp);
          rexpr_16.SetField(3, vdm_PAT_parms);
          rexpr_16.SetField(4, vdm_PAT_body);
          rexpr_16.SetField(5, vdm_PAT_fnpre);
          rexpr_16.SetField(6, vdm_PAT_fnpost);
          rexpr_16.SetField(7, vdm_PAT_env);
          rexpr_16.SetField(8, Nil());
          rexpr_16.SetField(9, vdm_PAT_modName);
          rexpr_16.SetField(10, Nil());
        }
        return rexpr_16;
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: ConstructExplFN");
}

Record vdm_PAT_ConstructFN(Record vdm_PAT_fn, Set vdm_PAT_id__s) {
  Bool cond_4;
  {
    Record argTmp_5;
    argTmp_5 = vdm_PAT_fn;
    if (argTmp_5.IsRecord()) 
      cond_4 = vdm_AS_ExplFnDef == argTmp_5.GetTag();
    else 
      cond_4 = false;
  }
  if (cond_4.GetValue()) {
    Record tmpVar_8;
    tmpVar_8 = vdm_PAT_fn;
    Set tmpVar_9;
    tmpVar_9 = vdm_PAT_id__s;
    return vdm_PAT_ConstructExplFN(tmpVar_8, tmpVar_9);
  }
  else {
    Record argTmp_6;
    argTmp_6 = vdm_PAT_fn;
    if (argTmp_6.IsRecord()) 
      cond_4 = vdm_AS_ImplFnDef == argTmp_6.GetTag();
    else 
      cond_4 = false;
    if (cond_4.GetValue()) {
      Record rexpr_7(vdm_SEM_ImplFN, length_SEM_ImplFN);
      rexpr_7 = Record(vdm_SEM_ImplFN, length_SEM_ImplFN);
      return rexpr_7;
    }
    else { RunTime("Can not evaluate an error statement"); }
  }
}

Record vdm_PAT_DoCarePattern(Record vdm_PAT_pat__p, Record vdm_PAT_id__base) {
  Record selRes_4;
  selRes_4 = vdm_PAT_pat__p;
  bool succ_5 = true;
  {
    Generic vdm_PAT_id;
    {
      succ_5 = false;
      if (selRes_4.IsRecord()) 
        if (vdm_AS_PatternName == ((Record) selRes_4).GetTag()) {
          Sequence e_l_6;
          for (int i_7 = 1; i_7 <= ((Record) selRes_4).Length(); i_7++) 
            e_l_6.ImpAppend(((Record) selRes_4).GetField(i_7));
          if (succ_5 = 2 == (Int) (e_l_6.Length())) {
            Generic permI_8;
            permI_8 = (Generic) (e_l_6.Hd());
            succ_5 = true;
            {
              vdm_PAT_id = permI_8;
              succ_5 = true;
            }
            permI_8 = (Generic) (e_l_6[2]);
            if (succ_5) 
              succ_5 = true;
          }
        }
    }
    if (succ_5) {
      Bool cond_9;
      cond_9 = (Bool) (vdm_PAT_id == Nil());
      if (cond_9.GetValue()) {
        Record rexpr_13(vdm_AS_PatternName, length_AS_PatternName);
        {
          rexpr_13 = Record(vdm_AS_PatternName, length_AS_PatternName);
          rexpr_13.SetField(1, vdm_PAT_id__base);
          rexpr_13.SetField(2, Nil());
        }
        return rexpr_13;
      }
      else {
        Record rexpr_12;
        rexpr_12 = vdm_PAT_pat__p;
        return rexpr_12;
      }
    }
  }
  if (!succ_5) {
    Record vdm_PAT_val;
    {
      succ_5 = false;
      if (selRes_4.IsRecord()) 
        if (vdm_AS_MatchVal == ((Record) selRes_4).GetTag()) {
          Sequence e_l_16;
          for (int i_17 = 1; i_17 <= ((Record) selRes_4).Length(); i_17++) 
            e_l_16.ImpAppend(((Record) selRes_4).GetField(i_17));
          if (succ_5 = 1 == (Int) (e_l_16.Length())) {
            Record permI_18;
            permI_18 = (Record) (e_l_16.Hd());
            succ_5 = true;
            {
              vdm_PAT_val = permI_18;
              succ_5 = true;
            }
          }
        }
    }
    if (succ_5) {
      Record rexpr_19;
      rexpr_19 = vdm_PAT_pat__p;
      return rexpr_19;
    }
  }
  if (!succ_5) {
    Sequence vdm_PAT_els;
    {
      succ_5 = false;
      if (selRes_4.IsRecord()) 
        if (vdm_AS_SetEnumPattern == ((Record) selRes_4).GetTag()) {
          Sequence e_l_20;
          for (int i_21 = 1; i_21 <= ((Record) selRes_4).Length(); i_21++) 
            e_l_20.ImpAppend(((Record) selRes_4).GetField(i_21));
          if (succ_5 = 2 == (Int) (e_l_20.Length())) {
            Generic permI_22;
            permI_22 = (Generic) (e_l_20.Hd());
            succ_5 = true;
            {
              vdm_PAT_els = permI_22;
              succ_5 = true;
            }
            permI_22 = (Generic) (e_l_20[2]);
            if (succ_5) 
              succ_5 = true;
          }
        }
    }
    if (succ_5) {
      Sequence vdm_PAT_e__l;
      {
        Sequence res_l_25;
        Record reselem_26;
        Set resBind_s_28;
        {
          Set riseq_33;
          int max_34 = (Int) (vdm_PAT_els.Length());
          for (int i_35 = 1; i_35 <= max_34; i_35++) 
            riseq_33.Insert((Int) i_35);
          resBind_s_28 = riseq_33;
        }
        Sequence bind_l_27;
        if ((Int) (resBind_s_28.Card()) != (Int) 0) 
          bind_l_27 = Sort(resBind_s_28);
        bool succ_29 = true;
        Int vdm_PAT_i;
        Generic tmpe_43;
        for (int i_42 = bind_l_27.First(tmpe_43); i_42; i_42 = bind_l_27.Next(tmpe_43)) {
          Int e_31 = tmpe_43;
          {
            vdm_PAT_i = e_31;
            succ_29 = true;
            if (succ_29) {
              Record tmpVar_36;
              {
                Sequence tmpseq_37;
                tmpseq_37 = vdm_PAT_els;
                tmpVar_36 = (Record) (tmpseq_37[vdm_PAT_i.GetValue()]);
              }
              reselem_26 = vdm_PAT_DoCarePattern(tmpVar_36, vdm_PAT_NewBase(vdm_PAT_id__base, vdm_PAT_i));
              res_l_25.ImpAppend(reselem_26);
            }
          }
        }
        vdm_PAT_e__l = res_l_25;
      }
      {
        Record rexpr_44(vdm_AS_SetEnumPattern, length_AS_SetEnumPattern);
        {
          rexpr_44 = Record(vdm_AS_SetEnumPattern, length_AS_SetEnumPattern);
          rexpr_44.SetField(1, vdm_PAT_e__l);
          rexpr_44.SetField(2, Nil());
        }
        return rexpr_44;
      }
    }
  }
  if (!succ_5) {
    Record vdm_PAT_lp;
    Record vdm_PAT_rp;
    {
      succ_5 = false;
      if (selRes_4.IsRecord()) 
        if (vdm_AS_SetUnionPattern == ((Record) selRes_4).GetTag()) {
          Sequence e_l_47;
          for (int i_48 = 1; i_48 <= ((Record) selRes_4).Length(); i_48++) 
            e_l_47.ImpAppend(((Record) selRes_4).GetField(i_48));
          if (succ_5 = 2 == (Int) (e_l_47.Length())) {
            Record permI_49;
            permI_49 = (Record) (e_l_47.Hd());
            succ_5 = true;
            {
              vdm_PAT_lp = permI_49;
              succ_5 = true;
            }
            permI_49 = (Record) (e_l_47[2]);
            if (succ_5) {
              vdm_PAT_rp = permI_49;
              succ_5 = true;
            }
          }
        }
    }
    if (succ_5) {
      Record rexpr_50(vdm_AS_SetUnionPattern, length_AS_SetUnionPattern);
      {
        rexpr_50 = Record(vdm_AS_SetUnionPattern, length_AS_SetUnionPattern);
        rexpr_50.SetField(1, vdm_PAT_DoCarePattern(vdm_PAT_lp, vdm_PAT_NewBase(vdm_PAT_id__base, (Int) 1)));
        rexpr_50.SetField(2, vdm_PAT_DoCarePattern(vdm_PAT_rp, vdm_PAT_NewBase(vdm_PAT_id__base, (Int) 2)));
      }
      return rexpr_50;
    }
  }
  if (!succ_5) {
    Sequence vdm_PAT_els;
    {
      succ_5 = false;
      if (selRes_4.IsRecord()) 
        if (vdm_AS_SeqEnumPattern == ((Record) selRes_4).GetTag()) {
          Sequence e_l_61;
          for (int i_62 = 1; i_62 <= ((Record) selRes_4).Length(); i_62++) 
            e_l_61.ImpAppend(((Record) selRes_4).GetField(i_62));
          if (succ_5 = 2 == (Int) (e_l_61.Length())) {
            Generic permI_63;
            permI_63 = (Generic) (e_l_61.Hd());
            succ_5 = true;
            {
              vdm_PAT_els = permI_63;
              succ_5 = true;
            }
            permI_63 = (Generic) (e_l_61[2]);
            if (succ_5) 
              succ_5 = true;
          }
        }
    }
    if (succ_5) {
      Sequence vdm_PAT_e__l;
      {
        Sequence res_l_66;
        Record reselem_67;
        Set resBind_s_69;
        {
          Set riseq_74;
          int max_75 = (Int) (vdm_PAT_els.Length());
          for (int i_76 = 1; i_76 <= max_75; i_76++) 
            riseq_74.Insert((Int) i_76);
          resBind_s_69 = riseq_74;
        }
        Sequence bind_l_68;
        if ((Int) (resBind_s_69.Card()) != (Int) 0) 
          bind_l_68 = Sort(resBind_s_69);
        bool succ_70 = true;
        Int vdm_PAT_i;
        Generic tmpe_84;
        for (int i_83 = bind_l_68.First(tmpe_84); i_83; i_83 = bind_l_68.Next(tmpe_84)) {
          Int e_72 = tmpe_84;
          {
            vdm_PAT_i = e_72;
            succ_70 = true;
            if (succ_70) {
              Record tmpVar_77;
              {
                Sequence tmpseq_78;
                tmpseq_78 = vdm_PAT_els;
                tmpVar_77 = (Record) (tmpseq_78[vdm_PAT_i.GetValue()]);
              }
              reselem_67 = vdm_PAT_DoCarePattern(tmpVar_77, vdm_PAT_NewBase(vdm_PAT_id__base, vdm_PAT_i));
              res_l_66.ImpAppend(reselem_67);
            }
          }
        }
        vdm_PAT_e__l = res_l_66;
      }
      {
        Record rexpr_85(vdm_AS_SeqEnumPattern, length_AS_SeqEnumPattern);
        {
          rexpr_85 = Record(vdm_AS_SeqEnumPattern, length_AS_SeqEnumPattern);
          rexpr_85.SetField(1, vdm_PAT_e__l);
          rexpr_85.SetField(2, Nil());
        }
        return rexpr_85;
      }
    }
  }
  if (!succ_5) {
    Record vdm_PAT_lp;
    Record vdm_PAT_rp;
    {
      succ_5 = false;
      if (selRes_4.IsRecord()) 
        if (vdm_AS_SeqConcPattern == ((Record) selRes_4).GetTag()) {
          Sequence e_l_88;
          for (int i_89 = 1; i_89 <= ((Record) selRes_4).Length(); i_89++) 
            e_l_88.ImpAppend(((Record) selRes_4).GetField(i_89));
          if (succ_5 = 2 == (Int) (e_l_88.Length())) {
            Record permI_90;
            permI_90 = (Record) (e_l_88.Hd());
            succ_5 = true;
            {
              vdm_PAT_lp = permI_90;
              succ_5 = true;
            }
            permI_90 = (Record) (e_l_88[2]);
            if (succ_5) {
              vdm_PAT_rp = permI_90;
              succ_5 = true;
            }
          }
        }
    }
    if (succ_5) {
      Record rexpr_91(vdm_AS_SeqConcPattern, length_AS_SeqConcPattern);
      {
        rexpr_91 = Record(vdm_AS_SeqConcPattern, length_AS_SeqConcPattern);
        rexpr_91.SetField(1, vdm_PAT_DoCarePattern(vdm_PAT_lp, vdm_PAT_NewBase(vdm_PAT_id__base, (Int) 1)));
        rexpr_91.SetField(2, vdm_PAT_DoCarePattern(vdm_PAT_rp, vdm_PAT_NewBase(vdm_PAT_id__base, (Int) 2)));
      }
      return rexpr_91;
    }
  }
  if (!succ_5) {
    Sequence vdm_PAT_p__l;
    Record vdm_PAT_tag(vdm_AS_Name, length_AS_Name);
    {
      succ_5 = false;
      if (selRes_4.IsRecord()) 
        if (vdm_AS_RecordPattern == ((Record) selRes_4).GetTag()) {
          Sequence e_l_102;
          for (int i_103 = 1; i_103 <= ((Record) selRes_4).Length(); i_103++) 
            e_l_102.ImpAppend(((Record) selRes_4).GetField(i_103));
          if (succ_5 = 3 == (Int) (e_l_102.Length())) {
            Generic permI_104;
            permI_104 = (Generic) (e_l_102.Hd());
            succ_5 = true;
            {
              vdm_PAT_tag = permI_104;
              succ_5 = true;
            }
            permI_104 = (Generic) (e_l_102[2]);
            if (succ_5) {
              vdm_PAT_p__l = permI_104;
              succ_5 = true;
            }
            permI_104 = (Generic) (e_l_102[3]);
            if (succ_5) 
              succ_5 = true;
          }
        }
    }
    if (succ_5) {
      Sequence vdm_PAT_e__l;
      {
        Sequence res_l_107;
        Record reselem_108;
        Set resBind_s_110;
        {
          Set riseq_115;
          int max_116 = (Int) (vdm_PAT_p__l.Length());
          for (int i_117 = 1; i_117 <= max_116; i_117++) 
            riseq_115.Insert((Int) i_117);
          resBind_s_110 = riseq_115;
        }
        Sequence bind_l_109;
        if ((Int) (resBind_s_110.Card()) != (Int) 0) 
          bind_l_109 = Sort(resBind_s_110);
        bool succ_111 = true;
        Int vdm_PAT_i;
        Generic tmpe_125;
        for (int i_124 = bind_l_109.First(tmpe_125); i_124; i_124 = bind_l_109.Next(tmpe_125)) {
          Int e_113 = tmpe_125;
          {
            vdm_PAT_i = e_113;
            succ_111 = true;
            if (succ_111) {
              Record tmpVar_118;
              {
                Sequence tmpseq_119;
                tmpseq_119 = vdm_PAT_p__l;
                tmpVar_118 = (Record) (tmpseq_119[vdm_PAT_i.GetValue()]);
              }
              reselem_108 = vdm_PAT_DoCarePattern(tmpVar_118, vdm_PAT_NewBase(vdm_PAT_id__base, vdm_PAT_i));
              res_l_107.ImpAppend(reselem_108);
            }
          }
        }
        vdm_PAT_e__l = res_l_107;
      }
      {
        Record rexpr_126(vdm_AS_RecordPattern, length_AS_RecordPattern);
        {
          rexpr_126 = Record(vdm_AS_RecordPattern, length_AS_RecordPattern);
          rexpr_126.SetField(1, vdm_PAT_tag);
          rexpr_126.SetField(2, vdm_PAT_e__l);
          rexpr_126.SetField(3, Nil());
        }
        return rexpr_126;
      }
    }
  }
  if (!succ_5) {
    Sequence vdm_PAT_p__l;
    {
      succ_5 = false;
      if (selRes_4.IsRecord()) 
        if (vdm_AS_TuplePattern == ((Record) selRes_4).GetTag()) {
          Sequence e_l_130;
          for (int i_131 = 1; i_131 <= ((Record) selRes_4).Length(); i_131++) 
            e_l_130.ImpAppend(((Record) selRes_4).GetField(i_131));
          if (succ_5 = 2 == (Int) (e_l_130.Length())) {
            Generic permI_132;
            permI_132 = (Generic) (e_l_130.Hd());
            succ_5 = true;
            {
              vdm_PAT_p__l = permI_132;
              succ_5 = true;
            }
            permI_132 = (Generic) (e_l_130[2]);
            if (succ_5) 
              succ_5 = true;
          }
        }
    }
    if (succ_5) {
      Sequence vdm_PAT_e__l;
      {
        Sequence res_l_135;
        Record reselem_136;
        Set resBind_s_138;
        {
          Set riseq_143;
          int max_144 = (Int) (vdm_PAT_p__l.Length());
          for (int i_145 = 1; i_145 <= max_144; i_145++) 
            riseq_143.Insert((Int) i_145);
          resBind_s_138 = riseq_143;
        }
        Sequence bind_l_137;
        if ((Int) (resBind_s_138.Card()) != (Int) 0) 
          bind_l_137 = Sort(resBind_s_138);
        bool succ_139 = true;
        Int vdm_PAT_i;
        Generic tmpe_153;
        for (int i_152 = bind_l_137.First(tmpe_153); i_152; i_152 = bind_l_137.Next(tmpe_153)) {
          Int e_141 = tmpe_153;
          {
            vdm_PAT_i = e_141;
            succ_139 = true;
            if (succ_139) {
              Record tmpVar_146;
              {
                Sequence tmpseq_147;
                tmpseq_147 = vdm_PAT_p__l;
                tmpVar_146 = (Record) (tmpseq_147[vdm_PAT_i.GetValue()]);
              }
              reselem_136 = vdm_PAT_DoCarePattern(tmpVar_146, vdm_PAT_NewBase(vdm_PAT_id__base, vdm_PAT_i));
              res_l_135.ImpAppend(reselem_136);
            }
          }
        }
        vdm_PAT_e__l = res_l_135;
      }
      {
        Record rexpr_154(vdm_AS_TuplePattern, length_AS_TuplePattern);
        {
          rexpr_154 = Record(vdm_AS_TuplePattern, length_AS_TuplePattern);
          rexpr_154.SetField(1, vdm_PAT_e__l);
          rexpr_154.SetField(2, Nil());
        }
        return rexpr_154;
      }
    }
  }
  if (!succ_5) {
    Record vdm_PAT_pat;
    Record vdm_PAT_set__e;
    {
      succ_5 = false;
      if (selRes_4.IsRecord()) 
        if (vdm_AS_SetBind == ((Record) selRes_4).GetTag()) {
          Sequence e_l_157;
          for (int i_158 = 1; i_158 <= ((Record) selRes_4).Length(); i_158++) 
            e_l_157.ImpAppend(((Record) selRes_4).GetField(i_158));
          if (succ_5 = 2 == (Int) (e_l_157.Length())) {
            Record permI_159;
            permI_159 = (Record) (e_l_157.Hd());
            succ_5 = true;
            {
              vdm_PAT_pat = permI_159;
              succ_5 = true;
            }
            permI_159 = (Record) (e_l_157[2]);
            if (succ_5) {
              vdm_PAT_set__e = permI_159;
              succ_5 = true;
            }
          }
        }
    }
    if (succ_5) {
      Record vdm_PAT_new__pat;
      vdm_PAT_new__pat = vdm_PAT_DoCarePattern(vdm_PAT_pat, vdm_PAT_NewBase(vdm_PAT_id__base, (Int) 1));
      {
        Record rexpr_166(vdm_AS_SetBind, length_AS_SetBind);
        {
          rexpr_166 = Record(vdm_AS_SetBind, length_AS_SetBind);
          rexpr_166.SetField(1, vdm_PAT_new__pat);
          rexpr_166.SetField(2, vdm_PAT_set__e);
        }
        return rexpr_166;
      }
    }
  }
  if (!succ_5) {
    Record vdm_PAT_pat;
    Record vdm_PAT_tp;
    {
      succ_5 = false;
      if (selRes_4.IsRecord()) 
        if (vdm_AS_TypeBind == ((Record) selRes_4).GetTag()) {
          Sequence e_l_169;
          for (int i_170 = 1; i_170 <= ((Record) selRes_4).Length(); i_170++) 
            e_l_169.ImpAppend(((Record) selRes_4).GetField(i_170));
          if (succ_5 = 2 == (Int) (e_l_169.Length())) {
            Record permI_171;
            permI_171 = (Record) (e_l_169.Hd());
            succ_5 = true;
            {
              vdm_PAT_pat = permI_171;
              succ_5 = true;
            }
            permI_171 = (Record) (e_l_169[2]);
            if (succ_5) {
              vdm_PAT_tp = permI_171;
              succ_5 = true;
            }
          }
        }
    }
    if (succ_5) {
      Record vdm_PAT_new__pat;
      vdm_PAT_new__pat = vdm_PAT_DoCarePattern(vdm_PAT_pat, vdm_PAT_NewBase(vdm_PAT_id__base, (Int) 1));
      {
        Record rexpr_178(vdm_AS_TypeBind, length_AS_TypeBind);
        {
          rexpr_178 = Record(vdm_AS_TypeBind, length_AS_TypeBind);
          rexpr_178.SetField(1, vdm_PAT_new__pat);
          rexpr_178.SetField(2, vdm_PAT_tp);
        }
        return rexpr_178;
      }
    }
  }
  if (!succ_5) 
    RunTime("Can not evaluate an error statement");
}

Set vdm_PAT_EvalBind(Record vdm_PAT_bind, Generic vdm_PAT_partition) {
  Bool cond_4;
  {
    Record argTmp_5;
    argTmp_5 = vdm_PAT_bind;
    if (argTmp_5.IsRecord()) 
      cond_4 = vdm_AS_SetBind == argTmp_5.GetTag();
    else 
      cond_4 = false;
  }
  if (cond_4.GetValue()) {
    Record tmpVar_6;
    tmpVar_6 = vdm_PAT_bind;
    Generic tmpVar_7;
    tmpVar_7 = vdm_PAT_partition;
    return vdm_PAT_EvalSetBind(tmpVar_6, tmpVar_7);
  }
  else { RunTime("Can not evaluate an error statement"); }
}

Set vdm_PAT_EvalMultBindSeq(Sequence vdm_PAT_bind__l, Generic vdm_PAT_partition) {
  Sequence vdm_PAT_pat__lp;
  vdm_PAT_pat__lp = Sequence();
  Sequence vdm_PAT_seq__lv;
  vdm_PAT_seq__lv = Sequence();
  Sequence vdm_PAT_env__ls;
  vdm_PAT_env__ls = Sequence();
  {
    Sequence sq_4;
    sq_4 = vdm_PAT_bind__l;
    Record vdm_PAT_bind;
    bool succ_6;
    Generic tmpe_29;
    for (int i_28 = sq_4.First(tmpe_29); i_28; i_28 = sq_4.Next(tmpe_29)) {
      Record elem_5 = tmpe_29;
      {
        succ_6 = true;
        {
          vdm_PAT_bind = elem_5;
          succ_6 = true;
        }
        if (succ_6) {
          Bool cond_7;
          {
            Record argTmp_8;
            argTmp_8 = vdm_PAT_bind;
            if (argTmp_8.IsRecord()) 
              cond_7 = vdm_AS_MultTypeBind == argTmp_8.GetTag();
            else 
              cond_7 = false;
          }
          if (cond_7.GetValue()) 
            RunTime("Can not evaluate an error statement");
          else {
            bool succ_9;
            Record tmpVal_10;
            tmpVal_10 = vdm_PAT_bind;
            Sequence vdm_PAT_pat__l;
            Record vdm_PAT_set__e;
            succ_9 = true;
            {
              succ_9 = false;
              if (tmpVal_10.IsRecord()) 
                if (vdm_AS_MultSetBind == ((Record) tmpVal_10).GetTag()) {
                  Sequence e_l_11;
                  for (int i_12 = 1; i_12 <= ((Record) tmpVal_10).Length(); i_12++) 
                    e_l_11.ImpAppend(((Record) tmpVal_10).GetField(i_12));
                  if (succ_9 = 2 == (Int) (e_l_11.Length())) {
                    Generic permI_13;
                    permI_13 = (Generic) (e_l_11.Hd());
                    succ_9 = true;
                    {
                      vdm_PAT_pat__l = permI_13;
                      succ_9 = true;
                    }
                    permI_13 = (Generic) (e_l_11[2]);
                    if (succ_9) {
                      vdm_PAT_set__e = permI_13;
                      succ_9 = true;
                    }
                  }
                }
            }
            if (!succ_9) 
              RunTime("Pattern match did not succeed in value definition");
            {
              Sequence sq_14;
              sq_14 = vdm_PAT_pat__l;
              Record vdm_PAT_pat__p;
              bool succ_16;
              Generic tmpe_27;
              for (int i_26 = sq_14.First(tmpe_27); i_26; i_26 = sq_14.Next(tmpe_27)) {
                Record elem_15 = tmpe_27;
                {
                  succ_16 = true;
                  {
                    vdm_PAT_pat__p = elem_15;
                    succ_16 = true;
                  }
                  if (succ_16) {
                    Sequence rhs_17;
                    {
                      Sequence var2_19;
                      var2_19 = Sequence().ImpAppend(vdm_PAT_EvalExpr(vdm_PAT_set__e));
                      rhs_17.ImpConc(vdm_PAT_seq__lv).ImpConc(var2_19);
                    }
                    vdm_PAT_seq__lv = rhs_17;
                    {
                      Sequence rhs_22;
                      {
                        Sequence var2_24;
                        var2_24 = Sequence().ImpAppend(vdm_PAT_pat__p);
                        rhs_22.ImpConc(vdm_PAT_pat__lp).ImpConc(var2_24);
                      }
                      vdm_PAT_pat__lp = rhs_22;
                    }
                  }
                  else 
                    RunTime("Pattern did not match in sequence for loop");
                }
              }
            }
          }
        }
        else 
          RunTime("Pattern did not match in sequence for loop");
      }
    }
  }
  {
    Bool cond_30;
    {
      bool tmpQuant_31 = true;
      {
        Sequence seq_lv_34;
        bool succ_32;
        Bool tsucc_35;
        tsucc_35 = true;
        {
          Set tmpVar_v_33;
          tmpVar_v_33 = vdm_PAT_seq__lv.Elems();
{ seq_lv_34.ImpAppend(tmpVar_v_33); }
        }
        Set allComb_36 = GenAllComb(seq_lv_34);
        Bool pred_42;
        Record vdm_PAT_elm__v;
        Generic tmpe_47;
        for (int bb_46 = allComb_36.First(tmpe_47); bb_46 && tmpQuant_31; bb_46 = allComb_36.Next(tmpe_47)) {
          Sequence tmp_43 = tmpe_47;
          {
            if (succ_32 = 1 == (Int) (tmp_43.Length())) {
              Record permI_45;
              permI_45 = (Record) (tmp_43.Hd());
              succ_32 = true;
              {
                vdm_PAT_elm__v = permI_45;
                succ_32 = true;
              }
            }
            if (succ_32) {
              Record argTmp_44;
              argTmp_44 = vdm_PAT_elm__v;
              if (argTmp_44.IsRecord()) 
                pred_42 = vdm_SEM_SET == argTmp_44.GetTag();
              else 
                pred_42 = false;
              if (pred_42.GetValue()) {}
              else 
                tmpQuant_31 = false;
            }
          }
        }
      }
      cond_30 = (Bool) tmpQuant_31;
    }
    if (cond_30.GetValue()) {
      Sequence vdm_PAT_seq__lsv;
      {
        Sequence res_l_50;
        Generic reselem_51;
        Set resBind_s_53;
        {
          Set riseq_58;
          int max_59 = (Int) (vdm_PAT_seq__lv.Length());
          for (int i_60 = 1; i_60 <= max_59; i_60++) 
            riseq_58.Insert((Int) i_60);
          resBind_s_53 = riseq_58;
        }
        Sequence bind_l_52;
        if ((Int) (resBind_s_53.Card()) != (Int) 0) 
          bind_l_52 = Sort(resBind_s_53);
        bool succ_54 = true;
        Int vdm_PAT_i;
        Generic tmpe_65;
        for (int i_64 = bind_l_52.First(tmpe_65); i_64; i_64 = bind_l_52.Next(tmpe_65)) {
          Int e_56 = tmpe_65;
          {
            vdm_PAT_i = e_56;
            succ_54 = true;
            if (succ_54) {
              Record tmpRec_61;
              {
                Sequence tmpseq_62;
                tmpseq_62 = vdm_PAT_seq__lv;
                tmpRec_61 = (Record) (tmpseq_62[vdm_PAT_i.GetValue()]);
              }
              if (((Record) tmpRec_61).Is(vdm_SEM_TUPLE)) 
                reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_TUPLE_v);
              else 
                if (((Record) tmpRec_61).Is(vdm_SEM_TOKEN)) 
                  reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_TOKEN_v);
                else 
                  if (((Record) tmpRec_61).Is(vdm_SEM_SET)) 
                    reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_SET_v);
                  else 
                    if (((Record) tmpRec_61).Is(vdm_SEM_SEQ)) 
                      reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_SEQ_v);
                    else 
                      if (((Record) tmpRec_61).Is(vdm_SEM_REC)) 
                        reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_REC_v);
                      else 
                        if (((Record) tmpRec_61).Is(vdm_SEM_QUOTE)) 
                          reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_QUOTE_v);
                        else 
                          if (((Record) tmpRec_61).Is(vdm_SEM_NUM)) 
                            reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_NUM_v);
                          else 
                            if (((Record) tmpRec_61).Is(vdm_SEM_MAP)) 
                              reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_MAP_v);
                            else 
                              if (((Record) tmpRec_61).Is(vdm_SEM_ExtVAL)) 
                                reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_ExtVAL_v);
                              else 
                                if (((Record) tmpRec_61).Is(vdm_SEM_EXIT)) 
                                  reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_EXIT_v);
                                else 
                                  if (((Record) tmpRec_61).Is(vdm_SEM_CHAR)) 
                                    reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_CHAR_v);
                                  else 
                                    if (((Record) tmpRec_61).Is(vdm_SEM_BOOL)) 
                                      reselem_51 = ((Record) tmpRec_61).GetField(pos_SEM_BOOL_v);
                                    else 
                                      RunTime("Unknown record field selector");
              res_l_50.ImpAppend(reselem_51);
            }
          }
        }
        vdm_PAT_seq__lsv = res_l_50;
      }
      {
        Set vdm_PAT_tmp__slv;
        vdm_PAT_tmp__slv = vdm_PAT_SeqOfSetOf2SetOfSeqOf(vdm_PAT_seq__lsv);
        {
          Set iset_69;
          iset_69 = vdm_PAT_tmp__slv;
          Sequence vdm_PAT_val__lv;
          bool succ_71;
          Generic tmpe_79;
          for (int bb_78 = iset_69.First(tmpe_79); bb_78; bb_78 = iset_69.Next(tmpe_79)) {
            Sequence elem_70 = tmpe_79;
            {
              succ_71 = true;
              {
                vdm_PAT_val__lv = elem_70;
                succ_71 = true;
              }
              if (succ_71) {
                Sequence rhs_72;
                {
                  Sequence var2_74;
                  var2_74 = Sequence().ImpAppend(vdm_PAT_MatchLists(vdm_PAT_pat__lp, vdm_PAT_val__lv));
                  rhs_72.ImpConc(vdm_PAT_env__ls).ImpConc(var2_74);
                }
                vdm_PAT_env__ls = rhs_72;
              }
              else 
                RunTime("Pattern did not match in set for loop");
            }
          }
          {
            Bool cond_80;
            cond_80 = (Bool) (vdm_PAT_partition == (Quote) "DO_PARTITION");
            if (cond_80.GetValue()) {
              Set rexpr_86;
              rexpr_86 = vdm_PAT_Partition(vdm_PAT_env__ls);
              return rexpr_86;
            }
            else {
              Set rexpr_83;
              rexpr_83 = vdm_PAT_UnionMatch(vdm_PAT_Collapse(vdm_PAT_env__ls));
              return rexpr_83;
            }
          }
        }
      }
    }
    else { RunTime("Can not evaluate an error statement"); }
  }
}

Set vdm_PAT_EvalSetBind(Record var_1_1, Generic var_2_2) {
  Generic vdm_PAT_partition;
  Record vdm_PAT_pat__p;
  Record vdm_PAT_set__e;
  bool succ_3 = true;
  {
    succ_3 = false;
    if (var_1_1.IsRecord()) 
      if (vdm_AS_SetBind == var_1_1.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_1_1.Length(); i_5++) 
          e_l_4.ImpAppend(var_1_1.GetField(i_5));
        if (succ_3 = 2 == (Int) (e_l_4.Length())) {
          Record permI_6;
          permI_6 = (Record) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_PAT_pat__p = permI_6;
            succ_3 = true;
          }
          permI_6 = (Record) (e_l_4[2]);
          if (succ_3) {
            vdm_PAT_set__e = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  {
    vdm_PAT_partition = var_2_2;
    succ_3 = true;
  }
  if (succ_3) {
    Sequence vdm_PAT_env__ls;
    vdm_PAT_env__ls = Sequence();
    {
      Record vdm_PAT_set__v;
      vdm_PAT_set__v = vdm_PAT_EvalExpr(vdm_PAT_set__e);
      {
        Bool cond_10;
        {
          Record argTmp_11;
          argTmp_11 = vdm_PAT_set__v;
          if (argTmp_11.IsRecord()) 
            cond_10 = vdm_SEM_SET == argTmp_11.GetTag();
          else 
            cond_10 = false;
        }
        if (cond_10.GetValue()) {
          bool succ_12;
          Record tmpVal_13;
          tmpVal_13 = vdm_PAT_set__v;
          Set vdm_PAT_set__sv;
          succ_12 = true;
          {
            succ_12 = false;
            if (tmpVal_13.IsRecord()) 
              if (vdm_SEM_SET == ((Record) tmpVal_13).GetTag()) {
                Sequence e_l_14;
                for (int i_15 = 1; i_15 <= ((Record) tmpVal_13).Length(); i_15++) 
                  e_l_14.ImpAppend(((Record) tmpVal_13).GetField(i_15));
                if (succ_12 = 1 == (Int) (e_l_14.Length())) {
                  Set permI_16;
                  permI_16 = (Set) (e_l_14.Hd());
                  succ_12 = true;
                  {
                    vdm_PAT_set__sv = permI_16;
                    succ_12 = true;
                  }
                }
              }
          }
          if (!succ_12) 
            RunTime("Pattern match did not succeed in value definition");
          {
            Set iset_17;
            iset_17 = vdm_PAT_set__sv;
            Record vdm_PAT_elm__v;
            bool succ_19;
            Generic tmpe_27;
            for (int bb_26 = iset_17.First(tmpe_27); bb_26; bb_26 = iset_17.Next(tmpe_27)) {
              Record elem_18 = tmpe_27;
              {
                succ_19 = true;
                {
                  vdm_PAT_elm__v = elem_18;
                  succ_19 = true;
                }
                if (succ_19) {
                  Sequence rhs_20;
                  {
                    Sequence var2_22;
                    var2_22 = Sequence().ImpAppend(vdm_PAT_PatternMatch(vdm_PAT_pat__p, vdm_PAT_elm__v));
                    rhs_20.ImpConc(vdm_PAT_env__ls).ImpConc(var2_22);
                  }
                  vdm_PAT_env__ls = rhs_20;
                }
                else 
                  RunTime("Pattern did not match in set for loop");
              }
            }
            {
              Bool cond_28;
              cond_28 = (Bool) (vdm_PAT_partition == (Quote) "DO_PARTITION");
              if (cond_28.GetValue()) {
                Set rexpr_33;
                rexpr_33 = vdm_PAT_Partition(vdm_PAT_env__ls);
                return rexpr_33;
              }
              else {
                Set rexpr_31;
                rexpr_31 = vdm_PAT_Collapse(vdm_PAT_env__ls);
                return rexpr_31;
              }
            }
          }
        }
        else { RunTime("Can not evaluate an error statement"); }
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: EvalSetBind");
}

Record vdm_PAT_GetExpr(Record vdm_PAT_pat) {
  Record selRes_3;
  selRes_3 = vdm_PAT_pat;
  bool succ_4 = true;
  {
    Generic vdm_PAT_id;
    {
      succ_4 = false;
      if (selRes_3.IsRecord()) 
        if (vdm_AS_PatternName == ((Record) selRes_3).GetTag()) {
          Sequence e_l_5;
          for (int i_6 = 1; i_6 <= ((Record) selRes_3).Length(); i_6++) 
            e_l_5.ImpAppend(((Record) selRes_3).GetField(i_6));
          if (succ_4 = 2 == (Int) (e_l_5.Length())) {
            Generic permI_7;
            permI_7 = (Generic) (e_l_5.Hd());
            succ_4 = true;
            {
              vdm_PAT_id = permI_7;
              succ_4 = true;
            }
            permI_7 = (Generic) (e_l_5[2]);
            if (succ_4) 
              succ_4 = true;
          }
        }
    }
    if (succ_4) {
      Bool cond_8;
      cond_8 = (Bool) (vdm_PAT_id == Nil());
      if (cond_8.GetValue()) {
        Record tmpVar_12;
        {
          Record tmpVar_14(vdm_AS_Name, length_AS_Name);
          {
            tmpVar_14 = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_15;
            tmpVar_15 = Sequence().ImpAppend(Sequence("1"));
            tmpVar_14.SetField(1, tmpVar_15);
            tmpVar_14.SetField(2, Nil());
          }
          tmpVar_12 = vdm_PAT_DoCarePattern(vdm_PAT_pat, tmpVar_14);
        }
        return vdm_PAT_GetExpr(tmpVar_12);
      }
      else {
        Generic rexpr_11;
        rexpr_11 = vdm_PAT_id;
        return rexpr_11;
      }
    }
  }
  if (!succ_4) {
    Record vdm_PAT_val;
    {
      succ_4 = false;
      if (selRes_3.IsRecord()) 
        if (vdm_AS_MatchVal == ((Record) selRes_3).GetTag()) {
          Sequence e_l_18;
          for (int i_19 = 1; i_19 <= ((Record) selRes_3).Length(); i_19++) 
            e_l_18.ImpAppend(((Record) selRes_3).GetField(i_19));
          if (succ_4 = 1 == (Int) (e_l_18.Length())) {
            Record permI_20;
            permI_20 = (Record) (e_l_18.Hd());
            succ_4 = true;
            {
              vdm_PAT_val = permI_20;
              succ_4 = true;
            }
          }
        }
    }
    if (succ_4) {
      Record rexpr_21;
      rexpr_21 = vdm_PAT_val;
      return rexpr_21;
    }
  }
  if (!succ_4) {
    Sequence vdm_PAT_els;
    {
      succ_4 = false;
      if (selRes_3.IsRecord()) 
        if (vdm_AS_SetEnumPattern == ((Record) selRes_3).GetTag()) {
          Sequence e_l_22;
          for (int i_23 = 1; i_23 <= ((Record) selRes_3).Length(); i_23++) 
            e_l_22.ImpAppend(((Record) selRes_3).GetField(i_23));
          if (succ_4 = 2 == (Int) (e_l_22.Length())) {
            Generic permI_24;
            permI_24 = (Generic) (e_l_22.Hd());
            succ_4 = true;
            {
              vdm_PAT_els = permI_24;
              succ_4 = true;
            }
            permI_24 = (Generic) (e_l_22[2]);
            if (succ_4) 
              succ_4 = true;
          }
        }
    }
    if (succ_4) {
      Sequence vdm_PAT_e__l;
      {
        Sequence res_l_27;
        Record reselem_28;
        Set resBind_s_30;
        {
          Set riseq_35;
          int max_36 = (Int) (vdm_PAT_els.Length());
          for (int i_37 = 1; i_37 <= max_36; i_37++) 
            riseq_35.Insert((Int) i_37);
          resBind_s_30 = riseq_35;
        }
        Sequence bind_l_29;
        if ((Int) (resBind_s_30.Card()) != (Int) 0) 
          bind_l_29 = Sort(resBind_s_30);
        bool succ_31 = true;
        Int vdm_PAT_i;
        Generic tmpe_42;
        for (int i_41 = bind_l_29.First(tmpe_42); i_41; i_41 = bind_l_29.Next(tmpe_42)) {
          Int e_33 = tmpe_42;
          {
            vdm_PAT_i = e_33;
            succ_31 = true;
            if (succ_31) {
              Record tmpVar_38;
              {
                Sequence tmpseq_39;
                tmpseq_39 = vdm_PAT_els;
                tmpVar_38 = (Record) (tmpseq_39[vdm_PAT_i.GetValue()]);
              }
              reselem_28 = vdm_PAT_GetExpr(tmpVar_38);
              res_l_27.ImpAppend(reselem_28);
            }
          }
        }
        vdm_PAT_e__l = res_l_27;
      }
      {
        Record rexpr_43(vdm_AS_SetEnumerationExpr, length_AS_SetEnumerationExpr);
        {
          rexpr_43 = Record(vdm_AS_SetEnumerationExpr, length_AS_SetEnumerationExpr);
          rexpr_43.SetField(1, vdm_PAT_e__l);
          rexpr_43.SetField(2, Nil());
        }
        return rexpr_43;
      }
    }
  }
  if (!succ_4) {
    Record vdm_PAT_lp;
    Record vdm_PAT_rp;
    {
      succ_4 = false;
      if (selRes_3.IsRecord()) 
        if (vdm_AS_SetUnionPattern == ((Record) selRes_3).GetTag()) {
          Sequence e_l_46;
          for (int i_47 = 1; i_47 <= ((Record) selRes_3).Length(); i_47++) 
            e_l_46.ImpAppend(((Record) selRes_3).GetField(i_47));
          if (succ_4 = 2 == (Int) (e_l_46.Length())) {
            Record permI_48;
            permI_48 = (Record) (e_l_46.Hd());
            succ_4 = true;
            {
              vdm_PAT_lp = permI_48;
              succ_4 = true;
            }
            permI_48 = (Record) (e_l_46[2]);
            if (succ_4) {
              vdm_PAT_rp = permI_48;
              succ_4 = true;
            }
          }
        }
    }
    if (succ_4) {
      Record rexpr_49(vdm_AS_BinaryExpr, length_AS_BinaryExpr);
      {
        rexpr_49 = Record(vdm_AS_BinaryExpr, length_AS_BinaryExpr);
        rexpr_49.SetField(1, vdm_PAT_GetExpr(vdm_PAT_lp));
        rexpr_49.SetField(2, (Quote) "SETUNION");
        rexpr_49.SetField(3, vdm_PAT_GetExpr(vdm_PAT_rp));
        rexpr_49.SetField(4, Nil());
      }
      return rexpr_49;
    }
  }
  if (!succ_4) {
    Sequence vdm_PAT_els;
    {
      succ_4 = false;
      if (selRes_3.IsRecord()) 
        if (vdm_AS_SeqEnumPattern == ((Record) selRes_3).GetTag()) {
          Sequence e_l_56;
          for (int i_57 = 1; i_57 <= ((Record) selRes_3).Length(); i_57++) 
            e_l_56.ImpAppend(((Record) selRes_3).GetField(i_57));
          if (succ_4 = 2 == (Int) (e_l_56.Length())) {
            Generic permI_58;
            permI_58 = (Generic) (e_l_56.Hd());
            succ_4 = true;
            {
              vdm_PAT_els = permI_58;
              succ_4 = true;
            }
            permI_58 = (Generic) (e_l_56[2]);
            if (succ_4) 
              succ_4 = true;
          }
        }
    }
    if (succ_4) {
      Sequence vdm_PAT_e__l;
      {
        Sequence res_l_61;
        Record reselem_62;
        Set resBind_s_64;
        {
          Set riseq_69;
          int max_70 = (Int) (vdm_PAT_els.Length());
          for (int i_71 = 1; i_71 <= max_70; i_71++) 
            riseq_69.Insert((Int) i_71);
          resBind_s_64 = riseq_69;
        }
        Sequence bind_l_63;
        if ((Int) (resBind_s_64.Card()) != (Int) 0) 
          bind_l_63 = Sort(resBind_s_64);
        bool succ_65 = true;
        Int vdm_PAT_i;
        Generic tmpe_76;
        for (int i_75 = bind_l_63.First(tmpe_76); i_75; i_75 = bind_l_63.Next(tmpe_76)) {
          Int e_67 = tmpe_76;
          {
            vdm_PAT_i = e_67;
            succ_65 = true;
            if (succ_65) {
              Record tmpVar_72;
              {
                Sequence tmpseq_73;
                tmpseq_73 = vdm_PAT_els;
                tmpVar_72 = (Record) (tmpseq_73[vdm_PAT_i.GetValue()]);
              }
              reselem_62 = vdm_PAT_GetExpr(tmpVar_72);
              res_l_61.ImpAppend(reselem_62);
            }
          }
        }
        vdm_PAT_e__l = res_l_61;
      }
      {
        Record rexpr_77(vdm_AS_SeqEnumerationExpr, length_AS_SeqEnumerationExpr);
        {
          rexpr_77 = Record(vdm_AS_SeqEnumerationExpr, length_AS_SeqEnumerationExpr);
          rexpr_77.SetField(1, vdm_PAT_e__l);
          rexpr_77.SetField(2, Nil());
        }
        return rexpr_77;
      }
    }
  }
  if (!succ_4) {
    Record vdm_PAT_lp;
    Record vdm_PAT_rp;
    {
      succ_4 = false;
      if (selRes_3.IsRecord()) 
        if (vdm_AS_SeqConcPattern == ((Record) selRes_3).GetTag()) {
          Sequence e_l_80;
          for (int i_81 = 1; i_81 <= ((Record) selRes_3).Length(); i_81++) 
            e_l_80.ImpAppend(((Record) selRes_3).GetField(i_81));
          if (succ_4 = 2 == (Int) (e_l_80.Length())) {
            Record permI_82;
            permI_82 = (Record) (e_l_80.Hd());
            succ_4 = true;
            {
              vdm_PAT_lp = permI_82;
              succ_4 = true;
            }
            permI_82 = (Record) (e_l_80[2]);
            if (succ_4) {
              vdm_PAT_rp = permI_82;
              succ_4 = true;
            }
          }
        }
    }
    if (succ_4) {
      Record rexpr_83(vdm_AS_BinaryExpr, length_AS_BinaryExpr);
      {
        rexpr_83 = Record(vdm_AS_BinaryExpr, length_AS_BinaryExpr);
        rexpr_83.SetField(1, vdm_PAT_GetExpr(vdm_PAT_lp));
        rexpr_83.SetField(2, (Quote) "SEQCONC");
        rexpr_83.SetField(3, vdm_PAT_GetExpr(vdm_PAT_rp));
        rexpr_83.SetField(4, Nil());
      }
      return rexpr_83;
    }
  }
  if (!succ_4) {
    Sequence vdm_PAT_p__l;
    Record vdm_PAT_tag(vdm_AS_Name, length_AS_Name);
    {
      succ_4 = false;
      if (selRes_3.IsRecord()) 
        if (vdm_AS_RecordPattern == ((Record) selRes_3).GetTag()) {
          Sequence e_l_90;
          for (int i_91 = 1; i_91 <= ((Record) selRes_3).Length(); i_91++) 
            e_l_90.ImpAppend(((Record) selRes_3).GetField(i_91));
          if (succ_4 = 3 == (Int) (e_l_90.Length())) {
            Generic permI_92;
            permI_92 = (Generic) (e_l_90.Hd());
            succ_4 = true;
            {
              vdm_PAT_tag = permI_92;
              succ_4 = true;
            }
            permI_92 = (Generic) (e_l_90[2]);
            if (succ_4) {
              vdm_PAT_p__l = permI_92;
              succ_4 = true;
            }
            permI_92 = (Generic) (e_l_90[3]);
            if (succ_4) 
              succ_4 = true;
          }
        }
    }
    if (succ_4) {
      Sequence vdm_PAT_e__l;
      {
        Sequence res_l_95;
        Record reselem_96;
        Set resBind_s_98;
        {
          Set riseq_103;
          int max_104 = (Int) (vdm_PAT_p__l.Length());
          for (int i_105 = 1; i_105 <= max_104; i_105++) 
            riseq_103.Insert((Int) i_105);
          resBind_s_98 = riseq_103;
        }
        Sequence bind_l_97;
        if ((Int) (resBind_s_98.Card()) != (Int) 0) 
          bind_l_97 = Sort(resBind_s_98);
        bool succ_99 = true;
        Int vdm_PAT_i;
        Generic tmpe_110;
        for (int i_109 = bind_l_97.First(tmpe_110); i_109; i_109 = bind_l_97.Next(tmpe_110)) {
          Int e_101 = tmpe_110;
          {
            vdm_PAT_i = e_101;
            succ_99 = true;
            if (succ_99) {
              Record tmpVar_106;
              {
                Sequence tmpseq_107;
                tmpseq_107 = vdm_PAT_p__l;
                tmpVar_106 = (Record) (tmpseq_107[vdm_PAT_i.GetValue()]);
              }
              reselem_96 = vdm_PAT_GetExpr(tmpVar_106);
              res_l_95.ImpAppend(reselem_96);
            }
          }
        }
        vdm_PAT_e__l = res_l_95;
      }
      {
        Record rexpr_111(vdm_AS_RecordConstructorExpr, length_AS_RecordConstructorExpr);
        {
          rexpr_111 = Record(vdm_AS_RecordConstructorExpr, length_AS_RecordConstructorExpr);
          rexpr_111.SetField(1, vdm_PAT_tag);
          rexpr_111.SetField(2, vdm_PAT_e__l);
          rexpr_111.SetField(3, Nil());
        }
        return rexpr_111;
      }
    }
  }
  if (!succ_4) {
    Sequence vdm_PAT_p__l;
    {
      succ_4 = false;
      if (selRes_3.IsRecord()) 
        if (vdm_AS_TuplePattern == ((Record) selRes_3).GetTag()) {
          Sequence e_l_115;
          for (int i_116 = 1; i_116 <= ((Record) selRes_3).Length(); i_116++) 
            e_l_115.ImpAppend(((Record) selRes_3).GetField(i_116));
          if (succ_4 = 2 == (Int) (e_l_115.Length())) {
            Generic permI_117;
            permI_117 = (Generic) (e_l_115.Hd());
            succ_4 = true;
            {
              vdm_PAT_p__l = permI_117;
              succ_4 = true;
            }
            permI_117 = (Generic) (e_l_115[2]);
            if (succ_4) 
              succ_4 = true;
          }
        }
    }
    if (succ_4) {
      Sequence vdm_PAT_e__l;
      {
        Sequence res_l_120;
        Record reselem_121;
        Set resBind_s_123;
        {
          Set riseq_128;
          int max_129 = (Int) (vdm_PAT_p__l.Length());
          for (int i_130 = 1; i_130 <= max_129; i_130++) 
            riseq_128.Insert((Int) i_130);
          resBind_s_123 = riseq_128;
        }
        Sequence bind_l_122;
        if ((Int) (resBind_s_123.Card()) != (Int) 0) 
          bind_l_122 = Sort(resBind_s_123);
        bool succ_124 = true;
        Int vdm_PAT_i;
        Generic tmpe_135;
        for (int i_134 = bind_l_122.First(tmpe_135); i_134; i_134 = bind_l_122.Next(tmpe_135)) {
          Int e_126 = tmpe_135;
          {
            vdm_PAT_i = e_126;
            succ_124 = true;
            if (succ_124) {
              Record tmpVar_131;
              {
                Sequence tmpseq_132;
                tmpseq_132 = vdm_PAT_p__l;
                tmpVar_131 = (Record) (tmpseq_132[vdm_PAT_i.GetValue()]);
              }
              reselem_121 = vdm_PAT_GetExpr(tmpVar_131);
              res_l_120.ImpAppend(reselem_121);
            }
          }
        }
        vdm_PAT_e__l = res_l_120;
      }
      {
        Record rexpr_136(vdm_AS_TupleConstructorExpr, length_AS_TupleConstructorExpr);
        {
          rexpr_136 = Record(vdm_AS_TupleConstructorExpr, length_AS_TupleConstructorExpr);
          rexpr_136.SetField(1, vdm_PAT_e__l);
          rexpr_136.SetField(2, Nil());
        }
        return rexpr_136;
      }
    }
  }
  if (!succ_4) 
    RunTime("Can not evaluate an error statement");
}

Set vdm_PAT_MatchLists(Sequence vdm_PAT_els__lp, Sequence vdm_PAT_val__lv) {
  Bool cond_4;
  cond_4 = (Bool) ((Int) (vdm_PAT_val__lv.Length()) == (Int) (vdm_PAT_els__lp.Length()));
  if (cond_4.GetValue()) {
    Bool cond_10;
    {
      Sequence var2_12;
      var2_12 = Sequence();
      cond_10 = (Bool) (vdm_PAT_val__lv == var2_12);
    }
    if (cond_10.GetValue()) {
      Set rexpr_60;
      rexpr_60 = Set().Insert(vdm_PAT_MkEmptyBlkEnv((Quote) "READ_ONLY"));
      return rexpr_60;
    }
    else {
      Sequence vdm_PAT_tmp__ls;
      {
        Sequence res_l_15;
        Set reselem_16;
        Set resBind_s_18;
        {
          Set riseq_23;
          int max_24 = (Int) (vdm_PAT_els__lp.Length());
          for (int i_25 = 1; i_25 <= max_24; i_25++) 
            riseq_23.Insert((Int) i_25);
          resBind_s_18 = riseq_23;
        }
        Sequence bind_l_17;
        if ((Int) (resBind_s_18.Card()) != (Int) 0) 
          bind_l_17 = Sort(resBind_s_18);
        bool succ_19 = true;
        Int vdm_PAT_i;
        Generic tmpe_33;
        for (int i_32 = bind_l_17.First(tmpe_33); i_32; i_32 = bind_l_17.Next(tmpe_33)) {
          Int e_21 = tmpe_33;
          {
            vdm_PAT_i = e_21;
            succ_19 = true;
            if (succ_19) {
              Record tmpVar_26;
              {
                Sequence tmpseq_27;
                tmpseq_27 = vdm_PAT_els__lp;
                tmpVar_26 = (Record) (tmpseq_27[vdm_PAT_i.GetValue()]);
              }
              Record tmpVar_29;
              {
                Sequence tmpseq_30;
                tmpseq_30 = vdm_PAT_val__lv;
                tmpVar_29 = (Record) (tmpseq_30[vdm_PAT_i.GetValue()]);
              }
              reselem_16 = vdm_PAT_PatternMatch(tmpVar_26, tmpVar_29);
              res_l_15.ImpAppend(reselem_16);
            }
          }
        }
        vdm_PAT_tmp__ls = res_l_15;
      }
      {
        Bool cond_34;
        {
          Set var1_35;
          var1_35 = Set();
          Set var2_36;
          var2_36 = vdm_PAT_tmp__ls.Elems();
          cond_34 = !(Bool) (var2_36.InSet(var1_35));
        }
        if (cond_34.GetValue()) {
          Set vdm_PAT_perm__s;
          vdm_PAT_perm__s = vdm_PAT_SeqOfSetOf2SetOfSeqOf(vdm_PAT_tmp__ls);
          {
            Set tmpVar_42;
            {
              Set res_s_43;
              {
                Sequence seq_lv_48;
                bool succ_46;
                Bool tsucc_49;
                tsucc_49 = true;
                {
                  Set tmpVar_v_47;
                  tmpVar_v_47 = vdm_PAT_perm__s;
{ seq_lv_48.ImpAppend(tmpVar_v_47); }
                }
                Set allComb_50 = GenAllComb(seq_lv_48);
                Sequence vdm_PAT_l;
                Generic tmpe_59;
                for (int bb_58 = allComb_50.First(tmpe_59); bb_58; bb_58 = allComb_50.Next(tmpe_59)) {
                  Sequence tmp_56 = tmpe_59;
                  {
                    if (succ_46 = 1 == (Int) (tmp_56.Length())) {
                      Sequence permI_57;
                      permI_57 = (Sequence) (tmp_56.Hd());
                      succ_46 = true;
                      {
                        vdm_PAT_l = permI_57;
                        succ_46 = true;
                      }
                    }
                    if (succ_46) 
                      res_s_43.Insert(vdm_PAT_DistribCombineBlkEnv(vdm_PAT_l));
                  }
                }
              }
              tmpVar_42 = res_s_43;
            }
            return vdm_PAT_UnionMatch(tmpVar_42);
          }
        }
        else {
          Set rexpr_38;
          rexpr_38 = Set();
          return rexpr_38;
        }
      }
    }
  }
  else {
    Set rexpr_9;
    rexpr_9 = Set();
    return rexpr_9;
  }
}

Set vdm_PAT_MatchMatchVal(Record var_1_1, Record var_2_2) {
  Record vdm_PAT_val__v;
  Record vdm_PAT_value__e;
  bool succ_3 = true;
  {
    succ_3 = false;
    if (var_1_1.IsRecord()) 
      if (vdm_AS_MatchVal == var_1_1.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_1_1.Length(); i_5++) 
          e_l_4.ImpAppend(var_1_1.GetField(i_5));
        if (succ_3 = 1 == (Int) (e_l_4.Length())) {
          Record permI_6;
          permI_6 = (Record) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_PAT_value__e = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  {
    vdm_PAT_val__v = var_2_2;
    succ_3 = true;
  }
  if (succ_3) {
    Record vdm_PAT_value__v;
    vdm_PAT_value__v = vdm_PAT_EvalExpr(vdm_PAT_value__e);
    {
      Bool cond_10;
      cond_10 = (Bool) (vdm_PAT_value__v == vdm_PAT_val__v);
      if (cond_10.GetValue()) {
        Set rexpr_14;
        rexpr_14 = Set().Insert(vdm_PAT_MkEmptyBlkEnv((Quote) "READ_ONLY"));
        return rexpr_14;
      }
      else {
        Set rexpr_13;
        rexpr_13 = Set();
        return rexpr_13;
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: MatchMatchVal");
}

Set vdm_PAT_MatchRecordPattern(Record var_1_1, Record var_2_2) {
  Sequence vdm_PAT_fields__lp;
  Record vdm_PAT_ptag(vdm_AS_Name, length_AS_Name);
  Record vdm_PAT_val__v;
  bool succ_3 = true;
  {
    succ_3 = false;
    if (var_1_1.IsRecord()) 
      if (vdm_AS_RecordPattern == var_1_1.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_1_1.Length(); i_5++) 
          e_l_4.ImpAppend(var_1_1.GetField(i_5));
        if (succ_3 = 3 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_PAT_ptag = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) {
            vdm_PAT_fields__lp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[3]);
          if (succ_3) 
            succ_3 = true;
        }
      }
  }
  {
    vdm_PAT_val__v = var_2_2;
    succ_3 = true;
  }
  if (succ_3) {
    Bool cond_7;
    {
      Record argTmp_8;
      argTmp_8 = vdm_PAT_val__v;
      if (argTmp_8.IsRecord()) 
        cond_7 = vdm_SEM_REC == argTmp_8.GetTag();
      else 
        cond_7 = false;
    }
    if (cond_7.GetValue()) {
      bool succ_10;
      Record tmpVal_11;
      tmpVal_11 = vdm_PAT_val__v;
      Sequence vdm_PAT_bd__lv;
      Record vdm_PAT_vtag(vdm_AS_Name, length_AS_Name);
      succ_10 = true;
      {
        succ_10 = false;
        if (tmpVal_11.IsRecord()) 
          if (vdm_SEM_REC == ((Record) tmpVal_11).GetTag()) {
            Sequence e_l_12;
            for (int i_13 = 1; i_13 <= ((Record) tmpVal_11).Length(); i_13++) 
              e_l_12.ImpAppend(((Record) tmpVal_11).GetField(i_13));
            if (succ_10 = 2 == (Int) (e_l_12.Length())) {
              Generic permI_14;
              permI_14 = (Generic) (e_l_12.Hd());
              succ_10 = true;
              {
                vdm_PAT_vtag = permI_14;
                succ_10 = true;
              }
              permI_14 = (Generic) (e_l_12[2]);
              if (succ_10) {
                vdm_PAT_bd__lv = permI_14;
                succ_10 = true;
              }
            }
          }
      }
      if (!succ_10) 
        RunTime("Pattern match did not succeed in value definition");
      {
        Bool cond_15;
        cond_15 = vdm_PAT_IsTypeStructExported(vdm_PAT_vtag);
        if (cond_15.GetValue()) {
          Bool cond_17;
          cond_17 = vdm_PAT_EqualNames(vdm_AUX_UniqueTagName(vdm_PAT_ptag), vdm_PAT_vtag);
          if (cond_17.GetValue()) {
            Sequence tmpVar_22;
            tmpVar_22 = vdm_PAT_fields__lp;
            Sequence tmpVar_23;
            tmpVar_23 = vdm_PAT_bd__lv;
            return vdm_PAT_MatchLists(tmpVar_22, tmpVar_23);
          }
          else {
            Set rexpr_21;
            rexpr_21 = Set();
            return rexpr_21;
          }
        }
        else { RunTime("Can not evaluate an error statement"); }
      }
    }
    else {
      Set rexpr_9;
      rexpr_9 = Set();
      return rexpr_9;
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: MatchRecordPattern");
}

Set vdm_PAT_MatchSeqConcPattern(Record var_1_1, Record var_2_2) {
  Record vdm_PAT_lp__p;
  Record vdm_PAT_rp__p;
  Record vdm_PAT_val__v;
  bool succ_3 = true;
  {
    succ_3 = false;
    if (var_1_1.IsRecord()) 
      if (vdm_AS_SeqConcPattern == var_1_1.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_1_1.Length(); i_5++) 
          e_l_4.ImpAppend(var_1_1.GetField(i_5));
        if (succ_3 = 2 == (Int) (e_l_4.Length())) {
          Record permI_6;
          permI_6 = (Record) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_PAT_lp__p = permI_6;
            succ_3 = true;
          }
          permI_6 = (Record) (e_l_4[2]);
          if (succ_3) {
            vdm_PAT_rp__p = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  {
    vdm_PAT_val__v = var_2_2;
    succ_3 = true;
  }
  if (succ_3) {
    Set vdm_PAT_envres__sl;
    vdm_PAT_envres__sl = Set();
    {
      Bool cond_7;
      {
        Record argTmp_8;
        argTmp_8 = vdm_PAT_val__v;
        if (argTmp_8.IsRecord()) 
          cond_7 = vdm_SEM_SEQ == argTmp_8.GetTag();
        else 
          cond_7 = false;
      }
      if (cond_7.GetValue()) {
        bool succ_10;
        Record tmpVal_11;
        tmpVal_11 = vdm_PAT_val__v;
        Sequence vdm_PAT_val__lv;
        succ_10 = true;
        {
          succ_10 = false;
          if (tmpVal_11.IsRecord()) 
            if (vdm_SEM_SEQ == ((Record) tmpVal_11).GetTag()) {
              Sequence e_l_12;
              for (int i_13 = 1; i_13 <= ((Record) tmpVal_11).Length(); i_13++) 
                e_l_12.ImpAppend(((Record) tmpVal_11).GetField(i_13));
              if (succ_10 = 1 == (Int) (e_l_12.Length())) {
                Sequence permI_14;
                permI_14 = (Sequence) (e_l_12.Hd());
                succ_10 = true;
                {
                  vdm_PAT_val__lv = permI_14;
                  succ_10 = true;
                }
              }
            }
        }
        if (!succ_10) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Set vdm_PAT_tmp__s;
          Set res_s_17;
          {
            Sequence seq_lv_56;
            bool succ_54;
            Bool tsucc_57;
            tsucc_57 = true;
            {
              Set tmpVar_v_55;
              {
                Set riseq_60;
                int max_61 = (Int) (vdm_PAT_val__lv.Length());
                for (int i_62 = 1; i_62 <= max_61; i_62++) 
                  riseq_60.Insert((Int) i_62);
                tmpVar_v_55 = riseq_60;
              }
{ seq_lv_56.ImpAppend(tmpVar_v_55); }
            }
            Set allComb_58 = GenAllComb(seq_lv_56);
            Int vdm_PAT_i;
            Generic tmpe_71;
            for (int bb_70 = allComb_58.First(tmpe_71); bb_70; bb_70 = allComb_58.Next(tmpe_71)) {
              Sequence tmp_68 = tmpe_71;
              {
                if (succ_54 = 1 == (Int) (tmp_68.Length())) {
                  Int permI_69;
                  permI_69 = (Int) (tmp_68.Hd());
                  succ_54 = true;
                  {
                    vdm_PAT_i = permI_69;
                    succ_54 = true;
                  }
                }
                if (succ_54) {
                  Tuple elem_18(2);
                  {
                    elem_18 = Tuple(2);
                    Sequence tmpVar_19;
                    {
                      Sequence res_l_20;
                      Record reselem_21;
                      Set resBind_s_23;
                      {
                        resBind_s_23 = Set();
                        Int lb_27;
                        Int ub_28;
                        lb_27 = (Int) 1;
                        ub_28 = vdm_PAT_i;
                        int ubi_29 = ub_28.GetValue();
                        for (int count_30 = lb_27.GetValue(); count_30 <= ubi_29; count_30++) 
                          resBind_s_23.Insert((Int) count_30);
                      }
                      Sequence bind_l_22;
                      if ((Int) (resBind_s_23.Card()) != (Int) 0) 
                        bind_l_22 = Sort(resBind_s_23);
                      bool succ_24 = true;
                      Int vdm_PAT_j;
                      Generic tmpe_34;
                      for (int i_33 = bind_l_22.First(tmpe_34); i_33; i_33 = bind_l_22.Next(tmpe_34)) {
                        Int e_26 = tmpe_34;
                        {
                          vdm_PAT_j = e_26;
                          succ_24 = true;
                          if (succ_24) {
                            Sequence tmpseq_31;
                            tmpseq_31 = vdm_PAT_val__lv;
                            reselem_21 = (Record) (tmpseq_31[vdm_PAT_j.GetValue()]);
                            res_l_20.ImpAppend(reselem_21);
                          }
                        }
                      }
                      tmpVar_19 = res_l_20;
                    }
                    elem_18.SetField(1, tmpVar_19);
                    Sequence tmpVar_35;
                    {
                      Sequence res_l_36;
                      Record reselem_37;
                      Set resBind_s_39;
                      {
                        resBind_s_39 = Set();
                        Int lb_43;
                        Int ub_44;
                        lb_43 = vdm_PAT_i + (Int) 1;
                        ub_44 = (Int) (vdm_PAT_val__lv.Length());
                        int ubi_45 = ub_44.GetValue();
                        for (int count_46 = lb_43.GetValue(); count_46 <= ubi_45; count_46++) 
                          resBind_s_39.Insert((Int) count_46);
                      }
                      Sequence bind_l_38;
                      if ((Int) (resBind_s_39.Card()) != (Int) 0) 
                        bind_l_38 = Sort(resBind_s_39);
                      bool succ_40 = true;
                      Int vdm_PAT_j;
                      Generic tmpe_53;
                      for (int i_52 = bind_l_38.First(tmpe_53); i_52; i_52 = bind_l_38.Next(tmpe_53)) {
                        Int e_42 = tmpe_53;
                        {
                          vdm_PAT_j = e_42;
                          succ_40 = true;
                          if (succ_40) {
                            Sequence tmpseq_50;
                            tmpseq_50 = vdm_PAT_val__lv;
                            reselem_37 = (Record) (tmpseq_50[vdm_PAT_j.GetValue()]);
                            res_l_36.ImpAppend(reselem_37);
                          }
                        }
                      }
                      tmpVar_35 = res_l_36;
                    }
                    elem_18.SetField(2, tmpVar_35);
                  }
                  res_s_17.Insert(elem_18);
                }
              }
            }
          }
          vdm_PAT_tmp__s = res_s_17;
          {
            Set iset_72;
            iset_72 = vdm_PAT_tmp__s;
            Sequence vdm_PAT_seql__lv;
            Sequence vdm_PAT_seqr__lv;
            bool succ_74;
            Generic tmpe_127;
            for (int bb_126 = iset_72.First(tmpe_127); bb_126; bb_126 = iset_72.Next(tmpe_127)) {
              Tuple elem_73 = tmpe_127;
              {
                succ_74 = true;
                {
                  succ_74 = false;
                  if (elem_73.IsTuple()) {
                    Sequence e_l_123;
                    for (int i_124 = 1; i_124 <= ((Tuple) elem_73).Length(); i_124++) 
                      e_l_123.ImpAppend(((Tuple) elem_73).GetField(i_124));
                    if (succ_74 = 2 == (Int) (e_l_123.Length())) {
                      Sequence permI_125;
                      permI_125 = (Sequence) (e_l_123.Hd());
                      succ_74 = true;
                      {
                        vdm_PAT_seql__lv = permI_125;
                        succ_74 = true;
                      }
                      permI_125 = (Sequence) (e_l_123[2]);
                      if (succ_74) {
                        vdm_PAT_seqr__lv = permI_125;
                        succ_74 = true;
                      }
                    }
                  }
                }
                if (succ_74) {
                  Set vdm_PAT_envl__sl;
                  Record tmpVar_78(vdm_SEM_SEQ, length_SEM_SEQ);
                  {
                    tmpVar_78 = Record(vdm_SEM_SEQ, length_SEM_SEQ);
                    tmpVar_78.SetField(1, vdm_PAT_seql__lv);
                  }
                  vdm_PAT_envl__sl = vdm_PAT_PatternMatch(vdm_PAT_lp__p, tmpVar_78);
                  Set vdm_PAT_envr__sl;
                  Record tmpVar_82(vdm_SEM_SEQ, length_SEM_SEQ);
                  {
                    tmpVar_82 = Record(vdm_SEM_SEQ, length_SEM_SEQ);
                    tmpVar_82.SetField(1, vdm_PAT_seqr__lv);
                  }
                  vdm_PAT_envr__sl = vdm_PAT_PatternMatch(vdm_PAT_rp__p, tmpVar_82);
                  {
                    Bool cond_84;
                    {
                      Bool var1_85;
                      Set var2_88;
                      var2_88 = Set();
                      var1_85 = (Bool) (!(vdm_PAT_envl__sl == var2_88));
                      if ((cond_84 = var1_85).GetValue()) {
                        Bool var2_86;
                        Set var2_90;
                        var2_90 = Set();
                        var2_86 = (Bool) (!(vdm_PAT_envr__sl == var2_90));
                        cond_84 = var2_86;
                      }
                    }
                    if (cond_84.GetValue()) {
                      Set vdm_PAT_tmp__sl;
                      Set res_s_93;
                      {
                        Sequence seq_lv_103;
                        bool succ_101;
                        Bool tsucc_104;
                        tsucc_104 = true;
                        {
                          Set tmpVar_v_102;
                          tmpVar_v_102 = vdm_PAT_envl__sl;
{ seq_lv_103.ImpAppend(tmpVar_v_102); }
                        }
                        {
                          Set tmpVar_v_102;
                          tmpVar_v_102 = vdm_PAT_envr__sl;
{ seq_lv_103.ImpAppend(tmpVar_v_102); }
                        }
                        Set allComb_105 = GenAllComb(seq_lv_103);
                        Record vdm_PAT_tmpl__l(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                        Record vdm_PAT_tmpr__l(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                        Generic tmpe_118;
                        for (int bb_117 = allComb_105.First(tmpe_118); bb_117; bb_117 = allComb_105.Next(tmpe_118)) {
                          Sequence tmp_115 = tmpe_118;
                          {
                            if (succ_101 = 2 == (Int) (tmp_115.Length())) {
                              Record permI_116(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                              permI_116 = (Record) (tmp_115.Hd());
                              succ_101 = true;
                              {
                                vdm_PAT_tmpl__l = permI_116;
                                succ_101 = true;
                              }
                              permI_116 = (Record) (tmp_115[2]);
                              if (succ_101) {
                                vdm_PAT_tmpr__l = permI_116;
                                succ_101 = true;
                              }
                            }
                            if (succ_101) {
                              Record elem_94(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                              {
                                elem_94 = Record(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                                Sequence tmpVar_95;
                                {
                                  Sequence var1_96;
                                  Record tmpRec_98(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                                  tmpRec_98 = vdm_PAT_tmpl__l;
                                  if (tmpRec_98.Is(vdm_SEM_BlkEnv)) 
                                    var1_96 = tmpRec_98.GetField(pos_SEM_BlkEnv_id__l);
                                  else 
                                    RunTime("Unknown record field selector");
                                  Sequence var2_97;
                                  Record tmpRec_99(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                                  tmpRec_99 = vdm_PAT_tmpr__l;
                                  if (tmpRec_99.Is(vdm_SEM_BlkEnv)) 
                                    var2_97 = tmpRec_99.GetField(pos_SEM_BlkEnv_id__l);
                                  else 
                                    RunTime("Unknown record field selector");
                                  tmpVar_95.ImpConc(var1_96).ImpConc(var2_97);
                                }
                                elem_94.SetField(1, tmpVar_95);
                                elem_94.SetField(2, (Quote) "READ_ONLY");
                              }
                              res_s_93.Insert(elem_94);
                            }
                          }
                        }
                      }
                      vdm_PAT_tmp__sl = res_s_93;
                      {
                        Set rhs_119;
                        {
                          rhs_119 = vdm_PAT_envres__sl;
                          rhs_119.ImpUnion(vdm_PAT_UnionMatch(vdm_PAT_tmp__sl));
                        }
                        vdm_PAT_envres__sl = rhs_119;
                      }
                    }
                  }
                }
                else 
                  RunTime("Pattern did not match in set for loop");
              }
            }
            {
              Set rexpr_128;
              rexpr_128 = vdm_PAT_envres__sl;
              return rexpr_128;
            }
          }
        }
      }
      else {
        Set rexpr_9;
        rexpr_9 = Set();
        return rexpr_9;
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: MatchSeqConcPattern");
}

Set vdm_PAT_MatchSeqEnumPattern(Record var_1_1, Record var_2_2) {
  Sequence vdm_PAT_els__lp;
  Record vdm_PAT_val__v;
  bool succ_3 = true;
  {
    succ_3 = false;
    if (var_1_1.IsRecord()) 
      if (vdm_AS_SeqEnumPattern == var_1_1.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_1_1.Length(); i_5++) 
          e_l_4.ImpAppend(var_1_1.GetField(i_5));
        if (succ_3 = 2 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_PAT_els__lp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) 
            succ_3 = true;
        }
      }
  }
  {
    vdm_PAT_val__v = var_2_2;
    succ_3 = true;
  }
  if (succ_3) {
    Bool cond_7;
    {
      Record argTmp_8;
      argTmp_8 = vdm_PAT_val__v;
      if (argTmp_8.IsRecord()) 
        cond_7 = vdm_SEM_SEQ == argTmp_8.GetTag();
      else 
        cond_7 = false;
    }
    if (cond_7.GetValue()) {
      bool succ_10;
      Record tmpVal_11;
      tmpVal_11 = vdm_PAT_val__v;
      Sequence vdm_PAT_val__lv;
      succ_10 = true;
      {
        succ_10 = false;
        if (tmpVal_11.IsRecord()) 
          if (vdm_SEM_SEQ == ((Record) tmpVal_11).GetTag()) {
            Sequence e_l_12;
            for (int i_13 = 1; i_13 <= ((Record) tmpVal_11).Length(); i_13++) 
              e_l_12.ImpAppend(((Record) tmpVal_11).GetField(i_13));
            if (succ_10 = 1 == (Int) (e_l_12.Length())) {
              Sequence permI_14;
              permI_14 = (Sequence) (e_l_12.Hd());
              succ_10 = true;
              {
                vdm_PAT_val__lv = permI_14;
                succ_10 = true;
              }
            }
          }
      }
      if (!succ_10) 
        RunTime("Pattern match did not succeed in value definition");
      {
        Sequence tmpVar_15;
        tmpVar_15 = vdm_PAT_els__lp;
        Sequence tmpVar_16;
        tmpVar_16 = vdm_PAT_val__lv;
        return vdm_PAT_MatchLists(tmpVar_15, tmpVar_16);
      }
    }
    else {
      Set rexpr_9;
      rexpr_9 = Set();
      return rexpr_9;
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: MatchSeqEnumPattern");
}

Set vdm_PAT_MatchSetEnumPattern(Record var_1_1, Record var_2_2) {
  Sequence vdm_PAT_elems__lp;
  Record vdm_PAT_val__v;
  bool succ_3 = true;
  {
    succ_3 = false;
    if (var_1_1.IsRecord()) 
      if (vdm_AS_SetEnumPattern == var_1_1.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_1_1.Length(); i_5++) 
          e_l_4.ImpAppend(var_1_1.GetField(i_5));
        if (succ_3 = 2 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_PAT_elems__lp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) 
            succ_3 = true;
        }
      }
  }
  {
    vdm_PAT_val__v = var_2_2;
    succ_3 = true;
  }
  if (succ_3) {
    Bool cond_7;
    {
      Record argTmp_8;
      argTmp_8 = vdm_PAT_val__v;
      if (argTmp_8.IsRecord()) 
        cond_7 = vdm_SEM_SET == argTmp_8.GetTag();
      else 
        cond_7 = false;
    }
    if (cond_7.GetValue()) {
      bool succ_10;
      Record tmpVal_11;
      tmpVal_11 = vdm_PAT_val__v;
      Set vdm_PAT_val__sv;
      succ_10 = true;
      {
        succ_10 = false;
        if (tmpVal_11.IsRecord()) 
          if (vdm_SEM_SET == ((Record) tmpVal_11).GetTag()) {
            Sequence e_l_12;
            for (int i_13 = 1; i_13 <= ((Record) tmpVal_11).Length(); i_13++) 
              e_l_12.ImpAppend(((Record) tmpVal_11).GetField(i_13));
            if (succ_10 = 1 == (Int) (e_l_12.Length())) {
              Set permI_14;
              permI_14 = (Set) (e_l_12.Hd());
              succ_10 = true;
              {
                vdm_PAT_val__sv = permI_14;
                succ_10 = true;
              }
            }
          }
      }
      if (!succ_10) 
        RunTime("Pattern match did not succeed in value definition");
      {
        Bool cond_15;
        {
          Int var2_17;
          Set unArg_19;
          unArg_19 = vdm_PAT_elems__lp.Elems();
          var2_17 = (Int) (unArg_19.Card());
          cond_15 = (Bool) ((Int) (vdm_PAT_val__sv.Card()) == var2_17);
        }
        if (cond_15.GetValue()) {
          Set vdm_PAT_perm__slv;
          vdm_PAT_perm__slv = vdm_PAT_Permute(vdm_PAT_ValSetToSeq(vdm_PAT_val__sv));
          {
            Set rexpr_26;
            {
              Set unArg_27;
              Set res_s_28;
              {
                Sequence seq_lv_34;
                bool succ_32;
                Bool tsucc_35;
                tsucc_35 = true;
                {
                  Set tmpVar_v_33;
                  tmpVar_v_33 = vdm_PAT_perm__slv;
{ seq_lv_34.ImpAppend(tmpVar_v_33); }
                }
                Set allComb_36 = GenAllComb(seq_lv_34);
                Sequence vdm_PAT_tmp__lv;
                Generic tmpe_45;
                for (int bb_44 = allComb_36.First(tmpe_45); bb_44; bb_44 = allComb_36.Next(tmpe_45)) {
                  Sequence tmp_42 = tmpe_45;
                  {
                    if (succ_32 = 1 == (Int) (tmp_42.Length())) {
                      Sequence permI_43;
                      permI_43 = (Sequence) (tmp_42.Hd());
                      succ_32 = true;
                      {
                        vdm_PAT_tmp__lv = permI_43;
                        succ_32 = true;
                      }
                    }
                    if (succ_32) 
                      res_s_28.Insert(vdm_PAT_MatchLists(vdm_PAT_elems__lp, vdm_PAT_tmp__lv));
                  }
                }
              }
              unArg_27 = res_s_28;
              {
                Set rduset_46;
                Generic tmpe_49;
                for (int bb_48 = unArg_27.First(tmpe_49); bb_48; bb_48 = unArg_27.Next(tmpe_49)) {
                  Set e_47 = tmpe_49;
                  rduset_46.ImpUnion(e_47);
                }
                rexpr_26 = rduset_46;
              }
            }
            return rexpr_26;
          }
        }
        else {
          Set rexpr_21;
          rexpr_21 = Set();
          return rexpr_21;
        }
      }
    }
    else {
      Set rexpr_9;
      rexpr_9 = Set();
      return rexpr_9;
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: MatchSetEnumPattern");
}

Set vdm_PAT_MatchSetUnionPattern(Record var_1_1, Record var_2_2) {
  Record vdm_PAT_lp__p;
  Record vdm_PAT_rp__p;
  Record vdm_PAT_val__v;
  bool succ_3 = true;
  {
    succ_3 = false;
    if (var_1_1.IsRecord()) 
      if (vdm_AS_SetUnionPattern == var_1_1.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_1_1.Length(); i_5++) 
          e_l_4.ImpAppend(var_1_1.GetField(i_5));
        if (succ_3 = 2 == (Int) (e_l_4.Length())) {
          Record permI_6;
          permI_6 = (Record) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_PAT_lp__p = permI_6;
            succ_3 = true;
          }
          permI_6 = (Record) (e_l_4[2]);
          if (succ_3) {
            vdm_PAT_rp__p = permI_6;
            succ_3 = true;
          }
        }
      }
  }
  {
    vdm_PAT_val__v = var_2_2;
    succ_3 = true;
  }
  if (succ_3) {
    Set vdm_PAT_envres__sl;
    vdm_PAT_envres__sl = Set();
    {
      Bool cond_7;
      {
        Record argTmp_8;
        argTmp_8 = vdm_PAT_val__v;
        if (argTmp_8.IsRecord()) 
          cond_7 = vdm_SEM_SET == argTmp_8.GetTag();
        else 
          cond_7 = false;
      }
      if (cond_7.GetValue()) {
        bool succ_10;
        Record tmpVal_11;
        tmpVal_11 = vdm_PAT_val__v;
        Set vdm_PAT_val__sv;
        succ_10 = true;
        {
          succ_10 = false;
          if (tmpVal_11.IsRecord()) 
            if (vdm_SEM_SET == ((Record) tmpVal_11).GetTag()) {
              Sequence e_l_12;
              for (int i_13 = 1; i_13 <= ((Record) tmpVal_11).Length(); i_13++) 
                e_l_12.ImpAppend(((Record) tmpVal_11).GetField(i_13));
              if (succ_10 = 1 == (Int) (e_l_12.Length())) {
                Set permI_14;
                permI_14 = (Set) (e_l_12.Hd());
                succ_10 = true;
                {
                  vdm_PAT_val__sv = permI_14;
                  succ_10 = true;
                }
              }
            }
        }
        if (!succ_10) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Set iset_15;
          {
            Set res_s_18;
            {
              Sequence seq_lv_24;
              bool succ_22;
              Bool tsucc_25;
              tsucc_25 = true;
              {
                Set tmpVar_v_23;
                {
                  Set rpowset_28;
                  unsigned long powcard_30 = (unsigned long) (pow(2, (Int) (vdm_PAT_val__sv.Card())));
                  if ((Int) (vdm_PAT_val__sv.Card()) > 15) 
                    RunTime("Power: Set too big");
                  for (unsigned long ii_31 = 0; ii_31 < powcard_30; ii_31++) {
                    Generic tmpg_29;
                    Set tmps_32;
                    for (int jj_33 = 0, bb_34 = vdm_PAT_val__sv.First(tmpg_29); bb_34; bb_34 = vdm_PAT_val__sv.Next(tmpg_29)) {
                      if (ii_31 & 1 << jj_33) 
                        tmps_32.Insert(tmpg_29);
                      jj_33++;
                    }
                    rpowset_28.Insert(tmps_32);
                  }
                  tmpVar_v_23 = rpowset_28;
                }
                {
                  seq_lv_24.ImpAppend(tmpVar_v_23);
                  seq_lv_24.ImpAppend(tmpVar_v_23);
                }
              }
              Set allComb_26 = GenAllComb(seq_lv_24);
              Bool pred_42;
              Set vdm_PAT_setl__sv;
              Set vdm_PAT_setr__sv;
              Generic tmpe_56;
              for (int bb_55 = allComb_26.First(tmpe_56); bb_55; bb_55 = allComb_26.Next(tmpe_56)) {
                Sequence tmp_43 = tmpe_56;
                {
                  if (succ_22 = 2 == (Int) (tmp_43.Length())) {
                    Set permI_54;
                    permI_54 = (Set) (tmp_43.Hd());
                    succ_22 = true;
                    {
                      vdm_PAT_setl__sv = permI_54;
                      succ_22 = true;
                    }
                    permI_54 = (Set) (tmp_43[2]);
                    if (succ_22) {
                      vdm_PAT_setr__sv = permI_54;
                      succ_22 = true;
                    }
                  }
                  if (succ_22) {
                    Bool var1_44;
                    Set var1_46;
                    var1_46 = vdm_PAT_setl__sv;
                    var1_46.ImpUnion(vdm_PAT_setr__sv);
                    var1_44 = (Bool) (var1_46 == vdm_PAT_val__sv);
                    if ((pred_42 = var1_44).GetValue()) {
                      Bool var2_45;
                      Set var1_50;
                      var1_50 = vdm_PAT_setl__sv;
                      var1_50.ImpIntersect(vdm_PAT_setr__sv);
                      Set var2_51;
                      var2_51 = Set();
                      var2_45 = (Bool) (var1_50 == var2_51);
                      pred_42 = var2_45;
                    }
                    if (pred_42.GetValue()) {
                      Tuple elem_19(2);
                      {
                        elem_19 = Tuple(2);
                        elem_19.SetField(1, vdm_PAT_setl__sv);
                        elem_19.SetField(2, vdm_PAT_setr__sv);
                      }
                      res_s_18.Insert(elem_19);
                    }
                  }
                }
              }
            }
            iset_15 = res_s_18;
          }
          Set vdm_PAT_setl__sv;
          Set vdm_PAT_setr__sv;
          bool succ_17;
          Generic tmpe_105;
          for (int bb_104 = iset_15.First(tmpe_105); bb_104; bb_104 = iset_15.Next(tmpe_105)) {
            Tuple elem_16 = tmpe_105;
            {
              succ_17 = true;
              {
                succ_17 = false;
                if (elem_16.IsTuple()) {
                  Sequence e_l_101;
                  for (int i_102 = 1; i_102 <= ((Tuple) elem_16).Length(); i_102++) 
                    e_l_101.ImpAppend(((Tuple) elem_16).GetField(i_102));
                  if (succ_17 = 2 == (Int) (e_l_101.Length())) {
                    Set permI_103;
                    permI_103 = (Set) (e_l_101.Hd());
                    succ_17 = true;
                    {
                      vdm_PAT_setl__sv = permI_103;
                      succ_17 = true;
                    }
                    permI_103 = (Set) (e_l_101[2]);
                    if (succ_17) {
                      vdm_PAT_setr__sv = permI_103;
                      succ_17 = true;
                    }
                  }
                }
              }
              if (succ_17) {
                Set vdm_PAT_envl__s;
                Record tmpVar_60(vdm_SEM_SET, length_SEM_SET);
                {
                  tmpVar_60 = Record(vdm_SEM_SET, length_SEM_SET);
                  tmpVar_60.SetField(1, vdm_PAT_setl__sv);
                }
                vdm_PAT_envl__s = vdm_PAT_PatternMatch(vdm_PAT_lp__p, tmpVar_60);
                Set vdm_PAT_envr__s;
                Record tmpVar_64(vdm_SEM_SET, length_SEM_SET);
                {
                  tmpVar_64 = Record(vdm_SEM_SET, length_SEM_SET);
                  tmpVar_64.SetField(1, vdm_PAT_setr__sv);
                }
                vdm_PAT_envr__s = vdm_PAT_PatternMatch(vdm_PAT_rp__p, tmpVar_64);
                {
                  Bool cond_66;
                  {
                    Bool var1_67;
                    Set var2_70;
                    var2_70 = Set();
                    var1_67 = (Bool) (!(vdm_PAT_envl__s == var2_70));
                    if ((cond_66 = var1_67).GetValue()) {
                      Bool var2_68;
                      Set var2_72;
                      var2_72 = Set();
                      var2_68 = (Bool) (!(vdm_PAT_envr__s == var2_72));
                      cond_66 = var2_68;
                    }
                  }
                  if (cond_66.GetValue()) {
                    Set vdm_PAT_tmpenv;
                    Set res_s_75;
                    {
                      Sequence seq_lv_81;
                      bool succ_79;
                      Bool tsucc_82;
                      tsucc_82 = true;
                      {
                        Set tmpVar_v_80;
                        tmpVar_v_80 = vdm_PAT_envl__s;
{ seq_lv_81.ImpAppend(tmpVar_v_80); }
                      }
                      {
                        Set tmpVar_v_80;
                        tmpVar_v_80 = vdm_PAT_envr__s;
{ seq_lv_81.ImpAppend(tmpVar_v_80); }
                      }
                      Set allComb_83 = GenAllComb(seq_lv_81);
                      Record vdm_PAT_tmp1(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                      Record vdm_PAT_tmp2(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                      Generic tmpe_96;
                      for (int bb_95 = allComb_83.First(tmpe_96); bb_95; bb_95 = allComb_83.Next(tmpe_96)) {
                        Sequence tmp_93 = tmpe_96;
                        {
                          if (succ_79 = 2 == (Int) (tmp_93.Length())) {
                            Record permI_94(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                            permI_94 = (Record) (tmp_93.Hd());
                            succ_79 = true;
                            {
                              vdm_PAT_tmp1 = permI_94;
                              succ_79 = true;
                            }
                            permI_94 = (Record) (tmp_93[2]);
                            if (succ_79) {
                              vdm_PAT_tmp2 = permI_94;
                              succ_79 = true;
                            }
                          }
                          if (succ_79) 
                            res_s_75.Insert(vdm_PAT_CombineBlkEnv(vdm_PAT_tmp1, vdm_PAT_tmp2));
                        }
                      }
                    }
                    vdm_PAT_tmpenv = res_s_75;
                    {
                      Set rhs_97;
                      {
                        rhs_97 = vdm_PAT_envres__sl;
                        rhs_97.ImpUnion(vdm_PAT_UnionMatch(vdm_PAT_tmpenv));
                      }
                      vdm_PAT_envres__sl = rhs_97;
                    }
                  }
                }
              }
              else 
                RunTime("Pattern did not match in set for loop");
            }
          }
          {
            Set rexpr_106;
            rexpr_106 = vdm_PAT_envres__sl;
            return rexpr_106;
          }
        }
      }
      else {
        Set rexpr_9;
        rexpr_9 = Set();
        return rexpr_9;
      }
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: MatchSetUnionPattern");
}

Set vdm_PAT_MatchTuplePattern(Record var_1_1, Record var_2_2) {
  Sequence vdm_PAT_fields__lp;
  Record vdm_PAT_val__v;
  bool succ_3 = true;
  {
    succ_3 = false;
    if (var_1_1.IsRecord()) 
      if (vdm_AS_TuplePattern == var_1_1.GetTag()) {
        Sequence e_l_4;
        for (int i_5 = 1; i_5 <= var_1_1.Length(); i_5++) 
          e_l_4.ImpAppend(var_1_1.GetField(i_5));
        if (succ_3 = 2 == (Int) (e_l_4.Length())) {
          Generic permI_6;
          permI_6 = (Generic) (e_l_4.Hd());
          succ_3 = true;
          {
            vdm_PAT_fields__lp = permI_6;
            succ_3 = true;
          }
          permI_6 = (Generic) (e_l_4[2]);
          if (succ_3) 
            succ_3 = true;
        }
      }
  }
  {
    vdm_PAT_val__v = var_2_2;
    succ_3 = true;
  }
  if (succ_3) {
    Bool cond_7;
    {
      Record argTmp_8;
      argTmp_8 = vdm_PAT_val__v;
      if (argTmp_8.IsRecord()) 
        cond_7 = vdm_SEM_TUPLE == argTmp_8.GetTag();
      else 
        cond_7 = false;
    }
    if (cond_7.GetValue()) {
      bool succ_10;
      Record tmpVal_11;
      tmpVal_11 = vdm_PAT_val__v;
      Sequence vdm_PAT_val__lv;
      succ_10 = true;
      {
        succ_10 = false;
        if (tmpVal_11.IsRecord()) 
          if (vdm_SEM_TUPLE == ((Record) tmpVal_11).GetTag()) {
            Sequence e_l_12;
            for (int i_13 = 1; i_13 <= ((Record) tmpVal_11).Length(); i_13++) 
              e_l_12.ImpAppend(((Record) tmpVal_11).GetField(i_13));
            if (succ_10 = 1 == (Int) (e_l_12.Length())) {
              Sequence permI_14;
              permI_14 = (Sequence) (e_l_12.Hd());
              succ_10 = true;
              {
                vdm_PAT_val__lv = permI_14;
                succ_10 = true;
              }
            }
          }
      }
      if (!succ_10) 
        RunTime("Pattern match did not succeed in value definition");
      {
        Sequence tmpVar_15;
        tmpVar_15 = vdm_PAT_fields__lp;
        Sequence tmpVar_16;
        tmpVar_16 = vdm_PAT_val__lv;
        return vdm_PAT_MatchLists(tmpVar_15, tmpVar_16);
      }
    }
    else {
      Set rexpr_9;
      rexpr_9 = Set();
      return rexpr_9;
    }
  }
  else 
    RunTime("Pattern match failed in function apply in operation: MatchTuplePattern");
}

Set vdm_PAT_Partition(Sequence vdm_PAT_env__ls) {
  Sequence vdm_PAT_env__ls__m;
  {
    Sequence res_l_5;
    Set reselem_6;
    Set resBind_s_8;
    {
      Set riseq_13;
      int max_14 = (Int) (vdm_PAT_env__ls.Length());
      for (int i_15 = 1; i_15 <= max_14; i_15++) 
        riseq_13.Insert((Int) i_15);
      resBind_s_8 = riseq_13;
    }
    Sequence bind_l_7;
    if ((Int) (resBind_s_8.Card()) != (Int) 0) 
      bind_l_7 = Sort(resBind_s_8);
    bool succ_9 = true;
    Int vdm_PAT_i;
    Generic tmpe_23;
    for (int i_22 = bind_l_7.First(tmpe_23); i_22; i_22 = bind_l_7.Next(tmpe_23)) {
      Int e_11 = tmpe_23;
      {
        vdm_PAT_i = e_11;
        succ_9 = true;
        if (succ_9) {
          Bool pred_10;
          {
            Set var1_18;
            Sequence tmpseq_20;
            tmpseq_20 = vdm_PAT_env__ls;
            var1_18 = (Set) (tmpseq_20[vdm_PAT_i.GetValue()]);
            Set var2_19;
            var2_19 = Set();
            pred_10 = (Bool) (!(var1_18 == var2_19));
          }
          if (pred_10.GetValue()) {
            Sequence tmpseq_16;
            tmpseq_16 = vdm_PAT_env__ls;
            reselem_6 = (Set) (tmpseq_16[vdm_PAT_i.GetValue()]);
            res_l_5.ImpAppend(reselem_6);
          }
        }
      }
    }
    vdm_PAT_env__ls__m = res_l_5;
  }
  {
    Bool cond_24;
    {
      Sequence var2_26;
      var2_26 = Sequence();
      cond_24 = (Bool) (!(vdm_PAT_env__ls__m == var2_26));
    }
    if (cond_24.GetValue()) {
      Set vdm_PAT_env__ss;
      vdm_PAT_env__ss = vdm_PAT_SeqOfSetOf2SetOfSeqOf(vdm_PAT_env__ls__m);
      {
        Set rexpr_32;
        {
          Set res_s_33;
          {
            Sequence seq_lv_38;
            bool succ_36;
            Bool tsucc_39;
            tsucc_39 = true;
            {
              Set tmpVar_v_37;
              tmpVar_v_37 = vdm_PAT_env__ss;
{ seq_lv_38.ImpAppend(tmpVar_v_37); }
            }
            Set allComb_40 = GenAllComb(seq_lv_38);
            Sequence vdm_PAT_env__s;
            Generic tmpe_49;
            for (int bb_48 = allComb_40.First(tmpe_49); bb_48; bb_48 = allComb_40.Next(tmpe_49)) {
              Sequence tmp_46 = tmpe_49;
              {
                if (succ_36 = 1 == (Int) (tmp_46.Length())) {
                  Sequence permI_47;
                  permI_47 = (Sequence) (tmp_46.Hd());
                  succ_36 = true;
                  {
                    vdm_PAT_env__s = permI_47;
                    succ_36 = true;
                  }
                }
                if (succ_36) {
                  Set elem_34;
                  elem_34 = vdm_PAT_env__s.Elems();
                  res_s_33.Insert(elem_34);
                }
              }
            }
          }
          rexpr_32 = res_s_33;
        }
        return rexpr_32;
      }
    }
    else {
      Set rexpr_27;
      {
        Set tmpVar_28;
        tmpVar_28 = Set();
        rexpr_27 = Set().Insert(tmpVar_28);
      }
      return rexpr_27;
    }
  }
}

Set vdm_PAT_PatternMatch(Record vdm_PAT_pat__p, Record vdm_PAT_val__v) {
  Bool selRes_4;
  selRes_4 = (Bool) true;
  bool succ_5 = true;
  {
    Bool tmpVal_6;
    {
      Record argTmp_7;
      argTmp_7 = vdm_PAT_pat__p;
      if (argTmp_7.IsRecord()) 
        tmpVal_6 = vdm_AS_PatternName == argTmp_7.GetTag();
      else 
        tmpVal_6 = false;
    }
    succ_5 = ((Bool) (selRes_4 == tmpVal_6)).GetValue();
    if (succ_5) {
      bool succ_8;
      Record tmpVal_9;
      tmpVal_9 = vdm_PAT_pat__p;
      Generic vdm_PAT_id;
      succ_8 = true;
      {
        succ_8 = false;
        if (tmpVal_9.IsRecord()) 
          if (vdm_AS_PatternName == ((Record) tmpVal_9).GetTag()) {
            Sequence e_l_10;
            for (int i_11 = 1; i_11 <= ((Record) tmpVal_9).Length(); i_11++) 
              e_l_10.ImpAppend(((Record) tmpVal_9).GetField(i_11));
            if (succ_8 = 2 == (Int) (e_l_10.Length())) {
              Generic permI_12;
              permI_12 = (Generic) (e_l_10.Hd());
              succ_8 = true;
              {
                vdm_PAT_id = permI_12;
                succ_8 = true;
              }
              permI_12 = (Generic) (e_l_10[2]);
              if (succ_8) 
                succ_8 = true;
            }
          }
      }
      if (!succ_8) 
        RunTime("Pattern match did not succeed in value definition");
      {
        Bool cond_13;
        cond_13 = (Bool) (vdm_PAT_id == Nil());
        if (cond_13.GetValue()) {
          Set rexpr_22;
          rexpr_22 = Set().Insert(vdm_PAT_MkEmptyBlkEnv((Quote) "READ_ONLY"));
          return rexpr_22;
        }
        else {
          Set rexpr_16;
          rexpr_16 = Set().Insert(vdm_PAT_MkBlkEnv(vdm_PAT_id, vdm_PAT_val__v, Nil(), (Quote) "READ_ONLY"));
          return rexpr_16;
        }
      }
    }
  }
  if (!succ_5) {
    Bool tmpVal_25;
    {
      Record argTmp_26;
      argTmp_26 = vdm_PAT_pat__p;
      if (argTmp_26.IsRecord()) 
        tmpVal_25 = vdm_AS_MatchVal == argTmp_26.GetTag();
      else 
        tmpVal_25 = false;
    }
    succ_5 = ((Bool) (selRes_4 == tmpVal_25)).GetValue();
    if (succ_5) {
      Record tmpVar_27;
      tmpVar_27 = vdm_PAT_pat__p;
      Record tmpVar_28;
      tmpVar_28 = vdm_PAT_val__v;
      return vdm_PAT_MatchMatchVal(tmpVar_27, tmpVar_28);
    }
  }
  if (!succ_5) {
    Bool tmpVal_29;
    {
      Record argTmp_30;
      argTmp_30 = vdm_PAT_pat__p;
      if (argTmp_30.IsRecord()) 
        tmpVal_29 = vdm_AS_SetEnumPattern == argTmp_30.GetTag();
      else 
        tmpVal_29 = false;
    }
    succ_5 = ((Bool) (selRes_4 == tmpVal_29)).GetValue();
    if (succ_5) {
      Record tmpVar_31;
      tmpVar_31 = vdm_PAT_pat__p;
      Record tmpVar_32;
      tmpVar_32 = vdm_PAT_val__v;
      return vdm_PAT_MatchSetEnumPattern(tmpVar_31, tmpVar_32);
    }
  }
  if (!succ_5) {
    Bool tmpVal_33;
    {
      Record argTmp_34;
      argTmp_34 = vdm_PAT_pat__p;
      if (argTmp_34.IsRecord()) 
        tmpVal_33 = vdm_AS_SetUnionPattern == argTmp_34.GetTag();
      else 
        tmpVal_33 = false;
    }
    succ_5 = ((Bool) (selRes_4 == tmpVal_33)).GetValue();
    if (succ_5) {
      Record tmpVar_35;
      tmpVar_35 = vdm_PAT_pat__p;
      Record tmpVar_36;
      tmpVar_36 = vdm_PAT_val__v;
      return vdm_PAT_MatchSetUnionPattern(tmpVar_35, tmpVar_36);
    }
  }
  if (!succ_5) {
    Bool tmpVal_37;
    {
      Record argTmp_38;
      argTmp_38 = vdm_PAT_pat__p;
      if (argTmp_38.IsRecord()) 
        tmpVal_37 = vdm_AS_SeqEnumPattern == argTmp_38.GetTag();
      else 
        tmpVal_37 = false;
    }
    succ_5 = ((Bool) (selRes_4 == tmpVal_37)).GetValue();
    if (succ_5) {
      Record tmpVar_39;
      tmpVar_39 = vdm_PAT_pat__p;
      Record tmpVar_40;
      tmpVar_40 = vdm_PAT_val__v;
      return vdm_PAT_MatchSeqEnumPattern(tmpVar_39, tmpVar_40);
    }
  }
  if (!succ_5) {
    Bool tmpVal_41;
    {
      Record argTmp_42;
      argTmp_42 = vdm_PAT_pat__p;
      if (argTmp_42.IsRecord()) 
        tmpVal_41 = vdm_AS_SeqConcPattern == argTmp_42.GetTag();
      else 
        tmpVal_41 = false;
    }
    succ_5 = ((Bool) (selRes_4 == tmpVal_41)).GetValue();
    if (succ_5) {
      Record tmpVar_43;
      tmpVar_43 = vdm_PAT_pat__p;
      Record tmpVar_44;
      tmpVar_44 = vdm_PAT_val__v;
      return vdm_PAT_MatchSeqConcPattern(tmpVar_43, tmpVar_44);
    }
  }
  if (!succ_5) {
    Bool tmpVal_45;
    {
      Record argTmp_46;
      argTmp_46 = vdm_PAT_pat__p;
      if (argTmp_46.IsRecord()) 
        tmpVal_45 = vdm_AS_TuplePattern == argTmp_46.GetTag();
      else 
        tmpVal_45 = false;
    }
    succ_5 = ((Bool) (selRes_4 == tmpVal_45)).GetValue();
    if (succ_5) {
      Record tmpVar_47;
      tmpVar_47 = vdm_PAT_pat__p;
      Record tmpVar_48;
      tmpVar_48 = vdm_PAT_val__v;
      return vdm_PAT_MatchTuplePattern(tmpVar_47, tmpVar_48);
    }
  }
  if (!succ_5) {
    Bool tmpVal_49;
    {
      Record argTmp_50;
      argTmp_50 = vdm_PAT_pat__p;
      if (argTmp_50.IsRecord()) 
        tmpVal_49 = vdm_AS_RecordPattern == argTmp_50.GetTag();
      else 
        tmpVal_49 = false;
    }
    succ_5 = ((Bool) (selRes_4 == tmpVal_49)).GetValue();
    if (succ_5) {
      Record tmpVar_51;
      tmpVar_51 = vdm_PAT_pat__p;
      Record tmpVar_52;
      tmpVar_52 = vdm_PAT_val__v;
      return vdm_PAT_MatchRecordPattern(tmpVar_51, tmpVar_52);
    }
  }
  if (!succ_5) {
    Bool tmpVal_53;
    {
      Record argTmp_54;
      argTmp_54 = vdm_PAT_pat__p;
      if (argTmp_54.IsRecord()) 
        tmpVal_53 = vdm_AS_SetBind == argTmp_54.GetTag();
      else 
        tmpVal_53 = false;
    }
    succ_5 = ((Bool) (selRes_4 == tmpVal_53)).GetValue();
    if (!succ_5) {
      Bool tmpVal_55;
      {
        Record argTmp_56;
        argTmp_56 = vdm_PAT_pat__p;
        if (argTmp_56.IsRecord()) 
          tmpVal_55 = vdm_AS_TypeBind == argTmp_56.GetTag();
        else 
          tmpVal_55 = false;
      }
      succ_5 = ((Bool) (selRes_4 == tmpVal_55)).GetValue();
    }
    if (succ_5) {
      Record tmpVar_57;
      tmpVar_57 = vdm_PAT_pat__p;
      Quote tmpVar_58;
      tmpVar_58 = (Quote) "DONT_PARTITION";
      return vdm_PAT_EvalBind(tmpVar_57, tmpVar_58);
    }
  }
  if (!succ_5) 
    RunTime("Can not evaluate an error statement");
}

Record vdm_PAT_SelPattern(Record vdm_PAT_bind) {
  Record rexpr_3;
  {
    Record tmpRec_4;
    tmpRec_4 = vdm_PAT_bind;
    if (((Record) tmpRec_4).Is(vdm_AS_TypeBind)) 
      rexpr_3 = ((Record) tmpRec_4).GetField(pos_AS_TypeBind_pat);
    else 
      if (((Record) tmpRec_4).Is(vdm_AS_SetBind)) 
        rexpr_3 = ((Record) tmpRec_4).GetField(pos_AS_SetBind_pat);
      else 
        RunTime("Unknown record field selector");
  }
  return rexpr_3;
}

Record vdm_PAT_StripDoubles(Record vdm_PAT_blk__l) {
  Record vdm_PAT_tmpblk__l(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
  vdm_PAT_tmpblk__l = vdm_PAT_blk__l;
  Record vdm_PAT_res__l(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
  vdm_PAT_res__l = vdm_PAT_MkEmptyBlkEnv((Quote) "READ_ONLY");
  {
    Bool whCrtl_4;
    while ( true){
      Sequence var1_5;
      Record tmpRec_7(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
      tmpRec_7 = vdm_PAT_tmpblk__l;
      if (tmpRec_7.Is(vdm_SEM_BlkEnv)) 
        var1_5 = tmpRec_7.GetField(pos_SEM_BlkEnv_id__l);
      else 
        RunTime("Unknown record field selector");
      Sequence var2_6;
      var2_6 = Sequence();
      whCrtl_4 = (Bool) (!(var1_5 == var2_6));
      if (whCrtl_4.GetValue()) {
        bool succ_8;
        Record tmpVal_9(vdm_SEM_IdVal, length_SEM_IdVal);
        {
          Sequence unArg_10;
          Record tmpRec_11(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
          tmpRec_11 = vdm_PAT_tmpblk__l;
          if (tmpRec_11.Is(vdm_SEM_BlkEnv)) 
            unArg_10 = tmpRec_11.GetField(pos_SEM_BlkEnv_id__l);
          else 
            RunTime("Unknown record field selector");
          tmpVal_9 = (Record) (unArg_10.Hd());
        }
        Record vdm_PAT_id(vdm_AS_Name, length_AS_Name);
        Record vdm_PAT_val__v;
        succ_8 = true;
        {
          succ_8 = false;
          if (tmpVal_9.IsRecord()) 
            if (vdm_SEM_IdVal == tmpVal_9.GetTag()) {
              Sequence e_l_12;
              for (int i_13 = 1; i_13 <= tmpVal_9.Length(); i_13++) 
                e_l_12.ImpAppend(tmpVal_9.GetField(i_13));
              if (succ_8 = 3 == (Int) (e_l_12.Length())) {
                Generic permI_14;
                permI_14 = (Generic) (e_l_12.Hd());
                succ_8 = true;
                {
                  vdm_PAT_id = permI_14;
                  succ_8 = true;
                }
                permI_14 = (Generic) (e_l_12[2]);
                if (succ_8) {
                  vdm_PAT_val__v = permI_14;
                  succ_8 = true;
                }
                permI_14 = (Generic) (e_l_12[3]);
                if (succ_8) 
                  succ_8 = true;
              }
            }
        }
        if (!succ_8) 
          RunTime("Pattern match did not succeed in value definition");
        {
          Bool cond_15;
          {
            Bool unArg_16;
            bool tmpQuant_17 = false;
            {
              Sequence seq_lv_20;
              bool succ_18;
              Bool tsucc_21;
              tsucc_21 = true;
              {
                Set tmpVar_v_19;
                {
                  Sequence unArg_23;
                  Sequence unArg_24;
                  Record tmpRec_25(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                  tmpRec_25 = vdm_PAT_tmpblk__l;
                  if (tmpRec_25.Is(vdm_SEM_BlkEnv)) 
                    unArg_24 = tmpRec_25.GetField(pos_SEM_BlkEnv_id__l);
                  else 
                    RunTime("Unknown record field selector");
                  unArg_23 = unArg_24.Tl();
                  tmpVar_v_19 = unArg_23.Elems();
                }
                {
                  Set tmpVar_s_26;
                  {
                    Record vdm_PAT_id1(vdm_AS_Name, length_AS_Name);
                    Generic tmpe_32;
                    for (int bb_31 = tmpVar_v_19.First(tmpe_32); bb_31; bb_31 = tmpVar_v_19.Next(tmpe_32)) {
                      Record tmp_27 = tmpe_32;
                      {
                        succ_18 = false;
                        if (tmp_27.IsRecord()) 
                          if (vdm_SEM_IdVal == tmp_27.GetTag()) {
                            Sequence e_l_28;
                            for (int i_29 = 1; i_29 <= tmp_27.Length(); i_29++) 
                              e_l_28.ImpAppend(tmp_27.GetField(i_29));
                            if (succ_18 = 3 == (Int) (e_l_28.Length())) {
                              Generic permI_30;
                              permI_30 = (Generic) (e_l_28.Hd());
                              succ_18 = true;
                              {
                                vdm_PAT_id1 = permI_30;
                                succ_18 = true;
                              }
                              permI_30 = (Generic) (e_l_28[2]);
                              if (succ_18) 
                                succ_18 = true;
                              permI_30 = (Generic) (e_l_28[3]);
                              if (succ_18) 
                                succ_18 = true;
                            }
                          }
                        if (succ_18) { tmpVar_s_26.Insert(tmp_27); }
                      }
                    }
                  }
                  seq_lv_20.ImpAppend(tmpVar_s_26);
                }
              }
              Set allComb_22 = GenAllComb(seq_lv_20);
              Bool pred_33;
              Record vdm_PAT_id1(vdm_AS_Name, length_AS_Name);
              Generic tmpe_42;
              for (int bb_41 = allComb_22.First(tmpe_42); bb_41 && !tmpQuant_17; bb_41 = allComb_22.Next(tmpe_42)) {
                Sequence tmp_34 = tmpe_42;
                {
                  if (succ_18 = 1 == (Int) (tmp_34.Length())) {
                    Record permI_37(vdm_SEM_IdVal, length_SEM_IdVal);
                    permI_37 = (Record) (tmp_34.Hd());
                    succ_18 = true;
                    {
                      succ_18 = false;
                      if (permI_37.IsRecord()) 
                        if (vdm_SEM_IdVal == permI_37.GetTag()) {
                          Sequence e_l_38;
                          for (int i_39 = 1; i_39 <= permI_37.Length(); i_39++) 
                            e_l_38.ImpAppend(permI_37.GetField(i_39));
                          if (succ_18 = 3 == (Int) (e_l_38.Length())) {
                            Generic permI_40;
                            permI_40 = (Generic) (e_l_38.Hd());
                            succ_18 = true;
                            {
                              vdm_PAT_id1 = permI_40;
                              succ_18 = true;
                            }
                            permI_40 = (Generic) (e_l_38[2]);
                            if (succ_18) 
                              succ_18 = true;
                            permI_40 = (Generic) (e_l_38[3]);
                            if (succ_18) 
                              succ_18 = true;
                          }
                        }
                    }
                  }
                  if (succ_18) { if (((Bool) (vdm_PAT_id1 == vdm_PAT_id)).GetValue()) 
   tmpQuant_17 = true; }
                }
              }
            }
            unArg_16 = (Bool) tmpQuant_17;
            cond_15 = (Bool) (!unArg_16.GetValue());
          }
          if (cond_15.GetValue()) {
            Record rhs_43(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
            rhs_43 = vdm_PAT_CombineBlkEnv(vdm_PAT_res__l, vdm_PAT_MkBlkEnv(vdm_PAT_id, vdm_PAT_val__v, Nil(), (Quote) "READ_ONLY"));
            vdm_PAT_res__l = rhs_43;
          }
          {
            Sequence rhs_50;
            {
              Sequence unArg_51;
              Record tmpRec_52(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
              tmpRec_52 = vdm_PAT_tmpblk__l;
              if (tmpRec_52.Is(vdm_SEM_BlkEnv)) 
                unArg_51 = tmpRec_52.GetField(pos_SEM_BlkEnv_id__l);
              else 
                RunTime("Unknown record field selector");
              rhs_50 = unArg_51.Tl();
            }
            Record mu_rhs_53(vdm_SEM_BlkEnv, length_SEM_BlkEnv);            {
              Record tmpRE_54(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
              tmpRE_54 = vdm_PAT_tmpblk__l;
              int mu_55;
              mu_55 = pos_SEM_BlkEnv_id__l;
              Sequence val_56;
              {
                Sequence unArg_57;
                Record tmpRec_58(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                tmpRec_58 = vdm_PAT_tmpblk__l;
                if (tmpRec_58.Is(vdm_SEM_BlkEnv)) 
                  unArg_57 = tmpRec_58.GetField(pos_SEM_BlkEnv_id__l);
                else 
                  RunTime("Unknown record field selector");
                val_56 = unArg_57.Tl();
              }
              tmpRE_54.SetField(mu_55, val_56);
              mu_rhs_53 = tmpRE_54;
            }            vdm_PAT_tmpblk__l = mu_rhs_53;
          }
        }
      }
      else 
        break;
    }
  }
  {
    Record rexpr_59(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
    rexpr_59 = vdm_PAT_res__l;
    return rexpr_59;
  }
}

Set vdm_PAT_UnionMatch(Set vdm_PAT_blk__sl) {
  Set rexpr_3;
  {
    Set res_s_4;
    {
      Sequence seq_lv_9;
      bool succ_7;
      Bool tsucc_10;
      tsucc_10 = true;
      {
        Set tmpVar_v_8;
        tmpVar_v_8 = vdm_PAT_blk__sl;
{ seq_lv_9.ImpAppend(tmpVar_v_8); }
      }
      Set allComb_11 = GenAllComb(seq_lv_9);
      Bool pred_16;
      Record vdm_PAT_blk__l(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
      Generic tmpe_57;
      for (int bb_56 = allComb_11.First(tmpe_57); bb_56; bb_56 = allComb_11.Next(tmpe_57)) {
        Sequence tmp_17 = tmpe_57;
        {
          if (succ_7 = 1 == (Int) (tmp_17.Length())) {
            Record permI_55(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
            permI_55 = (Record) (tmp_17.Hd());
            succ_7 = true;
            {
              vdm_PAT_blk__l = permI_55;
              succ_7 = true;
            }
          }
          if (succ_7) {
            bool tmpQuant_18 = true;
            {
              Sequence seq_lv_21;
              bool succ_19;
              Bool tsucc_22;
              tsucc_22 = true;
              {
                Set tmpVar_v_20;
                {
                  Sequence unArg_24;
                  Record tmpRec_25(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                  tmpRec_25 = vdm_PAT_blk__l;
                  if (tmpRec_25.Is(vdm_SEM_BlkEnv)) 
                    unArg_24 = tmpRec_25.GetField(pos_SEM_BlkEnv_id__l);
                  else 
                    RunTime("Unknown record field selector");
                  tmpVar_v_20 = unArg_24.Elems();
                }
                {
                  Set tmpVar_s_26;
                  {
                    Record vdm_PAT_id(vdm_AS_Name, length_AS_Name);
                    Record vdm_PAT_v1__v;
                    Generic tmpe_32;
                    for (int bb_31 = tmpVar_v_20.First(tmpe_32); bb_31; bb_31 = tmpVar_v_20.Next(tmpe_32)) {
                      Record tmp_27 = tmpe_32;
                      {
                        succ_19 = false;
                        if (tmp_27.IsRecord()) 
                          if (vdm_SEM_IdVal == tmp_27.GetTag()) {
                            Sequence e_l_28;
                            for (int i_29 = 1; i_29 <= tmp_27.Length(); i_29++) 
                              e_l_28.ImpAppend(tmp_27.GetField(i_29));
                            if (succ_19 = 3 == (Int) (e_l_28.Length())) {
                              Generic permI_30;
                              permI_30 = (Generic) (e_l_28.Hd());
                              succ_19 = true;
                              {
                                vdm_PAT_id = permI_30;
                                succ_19 = true;
                              }
                              permI_30 = (Generic) (e_l_28[2]);
                              if (succ_19) {
                                vdm_PAT_v1__v = permI_30;
                                succ_19 = true;
                              }
                              permI_30 = (Generic) (e_l_28[3]);
                              if (succ_19) 
                                succ_19 = true;
                            }
                          }
                        if (succ_19) { tmpVar_s_26.Insert(tmp_27); }
                      }
                    }
                  }
                  seq_lv_21.ImpAppend(tmpVar_s_26);
                }
              }
              {
                Set tmpVar_v_20;
                {
                  Sequence unArg_33;
                  Record tmpRec_34(vdm_SEM_BlkEnv, length_SEM_BlkEnv);
                  tmpRec_34 = vdm_PAT_blk__l;
                  if (tmpRec_34.Is(vdm_SEM_BlkEnv)) 
                    unArg_33 = tmpRec_34.GetField(pos_SEM_BlkEnv_id__l);
                  else 
                    RunTime("Unknown record field selector");
                  tmpVar_v_20 = unArg_33.Elems();
                }
                {
                  Set tmpVar_s_35;
                  {
                    Record vdm_PAT_id(vdm_AS_Name, length_AS_Name);
                    Record vdm_PAT_v2__v;
                    Generic tmpe_41;
                    for (int bb_40 = tmpVar_v_20.First(tmpe_41); bb_40; bb_40 = tmpVar_v_20.Next(tmpe_41)) {
                      Record tmp_36 = tmpe_41;
                      {
                        succ_19 = false;
                        if (tmp_36.IsRecord()) 
                          if (vdm_SEM_IdVal == tmp_36.GetTag()) {
                            Sequence e_l_37;
                            for (int i_38 = 1; i_38 <= tmp_36.Length(); i_38++) 
                              e_l_37.ImpAppend(tmp_36.GetField(i_38));
                            if (succ_19 = 3 == (Int) (e_l_37.Length())) {
                              Generic permI_39;
                              permI_39 = (Generic) (e_l_37.Hd());
                              succ_19 = true;
                              {
                                vdm_PAT_id = permI_39;
                                succ_19 = true;
                              }
                              permI_39 = (Generic) (e_l_37[2]);
                              if (succ_19) {
                                vdm_PAT_v2__v = permI_39;
                                succ_19 = true;
                              }
                              permI_39 = (Generic) (e_l_37[3]);
                              if (succ_19) 
                                succ_19 = true;
                            }
                          }
                        if (succ_19) { tmpVar_s_35.Insert(tmp_36); }
                      }
                    }
                  }
                  seq_lv_21.ImpAppend(tmpVar_s_35);
                }
              }
              Set allComb_23 = GenAllComb(seq_lv_21);
              Bool pred_42;
              Record vdm_PAT_id(vdm_AS_Name, length_AS_Name);
              Record vdm_PAT_v1__v;
              Record vdm_PAT_v2__v;
              Generic tmpe_54;
              for (int bb_53 = allComb_23.First(tmpe_54); bb_53 && tmpQuant_18; bb_53 = allComb_23.Next(tmpe_54)) {
                Sequence tmp_43 = tmpe_54;
                {
                  if (succ_19 = 2 == (Int) (tmp_43.Length())) {
                    Record permI_46(vdm_SEM_IdVal, length_SEM_IdVal);
                    permI_46 = (Record) (tmp_43.Hd());
                    succ_19 = true;
                    {
                      succ_19 = false;
                      if (permI_46.IsRecord()) 
                        if (vdm_SEM_IdVal == permI_46.GetTag()) {
                          Sequence e_l_47;
                          for (int i_48 = 1; i_48 <= permI_46.Length(); i_48++) 
                            e_l_47.ImpAppend(permI_46.GetField(i_48));
                          if (succ_19 = 3 == (Int) (e_l_47.Length())) {
                            Generic permI_49;
                            permI_49 = (Generic) (e_l_47.Hd());
                            succ_19 = true;
                            {
                              vdm_PAT_id = permI_49;
                              succ_19 = true;
                            }
                            permI_49 = (Generic) (e_l_47[2]);
                            if (succ_19) {
                              vdm_PAT_v1__v = permI_49;
                              succ_19 = true;
                            }
                            permI_49 = (Generic) (e_l_47[3]);
                            if (succ_19) 
                              succ_19 = true;
                          }
                        }
                    }
                    permI_46 = (Record) (tmp_43[2]);
                    if (succ_19) {
                      succ_19 = false;
                      if (permI_46.IsRecord()) 
                        if (vdm_SEM_IdVal == permI_46.GetTag()) {
                          Sequence e_l_50;
                          for (int i_51 = 1; i_51 <= permI_46.Length(); i_51++) 
                            e_l_50.ImpAppend(permI_46.GetField(i_51));
                          if (succ_19 = 3 == (Int) (e_l_50.Length())) {
                            Generic permI_52;
                            permI_52 = (Generic) (e_l_50.Hd());
                            succ_19 = true;
                            succ_19 = vdm_PAT_id == permI_52;
                            permI_52 = (Generic) (e_l_50[2]);
                            if (succ_19) {
                              vdm_PAT_v2__v = permI_52;
                              succ_19 = true;
                            }
                            permI_52 = (Generic) (e_l_50[3]);
                            if (succ_19) 
                              succ_19 = true;
                          }
                        }
                    }
                  }
                  if (succ_19) { if (((Bool) (vdm_PAT_v1__v == vdm_PAT_v2__v)).GetValue()) {}
 else 
   tmpQuant_18 = false; }
                }
              }
            }
            pred_16 = (Bool) tmpQuant_18;
            if (pred_16.GetValue()) 
              res_s_4.Insert(vdm_PAT_StripDoubles(vdm_PAT_blk__l));
          }
        }
      }
    }
    rexpr_3 = res_s_4;
  }
  return rexpr_3;
}
