//
// THIS FILE IS AUTOMATICALLY GENERATED!!
//
// Generated at Wed 20-Oct-99 by the VDM-SLtoC++ Code Generator
// (v3.3 - Mon 22-Mar-99)
//
// Supported compilers:
// 	egcs version 1.1 on SunOS4, SunOS5, Linux, HP-UX10
// 	VC++ version 6.0 on Windows95, Windows NT
//



#include "EXP_uPAT.h"

void TYPE_EXP_uPAT_Expand::Init(type_FL p1, TYPE_TRF_uTAR_uEXPR_Identifiers p2) {
  SetField(1, p1);
  SetField(2, p2);
}

type_FL TYPE_EXP_uPAT_Expand::get_ldefs() const { return (type_FL) GetField(1); }

void TYPE_EXP_uPAT_Expand::set_ldefs(const type_FL &p) { SetField(1, p); }

TYPE_TRF_uTAR_uEXPR_Identifiers TYPE_EXP_uPAT_Expand::get_ids() const { return (TYPE_TRF_uTAR_uEXPR_Identifiers) GetField(2); }

void TYPE_EXP_uPAT_Expand::set_ids(const TYPE_TRF_uTAR_uEXPR_Identifiers &p) { SetField(2, p); }
static TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandMatchVal(const TYPE_AS_ValueDef &, const TYPE_TRF_uTAR_uEXPR_Identifiers &, const TYPE_CI_ContextId &);
static TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandPatternName(const TYPE_AS_ValueDef &, const TYPE_TRF_uTAR_uEXPR_Identifiers &, const TYPE_CI_ContextId &);
static TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandRecordPattern(const TYPE_AS_ValueDef &, const TYPE_TRF_uTAR_uEXPR_Identifiers &, const TYPE_CI_ContextId &);
static Bool vdm_EXP_uPAT_pre_ExpandRecordPattern(const TYPE_AS_ValueDef &, const TYPE_TRF_uTAR_uEXPR_Identifiers &, const TYPE_CI_ContextId &);
static TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandSeqEnumPattern(const TYPE_AS_ValueDef &, const TYPE_TRF_uTAR_uEXPR_Identifiers &, const TYPE_CI_ContextId &);
static Bool vdm_EXP_uPAT_pre_ExpandSeqEnumPattern(const TYPE_AS_ValueDef &, const TYPE_TRF_uTAR_uEXPR_Identifiers &, const TYPE_CI_ContextId &);
static TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandTuplePattern(const TYPE_AS_ValueDef &, const TYPE_TRF_uTAR_uEXPR_Identifiers &, const TYPE_CI_ContextId &);
static Bool vdm_EXP_uPAT_pre_ExpandTuplePattern(const TYPE_AS_ValueDef &, const TYPE_TRF_uTAR_uEXPR_Identifiers &, const TYPE_CI_ContextId &);
static TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandValueDef(const TYPE_AS_ValueDef &, const TYPE_TRF_uTAR_uEXPR_Identifiers &, const TYPE_CI_ContextId &);

void init_EXP_uPAT_VDMLib() {
  VDMGetDefaultRecInfoMap().NewTag(TAG_TYPE_EXP_uPAT_Expand, 2);
  VDMGetDefaultRecInfoMap().SetSymTag(TAG_TYPE_EXP_uPAT_Expand, "EXP_uPAT`Expand");
  VDMGetDefaultRecInfoMap().NewTag(TOKEN, 1);
  VDMGetDefaultRecInfoMap().SetSymTag(TOKEN, "token");
}
#ifdef DEF_EXP_uPAT_USERIMPL

#include "EXP_uPAT_userimpl.cc"

#endif


void init_EXP_uPAT() { init_EXP_uPAT_VDMLib(); }
#ifndef DEF_EXP_uPAT_ExpandLocalDefList

TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandLocalDefList(const type_FL &vdm_EXP_uPAT_ldefs, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used_uids, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Record varRes_5(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    cout << "vdm_EXP_uPAT_ExpandLocalDefList 1" << endl;
  if (((Bool) (vdm_EXP_uPAT_ldefs == Sequence())).GetValue()) {
    varRes_5 = Record(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    varRes_5.SetField(1, Sequence());
    varRes_5.SetField(2, vdm_EXP_uPAT_used_uids);
  }
  else {
    bool succ_10;
    Record tmpVal_11(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    tmpVal_11 = vdm_EXP_uPAT_ExpandValueDef((Generic) (Record) vdm_EXP_uPAT_ldefs.Hd(), (Generic) vdm_EXP_uPAT_used_uids, (Generic) vdm_EXP_uPAT_cid);
    Sequence vdm_EXP_uPAT_hd_uldefs;
    Set vdm_EXP_uPAT_hd_uused_uids;
    succ_10 = true;
    if (tmpVal_11.IsRecord() && vdm_EXP_uPAT_Expand == tmpVal_11.GetTag()) {
      Sequence e_l_16;
      for (int i_17 = 1; i_17 <= tmpVal_11.Length(); i_17++) 
        e_l_16.ImpAppend(tmpVal_11.GetField(i_17));
      if (succ_10 = 2 == (Int) e_l_16.Length()) {
        vdm_EXP_uPAT_hd_uldefs = (Generic) e_l_16.Hd();
        vdm_EXP_uPAT_hd_uused_uids = (Generic) e_l_16[2];
      }
    }
    else 
      succ_10 = false;
    if (!succ_10) 
      RunTime("Pattern match did not succeed in value definition");
    Record tmpVal_18(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    tmpVal_18 = vdm_EXP_uPAT_ExpandLocalDefList((Generic) vdm_EXP_uPAT_ldefs.Tl(), (Generic) vdm_EXP_uPAT_hd_uused_uids, (Generic) vdm_EXP_uPAT_cid);
    Sequence vdm_EXP_uPAT_tl_uldefs;
    Set vdm_EXP_uPAT_tl_uused_uids;
    succ_10 = true;
    if (tmpVal_18.IsRecord() && vdm_EXP_uPAT_Expand == tmpVal_18.GetTag()) {
      Sequence e_l_23;
      for (int i_24 = 1; i_24 <= tmpVal_18.Length(); i_24++) 
        e_l_23.ImpAppend(tmpVal_18.GetField(i_24));
      if (succ_10 = 2 == (Int) e_l_23.Length()) {
        vdm_EXP_uPAT_tl_uldefs = (Generic) e_l_23.Hd();
        vdm_EXP_uPAT_tl_uused_uids = (Generic) e_l_23[2];
      }
    }
    else 
      succ_10 = false;
    if (!succ_10) 
      RunTime("Pattern match did not succeed in value definition");
    varRes_5 = Record(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    Sequence tmpVar_25;
    tmpVar_25.ImpConc(vdm_EXP_uPAT_hd_uldefs).ImpConc(vdm_EXP_uPAT_tl_uldefs);
    varRes_5.SetField(1, tmpVar_25);
    varRes_5.SetField(2, vdm_EXP_uPAT_tl_uused_uids);
  }
    cout << "vdm_EXP_uPAT_ExpandLocalDefList 2" << endl;
  return (Generic) varRes_5;
}
#endif

#ifndef DEF_EXP_uPAT_pre_ExpandLocalDefList

Bool vdm_EXP_uPAT_pre_ExpandLocalDefList(const type_FL &vdm_EXP_uPAT_ldefs, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used_uids, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Bool varRes_5;
  bool tmpQuant_6 = true;
  {
    bool succ_11 = true;
    Set e_set_12;    Set riseq_14;    int max_15 = (Int) vdm_EXP_uPAT_ldefs.Length();    for (int i_16 = 1; i_16 <= max_15; i_16++) 
      riseq_14.Insert((Int) i_16);    e_set_12 = riseq_14;
    Int vdm_EXP_uPAT_i;
    {
      Generic tmpe_19;
      for (int bb_18 = e_set_12.First(tmpe_19); bb_18 && tmpQuant_6; bb_18 = e_set_12.Next(tmpe_19)) {
        Int elem_17 = tmpe_19;
        succ_11 = true;        vdm_EXP_uPAT_i = elem_17;        if (succ_11) {
          Bool pred_7;
          if (((Record) vdm_EXP_uPAT_ldefs[vdm_EXP_uPAT_i.GetValue()]).IsRecord()) 
            pred_7 = vdm_AS_ValueDef == ((Record) vdm_EXP_uPAT_ldefs[vdm_EXP_uPAT_i.GetValue()]).GetTag();
          else 
            pred_7 = false;
          if (pred_7.GetValue()) {}
          else 
            tmpQuant_6 = false;
        }
      }
    }
  }
  varRes_5 = (Bool) tmpQuant_6;
  return (Generic) varRes_5;
}
#endif

#ifndef DEF_EXP_uPAT_ExpandMatchVal

TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandMatchVal(const TYPE_AS_ValueDef &vdm_EXP_uPAT_ldef, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used_uids, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Record varRes_5(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
  varRes_5 = Record(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
  varRes_5.SetField(1, Sequence());
  varRes_5.SetField(2, vdm_EXP_uPAT_used_uids);
  return (Generic) varRes_5;
}
#endif

#ifndef DEF_EXP_uPAT_ExpandPatternName

TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandPatternName(const TYPE_AS_ValueDef &vdm_EXP_uPAT_ldef, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used_uids, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Record varRes_5(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
  Bool cond_7;
  Generic var1_8;
  Record tmpRec_9;
  if (vdm_EXP_uPAT_ldef.Is(vdm_AS_ValueDef)) 
    tmpRec_9 = vdm_EXP_uPAT_ldef.GetField(pos_AS_ValueDef_pat);
  else 
    RunTime("Unknown record field selector");
  if (((Record) tmpRec_9).Is(vdm_AS_RecordPattern)) 
    var1_8 = ((Record) tmpRec_9).GetField(pos_AS_RecordPattern_nm);
  else 
    if (((Record) tmpRec_9).Is(vdm_AS_PatternName)) 
      var1_8 = ((Record) tmpRec_9).GetField(pos_AS_PatternName_nm);
    else 
      RunTime("Unknown record field selector");
  cond_7 = (Bool) (var1_8 == Nil());
  if (cond_7.GetValue()) {
    varRes_5 = Record(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    varRes_5.SetField(1, Sequence());
    varRes_5.SetField(2, vdm_EXP_uPAT_used_uids);
  }
  else {
    varRes_5 = Record(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    Sequence tmpVar_12;
    tmpVar_12 = Sequence().ImpAppend(vdm_EXP_uPAT_ldef);
    varRes_5.SetField(1, tmpVar_12);
    varRes_5.SetField(2, vdm_EXP_uPAT_used_uids);
  }
  return (Generic) varRes_5;
}
#endif

#ifndef DEF_EXP_uPAT_ExpandRecordPattern

TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandRecordPattern(const TYPE_AS_ValueDef &vdm_EXP_uPAT_val, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used_uids, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Record varRes_5(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
  {
    bool succ_6;
    Sequence vdm_EXP_uPAT_ids = vdm_TRF_uTAR_uEXPR_GetNewName((Generic) vdm_EXP_uPAT_used_uids);
    Set vdm_EXP_uPAT_new_uused_uids;
    Set var2_11;
    var2_11 = Set().Insert(vdm_EXP_uPAT_ids);
    vdm_EXP_uPAT_new_uused_uids = vdm_EXP_uPAT_used_uids;
    vdm_EXP_uPAT_new_uused_uids.ImpUnion(var2_11);
    Record vdm_EXP_uPAT_nm(vdm_AS_Name, length_AS_Name);
    vdm_EXP_uPAT_nm = Record(vdm_AS_Name, length_AS_Name);
    vdm_EXP_uPAT_nm.SetField(1, vdm_EXP_uPAT_ids);
    Int tmpVar_15;
    Record tmpRec_16;
    if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
      tmpRec_16 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
    else 
      RunTime("Unknown record field selector");
    if (((Record) tmpRec_16).Is(vdm_AS_TuplePattern)) 
      tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_TuplePattern_cid);
    else 
      if (((Record) tmpRec_16).Is(vdm_AS_SetUnionPattern)) 
        tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_SetUnionPattern_cid);
      else 
        if (((Record) tmpRec_16).Is(vdm_AS_SetEnumPattern)) 
          tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_SetEnumPattern_cid);
        else 
          if (((Record) tmpRec_16).Is(vdm_AS_SeqEnumPattern)) 
            tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_SeqEnumPattern_cid);
          else 
            if (((Record) tmpRec_16).Is(vdm_AS_SeqConcPattern)) 
              tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_SeqConcPattern_cid);
            else 
              if (((Record) tmpRec_16).Is(vdm_AS_RecordPattern)) 
                tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_RecordPattern_cid);
              else 
                if (((Record) tmpRec_16).Is(vdm_AS_PatternName)) 
                  tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_PatternName_cid);
                else 
                  if (((Record) tmpRec_16).Is(vdm_AS_MatchVal)) 
                    tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_MatchVal_cid);
                  else 
                    RunTime("Unknown record field selector");
    vdm_EXP_uPAT_nm.SetField(2, tmpVar_15);
    Record vdm_EXP_uPAT_new_upat(vdm_AS_PatternName, length_AS_PatternName);
    vdm_EXP_uPAT_new_upat = Record(vdm_AS_PatternName, length_AS_PatternName);
    vdm_EXP_uPAT_new_upat.SetField(1, vdm_EXP_uPAT_nm);
    Int tmpVar_20;
    if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
      tmpVar_20 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_cid);
    else 
      RunTime("Unknown record field selector");
    vdm_EXP_uPAT_new_upat.SetField(2, tmpVar_20);
    Record vdm_EXP_uPAT_new_uval(vdm_AS_ValueDef, length_AS_ValueDef);
    Record tmpRE_24 = vdm_EXP_uPAT_val;
    int mu_25;
    mu_25 = pos_AS_ValueDef_pat;
    tmpRE_24.SetField(mu_25, vdm_EXP_uPAT_new_upat);
    vdm_EXP_uPAT_new_uval = tmpRE_24;
    Record vdm_EXP_uPAT_tp_urep;
    Int par_28;
    Record tmpRec_29;
    if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
      tmpRec_29 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
    else 
      RunTime("Unknown record field selector");
    if (((Record) tmpRec_29).Is(vdm_AS_TuplePattern)) 
      par_28 = ((Record) tmpRec_29).GetField(pos_AS_TuplePattern_cid);
    else 
      if (((Record) tmpRec_29).Is(vdm_AS_SetUnionPattern)) 
        par_28 = ((Record) tmpRec_29).GetField(pos_AS_SetUnionPattern_cid);
      else 
        if (((Record) tmpRec_29).Is(vdm_AS_SetEnumPattern)) 
          par_28 = ((Record) tmpRec_29).GetField(pos_AS_SetEnumPattern_cid);
        else 
          if (((Record) tmpRec_29).Is(vdm_AS_SeqEnumPattern)) 
            par_28 = ((Record) tmpRec_29).GetField(pos_AS_SeqEnumPattern_cid);
          else 
            if (((Record) tmpRec_29).Is(vdm_AS_SeqConcPattern)) 
              par_28 = ((Record) tmpRec_29).GetField(pos_AS_SeqConcPattern_cid);
            else 
              if (((Record) tmpRec_29).Is(vdm_AS_RecordPattern)) 
                par_28 = ((Record) tmpRec_29).GetField(pos_AS_RecordPattern_cid);
              else 
                if (((Record) tmpRec_29).Is(vdm_AS_PatternName)) 
                  par_28 = ((Record) tmpRec_29).GetField(pos_AS_PatternName_cid);
                else 
                  if (((Record) tmpRec_29).Is(vdm_AS_MatchVal)) 
                    par_28 = ((Record) tmpRec_29).GetField(pos_AS_MatchVal_cid);
                  else 
                    RunTime("Unknown record field selector");
    vdm_EXP_uPAT_tp_urep = vdm_CI_GetTypeInfo((Generic) par_28);
    Record vdm_EXP_uPAT_tp;
    Int par_33;
    if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
      par_33 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_cid);
    else 
      RunTime("Unknown record field selector");
    vdm_EXP_uPAT_tp = vdm_REP2TYPE_TypeRepToType((Generic) vdm_EXP_uPAT_tp_urep, (Generic) par_33);
    Sequence vdm_EXP_uPAT_new_uldefs;
    {
      Sequence res_l_36;
      Set resBind_s_38;
      Sequence unArg_41;
      Record tmpRec_42;
      if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
        tmpRec_42 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
      else 
        RunTime("Unknown record field selector");
      if (((Record) tmpRec_42).Is(vdm_AS_TuplePattern)) 
        unArg_41 = ((Record) tmpRec_42).GetField(pos_AS_TuplePattern_fields);
      else 
        if (((Record) tmpRec_42).Is(vdm_AS_RecordPattern)) 
          unArg_41 = ((Record) tmpRec_42).GetField(pos_AS_RecordPattern_fields);
        else 
          RunTime("Unknown record field selector");
      Set riseq_44;      int max_45 = (Int) unArg_41.Length();      for (int i_46 = 1; i_46 <= max_45; i_46++) 
        riseq_44.Insert((Int) i_46);      resBind_s_38 = riseq_44;
      Sequence bind_l_37;
      if ((Int) resBind_s_38.Card() != (Int) 0) 
        bind_l_37 = Sort(resBind_s_38);
      bool succ_39 = true;
      Int vdm_EXP_uPAT_i;
      Generic tmpe_69;
      for (int i_68 = bind_l_37.First(tmpe_69); i_68; i_68 = bind_l_37.Next(tmpe_69)) {
        Int e_40 = tmpe_69;
        vdm_EXP_uPAT_i = e_40;
        if (succ_39) {
          Record reselem_47(vdm_AS_ValueDef, length_AS_ValueDef);
          {
            Generic vdm_EXP_uPAT_field;
            Record tmpRec_50(vdm_AS_Field, length_AS_Field);
            Sequence tmp_l_51;
            if (((Record) vdm_EXP_uPAT_tp).Is(vdm_AS_CompositeType)) 
              tmp_l_51 = ((Record) vdm_EXP_uPAT_tp).GetField(pos_AS_CompositeType_fields);
            else 
              RunTime("Unknown record field selector");
            tmpRec_50 = (Record) tmp_l_51[vdm_EXP_uPAT_i.GetValue()];
            if (tmpRec_50.Is(vdm_AS_Field)) 
              vdm_EXP_uPAT_field = tmpRec_50.GetField(pos_AS_Field_sel);
            else 
              RunTime("Unknown record field selector");
            Record vdm_EXP_uPAT_pat;
            Sequence tmp_l_55;
            Record tmpRec_56;
            if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
              tmpRec_56 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
            else 
              RunTime("Unknown record field selector");
            if (((Record) tmpRec_56).Is(vdm_AS_TuplePattern)) 
              tmp_l_55 = ((Record) tmpRec_56).GetField(pos_AS_TuplePattern_fields);
            else 
              if (((Record) tmpRec_56).Is(vdm_AS_RecordPattern)) 
                tmp_l_55 = ((Record) tmpRec_56).GetField(pos_AS_RecordPattern_fields);
              else 
                RunTime("Unknown record field selector");
            vdm_EXP_uPAT_pat = (Record) tmp_l_55[vdm_EXP_uPAT_i.GetValue()];
            Record vdm_EXP_uPAT_expr(vdm_AS_FieldSelectExpr, length_AS_FieldSelectExpr);
            vdm_EXP_uPAT_expr = Record(vdm_AS_FieldSelectExpr, length_AS_FieldSelectExpr);
            vdm_EXP_uPAT_expr.SetField(1, vdm_EXP_uPAT_nm);
            vdm_EXP_uPAT_expr.SetField(2, vdm_EXP_uPAT_field);
            vdm_EXP_uPAT_expr.SetField(3, vdm_CI_NilContextId);
            reselem_47 = Record(vdm_AS_ValueDef, length_AS_ValueDef);
            reselem_47.SetField(1, vdm_EXP_uPAT_pat);
            reselem_47.SetField(2, Nil());
            reselem_47.SetField(3, vdm_EXP_uPAT_expr);
            Int tmpVar_66;
            if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
              tmpVar_66 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_cid);
            else 
              RunTime("Unknown record field selector");
            reselem_47.SetField(4, tmpVar_66);
          }
          res_l_36.ImpAppend(reselem_47);
        }
      }
      vdm_EXP_uPAT_new_uldefs = res_l_36;
    }
    Record tmpVal_70(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    tmpVal_70 = vdm_EXP_uPAT_ExpandLocalDefList((Generic) vdm_EXP_uPAT_new_uldefs, (Generic) vdm_EXP_uPAT_new_uused_uids, (Generic) vdm_EXP_uPAT_cid);
    Sequence vdm_EXP_uPAT_exp_unew_uldefs;
    Set vdm_EXP_uPAT_rtn_uused_uids;
    succ_6 = true;
    if (tmpVal_70.IsRecord() && vdm_EXP_uPAT_Expand == tmpVal_70.GetTag()) {
      Sequence e_l_74;
      for (int i_75 = 1; i_75 <= tmpVal_70.Length(); i_75++) 
        e_l_74.ImpAppend(tmpVal_70.GetField(i_75));
      if (succ_6 = 2 == (Int) e_l_74.Length()) {
        vdm_EXP_uPAT_exp_unew_uldefs = (Generic) e_l_74.Hd();
        vdm_EXP_uPAT_rtn_uused_uids = (Generic) e_l_74[2];
      }
    }
    else 
      succ_6 = false;
    if (!succ_6) 
      RunTime("Pattern match did not succeed in value definition");
    varRes_5 = Record(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    Sequence tmpVar_76;
    Sequence var1_77;
    var1_77 = Sequence().ImpAppend(vdm_EXP_uPAT_new_uval);
    tmpVar_76.ImpConc(var1_77).ImpConc(vdm_EXP_uPAT_exp_unew_uldefs);
    varRes_5.SetField(1, tmpVar_76);
    varRes_5.SetField(2, vdm_EXP_uPAT_rtn_uused_uids);
  }
  return (Generic) varRes_5;
}
#endif

#ifndef DEF_EXP_uPAT_pre_ExpandRecordPattern

Bool vdm_EXP_uPAT_pre_ExpandRecordPattern(const TYPE_AS_ValueDef &vdm_EXP_uPAT_val, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used_uids, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Bool varRes_5;
  Record argTmp_6;
  if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
    argTmp_6 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
  else 
    RunTime("Unknown record field selector");
  if (argTmp_6.IsRecord()) 
    varRes_5 = vdm_AS_RecordPattern == argTmp_6.GetTag();
  else 
    varRes_5 = false;
  return (Generic) varRes_5;
}
#endif

#ifndef DEF_EXP_uPAT_ExpandSeqEnumPattern

TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandSeqEnumPattern(const TYPE_AS_ValueDef &vdm_EXP_uPAT_val, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used_uids, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Record varRes_5(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
  {
    bool succ_6;
    Int tmpVal_7;
    if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
      tmpVal_7 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_cid);
    else 
      RunTime("Unknown record field selector");
    Int vdm_EXP_uPAT_cid;
    vdm_EXP_uPAT_cid = tmpVal_7;
    Sequence vdm_EXP_uPAT_ids = vdm_TRF_uTAR_uEXPR_GetNewName((Generic) vdm_EXP_uPAT_used_uids);
    Set vdm_EXP_uPAT_new_uused_uids;
    Set var2_13;
    var2_13 = Set().Insert(vdm_EXP_uPAT_ids);
    vdm_EXP_uPAT_new_uused_uids = vdm_EXP_uPAT_used_uids;
    vdm_EXP_uPAT_new_uused_uids.ImpUnion(var2_13);
    Record vdm_EXP_uPAT_nm(vdm_AS_Name, length_AS_Name);
    vdm_EXP_uPAT_nm = Record(vdm_AS_Name, length_AS_Name);
    vdm_EXP_uPAT_nm.SetField(1, vdm_EXP_uPAT_ids);
    Int tmpVar_17;
    Record tmpRec_18;
    if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
      tmpRec_18 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
    else 
      RunTime("Unknown record field selector");
    if (((Record) tmpRec_18).Is(vdm_AS_TuplePattern)) 
      tmpVar_17 = ((Record) tmpRec_18).GetField(pos_AS_TuplePattern_cid);
    else 
      if (((Record) tmpRec_18).Is(vdm_AS_SetUnionPattern)) 
        tmpVar_17 = ((Record) tmpRec_18).GetField(pos_AS_SetUnionPattern_cid);
      else 
        if (((Record) tmpRec_18).Is(vdm_AS_SetEnumPattern)) 
          tmpVar_17 = ((Record) tmpRec_18).GetField(pos_AS_SetEnumPattern_cid);
        else 
          if (((Record) tmpRec_18).Is(vdm_AS_SeqEnumPattern)) 
            tmpVar_17 = ((Record) tmpRec_18).GetField(pos_AS_SeqEnumPattern_cid);
          else 
            if (((Record) tmpRec_18).Is(vdm_AS_SeqConcPattern)) 
              tmpVar_17 = ((Record) tmpRec_18).GetField(pos_AS_SeqConcPattern_cid);
            else 
              if (((Record) tmpRec_18).Is(vdm_AS_RecordPattern)) 
                tmpVar_17 = ((Record) tmpRec_18).GetField(pos_AS_RecordPattern_cid);
              else 
                if (((Record) tmpRec_18).Is(vdm_AS_PatternName)) 
                  tmpVar_17 = ((Record) tmpRec_18).GetField(pos_AS_PatternName_cid);
                else 
                  if (((Record) tmpRec_18).Is(vdm_AS_MatchVal)) 
                    tmpVar_17 = ((Record) tmpRec_18).GetField(pos_AS_MatchVal_cid);
                  else 
                    RunTime("Unknown record field selector");
    vdm_EXP_uPAT_nm.SetField(2, tmpVar_17);
    Record vdm_EXP_uPAT_new_upat(vdm_AS_PatternName, length_AS_PatternName);
    vdm_EXP_uPAT_new_upat = Record(vdm_AS_PatternName, length_AS_PatternName);
    vdm_EXP_uPAT_new_upat.SetField(1, vdm_EXP_uPAT_nm);
    vdm_EXP_uPAT_new_upat.SetField(2, vdm_EXP_uPAT_cid);
    Record vdm_EXP_uPAT_new_uval(vdm_AS_ValueDef, length_AS_ValueDef);
    Record tmpRE_25 = vdm_EXP_uPAT_val;
    int mu_26;
    mu_26 = pos_AS_ValueDef_pat;
    tmpRE_25.SetField(mu_26, vdm_EXP_uPAT_new_upat);
    vdm_EXP_uPAT_new_uval = tmpRE_25;
    Sequence vdm_EXP_uPAT_new_uldefs;
    {
      Sequence res_l_29;
      Set resBind_s_31;
      Sequence unArg_34;
      Record tmpRec_35;
      if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
        tmpRec_35 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
      else 
        RunTime("Unknown record field selector");
      if (((Record) tmpRec_35).Is(vdm_AS_SeqEnumPattern)) 
        unArg_34 = ((Record) tmpRec_35).GetField(pos_AS_SeqEnumPattern_els);
      else 
        RunTime("Unknown record field selector");
      Set riseq_37;      int max_38 = (Int) unArg_34.Length();      for (int i_39 = 1; i_39 <= max_38; i_39++) 
        riseq_37.Insert((Int) i_39);      resBind_s_31 = riseq_37;
      Sequence bind_l_30;
      if ((Int) resBind_s_31.Card() != (Int) 0) 
        bind_l_30 = Sort(resBind_s_31);
      bool succ_32 = true;
      Int vdm_EXP_uPAT_i;
      Generic tmpe_61;
      for (int i_60 = bind_l_30.First(tmpe_61); i_60; i_60 = bind_l_30.Next(tmpe_61)) {
        Int e_33 = tmpe_61;
        vdm_EXP_uPAT_i = e_33;
        if (succ_32) {
          Record reselem_40(vdm_AS_ValueDef, length_AS_ValueDef);
          {
            Record vdm_EXP_uPAT_index(vdm_AS_RealLit, length_AS_RealLit);
            vdm_EXP_uPAT_index = Record(vdm_AS_RealLit, length_AS_RealLit);
            vdm_EXP_uPAT_index.SetField(1, vdm_EXP_uPAT_i);
            vdm_EXP_uPAT_index.SetField(2, vdm_EXP_uPAT_cid);
            Record vdm_EXP_uPAT_pat;
            Sequence tmp_l_46;
            Record tmpRec_47;
            if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
              tmpRec_47 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
            else 
              RunTime("Unknown record field selector");
            if (((Record) tmpRec_47).Is(vdm_AS_SeqEnumPattern)) 
              tmp_l_46 = ((Record) tmpRec_47).GetField(pos_AS_SeqEnumPattern_els);
            else 
              RunTime("Unknown record field selector");
            vdm_EXP_uPAT_pat = (Record) tmp_l_46[vdm_EXP_uPAT_i.GetValue()];
            Record vdm_EXP_uPAT_expr(vdm_AS_ApplyExpr, length_AS_ApplyExpr);
            vdm_EXP_uPAT_expr = Record(vdm_AS_ApplyExpr, length_AS_ApplyExpr);
            vdm_EXP_uPAT_expr.SetField(1, vdm_EXP_uPAT_nm);
            Sequence tmpVar_52;
            tmpVar_52 = Sequence().ImpAppend(vdm_EXP_uPAT_index);
            vdm_EXP_uPAT_expr.SetField(2, tmpVar_52);
            vdm_EXP_uPAT_expr.SetField(3, vdm_EXP_uPAT_cid);
            reselem_40 = Record(vdm_AS_ValueDef, length_AS_ValueDef);
            reselem_40.SetField(1, vdm_EXP_uPAT_pat);
            reselem_40.SetField(2, Nil());
            reselem_40.SetField(3, vdm_EXP_uPAT_expr);
            Int tmpVar_58;
            if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
              tmpVar_58 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_cid);
            else 
              RunTime("Unknown record field selector");
            reselem_40.SetField(4, tmpVar_58);
          }
          res_l_29.ImpAppend(reselem_40);
        }
      }
      vdm_EXP_uPAT_new_uldefs = res_l_29;
    }
    Record tmpVal_62(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    tmpVal_62 = vdm_EXP_uPAT_ExpandLocalDefList((Generic) vdm_EXP_uPAT_new_uldefs, (Generic) vdm_EXP_uPAT_new_uused_uids, (Generic) vdm_EXP_uPAT_cid);
    Sequence vdm_EXP_uPAT_exp_unew_uldefs;
    Set vdm_EXP_uPAT_rtn_uused_uids;
    succ_6 = true;
    if (tmpVal_62.IsRecord() && vdm_EXP_uPAT_Expand == tmpVal_62.GetTag()) {
      Sequence e_l_66;
      for (int i_67 = 1; i_67 <= tmpVal_62.Length(); i_67++) 
        e_l_66.ImpAppend(tmpVal_62.GetField(i_67));
      if (succ_6 = 2 == (Int) e_l_66.Length()) {
        vdm_EXP_uPAT_exp_unew_uldefs = (Generic) e_l_66.Hd();
        vdm_EXP_uPAT_rtn_uused_uids = (Generic) e_l_66[2];
      }
    }
    else 
      succ_6 = false;
    if (!succ_6) 
      RunTime("Pattern match did not succeed in value definition");
    varRes_5 = Record(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    Sequence tmpVar_68;
    Sequence var1_69;
    var1_69 = Sequence().ImpAppend(vdm_EXP_uPAT_new_uval);
    tmpVar_68.ImpConc(var1_69).ImpConc(vdm_EXP_uPAT_exp_unew_uldefs);
    varRes_5.SetField(1, tmpVar_68);
    varRes_5.SetField(2, vdm_EXP_uPAT_rtn_uused_uids);
  }
  return (Generic) varRes_5;
}
#endif

#ifndef DEF_EXP_uPAT_pre_ExpandSeqEnumPattern

Bool vdm_EXP_uPAT_pre_ExpandSeqEnumPattern(const TYPE_AS_ValueDef &vdm_EXP_uPAT_val, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used_uids, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Bool varRes_5;
  Record argTmp_6;
  if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
    argTmp_6 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
  else 
    RunTime("Unknown record field selector");
  if (argTmp_6.IsRecord()) 
    varRes_5 = vdm_AS_SeqEnumPattern == argTmp_6.GetTag();
  else 
    varRes_5 = false;
  return (Generic) varRes_5;
}
#endif

#ifndef DEF_EXP_uPAT_ExpandTuplePattern

TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandTuplePattern(const TYPE_AS_ValueDef &vdm_EXP_uPAT_val, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used_uids, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Record varRes_5(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
  {
    bool succ_6;
    Sequence vdm_EXP_uPAT_ids = vdm_TRF_uTAR_uEXPR_GetNewName((Generic) vdm_EXP_uPAT_used_uids);
    Set vdm_EXP_uPAT_new_uused_uids;
    Set var2_11;
    var2_11 = Set().Insert(vdm_EXP_uPAT_ids);
    vdm_EXP_uPAT_new_uused_uids = vdm_EXP_uPAT_used_uids;
    vdm_EXP_uPAT_new_uused_uids.ImpUnion(var2_11);
    Record vdm_EXP_uPAT_nm(vdm_AS_Name, length_AS_Name);
    vdm_EXP_uPAT_nm = Record(vdm_AS_Name, length_AS_Name);
    vdm_EXP_uPAT_nm.SetField(1, vdm_EXP_uPAT_ids);
    Int tmpVar_15;
    Record tmpRec_16;
    if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
      tmpRec_16 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
    else 
      RunTime("Unknown record field selector");
    if (((Record) tmpRec_16).Is(vdm_AS_TuplePattern)) 
      tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_TuplePattern_cid);
    else 
      if (((Record) tmpRec_16).Is(vdm_AS_SetUnionPattern)) 
        tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_SetUnionPattern_cid);
      else 
        if (((Record) tmpRec_16).Is(vdm_AS_SetEnumPattern)) 
          tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_SetEnumPattern_cid);
        else 
          if (((Record) tmpRec_16).Is(vdm_AS_SeqEnumPattern)) 
            tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_SeqEnumPattern_cid);
          else 
            if (((Record) tmpRec_16).Is(vdm_AS_SeqConcPattern)) 
              tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_SeqConcPattern_cid);
            else 
              if (((Record) tmpRec_16).Is(vdm_AS_RecordPattern)) 
                tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_RecordPattern_cid);
              else 
                if (((Record) tmpRec_16).Is(vdm_AS_PatternName)) 
                  tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_PatternName_cid);
                else 
                  if (((Record) tmpRec_16).Is(vdm_AS_MatchVal)) 
                    tmpVar_15 = ((Record) tmpRec_16).GetField(pos_AS_MatchVal_cid);
                  else 
                    RunTime("Unknown record field selector");
    vdm_EXP_uPAT_nm.SetField(2, tmpVar_15);
    Record vdm_EXP_uPAT_new_upat(vdm_AS_PatternName, length_AS_PatternName);
    vdm_EXP_uPAT_new_upat = Record(vdm_AS_PatternName, length_AS_PatternName);
    vdm_EXP_uPAT_new_upat.SetField(1, vdm_EXP_uPAT_nm);
    Int tmpVar_20;
    Record tmpRec_21;
    if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
      tmpRec_21 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
    else 
      RunTime("Unknown record field selector");
    if (((Record) tmpRec_21).Is(vdm_AS_TuplePattern)) 
      tmpVar_20 = ((Record) tmpRec_21).GetField(pos_AS_TuplePattern_cid);
    else 
      if (((Record) tmpRec_21).Is(vdm_AS_SetUnionPattern)) 
        tmpVar_20 = ((Record) tmpRec_21).GetField(pos_AS_SetUnionPattern_cid);
      else 
        if (((Record) tmpRec_21).Is(vdm_AS_SetEnumPattern)) 
          tmpVar_20 = ((Record) tmpRec_21).GetField(pos_AS_SetEnumPattern_cid);
        else 
          if (((Record) tmpRec_21).Is(vdm_AS_SeqEnumPattern)) 
            tmpVar_20 = ((Record) tmpRec_21).GetField(pos_AS_SeqEnumPattern_cid);
          else 
            if (((Record) tmpRec_21).Is(vdm_AS_SeqConcPattern)) 
              tmpVar_20 = ((Record) tmpRec_21).GetField(pos_AS_SeqConcPattern_cid);
            else 
              if (((Record) tmpRec_21).Is(vdm_AS_RecordPattern)) 
                tmpVar_20 = ((Record) tmpRec_21).GetField(pos_AS_RecordPattern_cid);
              else 
                if (((Record) tmpRec_21).Is(vdm_AS_PatternName)) 
                  tmpVar_20 = ((Record) tmpRec_21).GetField(pos_AS_PatternName_cid);
                else 
                  if (((Record) tmpRec_21).Is(vdm_AS_MatchVal)) 
                    tmpVar_20 = ((Record) tmpRec_21).GetField(pos_AS_MatchVal_cid);
                  else 
                    RunTime("Unknown record field selector");
    vdm_EXP_uPAT_new_upat.SetField(2, tmpVar_20);
    Record vdm_EXP_uPAT_new_uval(vdm_AS_ValueDef, length_AS_ValueDef);
    Record tmpRE_25 = vdm_EXP_uPAT_val;
    int mu_26;
    mu_26 = pos_AS_ValueDef_pat;
    tmpRE_25.SetField(mu_26, vdm_EXP_uPAT_new_upat);
    vdm_EXP_uPAT_new_uval = tmpRE_25;
    Record vdm_EXP_uPAT_tp_urep;
    Int par_29;
    Record tmpRec_30;
    if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
      tmpRec_30 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
    else 
      RunTime("Unknown record field selector");
    if (((Record) tmpRec_30).Is(vdm_AS_TuplePattern)) 
      par_29 = ((Record) tmpRec_30).GetField(pos_AS_TuplePattern_cid);
    else 
      if (((Record) tmpRec_30).Is(vdm_AS_SetUnionPattern)) 
        par_29 = ((Record) tmpRec_30).GetField(pos_AS_SetUnionPattern_cid);
      else 
        if (((Record) tmpRec_30).Is(vdm_AS_SetEnumPattern)) 
          par_29 = ((Record) tmpRec_30).GetField(pos_AS_SetEnumPattern_cid);
        else 
          if (((Record) tmpRec_30).Is(vdm_AS_SeqEnumPattern)) 
            par_29 = ((Record) tmpRec_30).GetField(pos_AS_SeqEnumPattern_cid);
          else 
            if (((Record) tmpRec_30).Is(vdm_AS_SeqConcPattern)) 
              par_29 = ((Record) tmpRec_30).GetField(pos_AS_SeqConcPattern_cid);
            else 
              if (((Record) tmpRec_30).Is(vdm_AS_RecordPattern)) 
                par_29 = ((Record) tmpRec_30).GetField(pos_AS_RecordPattern_cid);
              else 
                if (((Record) tmpRec_30).Is(vdm_AS_PatternName)) 
                  par_29 = ((Record) tmpRec_30).GetField(pos_AS_PatternName_cid);
                else 
                  if (((Record) tmpRec_30).Is(vdm_AS_MatchVal)) 
                    par_29 = ((Record) tmpRec_30).GetField(pos_AS_MatchVal_cid);
                  else 
                    RunTime("Unknown record field selector");
    vdm_EXP_uPAT_tp_urep = vdm_CI_GetTypeInfo((Generic) par_29);
    Record vdm_EXP_uPAT_tp;
    Int par_34;
    if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
      par_34 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_cid);
    else 
      RunTime("Unknown record field selector");
    vdm_EXP_uPAT_tp = vdm_REP2TYPE_TypeRepToType((Generic) vdm_EXP_uPAT_tp_urep, (Generic) par_34);
    Record vdm_EXP_uPAT_index_utp(vdm_AS_BasicType, length_AS_BasicType);
    vdm_EXP_uPAT_index_utp = Record(vdm_AS_BasicType, length_AS_BasicType);
    vdm_EXP_uPAT_index_utp.SetField(1, (Quote) "NATONE");
    vdm_EXP_uPAT_index_utp.SetField(2, vdm_CI_NilContextId);
    Record vdm_EXP_uPAT_tuple_utp(vdm_AS_ProductType, length_AS_ProductType);
    vdm_EXP_uPAT_tuple_utp = Record(vdm_AS_ProductType, length_AS_ProductType);
    Sequence tmpVar_40;
    tmpVar_40 = Sequence().ImpAppend(vdm_EXP_uPAT_tp);
    tmpVar_40.ImpAppend(vdm_EXP_uPAT_index_utp);
    vdm_EXP_uPAT_tuple_utp.SetField(1, tmpVar_40);
    vdm_EXP_uPAT_tuple_utp.SetField(2, vdm_CI_NilContextId);
    Record vdm_EXP_uPAT_index_upat(vdm_AS_PatternName, length_AS_PatternName);
    vdm_EXP_uPAT_index_upat = Record(vdm_AS_PatternName, length_AS_PatternName);
    Record tmpVar_45(vdm_AS_Name, length_AS_Name);
    tmpVar_45 = Record(vdm_AS_Name, length_AS_Name);
    Sequence tmpVar_46;
    tmpVar_46 = Sequence().ImpAppend(Sequence("i"));
    tmpVar_45.SetField(1, tmpVar_46);
    tmpVar_45.SetField(2, vdm_CI_NilContextId);
    vdm_EXP_uPAT_index_upat.SetField(1, tmpVar_45);
    vdm_EXP_uPAT_index_upat.SetField(2, vdm_CI_NilContextId);
    Record vdm_EXP_uPAT_entry_upat(vdm_AS_TuplePattern, length_AS_TuplePattern);
    vdm_EXP_uPAT_entry_upat = Record(vdm_AS_TuplePattern, length_AS_TuplePattern);
    Sequence tmpVar_51;
    {
      Sequence res_l_52;
      Set resBind_s_54;
      Sequence unArg_57;
      Record tmpRec_58;
      if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
        tmpRec_58 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
      else 
        RunTime("Unknown record field selector");
      if (((Record) tmpRec_58).Is(vdm_AS_TuplePattern)) 
        unArg_57 = ((Record) tmpRec_58).GetField(pos_AS_TuplePattern_fields);
      else 
        if (((Record) tmpRec_58).Is(vdm_AS_RecordPattern)) 
          unArg_57 = ((Record) tmpRec_58).GetField(pos_AS_RecordPattern_fields);
        else 
          RunTime("Unknown record field selector");
      Set riseq_60;      int max_61 = (Int) unArg_57.Length();      for (int i_62 = 1; i_62 <= max_61; i_62++) 
        riseq_60.Insert((Int) i_62);      resBind_s_54 = riseq_60;
      Sequence bind_l_53;
      if ((Int) resBind_s_54.Card() != (Int) 0) 
        bind_l_53 = Sort(resBind_s_54);
      bool succ_55 = true;
      Int vdm_EXP_uPAT_i;
      Generic tmpe_73;
      for (int i_72 = bind_l_53.First(tmpe_73); i_72; i_72 = bind_l_53.Next(tmpe_73)) {
        Int e_56 = tmpe_73;
        vdm_EXP_uPAT_i = e_56;
        if (succ_55) {
          Record reselem_63(vdm_AS_PatternName, length_AS_PatternName);
          reselem_63 = Record(vdm_AS_PatternName, length_AS_PatternName);
          Record tmpVar_64(vdm_AS_Name, length_AS_Name);
          tmpVar_64 = Record(vdm_AS_Name, length_AS_Name);
          Sequence tmpVar_65;
          Sequence e_seq_66;
          e_seq_66.ImpConc(Sequence("x")).ImpConc(vdm_TRF_uTAR_uEXPR_Nat2str((Generic) vdm_EXP_uPAT_i));
          tmpVar_65 = Sequence().ImpAppend(e_seq_66);
          tmpVar_64.SetField(1, tmpVar_65);
          tmpVar_64.SetField(2, vdm_CI_NilContextId);
          reselem_63.SetField(1, tmpVar_64);
          reselem_63.SetField(2, vdm_CI_NilContextId);
          res_l_52.ImpAppend(reselem_63);
        }
      }
      tmpVar_51 = res_l_52;
    }
    vdm_EXP_uPAT_entry_upat.SetField(1, tmpVar_51);
    vdm_EXP_uPAT_entry_upat.SetField(2, vdm_CI_NilContextId);
    Record vdm_EXP_uPAT_tuple_upat(vdm_AS_TuplePattern, length_AS_TuplePattern);
    vdm_EXP_uPAT_tuple_upat = Record(vdm_AS_TuplePattern, length_AS_TuplePattern);
    Sequence tmpVar_76;
    tmpVar_76 = Sequence().ImpAppend(vdm_EXP_uPAT_entry_upat);
    tmpVar_76.ImpAppend(vdm_EXP_uPAT_index_upat);
    vdm_EXP_uPAT_tuple_upat.SetField(1, tmpVar_76);
    vdm_EXP_uPAT_tuple_upat.SetField(2, vdm_CI_NilContextId);
    Record vdm_EXP_uPAT_tp_ubind(vdm_AS_TypeBind, length_AS_TypeBind);
    vdm_EXP_uPAT_tp_ubind = Record(vdm_AS_TypeBind, length_AS_TypeBind);
    vdm_EXP_uPAT_tp_ubind.SetField(1, vdm_EXP_uPAT_tuple_upat);
    vdm_EXP_uPAT_tp_ubind.SetField(2, vdm_EXP_uPAT_tuple_utp);
    vdm_EXP_uPAT_tp_ubind.SetField(3, vdm_CI_NilContextId);
    Sequence vdm_EXP_uPAT_new_uldefs;
    {
      Sequence res_l_85;
      Set resBind_s_87;
      Sequence unArg_90;
      Record tmpRec_91;
      if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
        tmpRec_91 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
      else 
        RunTime("Unknown record field selector");
      if (((Record) tmpRec_91).Is(vdm_AS_TuplePattern)) 
        unArg_90 = ((Record) tmpRec_91).GetField(pos_AS_TuplePattern_fields);
      else 
        if (((Record) tmpRec_91).Is(vdm_AS_RecordPattern)) 
          unArg_90 = ((Record) tmpRec_91).GetField(pos_AS_RecordPattern_fields);
        else 
          RunTime("Unknown record field selector");
      Set riseq_93;      int max_94 = (Int) unArg_90.Length();      for (int i_95 = 1; i_95 <= max_94; i_95++) 
        riseq_93.Insert((Int) i_95);      resBind_s_87 = riseq_93;
      Sequence bind_l_86;
      if ((Int) resBind_s_87.Card() != (Int) 0) 
        bind_l_86 = Sort(resBind_s_87);
      bool succ_88 = true;
      Int vdm_EXP_uPAT_i;
      Generic tmpe_136;
      for (int i_135 = bind_l_86.First(tmpe_136); i_135; i_135 = bind_l_86.Next(tmpe_136)) {
        Int e_89 = tmpe_136;
        vdm_EXP_uPAT_i = e_89;
        if (succ_88) {
          Record reselem_96(vdm_AS_ValueDef, length_AS_ValueDef);
          {
            Record vdm_EXP_uPAT_index(vdm_AS_RealLit, length_AS_RealLit);
            vdm_EXP_uPAT_index = Record(vdm_AS_RealLit, length_AS_RealLit);
            vdm_EXP_uPAT_index.SetField(1, vdm_EXP_uPAT_i);
            vdm_EXP_uPAT_index.SetField(2, vdm_CI_NilContextId);
            Record vdm_EXP_uPAT_pat;
            Sequence tmp_l_102;
            Record tmpRec_103;
            if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
              tmpRec_103 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
            else 
              RunTime("Unknown record field selector");
            if (((Record) tmpRec_103).Is(vdm_AS_TuplePattern)) 
              tmp_l_102 = ((Record) tmpRec_103).GetField(pos_AS_TuplePattern_fields);
            else 
              if (((Record) tmpRec_103).Is(vdm_AS_RecordPattern)) 
                tmp_l_102 = ((Record) tmpRec_103).GetField(pos_AS_RecordPattern_fields);
              else 
                RunTime("Unknown record field selector");
            vdm_EXP_uPAT_pat = (Record) tmp_l_102[vdm_EXP_uPAT_i.GetValue()];
            Record vdm_EXP_uPAT_body(vdm_AS_Name, length_AS_Name);
            vdm_EXP_uPAT_body = Record(vdm_AS_Name, length_AS_Name);
            Sequence tmpVar_107;
            Sequence e_seq_108;
            e_seq_108.ImpConc(Sequence("x")).ImpConc(vdm_TRF_uTAR_uEXPR_Nat2str((Generic) vdm_EXP_uPAT_i));
            tmpVar_107 = Sequence().ImpAppend(e_seq_108);
            vdm_EXP_uPAT_body.SetField(1, tmpVar_107);
            vdm_EXP_uPAT_body.SetField(2, vdm_CI_NilContextId);
            Record vdm_EXP_uPAT_proj(vdm_AS_BracketedExpr, length_AS_BracketedExpr);
            vdm_EXP_uPAT_proj = Record(vdm_AS_BracketedExpr, length_AS_BracketedExpr);
            Record tmpVar_114(vdm_AS_LambdaExpr, length_AS_LambdaExpr);
            tmpVar_114 = Record(vdm_AS_LambdaExpr, length_AS_LambdaExpr);
            Sequence tmpVar_115;
            tmpVar_115 = Sequence().ImpAppend(vdm_EXP_uPAT_tp_ubind);
            tmpVar_114.SetField(1, tmpVar_115);
            tmpVar_114.SetField(2, vdm_EXP_uPAT_body);
            tmpVar_114.SetField(3, vdm_CI_NilContextId);
            vdm_EXP_uPAT_proj.SetField(1, tmpVar_114);
            vdm_EXP_uPAT_proj.SetField(2, vdm_CI_NilContextId);
            Record vdm_EXP_uPAT_arg(vdm_AS_TupleConstructorExpr, length_AS_TupleConstructorExpr);
            vdm_EXP_uPAT_arg = Record(vdm_AS_TupleConstructorExpr, length_AS_TupleConstructorExpr);
            Sequence tmpVar_121;
            tmpVar_121 = Sequence().ImpAppend(vdm_EXP_uPAT_nm);
            tmpVar_121.ImpAppend(vdm_EXP_uPAT_index);
            vdm_EXP_uPAT_arg.SetField(1, tmpVar_121);
            vdm_EXP_uPAT_arg.SetField(2, vdm_CI_NilContextId);
            Record vdm_EXP_uPAT_expr(vdm_AS_ApplyExpr, length_AS_ApplyExpr);
            vdm_EXP_uPAT_expr = Record(vdm_AS_ApplyExpr, length_AS_ApplyExpr);
            vdm_EXP_uPAT_expr.SetField(1, vdm_EXP_uPAT_proj);
            Sequence tmpVar_127;
            tmpVar_127 = Sequence().ImpAppend(vdm_EXP_uPAT_arg);
            vdm_EXP_uPAT_expr.SetField(2, tmpVar_127);
            vdm_EXP_uPAT_expr.SetField(3, vdm_CI_NilContextId);
            reselem_96 = Record(vdm_AS_ValueDef, length_AS_ValueDef);
            reselem_96.SetField(1, vdm_EXP_uPAT_pat);
            reselem_96.SetField(2, Nil());
            reselem_96.SetField(3, vdm_EXP_uPAT_expr);
            Int tmpVar_133;
            if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
              tmpVar_133 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_cid);
            else 
              RunTime("Unknown record field selector");
            reselem_96.SetField(4, tmpVar_133);
          }
          res_l_85.ImpAppend(reselem_96);
        }
      }
      vdm_EXP_uPAT_new_uldefs = res_l_85;
    }
    Record tmpVal_137(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    tmpVal_137 = vdm_EXP_uPAT_ExpandLocalDefList((Generic) vdm_EXP_uPAT_new_uldefs, (Generic) vdm_EXP_uPAT_new_uused_uids, (Generic) vdm_EXP_uPAT_cid);
    Sequence vdm_EXP_uPAT_exp_unew_uldefs;
    Set vdm_EXP_uPAT_rtn_uused_uids;
    succ_6 = true;
    if (tmpVal_137.IsRecord() && vdm_EXP_uPAT_Expand == tmpVal_137.GetTag()) {
      Sequence e_l_141;
      for (int i_142 = 1; i_142 <= tmpVal_137.Length(); i_142++) 
        e_l_141.ImpAppend(tmpVal_137.GetField(i_142));
      if (succ_6 = 2 == (Int) e_l_141.Length()) {
        vdm_EXP_uPAT_exp_unew_uldefs = (Generic) e_l_141.Hd();
        vdm_EXP_uPAT_rtn_uused_uids = (Generic) e_l_141[2];
      }
    }
    else 
      succ_6 = false;
    if (!succ_6) 
      RunTime("Pattern match did not succeed in value definition");
    varRes_5 = Record(vdm_EXP_uPAT_Expand, length_EXP_uPAT_Expand);
    Sequence tmpVar_143;
    Sequence var1_144;
    var1_144 = Sequence().ImpAppend(vdm_EXP_uPAT_new_uval);
    tmpVar_143.ImpConc(var1_144).ImpConc(vdm_EXP_uPAT_exp_unew_uldefs);
    varRes_5.SetField(1, tmpVar_143);
    varRes_5.SetField(2, vdm_EXP_uPAT_rtn_uused_uids);
  }
  return (Generic) varRes_5;
}
#endif

#ifndef DEF_EXP_uPAT_pre_ExpandTuplePattern

Bool vdm_EXP_uPAT_pre_ExpandTuplePattern(const TYPE_AS_ValueDef &vdm_EXP_uPAT_val, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used_uids, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Bool varRes_5;
  Record argTmp_6;
  if (vdm_EXP_uPAT_val.Is(vdm_AS_ValueDef)) 
    argTmp_6 = vdm_EXP_uPAT_val.GetField(pos_AS_ValueDef_pat);
  else 
    RunTime("Unknown record field selector");
  if (argTmp_6.IsRecord()) 
    varRes_5 = vdm_AS_TuplePattern == argTmp_6.GetTag();
  else 
    varRes_5 = false;
  return (Generic) varRes_5;
}
#endif

#ifndef DEF_EXP_uPAT_ExpandValueDef

TYPE_EXP_uPAT_Expand vdm_EXP_uPAT_ExpandValueDef(const TYPE_AS_ValueDef &vdm_EXP_uPAT_ldef, const TYPE_TRF_uTAR_uEXPR_Identifiers &vdm_EXP_uPAT_used, const TYPE_CI_ContextId &vdm_EXP_uPAT_cid) {
  Generic varRes_5;
  Record selRes_7;
  if (vdm_EXP_uPAT_ldef.Is(vdm_AS_ValueDef)) 
    selRes_7 = vdm_EXP_uPAT_ldef.GetField(pos_AS_ValueDef_pat);
  else 
    RunTime("Unknown record field selector");
  bool succ_6 = true;
  {
    succ_6 = true;
    if (selRes_7.IsRecord() && vdm_AS_PatternName == ((Record) selRes_7).GetTag()) {
      Sequence e_l_10;
      for (int i_11 = 1; i_11 <= ((Record) selRes_7).Length(); i_11++) 
        e_l_10.ImpAppend(((Record) selRes_7).GetField(i_11));
      if (succ_6 = 2 == (Int) e_l_10.Length()) {}
    }
    else 
      succ_6 = false;
    if (succ_6) 
      varRes_5 = vdm_EXP_uPAT_ExpandPatternName((Generic) vdm_EXP_uPAT_ldef, (Generic) vdm_EXP_uPAT_used, (Generic) vdm_EXP_uPAT_cid);
  }
  if (!succ_6) {
    succ_6 = true;
    if (selRes_7.IsRecord() && vdm_AS_MatchVal == ((Record) selRes_7).GetTag()) {
      Sequence e_l_15;
      for (int i_16 = 1; i_16 <= ((Record) selRes_7).Length(); i_16++) 
        e_l_15.ImpAppend(((Record) selRes_7).GetField(i_16));
      if (succ_6 = 2 == (Int) e_l_15.Length()) {}
    }
    else 
      succ_6 = false;
    if (succ_6) 
      varRes_5 = vdm_EXP_uPAT_ExpandMatchVal((Generic) vdm_EXP_uPAT_ldef, (Generic) vdm_EXP_uPAT_used, (Generic) vdm_EXP_uPAT_cid);
  }
  if (!succ_6) {
    succ_6 = true;
    if (selRes_7.IsRecord() && vdm_AS_SetEnumPattern == ((Record) selRes_7).GetTag()) {
      Sequence e_l_20;
      for (int i_21 = 1; i_21 <= ((Record) selRes_7).Length(); i_21++) 
        e_l_20.ImpAppend(((Record) selRes_7).GetField(i_21));
      if (succ_6 = 2 == (Int) e_l_20.Length()) {}
    }
    else 
      succ_6 = false;
    if (succ_6) 
      RunTime("Can not evaluate an undefined expression");
  }
  if (!succ_6) {
    succ_6 = true;
    if (selRes_7.IsRecord() && vdm_AS_SetUnionPattern == ((Record) selRes_7).GetTag()) {
      Sequence e_l_22;
      for (int i_23 = 1; i_23 <= ((Record) selRes_7).Length(); i_23++) 
        e_l_22.ImpAppend(((Record) selRes_7).GetField(i_23));
      if (succ_6 = 3 == (Int) e_l_22.Length()) {}
    }
    else 
      succ_6 = false;
    if (succ_6) 
      RunTime("Can not evaluate an undefined expression");
  }
  if (!succ_6) {
    succ_6 = true;
    if (selRes_7.IsRecord() && vdm_AS_SeqEnumPattern == ((Record) selRes_7).GetTag()) {
      Sequence e_l_24;
      for (int i_25 = 1; i_25 <= ((Record) selRes_7).Length(); i_25++) 
        e_l_24.ImpAppend(((Record) selRes_7).GetField(i_25));
      if (succ_6 = 2 == (Int) e_l_24.Length()) {}
    }
    else 
      succ_6 = false;
    if (succ_6) 
      varRes_5 = vdm_EXP_uPAT_ExpandSeqEnumPattern((Generic) vdm_EXP_uPAT_ldef, (Generic) vdm_EXP_uPAT_used, (Generic) vdm_EXP_uPAT_cid);
  }
  if (!succ_6) {
    succ_6 = true;
    if (selRes_7.IsRecord() && vdm_AS_SeqConcPattern == ((Record) selRes_7).GetTag()) {
      Sequence e_l_29;
      for (int i_30 = 1; i_30 <= ((Record) selRes_7).Length(); i_30++) 
        e_l_29.ImpAppend(((Record) selRes_7).GetField(i_30));
      if (succ_6 = 3 == (Int) e_l_29.Length()) {}
    }
    else 
      succ_6 = false;
    if (succ_6) 
      RunTime("Can not evaluate an undefined expression");
  }
  if (!succ_6) {
    succ_6 = true;
    if (selRes_7.IsRecord() && vdm_AS_RecordPattern == ((Record) selRes_7).GetTag()) {
      Sequence e_l_31;
      for (int i_32 = 1; i_32 <= ((Record) selRes_7).Length(); i_32++) 
        e_l_31.ImpAppend(((Record) selRes_7).GetField(i_32));
      if (succ_6 = 3 == (Int) e_l_31.Length()) {}
    }
    else 
      succ_6 = false;
    if (succ_6) 
      varRes_5 = vdm_EXP_uPAT_ExpandRecordPattern((Generic) vdm_EXP_uPAT_ldef, (Generic) vdm_EXP_uPAT_used, (Generic) vdm_EXP_uPAT_cid);
  }
  if (!succ_6) {
    succ_6 = true;
    if (selRes_7.IsRecord() && vdm_AS_TuplePattern == ((Record) selRes_7).GetTag()) {
      Sequence e_l_36;
      for (int i_37 = 1; i_37 <= ((Record) selRes_7).Length(); i_37++) 
        e_l_36.ImpAppend(((Record) selRes_7).GetField(i_37));
      if (succ_6 = 2 == (Int) e_l_36.Length()) {}
    }
    else 
      succ_6 = false;
    if (succ_6) 
      varRes_5 = vdm_EXP_uPAT_ExpandTuplePattern((Generic) vdm_EXP_uPAT_ldef, (Generic) vdm_EXP_uPAT_used, (Generic) vdm_EXP_uPAT_cid);
  }
  if (!succ_6) 
    RunTime("Can not evaluate an undefined expression");
  return (Generic) varRes_5;
}
#endif

